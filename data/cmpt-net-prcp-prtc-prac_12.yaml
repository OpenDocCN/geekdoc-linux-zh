- en: Datalink layer technologies#
  id: totrans-0
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 数据链路层技术#
- en: 原文：[https://4ed.computer-networking.info/syllabus/default/networks/lan.html](https://4ed.computer-networking.info/syllabus/default/networks/lan.html)
  id: totrans-1
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
  zh: '[https://4ed.computer-networking.info/syllabus/default/networks/lan.html](https://4ed.computer-networking.info/syllabus/default/networks/lan.html)'
- en: In this chapter, we review the key characteristics of several datalink layer
    technologies. We discuss in more detail the technologies that are widely used
    today. A detailed survey of all datalink layer technologies would be outside the
    scope of this book.
  id: totrans-2
  prefs: []
  type: TYPE_NORMAL
  zh: 在本章中，我们回顾了几种数据链路层技术的关键特性。我们更详细地讨论了今天广泛使用的这些技术。对所有数据链路层技术进行详细调查超出了本书的范围。
- en: '## The Point-to-Point Protocol[#](#the-point-to-point-protocol "Link to this
    heading")'
  id: totrans-3
  prefs: []
  type: TYPE_NORMAL
  zh: '## 点对点协议[#](#the-point-to-point-protocol "链接到这个标题")'
- en: Many point-to-point datalink layers [[1]](#flapb) have been developed, starting
    in the 1960s. In this section, we focus on the protocols that are often used to
    transport IP packets between hosts or routers that are directly connected by a
    point-to-point link. This link can be a dedicated physical cable, a leased line
    through the telephone network or a dial-up connection with modems on the two communicating
    hosts.
  id: totrans-4
  prefs: []
  type: TYPE_NORMAL
  zh: 从20世纪60年代开始，已经开发了多种点对点数据链路层[[1]](#flapb)。在本节中，我们专注于通常用于在通过点对点链路直接连接的主机或路由器之间传输IP数据包的协议。这种链路可以是一条专用物理电缆，通过电话网络租用的线路，或者两个通信主机上的调制解调器之间的拨号连接。
- en: 'The first solution to transport IP packets over a serial line was proposed
    in [**RFC 1055**](https://datatracker.ietf.org/doc/html/rfc1055.html) and is known
    as Serial Line IP (SLIP). SLIP is a simple character stuffing technique applied
    to IP packets. SLIP defines two special characters : END (decimal 192) and ESC
    (decimal 219). END appears at the beginning and at the end of each transmitted
    IP packet and the sender adds ESC before each END character inside each transmitted
    IP packet. SLIP only supports the transmission of IP packets and it assumes that
    the two communicating hosts/routers have been manually configured with each other’s
    IP address. SLIP was mainly used over links offering bandwidth of often less than
    20 Kbps. On such a low bandwidth link, sending 20 bytes of IP header followed
    by 20 bytes of TCP header for each TCP segment takes a lot of time. This initiated
    the development of a family of compression techniques to efficiently compress
    the TCP/IP headers. The first header compression technique proposed in [**RFC
    1144**](https://datatracker.ietf.org/doc/html/rfc1144.html) was designed to exploit
    the redundancy between several consecutive segments that belong to the same TCP
    connection. In all these segments, the IP addresses and port numbers are always
    the same. Furthermore, fields such as the sequence and acknowledgment numbers
    do not change in a random way. [**RFC 1144**](https://datatracker.ietf.org/doc/html/rfc1144.html)
    defined simple techniques to reduce the redundancy found in successive segments.
    The development of header compression techniques continued and there are still
    improvements being developed now [**RFC 5795**](https://datatracker.ietf.org/doc/html/rfc5795.html).'
  id: totrans-5
  prefs: []
  type: TYPE_NORMAL
  zh: 在[**RFC 1055**](https://datatracker.ietf.org/doc/html/rfc1055.html)中首次提出了在串行线路上传输IP数据包的解决方案，被称为串行线路IP（SLIP）。SLIP是对IP数据包应用的一种简单的字符填充技术。SLIP定义了两个特殊字符：END（十进制192）和ESC（十进制219）。END出现在每个传输的IP数据包的开始和结束处，发送者在每个传输的IP数据包中的每个END字符之前添加ESC。SLIP仅支持IP数据包的传输，并假设两个通信的主机/路由器已经手动配置了彼此的IP地址。SLIP主要在带宽通常小于20
    Kbps的链路上使用。在这样的低带宽链路上，为每个TCP段发送20字节的IP头部，然后是20字节的TCP头部，需要花费很多时间。这促使开发了一系列压缩技术，以有效地压缩TCP/IP头部。在[**RFC
    1144**](https://datatracker.ietf.org/doc/html/rfc1144.html)中提出的第一个头部压缩技术旨在利用属于同一TCP连接的几个连续段之间的冗余。在这些所有段中，IP地址和端口号始终相同。此外，如序列号和确认号等字段不会以随机方式改变。[**RFC
    1144**](https://datatracker.ietf.org/doc/html/rfc1144.html)定义了简单的技术来减少连续段中发现的冗余。头部压缩技术的发展仍在继续，现在仍在开发改进技术[**RFC
    5795**](https://datatracker.ietf.org/doc/html/rfc5795.html)。
- en: 'While SLIP was implemented and used in some environments, it had several limitations
    discussed in [**RFC 1055**](https://datatracker.ietf.org/doc/html/rfc1055.html).
    The Point-to-Point Protocol (PPP) was designed shortly after and is specified
    in [**RFC 1548**](https://datatracker.ietf.org/doc/html/rfc1548.html). PPP aims
    to support IP and other network layer protocols over various types of serial lines.
    PPP is in fact a family of three protocols that are used together :'
  id: totrans-6
  prefs: []
  type: TYPE_NORMAL
  zh: 虽然SLIP在一些环境中得到了实现和使用，但它存在一些限制，这些限制在[**RFC 1055**](https://datatracker.ietf.org/doc/html/rfc1055.html)中进行了讨论。点对点协议（PPP）在之后不久被设计出来，并在[**RFC
    1548**](https://datatracker.ietf.org/doc/html/rfc1548.html)中进行了规范。PPP旨在支持IP和其他网络层协议通过各种类型的串行线路。PPP实际上是一组三个协议，它们一起使用：
- en: The Point-to-Point Protocol defines the framing technique to transport network
    layer packets.
  id: totrans-7
  prefs:
  - PREF_BQ
  - PREF_OL
  type: TYPE_NORMAL
  zh: 点对点协议定义了用于传输网络层数据包的帧技术。
- en: ''
  id: totrans-8
  prefs:
  - PREF_BQ
  - PREF_IND
  type: TYPE_NORMAL
- en: ''
  id: totrans-9
  prefs:
  - PREF_BQ
  - PREF_IND
  type: TYPE_NORMAL
- en: The Link Control Protocol that is used to negotiate options and authenticate
    the session by using username and password or other types of credentials
  id: totrans-10
  prefs:
  - PREF_BQ
  - PREF_OL
  type: TYPE_NORMAL
  zh: 链路控制协议，用于通过使用用户名和密码或其他类型的凭证协商选项并验证会话
- en: ''
  id: totrans-11
  prefs:
  - PREF_BQ
  - PREF_IND
  type: TYPE_NORMAL
- en: ''
  id: totrans-12
  prefs:
  - PREF_BQ
  - PREF_IND
  type: TYPE_NORMAL
- en: The Network Control Protocol that is specific for each network layer protocol.
    It is used to negotiate options that are specific for each protocol. For example,
    IPv4’s NCP [**RFC 1548**](https://datatracker.ietf.org/doc/html/rfc1548.html)
    can negotiate the IPv4 address to be used, the IPv4 address of the DNS resolver.
    IPv6’s NCP is defined in [**RFC 5072**](https://datatracker.ietf.org/doc/html/rfc5072.html).
  id: totrans-13
  prefs:
  - PREF_BQ
  - PREF_OL
  type: TYPE_NORMAL
  zh: 网络控制协议，针对每个网络层协议特定。它用于协商每个协议特定的选项。例如，IPv4的NCP [**RFC 1548**](https://datatracker.ietf.org/doc/html/rfc1548.html)可以协商要使用的IPv4地址，DNS解析器的IPv4地址。IPv6的NCP在[**RFC
    5072**](https://datatracker.ietf.org/doc/html/rfc5072.html)中定义。
- en: The PPP framing [**RFC 1662**](https://datatracker.ietf.org/doc/html/rfc1662.html)
    was inspired by the datalink layer protocols standardized by ITU-T and ISO. A
    typical PPP frame is composed of the fields shown in the figure below. A PPP frame
    starts with a one byte flag containing 01111110. PPP can use bit stuffing or character
    stuffing depending on the environment where the protocol is used. The address
    and control fields are present for backward compatibility reasons. The 16 bit
    Protocol field contains the identifier [[2]](#fpppid) of the network layer protocol
    that is carried in the PPP frame. 0x002d is used for an IPv4 packet compressed
    with [**RFC 1144**](https://datatracker.ietf.org/doc/html/rfc1144.html) while
    0x002f is used for an uncompressed IPv4 packet. 0xc021 is used by the Link Control
    Protocol, 0xc023 is used by the Password Authentication Protocol (PAP). 0x0057
    is used for IPv6 packets. PPP supports variable length packets, but LCP can negotiate
    a maximum packet length. The PPP frame ends with a Frame Check Sequence. The default
    is a 16 bits CRC, but some implementations can negotiate a 32 bits CRC. The frame
    ends with the 01111110 flag.
  id: totrans-14
  prefs: []
  type: TYPE_NORMAL
  zh: PPP帧格式[**RFC 1662**](https://datatracker.ietf.org/doc/html/rfc1662.html)受到了ITU-T和ISO标准化的数据链路层协议的启发。一个典型的PPP帧由下面图中显示的字段组成。PPP帧以一个包含01111110的一个字节标志开始。PPP可以根据协议使用的环境使用位填充或字符填充。地址和控制字段的存在是为了向后兼容。16位的协议字段包含承载在PPP帧中的网络层协议的标识符
    [[2]](#fpppid)。0x002d用于使用[**RFC 1144**](https://datatracker.ietf.org/doc/html/rfc1144.html)压缩的IPv4数据包，而0x002f用于未压缩的IPv4数据包。0xc021由链路控制协议使用，0xc023由密码认证协议（PAP）使用。0x0057用于IPv6数据包。PPP支持可变长度的数据包，但LCP可以协商最大数据包长度。PPP帧以帧校验序列结束。默认是16位CRC，但某些实现可以协商32位CRC。帧以01111110标志结束。
- en: '[![../_images/ppp.svg](../Images/49b08aa9821170a5792f0c343aa273c5.png)](../_images/ppp.svg)'
  id: totrans-15
  prefs: []
  type: TYPE_NORMAL
  zh: '![../_images/ppp.svg](../Images/49b08aa9821170a5792f0c343aa273c5.png)'
- en: Fig. 166 PPP frame format[#](#id186 "Link to this image")
  id: totrans-16
  prefs: []
  type: TYPE_NORMAL
  zh: 图. 166 PPP帧格式[#](#id186 "链接到这张图片")
- en: PPP played a key role in allowing Internet Service Providers to provide dial-up
    access over modems in the late 1990s and early 2000s. ISPs operated modem banks
    connected to the telephone network. For these ISPs, a key issue was to authenticate
    each user connected through the telephone network. This authentication was performed
    by using the Extensible Authentication Protocol (EAP) defined in [**RFC 3748**](https://datatracker.ietf.org/doc/html/rfc3748.html).
    EAP is a simple, but extensible protocol that was initially used by access routers
    to authenticate the users connected through dial-up lines. Several authentication
    methods, starting from the simple username/password pairs to more complex schemes
    have been defined and implemented. When ISPs started to upgrade their physical
    infrastructure to provide Internet access over Asymmetric Digital Subscriber Lines
    (ADSL), they tried to reuse their existing authentication (and billing) systems.
    To meet these requirements, the IETF developed specifications to allow PPP frames
    to be transported over other networks than the point-to-point links for which
    PPP was designed. Nowadays, most ADSL deployments use PPP over either ATM [**RFC
    2364**](https://datatracker.ietf.org/doc/html/rfc2364.html) or Ethernet [**RFC
    2516**](https://datatracker.ietf.org/doc/html/rfc2516.html).
  id: totrans-17
  prefs: []
  type: TYPE_NORMAL
  zh: PPP在1990年代末和2000年代初允许互联网服务提供商通过调制解调器提供拨号访问中发挥了关键作用。这些互联网服务提供商运营着连接到电话网络的调制解调器银行。对于这些互联网服务提供商来说，一个关键问题是验证通过电话网络连接的每个用户。这种验证是通过使用在[**RFC
    3748**](https://datatracker.ietf.org/doc/html/rfc3748.html)中定义的可扩展认证协议（EAP）来完成的。EAP是一个简单但可扩展的协议，最初被接入路由器用于验证通过拨号线路连接的用户。已经定义并实现了多种认证方法，从简单的用户名/密码对到更复杂的方案。当互联网服务提供商开始升级其物理基础设施以通过非对称数字用户线（ADSL）提供互联网访问时，他们试图重用他们现有的认证（和计费）系统。为了满足这些要求，IETF开发了规范，允许PPP帧在PPP最初设计的点对点链路之外的其他网络上传输。如今，大多数ADSL部署都使用PPP在ATM
    [**RFC 2364**](https://datatracker.ietf.org/doc/html/rfc2364.html)或以太网 [**RFC
    2516**](https://datatracker.ietf.org/doc/html/rfc2516.html)上传输。
- en: 'Footnotes  ## Ethernet[#](#ethernet "Link to this heading")'
  id: totrans-18
  prefs: []
  type: TYPE_NORMAL
  zh: '脚注  ## 以太网[#](#ethernet "链接到这个标题")'
- en: Ethernet was designed in the 1970s at the Palo Alto Research Center [[Metcalfe1976]](../bibliography.html#metcalfe1976).
    The first prototype [[3]](#fethernethistory) used a coaxial cable as the shared
    medium and 3 Mbps of bandwidth. Ethernet was improved during the late 1970s and
    in the 1980s, Digital Equipment, Intel and Xerox published the first official
    Ethernet specification [[DIX]](../bibliography.html#dix). This specification defines
    several important parameters for Ethernet networks. The first decision was to
    standardize the commercial Ethernet at 10 Mbps. The second decision was the duration
    of the slot time. In Ethernet, a long slot time enables networks to span a long
    distance but forces the host to use a larger minimum frame size. The compromise
    was a slot time of 51.2 microseconds, which corresponds to a minimum frame size
    of 64 bytes.
  id: totrans-19
  prefs: []
  type: TYPE_NORMAL
  zh: 以太网是在20世纪70年代在帕洛阿托研究中心设计的 [[Metcalfe1976]](../bibliography.html#metcalfe1976)。第一个原型
    [[3]](#fethernethistory) 使用同轴电缆作为共享介质，带宽为3 Mbps。以太网在20世纪70年代末和80年代得到了改进，数字设备公司、英特尔和施乐发布了第一个官方以太网规范
    [[DIX]](../bibliography.html#dix)。该规范定义了以太网网络的一些重要参数。第一个决定是将商业以太网标准化为10 Mbps。第二个决定是时隙的持续时间。在以太网中，较长的时隙可以使网络跨越更长的距离，但迫使主机使用更大的最小帧大小。妥协方案是时隙为51.2微秒，对应的最小帧大小为64字节。
- en: The third decision was the frame format. The experimental 3 Mbps Ethernet network
    built at Xerox used short frames containing 8 bit source and destination addresses
    fields, a 16 bit type indication, up to 554 bytes of payload and a 16 bit CRC.
    Using 8 bit addresses was suitable for an experimental network, but it was clearly
    too small for commercial deployments. Although the initial Ethernet specification
    [[DIX]](../bibliography.html#dix) only allowed up to 1024 hosts on an Ethernet
    network, it also recommended three important changes compared to the networking
    technologies that were available at that time. The first change was to require
    each host attached to an Ethernet network to have a globally unique datalink layer
    address. Until then, datalink layer addresses were manually configured on each
    host. [[DP1981]](../bibliography.html#dp1981) went against that state of the art
    and noted “Suitable installation-specific administrative procedures are also needed
    for assigning numbers to hosts on a network. If a host is moved from one network
    to another it may be necessary to change its host number if its former number
    is in use on the new network. This is easier said than done, as each network must
    have an administrator who must record the continuously changing state of the system
    (often on a piece of paper tacked to the wall !). It is anticipated that in future
    office environments, hosts locations will change as often as telephones are changed
    in present-day offices.” The second change introduced by Ethernet was to encode
    each address as a 48 bits field [[DP1981]](../bibliography.html#dp1981). 48 bit
    addresses were huge compared to the networking technologies available in the 1980s,
    but the huge address space had several advantages [[DP1981]](../bibliography.html#dp1981)
    including the ability to allocate large blocks of addresses to manufacturers.
    Eventually, other LAN technologies opted for 48 bits addresses as well [[IEEE802]](../bibliography.html#ieee802)
    . The third change introduced by Ethernet was the definition of broadcast and
    multicast addresses. The need for multicast Ethernet was foreseen in [[DP1981]](../bibliography.html#dp1981)
    and thanks to the size of the addressing space it was possible to reserve a large
    block of multicast addresses for each manufacturer.
  id: totrans-20
  prefs: []
  type: TYPE_NORMAL
  zh: 第三项决定是帧格式。施乐公司建立的实验性3 Mbps以太网网络使用了包含8位源和目的地址字段、16位类型指示、最多554字节的负载和16位CRC的短帧。使用8位地址适合于实验网络，但显然对于商业部署来说太小了。尽管最初的以太网规范[[DIX]](../bibliography.html#dix)只允许以太网网络上有最多1024个主机，但它也对比当时可用的网络技术提出了三个重要变更。第一个变更要求连接到以太网网络的每个主机都必须有一个全局唯一的链路层地址。在此之前，链路层地址是在每个主机上手动配置的。[[DP1981]](../bibliography.html#dp1981)反对这种做法，并指出“为网络上的主机分配数字也需要适当的安装特定管理程序。如果主机从一个网络移动到另一个网络，如果其旧数字在新网络上已被使用，则可能需要更改其主机号。这比说起来容易，因为每个网络都必须有一个管理员，必须记录系统不断变化的状态（通常是一张贴在墙上的纸
    !）。预计在未来办公室环境中，主机位置的变化将像现在办公室中电话的变化一样频繁。”以太网引入的第二个变更是将每个地址编码为48位字段[[DP1981]](../bibliography.html#dp1981)。与20世纪80年代的现有网络技术相比，48位地址非常大，但巨大的地址空间有几个优点[[DP1981]](../bibliography.html#dp1981)，包括能够将大块地址分配给制造商。最终，其他局域网技术也选择了48位地址[[IEEE802]](../bibliography.html#ieee802)。以太网引入的第三个变更是对广播和多播地址的定义。在[[DP1981]](../bibliography.html#dp1981)中预见到了多播以太网的需求，并且由于地址空间的大小，可以为每个制造商预留一大块多播地址。
- en: The datalink layer addresses used in Ethernet networks are often called MAC
    addresses. They are structured as shown in figure [Fig. 167](#fig-ethernet-add-format).
    The first bit of the address indicates whether the address identifies a network
    adapter or a multicast group. The upper 24 bits are used to encode an Organization
    Unique Identifier (OUI). This OUI identifies a block of addresses that has been
    allocated by the secretariat [[4]](#foui) that is responsible for the uniqueness
    of Ethernet addresses to a manufacturer. Once a manufacturer has received an OUI,
    it can build and sell products with one of the 16 million addresses in this block.
  id: totrans-21
  prefs: []
  type: TYPE_NORMAL
  zh: 在以太网网络中使用的数据链路层地址通常被称为MAC地址。它们的结构如图[图167](#fig-ethernet-add-format)所示。地址的第一位表示该地址是否标识一个网络适配器或一个多播组。高24位用于编码一个组织唯一标识符（OUI）。这个OUI标识了一个由负责以太网地址唯一性的秘书处[[4]](#foui)分配的地址块。一旦制造商收到一个OUI，它就可以构建并销售该块中1600万个地址之一的产品。
- en: '![Figure made with TikZ](../Images/f3897860be3ce498f407c1420b6944b8.png)'
  id: totrans-22
  prefs:
  - PREF_BQ
  type: TYPE_IMG
  zh: '![使用 TikZ 制作的图](../Images/f3897860be3ce498f407c1420b6944b8.png)'
- en: ''
  id: totrans-23
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: Fig. 167 48 bits Ethernet address format
  id: totrans-24
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
  zh: 图 167 48 位以太网地址格式
- en: The original 10 Mbps Ethernet specification [[DIX]](../bibliography.html#dix)
    defined a simple frame format where each frame is composed of five fields. The
    Ethernet frame starts with a preamble (not shown in figure [Fig. 169](#fig-ethernet-dix))
    that is used by the physical layer of the receiver to synchronize its clock with
    the sender’s clock. The first field of the frame is the destination address. As
    this address is placed at the beginning of the frame, an Ethernet interface can
    quickly verify whether it is the frame recipient and if not, cancel the processing
    of the arriving frame. The second field is the source address. While the destination
    address can be either a unicast or a multicast/broadcast address, the source address
    must always be a unicast address. The third field is a 16 bits integer that indicates
    which type of network layer packet is carried inside the frame. This field is
    often called the EtherType. Frequently used EtherType values [[5]](#fethertype)
    include 0x0800 for IPv4, 0x86DD for IPv6 [[6]](#fipv6ether) and 0x806 for the
    Address Resolution Protocol (ARP).
  id: totrans-25
  prefs: []
  type: TYPE_NORMAL
  zh: 原始的 10 Mbps 以太网规范 [[DIX]](../bibliography.html#dix) 定义了一种简单的帧格式，其中每个帧由五个字段组成。以太网帧以预同步（在图
    [图 169](#fig-ethernet-dix) 中未显示）开始，该预同步由接收器的物理层用于与发送器的时钟同步。帧的第一个字段是目标地址。由于此地址位于帧的开头，以太网接口可以快速验证它是否是帧的接收者，如果不是，则取消处理到达的帧。第二个字段是源地址。虽然目标地址可以是单播或组播/广播地址，但源地址必须是单播地址。第三个字段是一个
    16 位整数，指示帧内携带哪种类型的网络层数据包。该字段通常称为 EtherType。常用的 EtherType 值 [[5]](#fethertype)
    包括 0x0800 用于 IPv4，0x86DD 用于 IPv6 [[6]](#fipv6ether) 和 0x806 用于地址解析协议 (ARP)。
- en: The fourth part of the Ethernet frame is the payload. The minimum length of
    the payload is 46 bytes to ensure a minimum frame size, including the header of
    512 bits. The Ethernet payload cannot be longer than 1500 bytes. This size was
    found reasonable when the first Ethernet specification was written. At that time,
    Xerox had been using its experimental 3 Mbps Ethernet that offered 554 bytes of
    payload and [**RFC 1122**](https://datatracker.ietf.org/doc/html/rfc1122.html)
    required a minimum MTU of 572 bytes for IPv4\. 1500 bytes was large enough to
    support these needs without forcing the network adapters to contain overly large
    memories. Furthermore, simulations and measurement studies performed in Ethernet
    networks revealed that CSMA/CD was able to achieve a very high utilization. This
    is illustrated in figure [Fig. 168](#fig-ethernet-utilization) based on [[SH1980]](../bibliography.html#sh1980),
    which shows the channel utilization achieved in Ethernet networks containing different
    numbers of hosts that are sending frames of different sizes.
  id: totrans-26
  prefs: []
  type: TYPE_NORMAL
  zh: 以太网帧的第四部分是有效载荷。有效载荷的最小长度为 46 字节，以确保最小帧大小，包括 512 位的头部。以太网有效载荷的长度不能超过 1500 字节。当首次编写以太网规范时，这个大小被认为是合理的。当时，施乐公司一直在使用其实验性的
    3 Mbps 以太网，提供 554 字节的有效载荷，而 [**RFC 1122**](https://datatracker.ietf.org/doc/html/rfc1122.html)
    要求 IPv4 的最小 MTU 为 572 字节。1500 字节足够大，可以满足这些需求，而不需要网络适配器包含过大的内存。此外，在以太网网络中进行的模拟和测量研究表明，CSMA/CD
    能够实现非常高的利用率。这如图 [图 168](#fig-ethernet-utilization) 所示，基于 [[SH1980]](../bibliography.html#sh1980)，它显示了包含不同数量主机且发送不同大小帧的以太网网络中实现的信道利用率。
- en: '[![../_images/ethernet-util.png](../Images/da4b08a7d46cd9d4962e244a40694091.png)](../_images/ethernet-util.png)'
  id: totrans-27
  prefs: []
  type: TYPE_NORMAL
  zh: '![以太网工具图](../Images/da4b08a7d46cd9d4962e244a40694091.png)(../_images/ethernet-util.png)'
- en: Fig. 168 Impact of the frame length on the maximum channel utilization [[SH1980]](../bibliography.html#sh1980)[#](#id188
    "Link to this image")
  id: totrans-28
  prefs: []
  type: TYPE_NORMAL
  zh: 图 168 帧长度对最大信道利用率的影响 [[SH1980]](../bibliography.html#sh1980)[#](#id188 "链接到这张图片")
- en: The last field of the Ethernet frame is a 32 bit Cyclical Redundancy Check (CRC).
    This CRC is able to catch a much larger number of transmission errors than the
    Internet checksum used by IP, UDP and TCP [[SGP98]](../bibliography.html#sgp98).
    The format of the Ethernet frame is shown in figure [Fig. 169](#fig-ethernet-dix)
    .
  id: totrans-29
  prefs: []
  type: TYPE_NORMAL
  zh: 以太网帧的最后一个字段是 32 位的循环冗余校验 (CRC)。这种 CRC 能够捕获比 IP、UDP 和 TCP 使用的互联网校验和更多的传输错误 [[SGP98]](../bibliography.html#sgp98)。以太网帧的格式如图
    [图 169](#fig-ethernet-dix) 所示。
- en: '[![../_images/ethernet-dix.svg](../Images/163da7add640c911c0e0db0efe6683b0.png)](../_images/ethernet-dix.svg)'
  id: totrans-30
  prefs: []
  type: TYPE_NORMAL
  zh: '![以太网 DIX 规范图](../Images/163da7add640c911c0e0db0efe6683b0.png)(../_images/ethernet-dix.svg)'
- en: Fig. 169 Ethernet DIX frame format[#](#fig-ethernet-dix "Link to this image")
  id: totrans-31
  prefs: []
  type: TYPE_NORMAL
  zh: 图 169 以太网 DIX 帧格式[#](#fig-ethernet-dix "链接到这张图片")
- en: Note
  id: totrans-32
  prefs: []
  type: TYPE_NORMAL
  zh: 注意
- en: Where should the CRC be located in a frame ?
  id: totrans-33
  prefs: []
  type: TYPE_NORMAL
  zh: 帧中的 CRC 应该放在哪里？
- en: The transport and datalink layers usually chose different strategies to place
    their CRCs or checksums. Transport layer protocols usually place their CRCs or
    checksums in the segment header. Datalink layer protocols sometimes place their
    CRC in the frame header, but often in a trailer at the end of the frame. This
    choice reflects implementation assumptions, but also influences performance [**RFC
    893**](https://datatracker.ietf.org/doc/html/rfc893.html). When the CRC is placed
    in the trailer, as in Ethernet, the datalink layer can compute it while transmitting
    the frame and insert it at the end of the transmission. All Ethernet interfaces
    use this optimization today. When the checksum is placed in the header, as in
    a TCP segment, it is impossible for the network interface to compute it while
    transmitting the segment. Some network interfaces provide hardware assistance
    to compute the TCP checksum, but this is more complex than if the TCP checksum
    were placed in the trailer [[7]](#ftso).
  id: totrans-34
  prefs: []
  type: TYPE_NORMAL
  zh: 传输层和数据链路层通常选择不同的策略来放置它们的 CRC 或校验和。传输层协议通常将它们的 CRC 或校验和放在段头中。数据链路层协议有时将 CRC 放在帧头中，但通常放在帧末尾的尾部。这种选择反映了实现假设，但也影响了性能
    [**RFC 893**](https://datatracker.ietf.org/doc/html/rfc893.html)。当 CRC 放在尾部时，如在以太网中，数据链路层可以在发送帧的同时计算它，并在传输结束时插入。今天所有以太网接口都使用这种优化。当校验和放在头部时，如在
    TCP 段中，网络接口在发送段时无法计算它。一些网络接口提供硬件辅助来计算 TCP 校验和，但这比如果 TCP 校验和放在尾部要复杂 [[7]](#ftso)。
- en: The Ethernet frame format discussed above is specified in [[DIX]](../bibliography.html#dix).
    This is the format used to send both IPv4 [**RFC 894**](https://datatracker.ietf.org/doc/html/rfc894.html)
    and IPv6 packets [**RFC 2464**](https://datatracker.ietf.org/doc/html/rfc2464.html).
    After the publication of [[DIX]](../bibliography.html#dix), the Institute of Electrical
    and Electronic Engineers (IEEE) began to standardize several Local Area Network
    technologies. IEEE worked on several LAN technologies, starting with Ethernet,
    Token Ring and Token Bus. These three technologies were completely different,
    but they all agreed to use the 48 bits MAC addresses specified initially for Ethernet
    [[IEEE802]](../bibliography.html#ieee802) . While developing its Ethernet standard
    [[IEEE802.3]](../bibliography.html#ieee802-3), the IEEE 802.3 working group was
    confronted with a problem. Ethernet mandated a minimum payload size of 46 bytes,
    while some companies were looking for a LAN technology that could transparently
    transport short frames containing only a few bytes of payload. Such a frame can
    be sent by an Ethernet host by padding it to ensure that the payload is at least
    46 bytes long. However since the Ethernet header [[DIX]](../bibliography.html#dix)
    does not contain a length field, it is impossible for the receiver to determine
    how many useful bytes were placed inside the payload field. To solve this problem,
    the IEEE decided to replace the Type field of the Ethernet [[DIX]](../bibliography.html#dix)
    header with a length field [[8]](#ftypelen). This Length field contains the number
    of useful bytes in the frame payload. The payload must still contain at least
    46 bytes, but padding bytes are added by the sender and removed by the receiver.
    In order to add the Length field without significantly changing the frame format,
    IEEE had to remove the Type field. Without this field, it is impossible for a
    receiving host to identify the type of network layer packet inside a received
    frame. To solve this new problem, IEEE developed a completely new sublayer called
    the Logical Link Control [[IEEE802.2]](../bibliography.html#ieee802-2). Several
    protocols were defined in this sublayer. One of them provided a slightly different
    version of the Type field of the original Ethernet frame format. Another contained
    acknowledgments and retransmissions to provide a reliable service… In practice,
    [[IEEE802.2]](../bibliography.html#ieee802-2) is never used to support IP in Ethernet
    networks. Figure [Fig. 170](#fig-ethernet-8023-frame) shows the official [[IEEE802.3]](../bibliography.html#ieee802-3)
    frame format.
  id: totrans-35
  prefs: []
  type: TYPE_NORMAL
  zh: 上文讨论的以太网帧格式由 [[DIX]](../bibliography.html#dix) 规定。这是用于发送 IPv4 [**RFC 894**](https://datatracker.ietf.org/doc/html/rfc894.html)
    和 IPv6 数据包 [**RFC 2464**](https://datatracker.ietf.org/doc/html/rfc2464.html)
    的格式。在 [[DIX]](../bibliography.html#dix) 发布后，电气和电子工程师协会 (IEEE) 开始标准化几种局域网技术。IEEE
    从以太网、令牌环和令牌总线等局域网技术开始工作。这三种技术完全不同，但它们都同意使用最初为以太网指定的 48 位 MAC 地址 [[IEEE802]](../bibliography.html#ieee802)。在开发其以太网标准
    [[IEEE802.3]](../bibliography.html#ieee802-3) 的过程中，IEEE 802.3 工作组面临了一个问题。以太网规定最小有效载荷大小为
    46 字节，而一些公司正在寻找一种能够透明地传输仅包含几个字节有效载荷的短帧的局域网技术。这样的帧可以通过以太网主机通过填充来发送，以确保有效载荷至少为 46
    字节长。然而，由于以太网头部 [[DIX]](../bibliography.html#dix) 中不包含长度字段，接收器无法确定有效载荷字段中放置了多少有用的字节。为了解决这个问题，IEEE
    决定用长度字段替换以太网 [[DIX]](../bibliography.html#dix) 头部的类型字段 [[8]](#ftypelen)。这个长度字段包含帧有效载荷中的有用字节数。有效载荷仍然必须包含至少
    46 字节，但填充字节由发送方添加并由接收方移除。为了在不显著改变帧格式的情况下添加长度字段，IEEE 必须移除类型字段。没有这个字段，接收主机无法识别接收帧中网络层数据包的类型。为了解决这个新问题，IEEE
    开发了一个全新的子层，称为逻辑链路控制 [[IEEE802.2]](../bibliography.html#ieee802-2)。在这个子层中定义了几个协议。其中之一提供了原始以太网帧格式类型字段的略微不同版本。另一个包含了确认和重传，以提供可靠的服务……在实践中，[[IEEE802.2]](../bibliography.html#ieee802-2)
    从未用于在以太网网络中支持 IP。图 [图 170](#fig-ethernet-8023-frame) 显示了官方 [[IEEE802.3]](../bibliography.html#ieee802-3)
    帧格式。
- en: '[![../_images/ethernet-8023.svg](../Images/79781bc50862d2a32133ea8cd17bc68b.png)](../_images/ethernet-8023.svg)'
  id: totrans-36
  prefs: []
  type: TYPE_NORMAL
  zh: '![![../_images/ethernet-8023.svg](../Images/79781bc50862d2a32133ea8cd17bc68b.png)](../_images/ethernet-8023.svg)'
- en: Fig. 170 Ethernet 802.3 frame format[#](#fig-ethernet-8023-frame "Link to this
    image")
  id: totrans-37
  prefs: []
  type: TYPE_NORMAL
  zh: 图 170 802.3 以太网帧格式[#](#fig-ethernet-8023-frame "链接到这张图片")
- en: Note
  id: totrans-38
  prefs: []
  type: TYPE_NORMAL
  zh: 注意
- en: What is the Ethernet service ?
  id: totrans-39
  prefs: []
  type: TYPE_NORMAL
  zh: 什么是以太网服务？
- en: 'An Ethernet network provides an unreliable connectionless service. It supports
    three different transmission modes : unicast, multicast and broadcast. While the
    Ethernet service is unreliable in theory, a good Ethernet network should, in practice,
    provide a service that:'
  id: totrans-40
  prefs: []
  type: TYPE_NORMAL
  zh: 以太网网络提供了一种不可靠的无连接服务。它支持三种不同的传输模式：单播、多播和广播。虽然以太网服务在理论上不可靠，但在实践中，一个好的以太网网络应该提供以下服务：
- en: delivers frames to their destination with a very high probability of successful
    delivery
  id: totrans-41
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 以非常高的概率将帧成功发送到目的地
- en: does not reorder the transmitted frames
  id: totrans-42
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 不重新排序传输的帧
- en: The first property is a consequence of the utilization of CSMA/CD. The second
    property is a consequence of the physical organization of the Ethernet network
    as a shared bus. These two properties are important and all revisions to the Ethernet
    technology have preserved them.
  id: totrans-43
  prefs: []
  type: TYPE_NORMAL
  zh: 第一个属性是CSMA/CD（载波侦听多路访问/碰撞检测）利用的结果。第二个属性是以太网网络作为共享总线物理组织的结果。这两个属性非常重要，并且所有对以太网技术的修订都保留了它们。
- en: Several physical layers have been defined for Ethernet networks. The first physical
    layer, usually called 10Base5, provided 10 Mbps over a thick coaxial cable. The
    characteristics of the cable and the transceivers that were used then enabled
    the utilization of 500 meter long segments. A 10Base5 network can also include
    repeaters between segments.
  id: totrans-44
  prefs: []
  type: TYPE_NORMAL
  zh: 已经为以太网网络定义了几个物理层。第一个物理层通常称为10Base5，通过粗同轴电缆提供10 Mbps的传输速率。当时使用的电缆和收发器的特性使得500米长的段可以被利用。10Base5网络还可以在段之间包含中继器。
- en: The second physical layer was 10Base2\. This physical layer used a thin coaxial
    cable that was easier to install than the 10Base5 cable, but could not be longer
    than 185 meters. A 10BaseF physical layer was also defined to transport Ethernet
    over point-to-point optical links. The major change to the physical layer was
    the support of twisted pairs in the 10BaseT specification. Twisted pair cables
    are traditionally used to support the telephone service in office buildings. Most
    office buildings today are equipped with structured cabling. Several twisted pair
    cables are installed between any room and a central telecom closet per building
    or per floor in large buildings. These telecom closets act as concentration points
    for the telephone service but also for LANs.
  id: totrans-45
  prefs: []
  type: TYPE_NORMAL
  zh: 第二个物理层是10Base2。这个物理层使用的是比10Base5电缆更容易安装的细同轴电缆，但其长度不能超过185米。还定义了一个10BaseF物理层，用于通过点对点光链路传输以太网。物理层的主要变化是在10BaseT规范中支持双绞线。双绞线电缆传统上用于支持办公楼中的电话服务。如今，大多数办公楼都配备了结构化布线。在大楼中，任何房间和中央电信室之间或每层楼之间都安装了几条双绞线电缆。这些电信室作为电话服务的集中点，同时也是局域网的集中点。
- en: The introduction of the twisted pairs led to two major changes to Ethernet.
    The first change concerns the physical topology of the network. 10Base2 and 10Base5
    networks are shared buses, the coaxial cable typically passes through each room
    that contains a connected computer. A 10BaseT network is a star-shaped network.
    All the devices connected to the network are attached to a twisted pair cable
    that ends in the telecom closet. From a maintenance perspective, this is a major
    improvement. The cable is a weak point in 10Base2 and 10Base5 networks. Any physical
    damage on the cable broke the entire network and when such a failure occurred,
    the network administrator had to manually check the entire cable to detect where
    it was damaged. With 10BaseT, when one twisted pair is damaged, only the device
    connected to this twisted pair is affected and this does not affect the other
    devices. The second major change introduced by 10BaseT was that is was impossible
    to build a 10BaseT network by simply connecting all the twisted pairs together.
    All the twisted pairs must be connected to a relay that operates in the physical
    layer. This relay is called an Ethernet hub. A hub is thus a physical layer relay
    that receives an electrical signal on one of its interfaces, regenerates the signal
    and transmits it over all its other interfaces. Some hubs are also able to convert
    the electrical signal from one physical layer to another (e.g. 10BaseT to 10Base2
    conversion). An Ethernet hub is a relay that operates at the physical layer as
    shown in figure [Fig. 171](#fig-ethernet-hub).
  id: totrans-46
  prefs: []
  type: TYPE_NORMAL
  zh: 双绞线的引入导致了以太网的两个主要变化。第一个变化涉及网络的物理拓扑。10Base2 和 10Base5 网络是共享总线，同轴电缆通常穿过每个包含连接计算机的房间。10BaseT
    网络是星形网络。连接到网络的全部设备都连接到一条以电信间为终点的双绞线。从维护的角度来看，这是一个重大的改进。电缆是 10Base2 和 10Base5 网络的弱点。任何电缆的物理损坏都会破坏整个网络，当发生此类故障时，网络管理员必须手动检查整个电缆以检测损坏的位置。在
    10BaseT 中，当一条双绞线损坏时，只有连接到该双绞线的设备受到影响，这不会影响其他设备。10BaseT 引入的第二个主要变化是，不可能简单地通过连接所有双绞线来构建
    10BaseT 网络。所有双绞线都必须连接到一个在物理层操作的继电器。这个继电器被称为以太网集线器。因此，集线器是一个物理层中继器，它在其中一个接口上接收电信号，再生信号并将其通过其所有其他接口传输。一些集线器还能够将一个物理层的电信号转换到另一个物理层（例如，10BaseT
    到 10Base2 的转换）。以太网集线器是一个在物理层操作的继电器，如图 [图 171](#fig-ethernet-hub) 所示。
- en: '![Figure made with TikZ](../Images/32f9a71dd5d981a251f55babe3afd5bc.png)'
  id: totrans-47
  prefs:
  - PREF_BQ
  type: TYPE_IMG
  zh: '![使用 TikZ 制作的图](../Images/32f9a71dd5d981a251f55babe3afd5bc.png)'
- en: ''
  id: totrans-48
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: Fig. 171 Ethernet hubs in the reference model
  id: totrans-49
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
  zh: 图 171 参考模型中的以太网集线器
- en: Computers can directly be attached to Ethernet hubs. Ethernet hubs themselves
    can be attached to other Ethernet hubs to build a larger network. However, some
    important guidelines must be followed when building a complex network with hubs.
    First, the network topology must be a tree. As hubs are relays in the physical
    layer, adding a link between Hub2 and Hub3 in the network of figure [Fig. 172](#fig-network-hubs)
    would create an electrical shortcut that would completely disrupt the network.
    This implies that there cannot be any redundancy in a hub-based network. A failure
    of a hub or of a link between two hubs would partition the network into two isolated
    networks. Second, as hubs are relays in the physical layer, collisions can happen
    and must be handled by CSMA/CD as in a 10Base5 network. This implies that the
    maximum delay between any pair of devices in the network cannot be longer than
    the 51.2 microseconds slot time. If the delay is longer, collisions between short
    frames may not be correctly detected. This constraint limits the geographical
    spread of 10BaseT networks containing hubs.
  id: totrans-50
  prefs: []
  type: TYPE_NORMAL
  zh: 计算机可以直接连接到以太网集线器。以太网集线器本身也可以连接到其他以太网集线器以构建更大的网络。然而，在构建由集线器组成的复杂网络时，必须遵循一些重要指南。首先，网络拓扑必须是树形结构。由于集线器是物理层的中继器，在图
    [图 172](#fig-network-hubs) 的网络中在 Hub2 和 Hub3 之间添加一个链接将会创建一个电气短路，这将完全破坏网络。这意味着基于集线器的网络中不能有任何冗余。集线器或两个集线器之间的链接故障会将网络分割成两个孤立的网络。其次，由于集线器是物理层的中继器，可能会发生冲突，并且必须像在
    10Base5 网络中那样由 CSMA/CD 处理。这意味着网络中任何一对设备之间的最大延迟不能超过 51.2 微秒的时隙时间。如果延迟更长，短帧之间的冲突可能无法正确检测。这个约束限制了包含集线器的
    10BaseT 网络的地理分布。
- en: '[![../_images/ethernet-net-hub.png](../Images/7b0810c7bcca0cc446f10cbc40ffc06f.png)](../_images/ethernet-net-hub.png)'
  id: totrans-51
  prefs: []
  type: TYPE_NORMAL
  zh: '![../_images/ethernet-net-hub.png](../Images/7b0810c7bcca0cc446f10cbc40ffc06f.png)'
- en: Fig. 172 A hierarchical Ethernet network composed of hubs[#](#fig-network-hubs
    "Link to this image")
  id: totrans-52
  prefs: []
  type: TYPE_NORMAL
  zh: 图. 172 由集线器组成的分层以太网网络[#](#fig-network-hubs "链接到这张图片")
- en: In the late 1980s, 10 Mbps became too slow for some applications and network
    manufacturers developed several LAN technologies that offered higher bandwidth,
    such as the 100 Mbps FDDI LAN that used optical fibers. As the development of
    10Base5, 10Base2 and 10BaseT had shown that Ethernet could be adapted to different
    physical layers, several manufacturers started to work on 100 Mbps Ethernet and
    convinced IEEE to standardize this new technology that was initially called Fast
    Ethernet. Fast Ethernet was designed under two constraints. First, Fast Ethernet
    had to support twisted pairs. Although it was easier from a physical layer perspective
    to support higher bandwidth on coaxial cables than on twisted pairs, coaxial cables
    were a nightmare from deployment and maintenance perspectives. Second, Fast Ethernet
    had to be perfectly compatible with the existing 10 Mbps Ethernet to allow Fast
    Ethernet technology to be used initially as a backbone technology to interconnect
    10 Mbps Ethernet networks. This forced Fast Ethernet to use exactly the same frame
    format as 10 Mbps Ethernet. This implied that the minimum Fast Ethernet frame
    size remained at 512 bits. To preserve CSMA/CD with this minimum frame size and
    100 Mbps instead of 10 Mbps, the duration of the slot time was decreased to 5.12
    microseconds.
  id: totrans-53
  prefs: []
  type: TYPE_NORMAL
  zh: 在20世纪80年代末，对于某些应用来说，10 Mbps的速度变得太慢，因此网络制造商开发了多种局域网技术，提供了更高的带宽，例如使用光纤的100 Mbps
    FDDI局域网。随着10Base5、10Base2和10BaseT的发展，已经表明以太网可以适应不同的物理层，几家制造商开始致力于100 Mbps以太网，并说服IEEE标准化这一新技术，最初称为快速以太网。快速以太网在设计时受到两个约束。首先，快速以太网必须支持双绞线。尽管从物理层角度来看，在双绞线上支持比在同轴电缆上支持更高的带宽更容易，但同轴电缆在部署和维护方面是一个噩梦。其次，快速以太网必须与现有的10
    Mbps以太网完全兼容，以便快速以太网技术最初可以作为骨干技术来互连10 Mbps以太网网络。这迫使快速以太网使用与10 Mbps以太网完全相同的帧格式。这意味着最小快速以太网帧大小保持在512位。为了保持最小帧大小为512位，并且将速率从10
    Mbps提高到100 Mbps，时隙时间被减少到5.12微秒。
- en: The evolution of Ethernet did not stop. In 1998, the IEEE published a first
    standard to provide Gigabit Ethernet over optical fibers. Several other types
    of physical layers were added afterwards. The [10 Gigabit Ethernet](http://en.wikipedia.org/wiki/10_gigabit_Ethernet)
    standard appeared in 2002\. Work is ongoing to develop [standards](http://www.ieee802.org/3/ba/public/index.html)
    for 40 Gigabit and 100 Gigabit Ethernet and some are thinking about [Terabit Ethernet](http://www.networkworld.com/news/2009/042009-terabit-ethernet.html).
    The table below lists the main Ethernet standards. A more detailed list may be
    found at [http://en.wikipedia.org/wiki/Ethernet_physical_layer](http://en.wikipedia.org/wiki/Ethernet_physical_layer).
  id: totrans-54
  prefs: []
  type: TYPE_NORMAL
  zh: 以太网的演变并未停止。1998年，IEEE发布了一个最初标准，以提供通过光纤的千兆以太网。之后又增加了几种其他类型的物理层。2002年出现了[10千兆以太网](http://en.wikipedia.org/wiki/10_gigabit_Ethernet)标准。目前正在开发40千兆和100千兆以太网的标准，有些人正在考虑[太比特以太网](http://www.networkworld.com/news/2009/042009-terabit-ethernet.html)。下表列出了主要的以太网标准。更详细的列表可以在[http://en.wikipedia.org/wiki/Ethernet_physical_layer](http://en.wikipedia.org/wiki/Ethernet_physical_layer)找到。
- en: '| Standard | Comments |'
  id: totrans-55
  prefs: []
  type: TYPE_TB
  zh: '| 标准 | 备注 |'
- en: '| --- | --- |'
  id: totrans-56
  prefs: []
  type: TYPE_TB
  zh: '| --- | --- |'
- en: '| 10Base5 | Thick coaxial cable, 500m |'
  id: totrans-57
  prefs: []
  type: TYPE_TB
  zh: '| 10Base5 | 厚同轴电缆，500m |'
- en: '| 10Base2 | Thin coaxial cable, 185m |'
  id: totrans-58
  prefs: []
  type: TYPE_TB
  zh: '| 10Base2 | 薄同轴电缆，185m |'
- en: '| 10BaseT | Two pairs of category 3+ UTP |'
  id: totrans-59
  prefs: []
  type: TYPE_TB
  zh: '| 10BaseT | 两对3类以上非屏蔽双绞线 |'
- en: '| 10Base-F | 10 Mb/s over optical fiber |'
  id: totrans-60
  prefs: []
  type: TYPE_TB
  zh: '| 10Base-F | 通过光纤的10 Mb/s |'
- en: '| 100Base-Tx | Category 5 UTP or STP, 100 m maximum |'
  id: totrans-61
  prefs: []
  type: TYPE_TB
  zh: '| 100Base-Tx | 5类或超5类非屏蔽双绞线或屏蔽双绞线，最大距离100 m |'
- en: '| 100Base-FX | Two multi-mode optical fiber, 2 km maximum |'
  id: totrans-62
  prefs: []
  type: TYPE_TB
  zh: '| 100Base-FX | 两种多模光纤，最大距离2 km |'
- en: '| 1000Base-CX | Two pairs shielded twisted pair, 25m maximum |'
  id: totrans-63
  prefs: []
  type: TYPE_TB
  zh: '| 1000Base-CX | 两对屏蔽双绞线，最大距离25m |'
- en: '| 1000Base-SX | Two multi-mode or single mode optical fibers with lasers |'
  id: totrans-64
  prefs: []
  type: TYPE_TB
  zh: '| 1000Base-SX | 两种多模或单模光纤，带有激光 |'
- en: '| 10 Gbps | Optical fiber but also Category 6 UTP |'
  id: totrans-65
  prefs: []
  type: TYPE_TB
  zh: '| 10 Gbps | 光纤以及6类非屏蔽双绞线 |'
- en: '| 40-100 Gbps | Optical fiber (experiences are performed with copper) |'
  id: totrans-66
  prefs: []
  type: TYPE_TB
  zh: '| 40-100 Gbps | 光纤（实验使用铜线） |'
- en: Footnotes
  id: totrans-67
  prefs: []
  type: TYPE_NORMAL
  zh: 脚注
- en: Ethernet Switches[#](#ethernet-switches "Link to this heading")
  id: totrans-68
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 以太网交换机[#](#ethernet-switches "链接到这个标题")
- en: Increasing the physical layer bandwidth as in Fast Ethernet was only one of
    the solutions to improve the performance of Ethernet LANs. A second solution was
    to replace the hubs with more intelligent devices. As Ethernet hubs operate in
    the physical layer, they can only regenerate the electrical signal to extend the
    geographical reach of the network. From a performance perspective, it would be
    more interesting to have devices that operate in the datalink layer and can analyze
    the destination address of each frame and forward the frames selectively on the
    link that leads to the destination. Such devices are usually called Ethernet switches
    [[9]](#fbridges). An Ethernet switch is a relay that operates in the datalink
    layer as is illustrated in figure [Fig. 173](#fig-switch-ref-model).
  id: totrans-69
  prefs: []
  type: TYPE_NORMAL
  zh: 在快速以太网中增加物理层带宽只是提高以太网局域网性能的解决方案之一。第二个解决方案是用更智能的设备替换集线器。由于以太网集线器在物理层工作，它们只能再生电信号以扩展网络的地理覆盖范围。从性能角度来看，拥有在数据链路层工作并能分析每个帧的目的地址并选择性地在通往目的地的链路上转发帧的设备会更感兴趣。这类设备通常被称为以太网交换机
    [[9]](#fbridges)。以太网交换机是一种在数据链路层工作的中继器，如图 [图 173](#fig-switch-ref-model) 所示。
- en: '![Figure made with TikZ](../Images/3ec5ee9e5eca2555bf183e60ae86fbcd.png)'
  id: totrans-70
  prefs:
  - PREF_BQ
  type: TYPE_IMG
  zh: '![使用 TikZ 制作的图](../Images/3ec5ee9e5eca2555bf183e60ae86fbcd.png)'
- en: ''
  id: totrans-71
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: Fig. 173 Ethernet switches in the reference model
  id: totrans-72
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
  zh: 图 173 参考模型中的以太网交换机
- en: An Ethernet switch understands the format of the Ethernet frames and can selectively
    forward frames over each interface. For this, each Ethernet switch maintains a
    MAC address table. This table contains, for each MAC address known by the switch,
    the identifier of the switch’s port over which a frame sent towards this address
    must be forwarded to reach its destination. This is illustrated in figure [Fig.
    174](#fig-operation-switch) with the MAC address table of the bottom switch. When
    the switch receives a frame destined to address B, it forwards the frame on its
    South port. If it receives a frame destined to address D, it forwards it only
    on its North port.
  id: totrans-73
  prefs: []
  type: TYPE_NORMAL
  zh: 以太网交换机理解以太网帧的格式，并且可以针对每个接口选择性地转发帧。为此，每个以太网交换机维护一个 MAC 地址表。该表包含，对于交换机所知的每个 MAC
    地址，一个标识符，表示发送到该地址的帧必须通过哪个交换机端口转发才能到达其目的地。这如图 [图 174](#fig-operation-switch) 中的底部交换机的
    MAC 地址表所示。当交换机收到一个目的地为 B 的帧时，它会在其南端口转发该帧。如果它收到一个目的地为 D 的帧，它只会在其北端口转发该帧。
- en: '[![../_images/datalink-fig-013-c.png](../Images/dea7b4a82ab8e1e49a6b3ef793fecc58.png)](../_images/datalink-fig-013-c.png)'
  id: totrans-74
  prefs: []
  type: TYPE_NORMAL
  zh: '[![../_images/datalink-fig-013-c.png](../Images/dea7b4a82ab8e1e49a6b3ef793fecc58.png)](../_images/datalink-fig-013-c.png)'
- en: Fig. 174 Operation of Ethernet switches[#](#fig-operation-switch "Link to this
    image")
  id: totrans-75
  prefs: []
  type: TYPE_NORMAL
  zh: 图 174 以太网交换机的工作原理[#](#fig-operation-switch "链接到这张图片")
- en: One of the selling points of Ethernet networks is that, thanks to the utilization
    of 48 bits MAC addresses, an Ethernet LAN is plug and play at the datalink layer.
    When two hosts are attached to the same Ethernet segment or hub, they can immediately
    exchange Ethernet frames without requiring any configuration. It is important
    to retain this plug and play capability for Ethernet switches as well. This implies
    that Ethernet switches must be able to build their MAC address table automatically
    without requiring any manual configuration. This automatic configuration is performed
    by the MAC address learning algorithm that runs on each Ethernet switch. This
    algorithm extracts the source address of the received frames and remembers the
    port over which a frame from each source Ethernet address has been received. This
    information is inserted into the MAC address table that the switch uses to forward
    frames. This allows the switch to automatically learn the ports that it can use
    to reach each destination address, provided that this host has previously sent
    at least one frame. This is not a problem since most upper layer protocols use
    acknowledgments at some layer and thus even an Ethernet printer sends Ethernet
    frames as well.
  id: totrans-76
  prefs: []
  type: TYPE_NORMAL
  zh: 以太网网络的一个卖点是由于使用了48位MAC地址，以太网局域网在数据链路层上可以即插即用。当两个主机连接到同一个以太网段或集线器时，它们可以立即交换以太网帧，而无需任何配置。对于以太网交换机来说，保留这种即插即用能力也很重要。这意味着以太网交换机必须能够自动构建它们的MAC地址表，而无需任何手动配置。这种自动配置是通过运行在每个以太网交换机上的MAC地址学习算法来完成的。该算法提取接收到的帧的源地址，并记住每个源以太网地址的帧是通过哪个端口接收到的。这些信息被插入到交换机使用的MAC地址表中，用于转发帧。这允许交换机自动学习它可以使用哪些端口到达每个目标地址，前提是此主机之前至少发送了一个帧。这并不是问题，因为大多数上层协议在某个层使用确认，因此即使是以太网打印机也会发送以太网帧。
- en: The pseudo-code below details how an Ethernet switch forwards Ethernet frames.
    It first updates its MAC address table with the source address of the frame. The
    MAC address table used by some switches also contains a timestamp that is updated
    each time a frame is received from each known source address. This timestamp is
    used to remove from the MAC address table entries that have not been active during
    the last n minutes. This limits the growth of the MAC address table, but also
    allows hosts to move from one port to another. The switch uses its MAC address
    table to forward the received unicast frame. If there is an entry for the frame’s
    destination address in the MAC address table, the frame is forwarded selectively
    on the port listed in this entry. Otherwise, the switch does not know how to reach
    the destination address and it must forward the frame on all its ports except
    the port from which the frame has been received. This ensures that the frame will
    reach its destination, at the expense of some unnecessary transmissions. These
    unnecessary transmissions will only last until the destination has sent its first
    frame. Multicast and Broadcast frames are also forwarded in a similar way.
  id: totrans-77
  prefs: []
  type: TYPE_NORMAL
  zh: 下面的伪代码详细说明了以太网交换机如何转发以太网帧。它首先使用帧的源地址更新其MAC地址表。某些交换机使用的MAC地址表还包含一个时间戳，每次从每个已知源地址接收帧时都会更新。这个时间戳用于从MAC地址表中删除在过去n分钟内未活跃的条目。这限制了MAC地址表的增长，但同时也允许主机从一个端口移动到另一个端口。交换机使用其MAC地址表来转发接收到的单播帧。如果MAC地址表中存在帧目标地址的条目，则该帧将根据此条目中列出的端口进行选择性转发。否则，交换机不知道如何到达目标地址，它必须在除了接收帧的端口之外的所有端口上转发该帧。这确保了帧将到达其目标，但代价是会有一些不必要的传输。这些不必要的传输只会持续到目标发送其第一个帧。多播和广播帧也以类似的方式转发。
- en: '[PRE0]'
  id: totrans-78
  prefs: []
  type: TYPE_PRE
  zh: '[PRE0]'
- en: Note
  id: totrans-79
  prefs: []
  type: TYPE_NORMAL
  zh: 注意
- en: Security issues with Ethernet hubs and switches
  id: totrans-80
  prefs: []
  type: TYPE_NORMAL
  zh: 以太网集线器和交换机的安全问题
- en: From a security perspective, Ethernet hubs have the same drawbacks as the older
    coaxial cable. A host attached to a hub will be able to capture all the frames
    exchanged between any pair of hosts attached to the same hub. Ethernet switches
    are much better from this perspective thanks to the selective forwarding, a host
    will usually only receive the frames destined to itself as well as the multicast,
    broadcast and unknown frames. However, this does not imply that switches are completely
    secure. There are, unfortunately, attacks against Ethernet switches. From a security
    perspective, the MAC address table is one of the fragile elements of an Ethernet
    switch. This table has a fixed size. Some low-end switches can store a few tens
    or a few hundreds of addresses while higher-end switches can store tens of thousands
    of addresses or more. From a security point of view, a limited resource can be
    the target of Denial of Service attacks. Unfortunately, such attacks are also
    possible on Ethernet switches. A malicious host could overflow the MAC address
    table of the switch by generating thousands of frames with random source addresses.
    Once the MAC address table is full, the switch needs to broadcast all the frames
    that it receives. At this point, an attacker will receive unicast frames that
    are not destined to its address. The ARP attack discussed in the previous chapter
    could also occur with Ethernet switches [[Vyncke2007]](../bibliography.html#vyncke2007).
    Recent switches implement several types of defenses against these attacks, but
    they need to be carefully configured by the network administrator. See [[Vyncke2007]](../bibliography.html#vyncke2007)
    for a detailed discussion on security issues with Ethernet switches.
  id: totrans-81
  prefs: []
  type: TYPE_NORMAL
  zh: 从安全角度来看，以太网集线器与较老的同轴电缆具有相同的缺点。连接到集线器的主机将能够捕获连接到同一集线器的任何一对主机之间交换的所有帧。由于选择性转发，以太网交换机在这方面要好得多，因为主机通常只会接收到目的地为自身的帧以及多播、广播和未知帧。然而，这并不意味着交换机是完全安全的。不幸的是，存在针对以太网交换机的攻击。从安全角度来看，MAC地址表是以太网交换机的一个脆弱元素。这个表的大小是固定的。一些低端交换机可以存储几十个或几百个地址，而高端交换机可以存储数万个或更多的地址。从安全角度来看，有限的资源可能成为拒绝服务攻击的目标。不幸的是，这种攻击在以太网交换机上也是可能的。恶意主机可以通过生成带有随机源地址的数千个帧来溢出交换机的MAC地址表。一旦MAC地址表满了，交换机需要广播它接收到的所有帧。此时，攻击者将接收到不是发送给其地址的单播帧。上一章讨论的ARP攻击也可能发生在以太网交换机上
    [[Vyncke2007]](../bibliography.html#vyncke2007)。最近的交换机实现了多种防御这些攻击的类型，但它们需要网络管理员仔细配置。参见
    [[Vyncke2007]](../bibliography.html#vyncke2007) 以了解以太网交换机安全问题的详细讨论。
- en: The MAC address learning algorithm combined with the forwarding algorithm work
    well in a tree-shaped network such as the one shown above. However, to deal with
    link and switch failures, network administrators often add redundant links to
    ensure that their network remains connected even after a failure. Let us consider
    what happens in the Ethernet network shown in figure [Fig. 175](#fig-ethernet-loop).
  id: totrans-82
  prefs: []
  type: TYPE_NORMAL
  zh: 将MAC地址学习算法与转发算法结合使用在树形网络（如上图所示）中效果良好。然而，为了处理链路和交换机故障，网络管理员通常会添加冗余链路以确保网络在故障后仍然保持连接。让我们考虑一下图
    [图 175](#fig-ethernet-loop) 中所示以太网网络会发生什么。
- en: '[![../_images/datalink-fig-014-c.png](../Images/e8f49a8642a420b51358c162a7018bf9.png)](../_images/datalink-fig-014-c.png)'
  id: totrans-83
  prefs: []
  type: TYPE_NORMAL
  zh: '[![../_images/datalink-fig-014-c.png](../Images/e8f49a8642a420b51358c162a7018bf9.png)](../_images/datalink-fig-014-c.png)'
- en: Fig. 175 Ethernet switches in a loop[#](#fig-ethernet-loop "Link to this image")
  id: totrans-84
  prefs: []
  type: TYPE_NORMAL
  zh: 图 175 环形以太网交换机[#](#fig-ethernet-loop "链接到这张图片")
- en: When all switches boot, their MAC address table is empty. Assume that host A
    sends a frame towards host C. Upon reception of this frame, switch1 updates its
    MAC address table to remember that address A is reachable via its West port. As
    there is no entry for address C in switch1’s MAC address table, the frame is forwarded
    to both switch2 and switch3\. When switch2 receives the frame, its updates its
    MAC address table for address A and forwards the frame to host C as well as to
    switch3\. switch3 has thus received two copies of the same frame. As switch3 does
    not know how to reach the destination address, it forwards the frame received
    from switch1 to switch2 and the frame received from switch2 to switch1… The single
    frame sent by host A will be continuously duplicated by the switches until their
    MAC address table contains an entry for address C. Quickly, all the available
    link bandwidth will be used to forward all the copies of this frame. As Ethernet
    does not contain any TTL or HopLimit, this loop will never stop.
  id: totrans-85
  prefs: []
  type: TYPE_NORMAL
  zh: 当所有交换机启动时，它们的MAC地址表都是空的。假设主机A向主机C发送一个帧。在接收到这个帧后，switch1更新其MAC地址表以记住地址A可以通过其西端口到达。由于switch1的MAC地址表中没有地址C的条目，因此该帧被转发到switch2和switch3。当switch2接收到帧时，它更新地址A的MAC地址表并将帧转发到主机C以及switch3。因此，switch3收到了两个相同的帧。由于switch3不知道如何到达目标地址，它将来自switch1的帧转发到switch2，并将来自switch2的帧转发到switch1……主机A发送的单个帧将被交换机不断复制，直到它们的MAC地址表中包含地址C的条目。很快，所有可用的链路带宽都将被用来转发这个帧的所有副本。由于以太网不包含任何TTL或跳数限制，这个环路将永远不会停止。
- en: The MAC address learning algorithm allows switches to be plug-and-play. Unfortunately,
    the loops that arise when the network topology is not a tree are a severe problem.
    Forcing the switches to only be used in tree-shaped networks as hubs would be
    a severe limitation. To solve this problem, the inventors of Ethernet switches
    have developed the Spanning Tree Protocol. This protocol allows switches to automatically
    disable ports on Ethernet switches to ensure that the network does not contain
    any cycle that could cause frames to loop forever.
  id: totrans-86
  prefs: []
  type: TYPE_NORMAL
  zh: MAC地址学习算法允许交换机即插即用。不幸的是，当网络拓扑不是树形时产生的环路是一个严重的问题。强迫交换机只能作为树形网络的中心使用将是一个严重的限制。为了解决这个问题，以太网交换机的发明者开发了生成树协议。该协议允许交换机自动关闭以太网交换机上的端口，以确保网络不包含任何可能导致帧无限循环的环路。
- en: Footnotes
  id: totrans-87
  prefs: []
  type: TYPE_NORMAL
  zh: 脚注
- en: The Spanning Tree Protocol (802.1d)[#](#the-spanning-tree-protocol-802-1d "Link
    to this heading")
  id: totrans-88
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 生成树协议（802.1d）[#](#the-spanning-tree-protocol-802-1d "链接到这个标题")
- en: The Spanning Tree Protocol (STP), proposed in [[Perlman1985]](../bibliography.html#perlman1985),
    is a distributed protocol that is used by switches to reduce the network topology
    to a spanning tree, so that there are no cycles in the topology. For example,
    consider the network shown in figure [Fig. 176](#fig-ethernet-spanning). In this
    figure, each bold line corresponds to an Ethernet to which two Ethernet switches
    are attached. This network contains several cycles that must be broken to allow
    Ethernet switches, using the MAC address learning algorithm, to exchange frames.
  id: totrans-89
  prefs: []
  type: TYPE_NORMAL
  zh: 生成树协议（STP），由[[Perlman1985]](../bibliography.html#perlman1985)提出，是一种分布式协议，交换机使用该协议将网络拓扑简化为生成树，从而在拓扑中不存在环路。例如，考虑图[图.176](#fig-ethernet-spanning)中所示的网络。在这个图中，每条粗线对应一个连接了两个以太网交换机的以太网。这个网络包含几个必须打破的环路，以便使用MAC地址学习算法的以太网交换机交换帧。
- en: '[![../_images/datalink-fig-015-c.png](../Images/5a29a9d52b3209b13650c40e94203b2e.png)](../_images/datalink-fig-015-c.png)'
  id: totrans-90
  prefs: []
  type: TYPE_NORMAL
  zh: '![../_images/datalink-fig-015-c.png](../Images/5a29a9d52b3209b13650c40e94203b2e.png)'
- en: Fig. 176 Spanning tree computed in a switched Ethernet network[#](#fig-ethernet-spanning
    "Link to this image")
  id: totrans-91
  prefs: []
  type: TYPE_NORMAL
  zh: 图.176 在交换式以太网网络中计算的生成树[#](#fig-ethernet-spanning "链接到这个图像")
- en: In this network, the STP will compute the following spanning tree. Switch1 will
    be the root of the tree. All the interfaces of Switch1, Switch2 and Switch7 are
    part of the spanning tree. Only the interface connected to LAN B will be active
    on Switch9. LAN H will only be served by Switch7 and the port of Switch44 on LAN
    G will be disabled. A frame originating on LAN B and destined for LAN A will be
    forwarded by Switch7 on LAN C, then by Switch1 on LAN E, then by Switch44 on LAN
    F and eventually by Switch2 on LAN A.
  id: totrans-92
  prefs: []
  type: TYPE_NORMAL
  zh: 在这个网络中，STP 将计算以下生成树。Switch1 将是树的根。Switch1、Switch2 和 Switch7 的所有接口都是生成树的一部分。只有连接到
    LAN B 的接口将在 Switch9 上激活。LAN H 只由 Switch7 服务，LAN G 上 Switch44 的端口将被禁用。一个从 LAN B
    发起并指向 LAN A 的帧将通过 Switch7 在 LAN C 上转发，然后通过 Switch1 在 LAN E 上转发，然后通过 Switch44 在
    LAN F 上转发，最终通过 Switch2 在 LAN A 上转发。
- en: Switches running the Spanning Tree Protocol exchange BPDUs. These BPDUs are
    always sent as frames with destination MAC address as the ALL_BRIDGES reserved
    multicast MAC address. Each switch has a unique 64 bit identifier. To ensure uniqueness,
    the lower 48 bits of the identifier are set to the unique MAC address allocated
    to the switch by its manufacturer. The high order 16 bits of the switch identifier
    can be configured by the network administrator to influence the topology of the
    spanning tree. The default value for these high order bits is 32768.
  id: totrans-93
  prefs: []
  type: TYPE_NORMAL
  zh: 运行生成树协议的交换机交换 BPDUs。这些 BPDUs 总是以带有 ALL_BRIDGES 保留组播 MAC 地址的 MAC 地址作为目标地址的帧发送。每个交换机都有一个唯一的
    64 位标识符。为确保唯一性，标识符的低位 48 位被设置为制造商分配给交换机的唯一 MAC 地址。交换机标识符的高位 16 位可以由网络管理员配置，以影响生成树的拓扑。这些高位位的默认值是
    32768。
- en: 'The switches exchange BPDUs to build the spanning tree. Intuitively, the spanning
    tree is built by first selecting the switch with the smallest identifier as the
    root of the tree. The branches of the spanning tree are then composed of the shortest
    paths that allow all of the switches that compose the network to be reached. The
    BPDUs exchanged by the switches contain the following information :'
  id: totrans-94
  prefs: []
  type: TYPE_NORMAL
  zh: 交换机交换 BPDUs 以构建生成树。直观地，生成树是通过首先选择具有最小标识符的交换机作为树的根来构建的。生成树的分支由允许到达构成网络的全部交换机的最短路径组成。交换机之间交换的
    BPDUs 包含以下信息：
- en: the identifier of the root switch (R)
  id: totrans-95
  prefs:
  - PREF_BQ
  - PREF_UL
  type: TYPE_NORMAL
  zh: 根交换机的标识符（R）
- en: ''
  id: totrans-96
  prefs:
  - PREF_BQ
  - PREF_IND
  type: TYPE_NORMAL
- en: ''
  id: totrans-97
  prefs:
  - PREF_BQ
  - PREF_IND
  type: TYPE_NORMAL
- en: the cost of the shortest path between the switch that sent the BPDU and the
    root switch (c)
  id: totrans-98
  prefs:
  - PREF_BQ
  - PREF_UL
  type: TYPE_NORMAL
  zh: 发送 BPDU 的交换机和根交换机之间的最短路径的成本（c）
- en: ''
  id: totrans-99
  prefs:
  - PREF_BQ
  - PREF_IND
  type: TYPE_NORMAL
- en: ''
  id: totrans-100
  prefs:
  - PREF_BQ
  - PREF_IND
  type: TYPE_NORMAL
- en: the identifier of the switch that sent the BPDU (T)
  id: totrans-101
  prefs:
  - PREF_BQ
  - PREF_UL
  type: TYPE_NORMAL
  zh: 发送 BPDU 的交换机标识符（T）
- en: ''
  id: totrans-102
  prefs:
  - PREF_BQ
  - PREF_IND
  type: TYPE_NORMAL
- en: ''
  id: totrans-103
  prefs:
  - PREF_BQ
  - PREF_IND
  type: TYPE_NORMAL
- en: the number of the switch port over which the BPDU was sent (p)
  id: totrans-104
  prefs:
  - PREF_BQ
  - PREF_UL
  type: TYPE_NORMAL
  zh: 发送 BPDU 的交换机端口号（p）
- en: We will use the notation <R,c,T,p> to represent a BPDU whose root identifier
    is R, cost is c and that was sent from the port p of switch T. The construction
    of the spanning tree depends on an ordering relationship among the BPDUs. This
    ordering relationship could be implemented by the Python function below.
  id: totrans-105
  prefs: []
  type: TYPE_NORMAL
  zh: 我们将使用 <R,c,T,p> 表示一个根标识符为 R、成本为 c 并且是从交换机 T 的端口 p 发送的 BPDU。生成树的构建取决于 BPDU 之间的排序关系。这种排序关系可以通过下面的
    Python 函数实现。
- en: '[PRE1]'
  id: totrans-106
  prefs: []
  type: TYPE_PRE
  zh: '[PRE1]'
- en: In addition to the identifier discussed above, the network administrator can
    also configure a cost to be associated to each switch port. Usually, the cost
    of a port depends on its bandwidth and the [[IEEE802.1d]](../bibliography.html#ieee802-1d)
    standard recommends the values below. Of course, the network administrator may
    choose other values. We will use the notation cost[p] to indicate the cost associated
    to port p in this section.
  id: totrans-107
  prefs: []
  type: TYPE_NORMAL
  zh: 除了上述标识符之外，网络管理员还可以为每个交换机端口配置一个与之关联的成本。通常，端口的成本取决于其带宽，IEEE802.1d 标准建议以下值。当然，网络管理员可以选择其他值。我们将使用
    cost[p] 表示本节中与端口 p 关联的成本。
- en: '| Bandwidth | Cost |'
  id: totrans-108
  prefs: []
  type: TYPE_TB
  zh: '| 带宽 | 成本 |'
- en: '| --- | --- |'
  id: totrans-109
  prefs: []
  type: TYPE_TB
  zh: '| --- | --- |'
- en: '| 10 Mbps | 2000000 |'
  id: totrans-110
  prefs: []
  type: TYPE_TB
  zh: '| 10 Mbps | 2000000 |'
- en: '| 100 Mbps | 200000 |'
  id: totrans-111
  prefs: []
  type: TYPE_TB
  zh: '| 100 Mbps | 200000 |'
- en: '| 1 Gbps | 20000 |'
  id: totrans-112
  prefs: []
  type: TYPE_TB
  zh: '| 1 Gbps | 20000 |'
- en: '| 10 Gbps | 2000 |'
  id: totrans-113
  prefs: []
  type: TYPE_TB
  zh: '| 10 Gbps | 2000 |'
- en: '| 100 Gbps | 200 |'
  id: totrans-114
  prefs: []
  type: TYPE_TB
  zh: '| 100 Gbps | 200 |'
- en: 'The Spanning Tree Protocol uses its own terminology that we illustrate in the
    figure above. A switch port can be in three different states : Root, Designated
    and Blocked. All the ports of the root switch are in the Designated state. The
    state of the ports on the other switches is determined based on the BPDU received
    on each port.'
  id: totrans-115
  prefs: []
  type: TYPE_NORMAL
  zh: 生成树协议使用其自己的术语，我们在上面的图中进行了说明。交换机端口可以处于三种不同的状态：根、指定和阻塞。根交换机的所有端口都处于指定状态。其他交换机端口的状态基于每个端口接收到的
    BPDU 确定。
- en: 'The Spanning Tree Protocol uses the ordering relationship to build the spanning
    tree. Each switch listens to BPDUs on its ports. When BPDU = <R,c,T,p> is received
    on port q, the switch computes the port’s root priority vector: V[q] = <R,c+cost[q],T,p,q>
    , where cost[q] is the cost associated to the port over which the BPDU was received.
    The switch stores in a table the last root priority vector received on each port.
    The switch then compares its own identifier with the smallest root identifier
    stored in this table. If its own identifier is smaller, then the switch is the
    root of the spanning tree and is, by definition, at a distance 0 of the root.
    The BPDU of the switch is then <R,0,R,p>, where R is the switch identifier and
    p will be set to the port number over which the BPDU is sent.'
  id: totrans-116
  prefs: []
  type: TYPE_NORMAL
  zh: 生成树协议使用排序关系来构建生成树。每个交换机在其端口上监听 BPDUs。当 BPDU = <R,c,T,p> 在端口 q 上接收时，交换机计算该端口的根优先级向量：V[q]
    = <R,c+cost[q],T,p,q>，其中 cost[q] 是与接收 BPDU 的端口相关的成本。交换机在表中存储每个端口上接收到的最后一个根优先级向量。然后，交换机将其自己的标识符与表中存储的最小根标识符进行比较。如果其自己的标识符更小，则该交换机是生成树的根，并且根据定义，距离根的距离为
    0。因此，该交换机的 BPDU 是 <R,0,R,p>，其中 R 是交换机标识符，p 将设置为发送 BPDU 的端口编号。
- en: Otherwise, the switch chooses the best priority vector from its table, bv =
    <R,c+cost[q’],T,p,q’>. The port q’, over which this best root priority vector
    was learned, is the switch port that is closest to the root switch. This port
    becomes the Root port of the switch. There is only one Root port per switch (except
    for the Root switches whose ports are all Designated). The switch can then compute
    its own BPDU as BPDU = <R,c’,S,p> , where R is the root identifier, c’ the cost
    of the best root priority vector, S the identifier of the switch and p will be
    replaced by the number of the port over which the BPDU will be sent.
  id: totrans-117
  prefs: []
  type: TYPE_NORMAL
  zh: 否则，交换机从其表中选择最佳优先级向量，bv = <R,c+cost[q’],T,p,q’>。通过此最佳根优先级向量学习的端口 q’，是距离根交换机最近的交换机端口。该端口成为交换机的根端口。每个交换机只有一个根端口（除了根交换机的端口都是指定端口的情况）。然后，交换机可以计算自己的
    BPDU，BPDU = <R,c’，S,p>，其中 R 是根标识符，c’ 是最佳根优先级向量的成本，S 是交换机标识符，p 将被替换为发送 BPDU 的端口编号。
- en: To determine the state of its other ports, the switch compares its own BPDU
    with the last BPDU received on each port. Note that the comparison is done by
    using the BPDUs and not the root priority vectors. If the switch’s BPDU is better
    than the last BPDU of this port, the port becomes a Designated port. Otherwise,
    the port becomes a Blocked port.
  id: totrans-118
  prefs: []
  type: TYPE_NORMAL
  zh: 为了确定其其他端口的状态，交换机将其自己的 BPDU 与每个端口上接收到的最后一个 BPDU 进行比较。请注意，比较是通过使用 BPDU 而不是根优先级向量进行的。如果交换机的
    BPDU 比此端口的最后一个 BPDU 更好，则该端口变为指定端口。否则，该端口变为阻塞端口。
- en: The state of each port is important when considering the transmission of BPDUs.
    The root switch regularly sends its own BPDU over all of its (Designated) ports.
    This BPDU is received on the Root port of all the switches that are directly connected
    to the root switch. Each of these switches computes its own BPDU and sends this
    BPDU over all its Designated ports. These BPDUs are then received on the Root
    port of downstream switches, which then compute their own BPDU, etc. When the
    network topology is stable, switches send their own BPDU on all their Designated
    ports, once they receive a BPDU on their Root port. No BPDU is sent on a Blocked
    port. Switches listen for BPDUs on their Blocked and Designated ports, but no
    BPDU should be received over these ports when the topology is stable. The utilization
    of the ports for both BPDUs and data frames is summarized in the table below.
  id: totrans-119
  prefs: []
  type: TYPE_NORMAL
  zh: 在考虑 BPDUs 传输时，每个端口的状况都很重要。根交换机定期将其自己的 BPDU 通过其所有（指定）端口发送。这个 BPDU 被所有直接连接到根交换机的交换机的根端口接收。这些交换机中的每一个都会计算自己的
    BPDU，并通过其所有指定端口发送这个 BPDU。然后，这些 BPDU 被下游交换机的根端口接收，这些交换机随后计算自己的 BPDU，等等。当网络拓扑稳定时，交换机在其所有指定端口上发送自己的
    BPDU，一旦它们在其根端口上接收到 BPDU。在阻塞端口上不会发送 BPDU。交换机在其阻塞和指定端口上监听 BPDUs，但在拓扑稳定时，不应通过这些端口接收任何
    BPDU。端口用于 BPDUs 和数据帧的利用率总结在下表。
- en: '| Port state | Receives BPDUs | Sends BPDU | Handles data frames |'
  id: totrans-120
  prefs: []
  type: TYPE_TB
  zh: '| 端口状态 | 接收 BPDUs | 发送 BPDU | 处理数据帧 |'
- en: '| --- | --- | --- | --- |'
  id: totrans-121
  prefs: []
  type: TYPE_TB
  zh: '| --- | --- | --- | --- |'
- en: '| Blocked | yes | no | no |'
  id: totrans-122
  prefs: []
  type: TYPE_TB
  zh: '| 阻塞 | 是 | 否 | 否 |'
- en: '| Root | yes | no | yes |'
  id: totrans-123
  prefs: []
  type: TYPE_TB
  zh: '| 根 | 是 | 否 | 是 |'
- en: '| Designated | yes | yes | yes |'
  id: totrans-124
  prefs: []
  type: TYPE_TB
  zh: '| 指定 | 是 | 是 | 是 |'
- en: To illustrate the operation of the Spanning Tree Protocol, let us consider the
    simple network topology in the figure [Fig. 177](#fig-stp-example).
  id: totrans-125
  prefs: []
  type: TYPE_NORMAL
  zh: 为了说明生成树协议的操作，让我们考虑图 [图 177](#fig-stp-example) 中的简单网络拓扑。
- en: '[![../_images/datalink-fig-016-c.svg](../Images/400b4ebfa6c09b6f49710e52c919a9a1.png)](../_images/datalink-fig-016-c.svg)'
  id: totrans-126
  prefs: []
  type: TYPE_NORMAL
  zh: '![../_images/datalink-fig-016-c.svg](../Images/400b4ebfa6c09b6f49710e52c919a9a1.png)'
- en: Fig. 177 A simple Spanning tree computed in a switched Ethernet network[#](#fig-stp-example
    "Link to this image")
  id: totrans-127
  prefs: []
  type: TYPE_NORMAL
  zh: 图177 在交换式以太网网络中计算的简单生成树[#](#fig-stp-example "链接到这张图片")
- en: Assume that Switch4 is the first to boot. It sends its own BPDU = <4,0,4,1>
    (resp. BPDU = <4,0,4,2>) on port 1 (resp. port 2). When Switch1 boots, it sends
    BPDU = <1,0,1,1>. This BPDU is received by Switch4, which updates its BPDU and
    root priority vector tables and computes a new BPDU = <1,3,4,1> (resp. BPDU =
    <1,3,4,2>) on port 1 (resp. port 2). Indeed, there is only one root priority vector
    and hence, it is the best one. Port 1 of Switch4 becomes the Root port while its
    second port is still in the Designated state.
  id: totrans-128
  prefs: []
  type: TYPE_NORMAL
  zh: 假设Switch4是第一个启动的。它在端口1上发送自己的BPDU = <4,0,4,1>（或BPDU = <4,0,4,2>）。当Switch1启动时，它发送BPDU
    = <1,0,1,1>。这个BPDU被Switch4接收，它更新其BPDU和根优先级向量表，并在端口1上（或端口2上）计算新的BPDU = <1,3,4,1>（或BPDU
    = <1,3,4,2>）。实际上，只有一个根优先级向量，因此它是最好的。Switch4的端口1成为根端口，而其第二个端口仍然处于指定状态。
- en: Assume now that Switch9 boots and immediately receives Switch1 ‘s BPDU on port
    1\. Switch9 computes its own BPDU = <1,1,9,1> (resp. BPDU = <1,1,9,2>) on port
    1 (resp. port 2) and port 1 becomes the Root port of this switch. The BPDU is
    sent on port 2 of Switch9 and reaches Switch4. Switch4 compares the priority vectors.
    It notices that the last computed vector (i.e., V[2] = <1,2,9,2,2>) is better
    than V[1] = <1,3,1,1,1>. Thus, Switch4’s BPDU is recomputed and port 2 becomes
    the Root port of Switch4. Switch4 compares its new BPDU = <1,2,4,p> with the last
    BPDU received on each port (except for the Root port). Port 1 becomes a Blocked
    port on Switch4 because the BPDU=<1,0,1,1> received on this port is better.
  id: totrans-129
  prefs: []
  type: TYPE_NORMAL
  zh: 假设现在Switch9启动并立即在端口1上接收到Switch1的BPDU。Switch9在端口1上计算自己的BPDU = <1,1,9,1>（或BPDU
    = <1,1,9,2>）并在端口2上（或端口2上）计算BPDU，端口1成为此交换机的根端口。BPDU在Switch9的端口2上发送并到达Switch4。Switch4比较优先级向量。它注意到最后一个计算的向量（即V[2]
    = <1,2,9,2,2>）比V[1] = <1,3,1,1,1>更好。因此，Switch4的BPDU被重新计算，端口2成为Switch4的根端口。Switch4将其新的BPDU
    = <1,2,4,p>与每个端口上接收到的最后一个BPDU（除了根端口）进行比较。端口1在Switch4上成为阻塞端口，因为在此端口上接收到的BPDU=<1,0,1,1>更好。
- en: During the computation of the spanning tree, switches discard all received data
    frames, as at that time the network topology is not guaranteed to be loop-free.
    Once that topology has been stable for some time, the switches again start to
    use the MAC learning algorithm to forward data frames. Only the Root and Designated
    ports are used to forward data frames. Switches discard all the data frames received
    on their Blocked ports and never forward frames on these ports.
  id: totrans-130
  prefs: []
  type: TYPE_NORMAL
  zh: 在计算生成树期间，交换机丢弃所有接收到的数据帧，因为那时网络拓扑不保证是无环的。一旦拓扑稳定了一段时间，交换机再次开始使用MAC学习算法转发数据帧。只有根端口和指定端口用于转发数据帧。交换机丢弃其阻塞端口上接收到的所有数据帧，并且从不在这类端口上转发帧。
- en: 'Switches, ports and links can fail in a switched Ethernet network. When a failure
    occurs, the switches must be able to recompute the spanning tree to recover from
    the failure. The Spanning Tree Protocol relies on regular transmissions of the
    BPDUs to detect these failures. A BPDU contains two additional fields : the Age
    of the BPDU and the Maximum Age. The Age contains the amount of time that has
    passed since the root switch initially originated the BPDU. The root switch sends
    its BPDU with an Age of zero and each switch that computes its own BPDU increments
    its Age by one. The Age of the BPDUs stored on a switch’s table is also incremented
    every second. A BPDU expires when its Age reaches the Maximum Age. When the network
    is stable, this does not happen as BPDU s are regularly sent by the root switch
    and downstream switches. However, if the root fails or the network becomes partitioned,
    BPDU will expire and switches will recompute their own BPDU and restart the Spanning
    Tree Protocol. Once a topology change has been detected, the forwarding of the
    data frames stops as the topology is not guaranteed to be loop-free. Additional
    details about the reaction to failures may be found in [[IEEE802.1d]](../bibliography.html#ieee802-1d).'
  id: totrans-131
  prefs: []
  type: TYPE_NORMAL
  zh: 在交换式以太网网络中，交换机、端口和链路可能会出现故障。当发生故障时，交换机必须能够重新计算生成树以从故障中恢复。生成树协议依赖于 BPDUs（桥接协议数据单元）的定期传输来检测这些故障。BPDU
    包含两个附加字段：BPDU 的年龄和最大年龄。年龄表示自根交换机最初生成 BPDU 以来经过的时间量。根交换机以年龄为零发送其 BPDU，每个计算自己 BPDU
    的交换机将其年龄增加一。交换机上存储的 BPDU 年龄每秒也会增加。当 BPDU 的年龄达到最大年龄时，BPDU 将过期。当网络稳定时，这不会发生，因为 BPDU
    由根交换机和下游交换机定期发送。然而，如果根交换机出现故障或网络变得分裂，BPDU 将过期，交换机将重新计算自己的 BPDU 并重新启动生成树协议。一旦检测到拓扑变化，数据帧的转发将停止，因为无法保证拓扑是无环的。有关对故障的反应的更多详细信息，请参阅
    [[IEEE802.1d]](../bibliography.html#ieee802-1d)。
- en: '### Virtual LANs[#](#virtual-lans "Link to this heading")'
  id: totrans-132
  prefs: []
  type: TYPE_NORMAL
  zh: '### 虚拟局域网[#](#virtual-lans "链接到这个标题")'
- en: Another important advantage of Ethernet switches is the ability to create Virtual
    Local Area Networks (VLANs). A virtual LAN can be defined as a set of ports attached
    to one or more Ethernet switches. A switch can support several VLANs and it runs
    one MAC learning algorithm for each Virtual LAN. When a switch receives a frame
    with an unknown or a multicast destination, it forwards it over all the ports
    that belong to the same Virtual LAN but not over the ports that belong to other
    Virtual LANs. Similarly, when a switch learns a source address on a port, it associates
    it to the Virtual LAN of this port and uses this information only when forwarding
    frames on this Virtual LAN.
  id: totrans-133
  prefs: []
  type: TYPE_NORMAL
  zh: 以太网交换机的另一个重要优点是能够创建虚拟局域网（VLAN）。虚拟局域网可以定义为连接到一个或多个以太网交换机的一组端口。交换机可以支持多个 VLAN，并为每个虚拟局域网运行一个
    MAC 学习算法。当交换机收到一个具有未知或组播目的地的帧时，它将转发到属于同一虚拟局域网的端口，但不转发到属于其他虚拟局域网的端口。同样，当交换机在端口上学习到一个源地址时，它将该地址关联到该端口的虚拟局域网，并在转发该虚拟局域网上的帧时使用此信息。
- en: Figure [Fig. 178](#fig-vlan) illustrates a switched Ethernet network with three
    Virtual LANs. VLAN2 and VLAN3 only require a local configuration of switch S1.
    Host C can exchange frames with host D, but not with hosts that are outside of
    its VLAN. VLAN1 is more complex as there are ports of this VLAN on several switches.
    To support such VLANs, local configuration is not sufficient anymore. When a switch
    receives a frame from another switch, it must be able to determine the VLAN in
    which the frame originated to use the correct MAC table to forward the frame.
    This is done by assigning an identifier to each Virtual LAN and placing this identifier
    inside the headers of the frames that are exchanged between switches.
  id: totrans-134
  prefs: []
  type: TYPE_NORMAL
  zh: 图 [图 178](#fig-vlan) 展示了一个包含三个虚拟局域网（VLAN）的交换式以太网网络。VLAN2 和 VLAN3 只需要交换机 S1 的本地配置。主机
    C 可以与主机 D 交换帧，但不能与它所在 VLAN 外的主机交换帧。VLAN1 更为复杂，因为这个 VLAN 的端口分布在几个交换机上。为了支持这样的 VLAN，仅本地配置已不再足够。当交换机从另一个交换机接收帧时，它必须能够确定帧的来源
    VLAN，以便使用正确的 MAC 表来转发帧。这是通过为每个虚拟局域网分配一个标识符，并将此标识符放置在交换机之间交换的帧的头部来实现的。
- en: '[![../_images/datalink-fig-017-c.png](../Images/2d641cc82f586881a3a072f7fc5bfdc8.png)](../_images/datalink-fig-017-c.png)'
  id: totrans-135
  prefs: []
  type: TYPE_NORMAL
  zh: '[![../_images/datalink-fig-017-c.png](../Images/2d641cc82f586881a3a072f7fc5bfdc8.png)](../_images/datalink-fig-017-c.png)'
- en: Fig. 178 Virtual Local Area Networks in a switched Ethernet network[#](#fig-vlan
    "Link to this image")
  id: totrans-136
  prefs: []
  type: TYPE_NORMAL
  zh: 图 178 交换式以太网网络中的虚拟局域网[#](#fig-vlan "链接到此图像")
- en: IEEE defined in the [[IEEE802.1q]](../bibliography.html#ieee802-1q) standard
    a special header to encode the VLAN identifiers. This 32 bit header includes a
    12 bit VLAN field that contains the VLAN identifier of each frame. The format
    of the [[IEEE802.1q]](../bibliography.html#ieee802-1q) header is shown in figure
    [Fig. 179](#fig-8021q).
  id: totrans-137
  prefs: []
  type: TYPE_NORMAL
  zh: IEEE 在 [[IEEE802.1q]](../bibliography.html#ieee802-1q) 标准中定义了一个特殊的头部来编码 VLAN
    标识符。这个 32 位头部包括一个 12 位的 VLAN 字段，它包含每个帧的 VLAN 标识符。[[IEEE802.1q]](../bibliography.html#ieee802-1q)
    头部的格式如图 [图 179](#fig-8021q) 所示。
- en: '[![../_images/8021q.svg](../Images/a5322aedde97417cdbe8bf165a0df75e.png)](../_images/8021q.svg)'
  id: totrans-138
  prefs: []
  type: TYPE_NORMAL
  zh: '[![../_images/8021q.svg](../Images/a5322aedde97417cdbe8bf165a0df75e.png)](../_images/8021q.svg)'
- en: Fig. 179 Format of the 802.1q header[#](#fig-8021q "Link to this image")
  id: totrans-139
  prefs: []
  type: TYPE_NORMAL
  zh: 图 179 802.1q 头部格式[#](#fig-8021q "链接到这个图像")
- en: The [[IEEE802.1q]](../bibliography.html#ieee802-1q) header is inserted immediately
    after the source MAC address in the Ethernet frame (i.e. before the EtherType
    field). The maximum frame size is increased by 4 bytes. It is encoded in 32 bits
    and contains four fields. The Tag Protocol Identifier is set to 0x8100 to allow
    the receiver to detect the presence of this additional header. The Priority Code
    Point (PCP) is a three bit field that is used to support different transmission
    priorities for the frame. Value 0 is the lowest priority and value 7 the highest.
    Frames with a higher priority can expect to be forwarded earlier than frames having
    a lower priority. The C bit is used for compatibility between Ethernet and Token
    Ring networks. The last 12 bits of the 802.1q header contain the VLAN identifier.
    Value 0 indicates that the frame does not belong to any VLAN while value 0xFFF
    is reserved. This implies that 4094 different VLAN identifiers can be used in
    an Ethernet network.
  id: totrans-140
  prefs: []
  type: TYPE_NORMAL
  zh: '[[IEEE802.1q]](../bibliography.html#ieee802-1q) 头部被插入到以太网帧中的源 MAC 地址之后（即在 EtherType
    字段之前）。最大帧大小增加了 4 个字节。它以 32 位编码，包含四个字段。标签协议标识符被设置为 0x8100，以便接收器检测到这个附加头部的存在。优先级代码点（PCP）是一个三位字段，用于支持帧的不同传输优先级。值
    0 是最低优先级，值 7 是最高优先级。具有较高优先级的帧可以期望比具有较低优先级的帧更早地转发。C 位用于以太网和令牌环网络之间的兼容性。802.1q 头部的最后
    12 位包含 VLAN 标识符。值 0 表示帧不属于任何 VLAN，而值 0xFFF 是保留的。这意味着在以太网网络中可以使用 4094 个不同的 VLAN
    标识符。'
- en: 802.11 wireless networks[#](#wireless-networks "Link to this heading")
  id: totrans-141
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 802.11 无线网络[#](#wireless-networks "链接到这个标题")
- en: The radio spectrum is a limited resource that must be shared by everyone. During
    most of the twentieth century, governments and international organizations have
    regulated most of the radio spectrum. This regulation controls the utilization
    of the radio spectrum, in order to prevent interference among different users.
    A company that wants to use a frequency range in a given region must apply for
    a license from the regulator. Most regulators charge a fee for the utilization
    of the radio spectrum and some governments have encouraged competition among companies
    bidding for the same frequency to increase the license fees.
  id: totrans-142
  prefs: []
  type: TYPE_NORMAL
  zh: 无线电频谱是一种有限的资源，必须由每个人共享。在二十世纪的绝大部分时间里，政府和国际组织已经监管了大部分的无线电频谱。这种监管控制了无线电频谱的利用，以防止不同用户之间的干扰。任何想要在特定区域使用频段范围的公司必须向监管机构申请许可证。大多数监管机构对无线电频谱的利用收取费用，一些政府鼓励对同一频段进行投标的公司之间的竞争，以增加许可证费用。
- en: 'In the 1970s, after the first experiments with ALOHANet, interest in wireless
    networks grew. Many experiments were done on and outside the ARPANet. One of these
    experiments was the [first mobile phone](http://news.bbc.co.uk/2/hi/programmes/click_online/8639590.stm)
    , which was developed and tested in 1973\. This experimental mobile phone was
    the starting point for the first generation analog mobile phones. Given the growing
    demand for mobile phones, it was clear that the analog mobile phone technology
    was not sufficient to support a large number of users. To support more users and
    new services, researchers in several countries worked on the development of digital
    mobile telephones. In 1987, several European countries decided to develop the
    standards for a common cellular telephone system across Europe : the Global System
    for Mobile Communications (GSM). Since then, the standards have evolved and more
    than three billion users are connected to GSM networks today.'
  id: totrans-143
  prefs: []
  type: TYPE_NORMAL
  zh: 在20世纪70年代，在首次进行ALOHANet实验之后，对无线网络产生了兴趣。许多实验在ARPANet内部和外部进行。其中之一是[第一台移动电话](http://news.bbc.co.uk/2/hi/programmes/click_online/8639590.stm)，它在1973年被开发和测试。这款实验性移动电话是第一代模拟移动电话的起点。鉴于对移动电话不断增长的需求，很明显，模拟移动电话技术不足以支持大量用户。为了支持更多用户和新服务，几个国家的科研人员致力于数字移动电话的开发。1987年，几个欧洲国家决定开发一个覆盖整个欧洲的共同蜂窝电话系统标准：全球移动通信系统（GSM）。从那时起，这些标准已经发展，今天超过30亿用户连接到了GSM网络上。
- en: While most of the frequency ranges of the radio spectrum are reserved for specific
    applications and require a special license, there are a few exceptions. These
    exceptions are known as the [Industrial, Scientific and Medical](http://en.wikipedia.org/wiki/ISM_band)
    (ISM) radio bands. These bands can be used for industrial, scientific and medical
    applications without requiring a license from the regulator. For example, some
    radio-controlled models use the 27 MHz ISM band and some cordless telephones operate
    in the 915 MHz ISM. In 1985, the 2.400-2.500 GHz band was added to the list of
    ISM bands. This frequency range corresponds to the frequencies that are emitted
    by microwave ovens. Sharing this band with licensed applications would have likely
    caused interference, given the large number of microwave ovens that are used.
    Despite the risk of interference with microwave ovens, the opening of the 2.400-2.500
    GHz allowed the networking industry to develop several wireless network techniques
    to allow computers to exchange data without using cables. In this section, we
    discuss in more detail the most popular one, i.e. the WiFi [[IEEE802.11]](../bibliography.html#ieee802-11)
    family of wireless networks. Other wireless networking techniques such as [BlueTooth](http://en.wikipedia.org/wiki/BlueTooth)
    or [HiperLAN](http://en.wikipedia.org/wiki/HiperLAN) use the same frequency range.
  id: totrans-144
  prefs: []
  type: TYPE_NORMAL
  zh: 尽管无线电频谱的大部分频段被保留用于特定应用并需要特殊许可证，但也有一些例外。这些例外被称为[工业、科学和医疗](http://en.wikipedia.org/wiki/ISM_band)（ISM）无线电频段。这些频段可以用于工业、科学和医疗应用，而无需从监管机构获得许可证。例如，一些无线电遥控模型使用27
    MHz ISM频段，一些无绳电话在915 MHz ISM频段工作。1985年，2.400-2.500 GHz频段被添加到ISM频段列表中。这个频段对应于微波炉发出的频率。考虑到使用的微波炉数量众多，与授权应用共享这个频段可能会引起干扰。尽管存在与微波炉干扰的风险，但2.400-2.500
    GHz频段的开放使得网络行业能够开发几种无线网络技术，允许计算机在不使用电缆的情况下交换数据。在本节中，我们将更详细地讨论最受欢迎的一种，即WiFi [[IEEE802.11]](../bibliography.html#ieee802-11)无线网络家族。其他无线网络技术，如[蓝牙](http://en.wikipedia.org/wiki/BlueTooth)或[HiperLAN](http://en.wikipedia.org/wiki/HiperLAN)，使用相同的频段。
- en: Today, WiFi is a very popular wireless networking technology. There are more
    than several hundreds of millions of WiFi devices. The development of this technology
    started in the late 1980s with the [WaveLAN](http://en.wikipedia.org/wiki/WaveLAN)
    proprietary wireless network. WaveLAN operated at 2 Mbps and used different frequency
    bands in different regions of the world. In the early 1990s, the [IEEE](https://www.ieee.org)
    created the [802.11 working group](http://www.ieee802.org/11/) to standardize
    a family of wireless network technologies. This working group was very prolific
    and produced several wireless networking standards that use different frequency
    ranges and different physical layers. The table below provides a summary of the
    main 802.11 standards.
  id: totrans-145
  prefs: []
  type: TYPE_NORMAL
  zh: 今天，WiFi是一种非常流行的无线网络技术。WiFi设备超过数亿台。这项技术的发展始于20世纪80年代末的[WaveLAN](http://en.wikipedia.org/wiki/WaveLAN)专有无线网络。WaveLAN在2
    Mbps的速度下运行，并在世界不同地区的不同频段上工作。在20世纪90年代初，[IEEE](https://www.ieee.org)创建了[802.11工作组](http://www.ieee802.org/11/)，以标准化一系列无线网络技术。这个工作组非常活跃，产生了多个使用不同频段和不同物理层的无线网络标准。下表提供了主要802.11标准的总结。
- en: '| Standard | Frequency | Typical throughput | Max bandwidth | Range (m) indoor/outdoor
    |'
  id: totrans-146
  prefs: []
  type: TYPE_TB
  zh: '| 标准 | 频率 | 典型吞吐量 | 最大带宽 | 范围（室内/室外） |'
- en: '| --- | --- | --- | --- | --- |'
  id: totrans-147
  prefs: []
  type: TYPE_TB
  zh: '| --- | --- | --- | --- | --- |'
- en: '| 802.11 | 2.4 GHz | 0.9 Mbps | 2 Mbps | 20/100 |'
  id: totrans-148
  prefs: []
  type: TYPE_TB
  zh: '| 802.11 | 2.4 GHz | 0.9 Mbps | 2 Mbps | 20/100 |'
- en: '| 802.11a | 5 GHz | 23 Mbps | 54 Mbps | 35/120 |'
  id: totrans-149
  prefs: []
  type: TYPE_TB
  zh: '| 802.11a | 5 GHz | 23 Mbps | 54 Mbps | 35/120 |'
- en: '| 802.11b | 2.4 GHz | 4.3 Mbps | 11 Mbps | 38/140 |'
  id: totrans-150
  prefs: []
  type: TYPE_TB
  zh: '| 802.11b | 2.4 GHz | 4.3 Mbps | 11 Mbps | 38/140 |'
- en: '| 802.11g | 2.4 GHz | 19 Mbps | 54 Mbps | 38/140 |'
  id: totrans-151
  prefs: []
  type: TYPE_TB
  zh: '| 802.11g | 2.4 GHz | 19 Mbps | 54 Mbps | 38/140 |'
- en: '| 802.11n | 2.4/5 GHz | 74 Mbps | 150 Mbps | 70/250 |'
  id: totrans-152
  prefs: []
  type: TYPE_TB
  zh: '| 802.11n | 2.4/5 GHz | 74 Mbps | 150 Mbps | 70/250 |'
- en: When developing its family of standards, the [IEEE 802.11 working group](http://www.ieee802.org/11/)
    took a similar approach as the [IEEE 802.3 working group](http://www.ieee802.org/3/)
    that developed various types of physical layers for Ethernet networks. 802.11
    networks use the CSMA/CA Medium Access Control technique described earlier and
    they all assume the same architecture and use the same frame format.
  id: totrans-153
  prefs: []
  type: TYPE_NORMAL
  zh: 在开发其标准系列时，[IEEE 802.11工作组](http://www.ieee802.org/11/)采取了与[IEEE 802.3工作组](http://www.ieee802.org/3/)类似的方法，后者为以太网网络开发了各种类型的物理层。802.11网络使用前面描述的CSMA/CA介质访问控制技术，并且它们都假设相同的架构并使用相同的帧格式。
- en: 'The architecture of WiFi networks is slightly different from the Local Area
    Networks that we have discussed until now. There are, in practice, two main types
    of WiFi networks : independent or adhoc networks and infrastructure networks [[10]](#fbss).
    An independent or adhoc network is composed of a set of devices that communicate
    with each other. These devices play the same role and the adhoc network is usually
    not connected to the global Internet. Adhoc networks are used when for example
    a few laptops need to exchange information or to connect a computer with a WiFi
    printer.'
  id: totrans-154
  prefs: []
  type: TYPE_NORMAL
  zh: WiFi网络的架构与我们至今讨论的局域网略有不同。实际上，WiFi网络主要有两种类型：独立或ad-hoc网络和基础设施网络[[10]](#fbss)。一个独立或ad-hoc网络由一组相互通信的设备组成。这些设备扮演相同的角色，ad-hoc网络通常不连接到全球互联网。当例如几台笔记本电脑需要交换信息或连接一台计算机到WiFi打印机时，会使用ad-hoc网络。
- en: '[![../_images/datalink-fig-018-c.png](../Images/04f0be24510b17bef06b3589cb0893eb.png)](../_images/datalink-fig-018-c.png)'
  id: totrans-155
  prefs: []
  type: TYPE_NORMAL
  zh: '[![../_images/datalink-fig-018-c.png](../Images/04f0be24510b17bef06b3589cb0893eb.png)](../_images/datalink-fig-018-c.png)'
- en: Fig. 180 An 802.11 independent or adhoc network[#](#fig-wifi-adhoc "Link to
    this image")
  id: totrans-156
  prefs: []
  type: TYPE_NORMAL
  zh: 图180 一个802.11独立或ad-hoc网络[#](#fig-wifi-adhoc "链接到这张图片")
- en: Most WiFi networks are infrastructure networks. An infrastructure network contains
    one or more access points that are attached to a fixed Local Area Network (usually
    an Ethernet network) that is connected to other networks such as the Internet.
    Figure `fig-wifi-infra` shows such a network with two access points and four WiFi
    devices. Each WiFi device is associated to one access point and uses this access
    point as a relay to exchange frames with the devices that are associated to another
    access point or reachable through the LAN.
  id: totrans-157
  prefs: []
  type: TYPE_NORMAL
  zh: 大多数WiFi网络是基础设施网络。一个基础设施网络包含一个或多个接入点，这些接入点连接到一个固定的局域网（通常是一个以太网网络），该网络连接到其他网络，如互联网。图`fig-wifi-infra`显示了这样一个网络，有两个接入点和四个WiFi设备。每个WiFi设备都与一个接入点关联，并使用该接入点作为中继，与其他接入点关联的设备或通过局域网可达的设备交换帧。
- en: '[![../_images/datalink-fig-019-c.png](../Images/f0d5e9e6d0d36f1759d63a3558c0f00a.png)](../_images/datalink-fig-019-c.png)'
  id: totrans-158
  prefs: []
  type: TYPE_NORMAL
  zh: '[![../_images/datalink-fig-019-c.png](../Images/f0d5e9e6d0d36f1759d63a3558c0f00a.png)](../_images/datalink-fig-019-c.png)'
- en: Fig. 181 An 802.11 infrastructure network[#](#fig-wifi-infra "Link to this image")
  id: totrans-159
  prefs: []
  type: TYPE_NORMAL
  zh: 图181 802.11基础设施网络[#](#fig-wifi-infra "链接到这张图片")
- en: An 802.11 access point is a relay that operates in the datalink layer like switches.
    Figure `fig-wifi-ap` represents the layers of the reference model that are involved
    when a WiFi host communicates with a host attached to an Ethernet network through
    an access point.
  id: totrans-160
  prefs: []
  type: TYPE_NORMAL
  zh: 802.11接入点是一个在链路层像交换机一样工作的中继。图 `fig-wifi-ap` 表示当WiFi主机通过接入点与连接到以太网网络的宿主机通信时，涉及的参考模型层。
- en: '![Figure made with TikZ](../Images/0faeff9a8c796e457aba98b2fbbe785f.png)'
  id: totrans-161
  prefs:
  - PREF_BQ
  type: TYPE_IMG
  zh: '![使用TikZ制作的图](../Images/0faeff9a8c796e457aba98b2fbbe785f.png)'
- en: ''
  id: totrans-162
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: Fig. 182 An 802.11 access point
  id: totrans-163
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
  zh: 图182 802.11接入点
- en: 802.11 devices exchange variable length frames, which have a slightly different
    structure than the simple frame format used in Ethernet LANs. We review the key
    parts of the 802.11 frames. Additional details may be found in [[IEEE802.11]](../bibliography.html#ieee802-11)
    and [[Gast2002]](../bibliography.html#gast2002) . An 802.11 frame contains a fixed
    length header, a variable length payload that may contain up 2324 bytes of user
    data and a 32 bits CRC. Although the payload can contain up to 2324 bytes, most
    802.11 deployments use a maximum payload size of 1500 bytes as they are used in
    infrastructure networks attached to Ethernet LANs. An 802.11 data frame is shown
    in figure `fig-80211-packet`.
  id: totrans-164
  prefs: []
  type: TYPE_NORMAL
  zh: 802.11设备交换可变长度的帧，这些帧的结构与以太网局域网中使用的简单帧格式略有不同。我们回顾了802.11帧的关键部分。更多详细信息可以在 [[IEEE802.11]](../bibliography.html#ieee802-11)
    和 [[Gast2002]](../bibliography.html#gast2002) 中找到。一个802.11帧包含一个固定长度的头部、一个可变长度的有效载荷，可能包含多达2324字节的用户数据，以及一个32位的CRC校验和。尽管有效载荷可以包含多达2324字节，但大多数802.11部署使用最大有效载荷大小为1500字节，因为它们用于连接到以太网局域网的基础设施网络。802.11数据帧如图
    `fig-80211-packet` 所示。
- en: '[![../_images/80211.svg](../Images/d4417bb14a34ecaa4ca9eb5590e752b4.png)](../_images/80211.svg)'
  id: totrans-165
  prefs: []
  type: TYPE_NORMAL
  zh: '[![../_images/80211.svg](../Images/d4417bb14a34ecaa4ca9eb5590e752b4.png)](../_images/80211.svg)'
- en: Fig. 183 802.11 data frame format[#](#fig-80211-packet "Link to this image")
  id: totrans-166
  prefs: []
  type: TYPE_NORMAL
  zh: 图183 802.11数据帧格式[#](#fig-80211-packet "链接到这张图片")
- en: The first part of the 802.11 header is the 16 bit Frame Control field. This
    field contains flags that indicate the type of frame (data frame, RTS/CTS, acknowledgment,
    management frames, etc), whether the frame is sent to or from a fixed LAN, etc
    [[IEEE802.11]](../bibliography.html#ieee802-11). The Duration is a 16 bit field
    that is used to reserve the transmission channel. In data frames, the Duration
    field is usually set to the time required to transmit one acknowledgment frame
    after a SIFS delay. Note that the Duration field must be set to zero in multicast
    and broadcast frames. As these frames are not acknowledged, there is no need to
    reserve the transmission channel after their transmission. The Sequence control
    field contains a 12 bits sequence number that is incremented for each data frame
    and a 4 bits fragment number.
  id: totrans-167
  prefs: []
  type: TYPE_NORMAL
  zh: 802.11头部的前一部分是16位的帧控制字段。该字段包含指示帧类型（数据帧、RTS/CTS、确认、管理帧等）、帧是否发送到或来自固定LAN等标志。持续时间是一个16位的字段，用于保留传输通道。在数据帧中，持续时间字段通常设置为在SIFS延迟后传输一个确认帧所需的时间。请注意，在多播和广播帧中，持续时间字段必须设置为0。因为这些帧不需要确认，所以在传输后没有必要保留传输通道。序列控制字段包含一个12位的序列号，该序列号在每个数据帧中递增，以及一个4位的分段号。
- en: The astute reader may have noticed that the 802.11 data frames contain three
    48-bits address fields [[11]](#f4addresses) . This is surprising compared to other
    protocols in the network and datalink layers whose headers only contain a source
    and a destination address. The need for a third address in the 802.11 header comes
    from the infrastructure networks. In such a network, frames are usually exchanged
    between routers and servers attached to the LAN and WiFi devices attached to one
    of the access points. The role of the three address fields is specified by bit
    flags in the Frame Control field.
  id: totrans-168
  prefs: []
  type: TYPE_NORMAL
  zh: 精明的读者可能已经注意到，802.11数据帧包含三个48位的地址字段 [[11]](#f4addresses)。与其他网络和链路层协议相比，这些协议的头部只包含源地址和目的地址，这一点令人惊讶。802.11头部中第三个地址的需求来自基础设施网络。在这样的网络中，帧通常在连接到LAN的路由器和服务器之间以及连接到接入点之一的WiFi设备之间交换。三个地址字段的作用由帧控制字段中的位标志指定。
- en: 'When a frame is sent from a WiFi device to a server attached to the same LAN
    as the access point, the first address of the frame is set to the MAC address
    of the access point, the second address is set to the MAC address of the source
    WiFi device and the third address is the address of the final destination on the
    LAN. When the server replies, it sends an Ethernet frame whose source address
    is its MAC address and the destination address is the MAC address of the WiFi
    device. This frame is captured by the access point that converts the Ethernet
    header into an 802.11 frame header. The 802.11 frame sent by the access point
    contains three addresses : the first address is the MAC address of the destination
    WiFi device, the second address is the MAC address of the access point and the
    third address the MAC address of the server that sent the frame.'
  id: totrans-169
  prefs: []
  type: TYPE_NORMAL
  zh: 当一个帧从一个 WiFi 设备发送到连接到同一 LAN 的服务器时，帧的第一个地址设置为接入点的 MAC 地址，第二个地址设置为源 WiFi 设备的 MAC
    地址，第三个地址是 LAN 上的最终目的地地址。当服务器回复时，它发送一个以太网帧，其源地址是其 MAC 地址，目的地址是 WiFi 设备的 MAC 地址。这个帧被接入点捕获，并将以太网头部转换为
    802.11 帧头部。接入点发送的 802.11 帧包含三个地址：第一个地址是目的 WiFi 设备的 MAC 地址，第二个地址是接入点的 MAC 地址，第三个地址是发送帧的服务器的
    MAC 地址。
- en: 802.11 control frames are simpler than data frames. They contain a Frame Control,
    a Duration field and one or two addresses. The acknowledgment frames are very
    small. They only contain the address of the destination of the acknowledgment.
    There is no source address and no Sequence Control field in the acknowledgment
    frames. This is because the acknowledgment frame can easily be associated to the
    previous frame that it acknowledges. Indeed, each unicast data frame contains
    a Duration field that is used to reserve the transmission channel to ensure that
    no collision will affect the acknowledgment frame. The Sequence Control field
    is mainly used by the receiver to remove duplicate frames. Duplicate frames are
    detected as follows. Each data frame contains a 12 bits sequence number in the
    Sequence Control field and the Frame Control field contains the Retry bit flag
    that is set when a frame is transmitted. Each 802.11 receiver stores the most
    recent sequence number received from each source address in frames whose Retry
    bit is reset. Upon reception of a frame with the Retry bit set, the receiver verifies
    its sequence number to determine whether it is a duplicated frame or not.
  id: totrans-170
  prefs: []
  type: TYPE_NORMAL
  zh: 802.11 控制帧比数据帧简单。它们包含一个帧控制字段、一个持续时间字段和一个或两个地址。确认帧非常小。它们只包含确认帧目的地的地址。确认帧中没有源地址和序列控制字段。这是因为确认帧可以很容易地与它所确认的上一帧关联。确实，每个单播数据帧都包含一个用于保留传输通道以确保不会影响确认帧的碰撞的持续时间字段。序列控制字段主要被接收方用于移除重复帧。重复帧的检测方法如下。每个数据帧在序列控制字段中包含一个
    12 位序列号，帧控制字段包含重试位标志，当帧被发送时设置。每个 802.11 接收器存储来自每个源地址的最新序列号，这些帧的 Retry 位被重置。当接收到一个
    Retry 位被设置的帧时，接收器验证其序列号以确定它是否是重复帧。
- en: '[![../_images/80211-cts.svg](../Images/fdb6baf01dc9eef915a1a9a2b7a211ab.png)](../_images/80211-cts.svg)'
  id: totrans-171
  prefs: []
  type: TYPE_NORMAL
  zh: '![802.11 CTS 帧图](../Images/fdb6baf01dc9eef915a1a9a2b7a211ab.png)'
- en: Fig. 184 IEEE 802.11 ACK and CTS frames[#](#fig-80211-cts-ack "Link to this
    image")
  id: totrans-172
  prefs: []
  type: TYPE_NORMAL
  zh: 图 184 IEEE 802.11 ACK 和 CTS 帧[#](#fig-80211-cts-ack "链接到这张图片")
- en: 802.11 RTS/CTS frames are used to reserve the transmission channel, in order
    to transmit one data frame and its acknowledgment. The RTS frames contain a Duration
    and the transmitter and receiver addresses. The Duration field of the RTS frame
    indicates the duration of the entire reservation (i.e. the time required to transmit
    the CTS, the data frame, the acknowledgments and the required SIFS delays). The
    CTS frame has the same format as the acknowledgment frame.
  id: totrans-173
  prefs: []
  type: TYPE_NORMAL
  zh: 802.11 RTS/CTS 帧用于保留传输通道，以便传输一个数据帧及其确认帧。RTS 帧包含一个持续时间字段和发送方与接收方地址。RTS 帧的持续时间字段表示整个保留时间（即传输
    CTS、数据帧、确认帧和所需的 SIFS 延迟所需的时间）。CTS 帧的格式与确认帧相同。
- en: '[![../_images/80211-rts.svg](../Images/3e40ea29420fe60b879e78422f5de602.png)](../_images/80211-rts.svg)'
  id: totrans-174
  prefs: []
  type: TYPE_NORMAL
  zh: '![802.11 RTS 帧图](../Images/3e40ea29420fe60b879e78422f5de602.png)'
- en: Fig. 185 IEEE 802.11 RTS frame format[#](#fig-80211-rst "Link to this image")
  id: totrans-175
  prefs: []
  type: TYPE_NORMAL
  zh: 图 185 IEEE 802.11 RTS 帧格式[#](#fig-80211-rst "链接到这张图片")
- en: Note
  id: totrans-176
  prefs: []
  type: TYPE_NORMAL
  zh: 注意
- en: The 802.11 service
  id: totrans-177
  prefs: []
  type: TYPE_NORMAL
  zh: 802.11 服务
- en: Despite the utilization of acknowledgments, the 802.11 layer only provides an
    unreliable connectionless service like Ethernet networks that do not use acknowledgments.
    The 802.11 acknowledgments are used to minimize the probability of frame duplication.
    They do not guarantee that all frames will be correctly received by their recipients.
    Like Ethernet, 802.11 networks provide a high probability of successful delivery
    of the frames, not a guarantee. Furthermore, it should be noted that 802.11 networks
    do not use acknowledgments for multicast and broadcast frames. This implies that
    in practice such frames are more likely to suffer from transmission errors than
    unicast frames.
  id: totrans-178
  prefs: []
  type: TYPE_NORMAL
  zh: 尽管使用了确认，但802.11层仅提供类似于不使用确认的以太网网络的不可靠无连接服务。802.11确认用于最小化帧重复的概率。它们不能保证所有帧都将被正确接收。像以太网一样，802.11网络提供成功传输帧的高概率，而不是保证。此外，应注意802.11网络不使用确认进行多播和广播帧。这意味着在实践中，此类帧比单播帧更容易出现传输错误。
- en: In addition to the data and control frames that we have briefly described above,
    802.11 networks use several types of management frames. These management frames
    are used for various purposes. We briefly describe some of these frames below.
    A detailed discussion may be found in [[IEEE802.11]](../bibliography.html#ieee802-11)
    and [[Gast2002]](../bibliography.html#gast2002).
  id: totrans-179
  prefs: []
  type: TYPE_NORMAL
  zh: 除了我们上面简要描述的数据和控制帧之外，802.11网络还使用几种类型的管理帧。这些管理帧用于各种目的。以下简要描述了一些这些帧。更详细的讨论可以在[[IEEE802.11]](../bibliography.html#ieee802-11)和[[Gast2002]](../bibliography.html#gast2002)中找到。
- en: A first type of management frames are the beacon frames. These frames are broadcasted
    regularly by access points. Each beacon frame contains information about the capabilities
    of the access point (e.g. the supported 802.11 transmission rates) and a Service
    Set Identity (SSID). The SSID is a null-terminated ASCII string that can contain
    up to 32 characters. An access point may support several SSIDs and announce them
    in beacon frames. An access point may also choose to remain silent and not advertise
    beacon frames. In this case, WiFi stations may send Probe request frames to force
    the available access points to return a Probe response frame.
  id: totrans-180
  prefs: []
  type: TYPE_NORMAL
  zh: 第一种类型的管理帧是信标帧。这些帧由接入点定期广播。每个信标帧包含有关接入点功能的信息（例如，支持的802.11传输速率）以及一个服务集标识符（SSID）。SSID是一个以空字符终止的ASCII字符串，可以包含多达32个字符。接入点可能支持多个SSID并在信标帧中宣布它们。接入点也可能选择保持沉默，不广播信标帧。在这种情况下，WiFi站点可能会发送探测请求帧，迫使可用的接入点返回探测响应帧。
- en: Note
  id: totrans-181
  prefs: []
  type: TYPE_NORMAL
  zh: 注意
- en: IP over 802.11
  id: totrans-182
  prefs: []
  type: TYPE_NORMAL
  zh: 802.11上的IP
- en: 'Two types of encapsulation schemes were defined to support IP in Ethernet networks
    : the original encapsulation scheme, built above the Ethernet DIX format is defined
    in [**RFC 894**](https://datatracker.ietf.org/doc/html/rfc894.html) and a second
    encapsulation [**RFC 1042**](https://datatracker.ietf.org/doc/html/rfc1042.html)
    scheme, built above the LLC/SNAP protocol [[IEEE802.2]](../bibliography.html#ieee802-2).
    In 802.11 networks, the situation is simpler and only the [**RFC 1042**](https://datatracker.ietf.org/doc/html/rfc1042.html)
    encapsulation is used. In practice, this encapsulation adds 6 bytes to the 802.11
    header. The first four bytes correspond to the LLC/SNAP header. They are followed
    by the two bytes Ethernet Type field (0x800 for IP and 0x806 for ARP). Figure
    `fig-ip-80211` shows an IP packet encapsulated in an 802.11 frame.'
  id: totrans-183
  prefs: []
  type: TYPE_NORMAL
  zh: 为了在以太网网络中支持IP，定义了两种封装方案：原始封装方案，建立在以太网DIX格式之上，在[**RFC 894**](https://datatracker.ietf.org/doc/html/rfc894.html)中定义；第二种封装[**RFC
    1042**](https://datatracker.ietf.org/doc/html/rfc1042.html)方案，建立在LLC/SNAP协议[[IEEE802.2]](../bibliography.html#ieee802-2)之上。在802.11网络中，情况更简单，仅使用[**RFC
    1042**](https://datatracker.ietf.org/doc/html/rfc1042.html)封装。实际上，这种封装在802.11头部增加了6个字节。前四个字节对应于LLC/SNAP头部。它们后面跟着两个字节的以太网类型字段（0x800用于IP，0x806用于ARP）。图`fig-ip-80211`显示了封装在802.11帧中的IP数据包。
- en: '[![../_images/ip-80211.svg](../Images/67e54b3cd9e60b19209b0a7114c48c39.png)](../_images/ip-80211.svg)'
  id: totrans-184
  prefs: []
  type: TYPE_NORMAL
  zh: '![802.11上的IP](../Images/67e54b3cd9e60b19209b0a7114c48c39.png)'
- en: Fig. 186 IP over IEEE 802.11[#](#fig-ip-80211 "Link to this image")
  id: totrans-185
  prefs: []
  type: TYPE_NORMAL
  zh: 图186 IP通过IEEE 802.11[#](#fig-ip-80211 "链接到这张图片")
- en: The second important utilization of the management frames is to allow a WiFi
    station to be associated with an access point. When a WiFi station starts, it
    listens to beacon frames to find the available SSIDs. To be allowed to send and
    receive frames via an access point, a WiFi station must be associated to this
    access point. If the access point does not use any security mechanism to secure
    the wireless transmission, the WiFi station simply sends an Association request
    frame to its preferred access point (usually the access point that it receives
    with the strongest radio signal). This frame contains some parameters chosen by
    the WiFi station and the SSID that it requests to join. The access point replies
    with an Association response frame if it accepts the WiFI station.
  id: totrans-186
  prefs: []
  type: TYPE_NORMAL
  zh: 管理帧的第二项重要用途是允许WiFi站点与接入点关联。当WiFi站点启动时，它会监听信标帧以找到可用的SSID。要允许通过接入点发送和接收帧，WiFi站点必须与该接入点关联。如果接入点不使用任何安全机制来保护无线传输，WiFi站点只需向其首选接入点（通常是它接收到的具有最强无线电信号的接入点）发送一个关联请求帧。此帧包含WiFi站点选择的某些参数以及它请求加入的SSID。如果接入点接受该WiFi站点，它会用一个关联响应帧回复。
- en: Footnotes
  id: totrans-187
  prefs: []
  type: TYPE_NORMAL
  zh: 脚注
- en: '## The Point-to-Point Protocol[#](#the-point-to-point-protocol "Link to this
    heading")'
  id: totrans-188
  prefs: []
  type: TYPE_NORMAL
  zh: '## 点对点协议[#](#the-point-to-point-protocol "链接到这个标题")'
- en: Many point-to-point datalink layers [[1]](#flapb) have been developed, starting
    in the 1960s. In this section, we focus on the protocols that are often used to
    transport IP packets between hosts or routers that are directly connected by a
    point-to-point link. This link can be a dedicated physical cable, a leased line
    through the telephone network or a dial-up connection with modems on the two communicating
    hosts.
  id: totrans-189
  prefs: []
  type: TYPE_NORMAL
  zh: 从20世纪60年代开始，已经开发了多种点对点数据链路层[[1]](#flapb)。在本节中，我们关注的是通常用于在通过点对点链路直接连接的主机或路由器之间传输IP数据包的协议。这种链路可以是一条专用物理电缆、通过电话网络租用的线路，或者两个通信主机上的调制解调器之间的拨号连接。
- en: 'The first solution to transport IP packets over a serial line was proposed
    in [**RFC 1055**](https://datatracker.ietf.org/doc/html/rfc1055.html) and is known
    as Serial Line IP (SLIP). SLIP is a simple character stuffing technique applied
    to IP packets. SLIP defines two special characters : END (decimal 192) and ESC
    (decimal 219). END appears at the beginning and at the end of each transmitted
    IP packet and the sender adds ESC before each END character inside each transmitted
    IP packet. SLIP only supports the transmission of IP packets and it assumes that
    the two communicating hosts/routers have been manually configured with each other’s
    IP address. SLIP was mainly used over links offering bandwidth of often less than
    20 Kbps. On such a low bandwidth link, sending 20 bytes of IP header followed
    by 20 bytes of TCP header for each TCP segment takes a lot of time. This initiated
    the development of a family of compression techniques to efficiently compress
    the TCP/IP headers. The first header compression technique proposed in [**RFC
    1144**](https://datatracker.ietf.org/doc/html/rfc1144.html) was designed to exploit
    the redundancy between several consecutive segments that belong to the same TCP
    connection. In all these segments, the IP addresses and port numbers are always
    the same. Furthermore, fields such as the sequence and acknowledgment numbers
    do not change in a random way. [**RFC 1144**](https://datatracker.ietf.org/doc/html/rfc1144.html)
    defined simple techniques to reduce the redundancy found in successive segments.
    The development of header compression techniques continued and there are still
    improvements being developed now [**RFC 5795**](https://datatracker.ietf.org/doc/html/rfc5795.html).'
  id: totrans-190
  prefs: []
  type: TYPE_NORMAL
  zh: 在 [**RFC 1055**](https://datatracker.ietf.org/doc/html/rfc1055.html) 中提出了在串行线上传输
    IP 分组的第一个解决方案，被称为串行线路 IP (SLIP)。SLIP 是一种应用于 IP 分组的简单字符填充技术。SLIP 定义了两个特殊字符：END（十进制
    192）和 ESC（十进制 219）。END 出现在每个传输的 IP 分组的开始和结束处，发送者在每个传输的 IP 分组中的每个 END 字符之前添加 ESC。SLIP
    只支持 IP 分组的传输，并假设两个通信的主机/路由器已经手动配置了彼此的 IP 地址。SLIP 主要用于带宽通常低于 20 Kbps 的链路上。在这样的低带宽链路上，为每个
    TCP 段发送 20 字节的 IP 头部，然后是 20 字节的 TCP 头部，需要花费很多时间。这促使一系列压缩技术被开发出来，以有效地压缩 TCP/IP
    头部。在 [**RFC 1144**](https://datatracker.ietf.org/doc/html/rfc1144.html) 中提出的第一个头部压缩技术旨在利用属于同一
    TCP 连接的几个连续段之间的冗余。在这些所有段中，IP 地址和端口号始终相同。此外，如序列号和确认号等字段不会以随机方式改变。[**RFC 1144**](https://datatracker.ietf.org/doc/html/rfc1144.html)
    定义了简单的技术来减少连续段中发现的冗余。头部压缩技术的发展仍在继续，现在仍在开发改进技术 [**RFC 5795**](https://datatracker.ietf.org/doc/html/rfc5795.html)。
- en: 'While SLIP was implemented and used in some environments, it had several limitations
    discussed in [**RFC 1055**](https://datatracker.ietf.org/doc/html/rfc1055.html).
    The Point-to-Point Protocol (PPP) was designed shortly after and is specified
    in [**RFC 1548**](https://datatracker.ietf.org/doc/html/rfc1548.html). PPP aims
    to support IP and other network layer protocols over various types of serial lines.
    PPP is in fact a family of three protocols that are used together :'
  id: totrans-191
  prefs: []
  type: TYPE_NORMAL
  zh: 虽然 SLIP 在一些环境中得到了实施和使用，但它存在一些限制，这些限制在 [**RFC 1055**](https://datatracker.ietf.org/doc/html/rfc1055.html)
    中进行了讨论。点对点协议（PPP）随后被设计出来，并在 [**RFC 1548**](https://datatracker.ietf.org/doc/html/rfc1548.html)
    中进行了规定。PPP 的目的是在各种类型的串行线上支持 IP 和其他网络层协议。实际上，PPP 是一组三个协议，它们一起使用：
- en: The Point-to-Point Protocol defines the framing technique to transport network
    layer packets.
  id: totrans-192
  prefs:
  - PREF_BQ
  - PREF_OL
  type: TYPE_NORMAL
  zh: 点对点协议定义了用于传输网络层分组的帧技术。
- en: ''
  id: totrans-193
  prefs:
  - PREF_BQ
  - PREF_IND
  type: TYPE_NORMAL
- en: ''
  id: totrans-194
  prefs:
  - PREF_BQ
  - PREF_IND
  type: TYPE_NORMAL
- en: The Link Control Protocol that is used to negotiate options and authenticate
    the session by using username and password or other types of credentials
  id: totrans-195
  prefs:
  - PREF_BQ
  - PREF_OL
  type: TYPE_NORMAL
  zh: 链路控制协议，用于通过使用用户名和密码或其他类型的凭证协商选项并验证会话
- en: ''
  id: totrans-196
  prefs:
  - PREF_BQ
  - PREF_IND
  type: TYPE_NORMAL
- en: ''
  id: totrans-197
  prefs:
  - PREF_BQ
  - PREF_IND
  type: TYPE_NORMAL
- en: The Network Control Protocol that is specific for each network layer protocol.
    It is used to negotiate options that are specific for each protocol. For example,
    IPv4’s NCP [**RFC 1548**](https://datatracker.ietf.org/doc/html/rfc1548.html)
    can negotiate the IPv4 address to be used, the IPv4 address of the DNS resolver.
    IPv6’s NCP is defined in [**RFC 5072**](https://datatracker.ietf.org/doc/html/rfc5072.html).
  id: totrans-198
  prefs:
  - PREF_BQ
  - PREF_OL
  type: TYPE_NORMAL
  zh: 网络控制协议，针对每个网络层协议特定。它用于协商针对每个协议的特定选项。例如，IPv4 的 NCP [**RFC 1548**](https://datatracker.ietf.org/doc/html/rfc1548.html)
    可以协商要使用的 IPv4 地址，DNS 解析器的 IPv4 地址。IPv6 的 NCP 在 [**RFC 5072**](https://datatracker.ietf.org/doc/html/rfc5072.html)
    中定义。
- en: The PPP framing [**RFC 1662**](https://datatracker.ietf.org/doc/html/rfc1662.html)
    was inspired by the datalink layer protocols standardized by ITU-T and ISO. A
    typical PPP frame is composed of the fields shown in the figure below. A PPP frame
    starts with a one byte flag containing 01111110. PPP can use bit stuffing or character
    stuffing depending on the environment where the protocol is used. The address
    and control fields are present for backward compatibility reasons. The 16 bit
    Protocol field contains the identifier [[2]](#fpppid) of the network layer protocol
    that is carried in the PPP frame. 0x002d is used for an IPv4 packet compressed
    with [**RFC 1144**](https://datatracker.ietf.org/doc/html/rfc1144.html) while
    0x002f is used for an uncompressed IPv4 packet. 0xc021 is used by the Link Control
    Protocol, 0xc023 is used by the Password Authentication Protocol (PAP). 0x0057
    is used for IPv6 packets. PPP supports variable length packets, but LCP can negotiate
    a maximum packet length. The PPP frame ends with a Frame Check Sequence. The default
    is a 16 bits CRC, but some implementations can negotiate a 32 bits CRC. The frame
    ends with the 01111110 flag.
  id: totrans-199
  prefs: []
  type: TYPE_NORMAL
  zh: PPP 帧格式 [**RFC 1662**](https://datatracker.ietf.org/doc/html/rfc1662.html) 是受到
    ITU-T 和 ISO 标准化的数据链路层协议的启发。一个典型的 PPP 帧由下面图中显示的字段组成。PPP 帧以一个包含 01111110 的一个字节标志开始。PPP
    可以根据协议使用的环境使用位填充或字符填充。地址和控制字段的存在是为了向后兼容。16 位协议字段包含 PPP 帧中携带的网络层协议的标识符 [[2]](#fpppid)。0x002d
    用于压缩的 IPv4 数据包，该数据包使用 [**RFC 1144**](https://datatracker.ietf.org/doc/html/rfc1144.html)。0x002f
    用于未压缩的 IPv4 数据包。0xc021 由链路控制协议使用，0xc023 由密码认证协议 (PAP) 使用。0x0057 用于 IPv6 数据包。PPP
    支持可变长度的数据包，但 LCP 可以协商最大数据包长度。PPP 帧以帧校验序列结束。默认是 16 位 CRC，但某些实现可以协商 32 位 CRC。帧以
    01111110 标志结束。
- en: '[![../_images/ppp.svg](../Images/49b08aa9821170a5792f0c343aa273c5.png)](../_images/ppp.svg)'
  id: totrans-200
  prefs: []
  type: TYPE_NORMAL
  zh: '![../_images/ppp.svg](../Images/49b08aa9821170a5792f0c343aa273c5.png)'
- en: Fig. 166 PPP frame format[#](#id186 "Link to this image")
  id: totrans-201
  prefs: []
  type: TYPE_NORMAL
  zh: 图 166 PPP 帧格式[#](#id186 "链接到此图像")
- en: PPP played a key role in allowing Internet Service Providers to provide dial-up
    access over modems in the late 1990s and early 2000s. ISPs operated modem banks
    connected to the telephone network. For these ISPs, a key issue was to authenticate
    each user connected through the telephone network. This authentication was performed
    by using the Extensible Authentication Protocol (EAP) defined in [**RFC 3748**](https://datatracker.ietf.org/doc/html/rfc3748.html).
    EAP is a simple, but extensible protocol that was initially used by access routers
    to authenticate the users connected through dial-up lines. Several authentication
    methods, starting from the simple username/password pairs to more complex schemes
    have been defined and implemented. When ISPs started to upgrade their physical
    infrastructure to provide Internet access over Asymmetric Digital Subscriber Lines
    (ADSL), they tried to reuse their existing authentication (and billing) systems.
    To meet these requirements, the IETF developed specifications to allow PPP frames
    to be transported over other networks than the point-to-point links for which
    PPP was designed. Nowadays, most ADSL deployments use PPP over either ATM [**RFC
    2364**](https://datatracker.ietf.org/doc/html/rfc2364.html) or Ethernet [**RFC
    2516**](https://datatracker.ietf.org/doc/html/rfc2516.html).
  id: totrans-202
  prefs: []
  type: TYPE_NORMAL
  zh: PPP 在 1990 年代末和 2000 年代初允许互联网服务提供商通过调制解调器提供拨号访问中发挥了关键作用。互联网服务提供商运营着连接到电话网络的调制解调器银行。对于这些互联网服务提供商来说，一个关键问题是验证通过电话网络连接的每个用户。这种验证是通过使用在
    [**RFC 3748**](https://datatracker.ietf.org/doc/html/rfc3748.html) 中定义的可扩展认证协议
    (EAP) 来执行的。EAP 是一个简单但可扩展的协议，最初由接入路由器用于验证通过拨号线路连接的用户。已经定义并实现了多种认证方法，从简单的用户名/密码对到更复杂的方案。当互联网服务提供商开始升级其物理基础设施以通过非对称数字用户线路
    (ADSL) 提供互联网访问时，他们试图重用现有的认证（和计费）系统。为了满足这些要求，IETF 开发了规范，允许 PPP 帧在 PPP 设计的点对点链路之外的其他网络上传输。如今，大多数
    ADSL 部署使用 PPP 通过 ATM [**RFC 2364**](https://datatracker.ietf.org/doc/html/rfc2364.html)
    或以太网 [**RFC 2516**](https://datatracker.ietf.org/doc/html/rfc2516.html)。
- en: Footnotes
  id: totrans-203
  prefs: []
  type: TYPE_NORMAL
  zh: 脚注
- en: '## Ethernet[#](#ethernet "Link to this heading")'
  id: totrans-204
  prefs: []
  type: TYPE_NORMAL
  zh: '## 以太网[#](#ethernet "链接到此标题")'
- en: Ethernet was designed in the 1970s at the Palo Alto Research Center [[Metcalfe1976]](../bibliography.html#metcalfe1976).
    The first prototype [[3]](#fethernethistory) used a coaxial cable as the shared
    medium and 3 Mbps of bandwidth. Ethernet was improved during the late 1970s and
    in the 1980s, Digital Equipment, Intel and Xerox published the first official
    Ethernet specification [[DIX]](../bibliography.html#dix). This specification defines
    several important parameters for Ethernet networks. The first decision was to
    standardize the commercial Ethernet at 10 Mbps. The second decision was the duration
    of the slot time. In Ethernet, a long slot time enables networks to span a long
    distance but forces the host to use a larger minimum frame size. The compromise
    was a slot time of 51.2 microseconds, which corresponds to a minimum frame size
    of 64 bytes.
  id: totrans-205
  prefs: []
  type: TYPE_NORMAL
  zh: 以太网是在20世纪70年代在帕洛阿托研究中心设计的 [[Metcalfe1976]](../bibliography.html#metcalfe1976)。第一个原型
    [[3]](#fethernethistory) 使用同轴电缆作为共享介质，带宽为3 Mbps。以太网在20世纪70年代末和80年代得到了改进，数字设备公司、英特尔和施乐发布了第一个官方以太网规范
    [[DIX]](../bibliography.html#dix)。该规范定义了以太网网络的一些重要参数。第一个决定是将商业以太网标准化为10 Mbps。第二个决定是时隙的持续时间。在以太网中，较长的时隙允许网络跨越更长的距离，但迫使主机使用更大的最小帧大小。妥协方案是时隙为51.2微秒，这对应于最小帧大小为64字节。
- en: The third decision was the frame format. The experimental 3 Mbps Ethernet network
    built at Xerox used short frames containing 8 bit source and destination addresses
    fields, a 16 bit type indication, up to 554 bytes of payload and a 16 bit CRC.
    Using 8 bit addresses was suitable for an experimental network, but it was clearly
    too small for commercial deployments. Although the initial Ethernet specification
    [[DIX]](../bibliography.html#dix) only allowed up to 1024 hosts on an Ethernet
    network, it also recommended three important changes compared to the networking
    technologies that were available at that time. The first change was to require
    each host attached to an Ethernet network to have a globally unique datalink layer
    address. Until then, datalink layer addresses were manually configured on each
    host. [[DP1981]](../bibliography.html#dp1981) went against that state of the art
    and noted “Suitable installation-specific administrative procedures are also needed
    for assigning numbers to hosts on a network. If a host is moved from one network
    to another it may be necessary to change its host number if its former number
    is in use on the new network. This is easier said than done, as each network must
    have an administrator who must record the continuously changing state of the system
    (often on a piece of paper tacked to the wall !). It is anticipated that in future
    office environments, hosts locations will change as often as telephones are changed
    in present-day offices.” The second change introduced by Ethernet was to encode
    each address as a 48 bits field [[DP1981]](../bibliography.html#dp1981). 48 bit
    addresses were huge compared to the networking technologies available in the 1980s,
    but the huge address space had several advantages [[DP1981]](../bibliography.html#dp1981)
    including the ability to allocate large blocks of addresses to manufacturers.
    Eventually, other LAN technologies opted for 48 bits addresses as well [[IEEE802]](../bibliography.html#ieee802)
    . The third change introduced by Ethernet was the definition of broadcast and
    multicast addresses. The need for multicast Ethernet was foreseen in [[DP1981]](../bibliography.html#dp1981)
    and thanks to the size of the addressing space it was possible to reserve a large
    block of multicast addresses for each manufacturer.
  id: totrans-206
  prefs: []
  type: TYPE_NORMAL
  zh: 第三项决定是帧格式。施乐公司建立的实验性3 Mbps以太网网络使用了包含8位源和目的地址字段、16位类型指示、最多554字节的有效载荷和16位CRC校验的短帧。使用8位地址适合于实验性网络，但显然对于商业部署来说太小了。尽管最初的以太网规范[[DIX]](../bibliography.html#dix)只允许以太网网络上有最多1024个主机，但它也对比当时可用的网络技术提出了三个重要的改进。第一个改进是要求每个连接到以太网网络的主机都必须有一个全球唯一的链路层地址。在此之前，链路层地址是在每个主机上手动配置的。[[DP1981]](../bibliography.html#dp1981)反对这种做法，并指出“为分配网络上的主机编号也需要合适的安装特定管理程序。如果一个主机从一个网络移动到另一个网络，如果其原来的编号在新网络上已被使用，那么可能需要更改其主机编号。这比说起来容易做起来难，因为每个网络都必须有一个管理员，他必须记录系统不断变化的状态（通常是一张贴在墙上的纸
    !）。预计在未来的办公环境中，主机的位置变化将像现在办公室里的电话变化一样频繁。”第二个由以太网引入的改进是将每个地址编码为48位字段[[DP1981]](../bibliography.html#dp1981)。与20世纪80年代的现有网络技术相比，48位地址非常庞大，但巨大的地址空间有几个优点[[DP1981]](../bibliography.html#dp1981)，包括能够为制造商分配大量地址块。最终，其他局域网技术也选择了48位地址[[IEEE802]](../bibliography.html#ieee802)。以太网引入的第三个改进是广播和多播地址的定义。在[[DP1981]](../bibliography.html#dp1981)中预见到了多播以太网的需求，并且由于地址空间的大小，可以为每个制造商预留一大块多播地址。
- en: The datalink layer addresses used in Ethernet networks are often called MAC
    addresses. They are structured as shown in figure [Fig. 167](#fig-ethernet-add-format).
    The first bit of the address indicates whether the address identifies a network
    adapter or a multicast group. The upper 24 bits are used to encode an Organization
    Unique Identifier (OUI). This OUI identifies a block of addresses that has been
    allocated by the secretariat [[4]](#foui) that is responsible for the uniqueness
    of Ethernet addresses to a manufacturer. Once a manufacturer has received an OUI,
    it can build and sell products with one of the 16 million addresses in this block.
  id: totrans-207
  prefs: []
  type: TYPE_NORMAL
  zh: 在以太网网络中使用的链路层地址通常被称为MAC地址。它们的结构如图[图167](#fig-ethernet-add-format)所示。地址的第一个比特表示该地址是否标识一个网络适配器或一个多播组。高24位用于编码组织唯一标识符（OUI）。这个OUI标识了一个由负责以太网地址唯一性的秘书处[[4]](#foui)分配的地址块。一旦制造商收到一个OUI，它就可以使用这个块中的1600万个地址之一来构建和销售产品。
- en: '![Figure made with TikZ](../Images/f3897860be3ce498f407c1420b6944b8.png)'
  id: totrans-208
  prefs:
  - PREF_BQ
  type: TYPE_IMG
  zh: '[![../_images/ethernet-util.png](../Images/da4b08a7d46cd9d4962e244a40694091.png)](../_images/ethernet-util.png)'
- en: ''
  id: totrans-209
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: Fig. 167 48 bits Ethernet address format
  id: totrans-210
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
  zh: 图. 167 48位以太网地址格式
- en: The original 10 Mbps Ethernet specification [[DIX]](../bibliography.html#dix)
    defined a simple frame format where each frame is composed of five fields. The
    Ethernet frame starts with a preamble (not shown in figure [Fig. 169](#fig-ethernet-dix))
    that is used by the physical layer of the receiver to synchronize its clock with
    the sender’s clock. The first field of the frame is the destination address. As
    this address is placed at the beginning of the frame, an Ethernet interface can
    quickly verify whether it is the frame recipient and if not, cancel the processing
    of the arriving frame. The second field is the source address. While the destination
    address can be either a unicast or a multicast/broadcast address, the source address
    must always be a unicast address. The third field is a 16 bits integer that indicates
    which type of network layer packet is carried inside the frame. This field is
    often called the EtherType. Frequently used EtherType values [[5]](#fethertype)
    include 0x0800 for IPv4, 0x86DD for IPv6 [[6]](#fipv6ether) and 0x806 for the
    Address Resolution Protocol (ARP).
  id: totrans-211
  prefs: []
  type: TYPE_NORMAL
  zh: '![Figure made with TikZ](../Images/f3897860be3ce498f407c1420b6944b8.png)'
- en: The fourth part of the Ethernet frame is the payload. The minimum length of
    the payload is 46 bytes to ensure a minimum frame size, including the header of
    512 bits. The Ethernet payload cannot be longer than 1500 bytes. This size was
    found reasonable when the first Ethernet specification was written. At that time,
    Xerox had been using its experimental 3 Mbps Ethernet that offered 554 bytes of
    payload and [**RFC 1122**](https://datatracker.ietf.org/doc/html/rfc1122.html)
    required a minimum MTU of 572 bytes for IPv4\. 1500 bytes was large enough to
    support these needs without forcing the network adapters to contain overly large
    memories. Furthermore, simulations and measurement studies performed in Ethernet
    networks revealed that CSMA/CD was able to achieve a very high utilization. This
    is illustrated in figure [Fig. 168](#fig-ethernet-utilization) based on [[SH1980]](../bibliography.html#sh1980),
    which shows the channel utilization achieved in Ethernet networks containing different
    numbers of hosts that are sending frames of different sizes.
  id: totrans-212
  prefs: []
  type: TYPE_NORMAL
  zh: 以太网帧的第四部分是有效载荷。有效载荷的最小长度为46字节，以确保最小帧大小，包括512位的头部。以太网有效载荷的长度不能超过1500字节。当首次编写以太网规范时，这个大小被认为是合理的。当时，施乐公司一直在使用其实验性的3
    Mbps以太网，提供554字节的有效载荷，而[**RFC 1122**](https://datatracker.ietf.org/doc/html/rfc1122.html)要求IPv4的最小MTU为572字节。1500字节足够大，可以满足这些需求，而不需要网络适配器包含过大的内存。此外，在以太网网络中进行的模拟和测量研究表明，CSMA/CD能够实现非常高的利用率。这如图[图.
    168](#fig-ethernet-utilization)所示，基于[[SH1980](../bibliography.html#sh1980)]，它显示了包含不同数量主机且发送不同大小帧的以太网网络中实现的信道利用率。
- en: '[![../_images/ethernet-util.png](../Images/da4b08a7d46cd9d4962e244a40694091.png)](../_images/ethernet-util.png)'
  id: totrans-213
  prefs: []
  type: TYPE_NORMAL
  zh: 原始的10 Mbps以太网规范[[DIX](../bibliography.html#dix)]定义了一个简单的帧格式，其中每个帧由五个字段组成。以太网帧以预同步（在图[图.
    169](#fig-ethernet-dix)中未显示）开始，该预同步由接收器的物理层用于与发送器的时钟同步。帧的第一个字段是目的地址。由于该地址位于帧的开头，以太网接口可以快速验证它是否是帧的接收者，如果不是，则取消处理到达的帧。第二个字段是源地址。虽然目的地址可以是单播或组播/广播地址，但源地址必须是单播地址。第三个字段是一个16位的整数，指示帧内携带哪种类型的网络层数据包。这个字段通常被称为以太网类型。常用的以太网类型值包括0x0800用于IPv4，0x86DD用于IPv6
    [[6](#fipv6ether)]和0x806用于地址解析协议（ARP）。
- en: Fig. 168 Impact of the frame length on the maximum channel utilization [[SH1980]](../bibliography.html#sh1980)[#](#id188
    "Link to this image")
  id: totrans-214
  prefs: []
  type: TYPE_NORMAL
  zh: 图. 168 帧长度对最大信道利用率的影响[[SH1980](../bibliography.html#sh1980)][#](#id188 "链接到这张图片")
- en: The last field of the Ethernet frame is a 32 bit Cyclical Redundancy Check (CRC).
    This CRC is able to catch a much larger number of transmission errors than the
    Internet checksum used by IP, UDP and TCP [[SGP98]](../bibliography.html#sgp98).
    The format of the Ethernet frame is shown in figure [Fig. 169](#fig-ethernet-dix)
    .
  id: totrans-215
  prefs: []
  type: TYPE_NORMAL
  zh: 以太网帧的最后一个字段是一个32位的循环冗余校验（CRC）。这个CRC能够捕获比IP、UDP和TCP使用的互联网校验和更多的传输错误[[SGP98](../bibliography.html#sgp98)]。以太网帧的格式如图[图.
    169](#fig-ethernet-dix)所示。
- en: '[![../_images/ethernet-dix.svg](../Images/163da7add640c911c0e0db0efe6683b0.png)](../_images/ethernet-dix.svg)'
  id: totrans-216
  prefs: []
  type: TYPE_NORMAL
  zh: '![../_images/ethernet-dix.svg](../Images/163da7add640c911c0e0db0efe6683b0.png)'
- en: Fig. 169 Ethernet DIX frame format[#](#fig-ethernet-dix "Link to this image")
  id: totrans-217
  prefs: []
  type: TYPE_NORMAL
  zh: 图. 169 Ethernet DIX帧格式[#](#fig-ethernet-dix "链接到这张图片")
- en: Note
  id: totrans-218
  prefs: []
  type: TYPE_NORMAL
  zh: 注意
- en: Where should the CRC be located in a frame ?
  id: totrans-219
  prefs: []
  type: TYPE_NORMAL
  zh: 在一个帧中CRC应该放在哪里？
- en: The transport and datalink layers usually chose different strategies to place
    their CRCs or checksums. Transport layer protocols usually place their CRCs or
    checksums in the segment header. Datalink layer protocols sometimes place their
    CRC in the frame header, but often in a trailer at the end of the frame. This
    choice reflects implementation assumptions, but also influences performance [**RFC
    893**](https://datatracker.ietf.org/doc/html/rfc893.html). When the CRC is placed
    in the trailer, as in Ethernet, the datalink layer can compute it while transmitting
    the frame and insert it at the end of the transmission. All Ethernet interfaces
    use this optimization today. When the checksum is placed in the header, as in
    a TCP segment, it is impossible for the network interface to compute it while
    transmitting the segment. Some network interfaces provide hardware assistance
    to compute the TCP checksum, but this is more complex than if the TCP checksum
    were placed in the trailer [[7]](#ftso).
  id: totrans-220
  prefs: []
  type: TYPE_NORMAL
  zh: 传输层和数据链路层通常选择不同的策略来放置它们的CRC或校验和。传输层协议通常将它们的CRC或校验和放在段头中。数据链路层协议有时将CRC放在帧头中，但通常放在帧末尾的尾部。这种选择反映了实现假设，但也影响了性能[**RFC
    893**](https://datatracker.ietf.org/doc/html/rfc893.html)。当CRC放在尾部，如以太网中，数据链路层可以在发送帧的同时计算它，并在传输结束时插入。今天所有以太网接口都使用这种优化。当校验和放在头部，如在TCP段中，网络接口在发送段时无法计算它。一些网络接口提供硬件辅助来计算TCP校验和，但这比如果TCP校验和放在尾部要复杂[[7]](#ftso)。
- en: The Ethernet frame format discussed above is specified in [[DIX]](../bibliography.html#dix).
    This is the format used to send both IPv4 [**RFC 894**](https://datatracker.ietf.org/doc/html/rfc894.html)
    and IPv6 packets [**RFC 2464**](https://datatracker.ietf.org/doc/html/rfc2464.html).
    After the publication of [[DIX]](../bibliography.html#dix), the Institute of Electrical
    and Electronic Engineers (IEEE) began to standardize several Local Area Network
    technologies. IEEE worked on several LAN technologies, starting with Ethernet,
    Token Ring and Token Bus. These three technologies were completely different,
    but they all agreed to use the 48 bits MAC addresses specified initially for Ethernet
    [[IEEE802]](../bibliography.html#ieee802) . While developing its Ethernet standard
    [[IEEE802.3]](../bibliography.html#ieee802-3), the IEEE 802.3 working group was
    confronted with a problem. Ethernet mandated a minimum payload size of 46 bytes,
    while some companies were looking for a LAN technology that could transparently
    transport short frames containing only a few bytes of payload. Such a frame can
    be sent by an Ethernet host by padding it to ensure that the payload is at least
    46 bytes long. However since the Ethernet header [[DIX]](../bibliography.html#dix)
    does not contain a length field, it is impossible for the receiver to determine
    how many useful bytes were placed inside the payload field. To solve this problem,
    the IEEE decided to replace the Type field of the Ethernet [[DIX]](../bibliography.html#dix)
    header with a length field [[8]](#ftypelen). This Length field contains the number
    of useful bytes in the frame payload. The payload must still contain at least
    46 bytes, but padding bytes are added by the sender and removed by the receiver.
    In order to add the Length field without significantly changing the frame format,
    IEEE had to remove the Type field. Without this field, it is impossible for a
    receiving host to identify the type of network layer packet inside a received
    frame. To solve this new problem, IEEE developed a completely new sublayer called
    the Logical Link Control [[IEEE802.2]](../bibliography.html#ieee802-2). Several
    protocols were defined in this sublayer. One of them provided a slightly different
    version of the Type field of the original Ethernet frame format. Another contained
    acknowledgments and retransmissions to provide a reliable service… In practice,
    [[IEEE802.2]](../bibliography.html#ieee802-2) is never used to support IP in Ethernet
    networks. Figure [Fig. 170](#fig-ethernet-8023-frame) shows the official [[IEEE802.3]](../bibliography.html#ieee802-3)
    frame format.
  id: totrans-221
  prefs: []
  type: TYPE_NORMAL
  zh: 上文讨论的以太网帧格式在 [[DIX]](../bibliography.html#dix) 中进行了规定。这是用于发送 IPv4 [**RFC 894**](https://datatracker.ietf.org/doc/html/rfc894.html)
    和 IPv6 数据包 [**RFC 2464**](https://datatracker.ietf.org/doc/html/rfc2464.html)
    的格式。在 [[DIX]](../bibliography.html#dix) 发布后，电气和电子工程师协会（IEEE）开始标准化几种局域网技术。IEEE
    从以太网、令牌环和令牌总线等局域网技术开始工作。这三种技术完全不同，但它们都同意使用最初为以太网指定的 48 位 MAC 地址 [[IEEE802]](../bibliography.html#ieee802)。在开发其以太网标准
    [[IEEE802.3]](../bibliography.html#ieee802-3) 的过程中，IEEE 802.3 工作组面临了一个问题。以太网规定最小有效载荷大小为
    46 字节，而一些公司正在寻找一种能够透明地传输仅包含几个字节有效载荷的短帧的局域网技术。这样的帧可以通过以太网主机通过填充来发送，以确保有效载荷至少为 46
    字节长。然而，由于以太网头部 [[DIX]](../bibliography.html#dix) 中不包含长度字段，接收器无法确定有效载荷字段中放置了多少有用的字节。为了解决这个问题，IEEE
    决定用长度字段 [[8]](#ftypelen) 替换以太网 [[DIX]](../bibliography.html#dix) 头部的类型字段。这个长度字段包含帧有效载荷中的有用字节数。有效载荷仍然必须包含至少
    46 字节，但填充字节由发送方添加并由接收方移除。为了在不显著改变帧格式的情况下添加长度字段，IEEE 必须移除类型字段。没有这个字段，接收主机无法识别接收帧中网络层数据包的类型。为了解决这个新问题，IEEE
    开发了一个全新的子层，称为逻辑链路控制 [[IEEE802.2]](../bibliography.html#ieee802-2)。在这个子层中定义了几个协议。其中之一提供了原始以太网帧格式类型字段的略微不同版本。另一个包含了确认和重传，以提供可靠的服务……在实践中，[[IEEE802.2]](../bibliography.html#ieee802-2)
    从未用于在以太网网络中支持 IP。图 [图 170](#fig-ethernet-8023-frame) 展示了官方 [[IEEE802.3]](../bibliography.html#ieee802-3)
    帧格式。
- en: '[![../_images/ethernet-8023.svg](../Images/79781bc50862d2a32133ea8cd17bc68b.png)](../_images/ethernet-8023.svg)'
  id: totrans-222
  prefs: []
  type: TYPE_NORMAL
  zh: '![![../_images/ethernet-8023.svg](../Images/79781bc50862d2a32133ea8cd17bc68b.png)](../_images/ethernet-8023.svg)'
- en: Fig. 170 Ethernet 802.3 frame format[#](#fig-ethernet-8023-frame "Link to this
    image")
  id: totrans-223
  prefs: []
  type: TYPE_NORMAL
  zh: 图 170 以太网 802.3 帧格式[#](#fig-ethernet-8023-frame "链接到这张图片")
- en: Note
  id: totrans-224
  prefs: []
  type: TYPE_NORMAL
  zh: 注意
- en: What is the Ethernet service ?
  id: totrans-225
  prefs: []
  type: TYPE_NORMAL
  zh: 什么是以太网服务？
- en: 'An Ethernet network provides an unreliable connectionless service. It supports
    three different transmission modes : unicast, multicast and broadcast. While the
    Ethernet service is unreliable in theory, a good Ethernet network should, in practice,
    provide a service that:'
  id: totrans-226
  prefs: []
  type: TYPE_NORMAL
  zh: 以太网网络提供一种不可靠的无连接服务。它支持三种不同的传输模式：单播、多播和广播。虽然以太网服务在理论上不可靠，但在实践中，一个好的以太网网络应该提供以下服务：
- en: delivers frames to their destination with a very high probability of successful
    delivery
  id: totrans-227
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 以非常高的概率将帧成功交付到目的地
- en: does not reorder the transmitted frames
  id: totrans-228
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 不重新排序传输的帧
- en: The first property is a consequence of the utilization of CSMA/CD. The second
    property is a consequence of the physical organization of the Ethernet network
    as a shared bus. These two properties are important and all revisions to the Ethernet
    technology have preserved them.
  id: totrans-229
  prefs: []
  type: TYPE_NORMAL
  zh: 第一个特性是CSMA/CD利用的结果。第二个特性是以太网网络作为共享总线物理组织的结果。这两个特性非常重要，并且所有对以太网技术的修订都保留了它们。
- en: Several physical layers have been defined for Ethernet networks. The first physical
    layer, usually called 10Base5, provided 10 Mbps over a thick coaxial cable. The
    characteristics of the cable and the transceivers that were used then enabled
    the utilization of 500 meter long segments. A 10Base5 network can also include
    repeaters between segments.
  id: totrans-230
  prefs: []
  type: TYPE_NORMAL
  zh: 已经为以太网网络定义了多个物理层。第一个物理层通常称为10Base5，通过粗同轴电缆提供10 Mbps的传输速率。当时使用的电缆和收发器的特性使得500米长的段可以被利用。10Base5网络还可以在段之间包含中继器。
- en: The second physical layer was 10Base2\. This physical layer used a thin coaxial
    cable that was easier to install than the 10Base5 cable, but could not be longer
    than 185 meters. A 10BaseF physical layer was also defined to transport Ethernet
    over point-to-point optical links. The major change to the physical layer was
    the support of twisted pairs in the 10BaseT specification. Twisted pair cables
    are traditionally used to support the telephone service in office buildings. Most
    office buildings today are equipped with structured cabling. Several twisted pair
    cables are installed between any room and a central telecom closet per building
    or per floor in large buildings. These telecom closets act as concentration points
    for the telephone service but also for LANs.
  id: totrans-231
  prefs: []
  type: TYPE_NORMAL
  zh: 第二个物理层是10Base2。这个物理层使用的是比10Base5电缆更容易安装的细同轴电缆，但其长度不能超过185米。还定义了一个10BaseF物理层，用于通过点对点光链路传输以太网。物理层的主要变化是在10BaseT规范中支持双绞线。双绞线电缆传统上用于支持办公楼中的电话服务。如今，大多数办公楼都配备了结构化布线。在大楼中，任何房间和中央电信室之间或每层楼之间都安装了几条双绞线电缆。这些电信室作为电话服务的集中点，同时也是局域网的集中点。
- en: The introduction of the twisted pairs led to two major changes to Ethernet.
    The first change concerns the physical topology of the network. 10Base2 and 10Base5
    networks are shared buses, the coaxial cable typically passes through each room
    that contains a connected computer. A 10BaseT network is a star-shaped network.
    All the devices connected to the network are attached to a twisted pair cable
    that ends in the telecom closet. From a maintenance perspective, this is a major
    improvement. The cable is a weak point in 10Base2 and 10Base5 networks. Any physical
    damage on the cable broke the entire network and when such a failure occurred,
    the network administrator had to manually check the entire cable to detect where
    it was damaged. With 10BaseT, when one twisted pair is damaged, only the device
    connected to this twisted pair is affected and this does not affect the other
    devices. The second major change introduced by 10BaseT was that is was impossible
    to build a 10BaseT network by simply connecting all the twisted pairs together.
    All the twisted pairs must be connected to a relay that operates in the physical
    layer. This relay is called an Ethernet hub. A hub is thus a physical layer relay
    that receives an electrical signal on one of its interfaces, regenerates the signal
    and transmits it over all its other interfaces. Some hubs are also able to convert
    the electrical signal from one physical layer to another (e.g. 10BaseT to 10Base2
    conversion). An Ethernet hub is a relay that operates at the physical layer as
    shown in figure [Fig. 171](#fig-ethernet-hub).
  id: totrans-232
  prefs: []
  type: TYPE_NORMAL
  zh: 双绞线的引入导致了以太网的两个主要变化。第一个变化涉及网络的物理拓扑。10Base2 和 10Base5 网络是共享总线，同轴电缆通常穿过包含连接计算机的每个房间。10BaseT
    网络是星形网络。所有连接到网络的所有设备都连接到一条以电信间为终点的双绞线。从维护的角度来看，这是一个重大的改进。在 10Base2 和 10Base5 网络中，电缆是一个弱点。任何电缆上的物理损坏都会破坏整个网络，当发生此类故障时，网络管理员必须手动检查整个电缆以确定损坏的位置。在
    10BaseT 中，当一条双绞线损坏时，只有连接到该双绞线的设备受到影响，这不会影响其他设备。10BaseT 引入的第二个主要变化是，不可能简单地通过连接所有双绞线来构建
    10BaseT 网络。所有双绞线都必须连接到一个在物理层操作的继电器。这个继电器被称为以太网集线器。因此，集线器是一个物理层继电器，它在其中一个接口上接收电信号，再生信号并将其通过其所有其他接口传输。一些集线器还能够将一个物理层的电信号转换到另一个物理层（例如，10BaseT
    到 10Base2 的转换）。以太网集线器是一个在物理层操作的继电器，如图 [图 171](#fig-ethernet-hub) 所示。
- en: '![Figure made with TikZ](../Images/32f9a71dd5d981a251f55babe3afd5bc.png)'
  id: totrans-233
  prefs:
  - PREF_BQ
  type: TYPE_IMG
  zh: '![使用 TikZ 制作的图](../Images/32f9a71dd5d981a251f55babe3afd5bc.png)'
- en: ''
  id: totrans-234
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: Fig. 171 Ethernet hubs in the reference model
  id: totrans-235
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
  zh: 图 171 参考模型中的以太网集线器
- en: Computers can directly be attached to Ethernet hubs. Ethernet hubs themselves
    can be attached to other Ethernet hubs to build a larger network. However, some
    important guidelines must be followed when building a complex network with hubs.
    First, the network topology must be a tree. As hubs are relays in the physical
    layer, adding a link between Hub2 and Hub3 in the network of figure [Fig. 172](#fig-network-hubs)
    would create an electrical shortcut that would completely disrupt the network.
    This implies that there cannot be any redundancy in a hub-based network. A failure
    of a hub or of a link between two hubs would partition the network into two isolated
    networks. Second, as hubs are relays in the physical layer, collisions can happen
    and must be handled by CSMA/CD as in a 10Base5 network. This implies that the
    maximum delay between any pair of devices in the network cannot be longer than
    the 51.2 microseconds slot time. If the delay is longer, collisions between short
    frames may not be correctly detected. This constraint limits the geographical
    spread of 10BaseT networks containing hubs.
  id: totrans-236
  prefs: []
  type: TYPE_NORMAL
  zh: 计算机可以直接连接到以太网集线器。以太网集线器本身也可以连接到其他以太网集线器以构建更大的网络。然而，在构建由集线器组成的复杂网络时，必须遵循一些重要指南。首先，网络拓扑必须是树形。由于集线器是物理层的继电器，在图
    [图 172](#fig-network-hubs) 的网络中在 Hub2 和 Hub3 之间添加一个链接将创建一个电气短路，这将完全破坏网络。这意味着在基于集线器的网络中不能有任何冗余。集线器或两个集线器之间链接的故障会将网络分割成两个孤立的网络。其次，由于集线器是物理层的继电器，可能会发生冲突，并且必须像在
    10Base5 网络中那样由 CSMA/CD 处理。这意味着网络中任何一对设备之间的最大延迟不能超过 51.2 微秒的时隙时间。如果延迟更长，短帧之间的冲突可能无法正确检测。这个约束限制了包含集线器的
    10BaseT 网络的地理分布。
- en: '[![../_images/ethernet-net-hub.png](../Images/7b0810c7bcca0cc446f10cbc40ffc06f.png)](../_images/ethernet-net-hub.png)'
  id: totrans-237
  prefs: []
  type: TYPE_NORMAL
  zh: '![../_images/ethernet-net-hub.png](../Images/7b0810c7bcca0cc446f10cbc40ffc06f.png)'
- en: Fig. 172 A hierarchical Ethernet network composed of hubs[#](#fig-network-hubs
    "Link to this image")
  id: totrans-238
  prefs: []
  type: TYPE_NORMAL
  zh: 图172 由集线器组成的分层以太网网络[#](#fig-network-hubs "链接到这张图片")
- en: In the late 1980s, 10 Mbps became too slow for some applications and network
    manufacturers developed several LAN technologies that offered higher bandwidth,
    such as the 100 Mbps FDDI LAN that used optical fibers. As the development of
    10Base5, 10Base2 and 10BaseT had shown that Ethernet could be adapted to different
    physical layers, several manufacturers started to work on 100 Mbps Ethernet and
    convinced IEEE to standardize this new technology that was initially called Fast
    Ethernet. Fast Ethernet was designed under two constraints. First, Fast Ethernet
    had to support twisted pairs. Although it was easier from a physical layer perspective
    to support higher bandwidth on coaxial cables than on twisted pairs, coaxial cables
    were a nightmare from deployment and maintenance perspectives. Second, Fast Ethernet
    had to be perfectly compatible with the existing 10 Mbps Ethernet to allow Fast
    Ethernet technology to be used initially as a backbone technology to interconnect
    10 Mbps Ethernet networks. This forced Fast Ethernet to use exactly the same frame
    format as 10 Mbps Ethernet. This implied that the minimum Fast Ethernet frame
    size remained at 512 bits. To preserve CSMA/CD with this minimum frame size and
    100 Mbps instead of 10 Mbps, the duration of the slot time was decreased to 5.12
    microseconds.
  id: totrans-239
  prefs: []
  type: TYPE_NORMAL
  zh: 在20世纪80年代末，10 Mbps对于某些应用和网络制造商来说已经太慢了，因此他们开发了几个提供更高带宽的局域网技术，例如使用光纤的100 Mbps
    FDDI局域网。随着10Base5、10Base2和10BaseT的发展，已经表明以太网可以适应不同的物理层，几家制造商开始着手开发100 Mbps以太网，并说服IEEE标准化这一新技术，最初称为快速以太网。快速以太网是在两个约束下设计的。首先，快速以太网必须支持双绞线。尽管从物理层角度来看，在双绞线上支持比在同轴电缆上更高的带宽更容易，但同轴电缆在部署和维护方面却是一个噩梦。其次，快速以太网必须与现有的10
    Mbps以太网完全兼容，以便快速以太网技术最初可以作为骨干技术来互连10 Mbps以太网网络。这迫使快速以太网使用与10 Mbps以太网完全相同的帧格式。这意味着最小快速以太网帧大小保持在512位。为了保持使用最小帧大小和100
    Mbps而不是10 Mbps的CSMA/CD，时隙时间被减少到5.12微秒。
- en: The evolution of Ethernet did not stop. In 1998, the IEEE published a first
    standard to provide Gigabit Ethernet over optical fibers. Several other types
    of physical layers were added afterwards. The [10 Gigabit Ethernet](http://en.wikipedia.org/wiki/10_gigabit_Ethernet)
    standard appeared in 2002\. Work is ongoing to develop [standards](http://www.ieee802.org/3/ba/public/index.html)
    for 40 Gigabit and 100 Gigabit Ethernet and some are thinking about [Terabit Ethernet](http://www.networkworld.com/news/2009/042009-terabit-ethernet.html).
    The table below lists the main Ethernet standards. A more detailed list may be
    found at [http://en.wikipedia.org/wiki/Ethernet_physical_layer](http://en.wikipedia.org/wiki/Ethernet_physical_layer).
  id: totrans-240
  prefs: []
  type: TYPE_NORMAL
  zh: 以太网的演变并未停止。1998年，IEEE发布了一个最初标准，以提供通过光纤的千兆以太网。之后又增加了几种其他类型的物理层。2002年出现了[10千兆以太网](http://en.wikipedia.org/wiki/10_gigabit_Ethernet)标准。目前正在开发40千兆和100千兆以太网的标准，有些人正在考虑[太比特以太网](http://www.networkworld.com/news/2009/042009-terabit-ethernet.html)。下表列出了主要的以太网标准。更详细的列表可以在[http://en.wikipedia.org/wiki/Ethernet_physical_layer](http://en.wikipedia.org/wiki/Ethernet_physical_layer)找到。
- en: '| Standard | Comments |'
  id: totrans-241
  prefs: []
  type: TYPE_TB
  zh: '| 标准 | 备注 |'
- en: '| --- | --- |'
  id: totrans-242
  prefs: []
  type: TYPE_TB
  zh: '| --- | --- |'
- en: '| 10Base5 | Thick coaxial cable, 500m |'
  id: totrans-243
  prefs: []
  type: TYPE_TB
  zh: '| 10Base5 | 厚同轴电缆，500米 |'
- en: '| 10Base2 | Thin coaxial cable, 185m |'
  id: totrans-244
  prefs: []
  type: TYPE_TB
  zh: '| 10Base2 | 薄同轴电缆，185米 |'
- en: '| 10BaseT | Two pairs of category 3+ UTP |'
  id: totrans-245
  prefs: []
  type: TYPE_TB
  zh: '| 10BaseT | 两对3+类UTP |'
- en: '| 10Base-F | 10 Mb/s over optical fiber |'
  id: totrans-246
  prefs: []
  type: TYPE_TB
  zh: '| 10Base-F | 通过光纤的10 Mb/s |'
- en: '| 100Base-Tx | Category 5 UTP or STP, 100 m maximum |'
  id: totrans-247
  prefs: []
  type: TYPE_TB
  zh: '| 100Base-Tx | 5类UTP或STP，最大100米 |'
- en: '| 100Base-FX | Two multi-mode optical fiber, 2 km maximum |'
  id: totrans-248
  prefs: []
  type: TYPE_TB
  zh: '| 100Base-FX | 两个多模光纤，最大2公里 |'
- en: '| 1000Base-CX | Two pairs shielded twisted pair, 25m maximum |'
  id: totrans-249
  prefs: []
  type: TYPE_TB
  zh: '| 1000Base-CX | 两对屏蔽双绞线，最大25米 |'
- en: '| 1000Base-SX | Two multi-mode or single mode optical fibers with lasers |'
  id: totrans-250
  prefs: []
  type: TYPE_TB
  zh: '| 1000Base-SX | 两个多模或单模光纤，使用激光 |'
- en: '| 10 Gbps | Optical fiber but also Category 6 UTP |'
  id: totrans-251
  prefs: []
  type: TYPE_TB
  zh: '| 10 Gbps | 光纤，但也包括6类UTP |'
- en: '| 40-100 Gbps | Optical fiber (experiences are performed with copper) |'
  id: totrans-252
  prefs: []
  type: TYPE_TB
  zh: '| 40-100 Gbps | 光纤（实验使用铜线） |'
- en: Footnotes
  id: totrans-253
  prefs: []
  type: TYPE_NORMAL
  zh: 脚注
- en: Ethernet Switches[#](#ethernet-switches "Link to this heading")
  id: totrans-254
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 以太网交换机[#](#ethernet-switches "链接到这个标题")
- en: Increasing the physical layer bandwidth as in Fast Ethernet was only one of
    the solutions to improve the performance of Ethernet LANs. A second solution was
    to replace the hubs with more intelligent devices. As Ethernet hubs operate in
    the physical layer, they can only regenerate the electrical signal to extend the
    geographical reach of the network. From a performance perspective, it would be
    more interesting to have devices that operate in the datalink layer and can analyze
    the destination address of each frame and forward the frames selectively on the
    link that leads to the destination. Such devices are usually called Ethernet switches
    [[9]](#fbridges). An Ethernet switch is a relay that operates in the datalink
    layer as is illustrated in figure [Fig. 173](#fig-switch-ref-model).
  id: totrans-255
  prefs: []
  type: TYPE_NORMAL
  zh: 在快速以太网中增加物理层带宽只是提高以太网局域网性能的解决方案之一。第二个解决方案是用更智能的设备替换集线器。由于以太网集线器在物理层工作，它们只能再生电信号以扩展网络的地理范围。从性能角度来看，拥有在数据链路层工作并能分析每个帧的目的地址，并在通往目的地的链路上选择性地转发帧的设备会更感兴趣。这类设备通常被称为以太网交换机
    [[9]](#fbridges)。以太网交换机是一个在数据链路层工作的中继器，如图 [图 173](#fig-switch-ref-model) 所示。
- en: '![Figure made with TikZ](../Images/3ec5ee9e5eca2555bf183e60ae86fbcd.png)'
  id: totrans-256
  prefs:
  - PREF_BQ
  type: TYPE_IMG
  zh: '![使用 TikZ 制作的图](../Images/3ec5ee9e5eca2555bf183e60ae86fbcd.png)'
- en: ''
  id: totrans-257
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: Fig. 173 Ethernet switches in the reference model
  id: totrans-258
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
  zh: 图 173 参考模型中的以太网交换机
- en: An Ethernet switch understands the format of the Ethernet frames and can selectively
    forward frames over each interface. For this, each Ethernet switch maintains a
    MAC address table. This table contains, for each MAC address known by the switch,
    the identifier of the switch’s port over which a frame sent towards this address
    must be forwarded to reach its destination. This is illustrated in figure [Fig.
    174](#fig-operation-switch) with the MAC address table of the bottom switch. When
    the switch receives a frame destined to address B, it forwards the frame on its
    South port. If it receives a frame destined to address D, it forwards it only
    on its North port.
  id: totrans-259
  prefs: []
  type: TYPE_NORMAL
  zh: 以太网交换机理解以太网帧的格式，并且可以针对每个接口选择性地转发帧。为此，每个以太网交换机维护一个 MAC 地址表。该表包含交换机所知的每个 MAC 地址，以及发送到该地址的帧必须转发到其目的地的交换机端口的标识符。这如图
    [图 174](#fig-operation-switch) 所示，展示了底部交换机的 MAC 地址表。当交换机收到一个目的地为 B 的帧时，它会在其南端口上转发该帧。如果它收到一个目的地为
    D 的帧，它只会在其北端口上转发。
- en: '[![../_images/datalink-fig-013-c.png](../Images/dea7b4a82ab8e1e49a6b3ef793fecc58.png)](../_images/datalink-fig-013-c.png)'
  id: totrans-260
  prefs: []
  type: TYPE_NORMAL
  zh: '![../_images/datalink-fig-013-c.png](../Images/dea7b4a82ab8e1e49a6b3ef793fecc58.png)'
- en: Fig. 174 Operation of Ethernet switches[#](#fig-operation-switch "Link to this
    image")
  id: totrans-261
  prefs: []
  type: TYPE_NORMAL
  zh: 图 174 交换机的操作[#](#fig-operation-switch "链接到这张图片")
- en: One of the selling points of Ethernet networks is that, thanks to the utilization
    of 48 bits MAC addresses, an Ethernet LAN is plug and play at the datalink layer.
    When two hosts are attached to the same Ethernet segment or hub, they can immediately
    exchange Ethernet frames without requiring any configuration. It is important
    to retain this plug and play capability for Ethernet switches as well. This implies
    that Ethernet switches must be able to build their MAC address table automatically
    without requiring any manual configuration. This automatic configuration is performed
    by the MAC address learning algorithm that runs on each Ethernet switch. This
    algorithm extracts the source address of the received frames and remembers the
    port over which a frame from each source Ethernet address has been received. This
    information is inserted into the MAC address table that the switch uses to forward
    frames. This allows the switch to automatically learn the ports that it can use
    to reach each destination address, provided that this host has previously sent
    at least one frame. This is not a problem since most upper layer protocols use
    acknowledgments at some layer and thus even an Ethernet printer sends Ethernet
    frames as well.
  id: totrans-262
  prefs: []
  type: TYPE_NORMAL
  zh: 以太网网络的一个卖点是由于使用了48位MAC地址，以太网局域网在数据链路层上可以即插即用。当两个主机连接到同一个以太网段或集线器时，它们可以立即交换以太网帧，而无需任何配置。对于以太网交换机来说，保留这种即插即用能力也很重要。这意味着以太网交换机必须能够自动构建它们的MAC地址表，而无需任何手动配置。这种自动配置是通过运行在每个以太网交换机上的MAC地址学习算法来执行的。该算法提取接收到的帧的源地址，并记住每个源以太网地址的帧是通过哪个端口接收到的。这些信息被插入到交换机使用的MAC地址表中，用于转发帧。这允许交换机自动学习它可以使用哪些端口到达每个目标地址，前提是此主机之前至少发送了一个帧。这不是问题，因为大多数上层协议在某个层使用确认，因此即使是以太网打印机也会发送以太网帧。
- en: The pseudo-code below details how an Ethernet switch forwards Ethernet frames.
    It first updates its MAC address table with the source address of the frame. The
    MAC address table used by some switches also contains a timestamp that is updated
    each time a frame is received from each known source address. This timestamp is
    used to remove from the MAC address table entries that have not been active during
    the last n minutes. This limits the growth of the MAC address table, but also
    allows hosts to move from one port to another. The switch uses its MAC address
    table to forward the received unicast frame. If there is an entry for the frame’s
    destination address in the MAC address table, the frame is forwarded selectively
    on the port listed in this entry. Otherwise, the switch does not know how to reach
    the destination address and it must forward the frame on all its ports except
    the port from which the frame has been received. This ensures that the frame will
    reach its destination, at the expense of some unnecessary transmissions. These
    unnecessary transmissions will only last until the destination has sent its first
    frame. Multicast and Broadcast frames are also forwarded in a similar way.
  id: totrans-263
  prefs: []
  type: TYPE_NORMAL
  zh: 下面的伪代码详细说明了以太网交换机如何转发以太网帧。它首先使用帧的源地址更新其MAC地址表。某些交换机使用的MAC地址表还包含一个时间戳，每次从每个已知源地址接收帧时都会更新。这个时间戳用于从MAC地址表中删除在过去n分钟内未活跃的条目。这限制了MAC地址表的增长，但也允许主机从一个端口移动到另一个端口。交换机使用其MAC地址表来转发接收到的单播帧。如果MAC地址表中存在帧目标地址的条目，则该帧将根据此条目中列出的端口进行选择性转发。否则，交换机不知道如何到达目标地址，它必须在除了接收帧的端口之外的所有端口上转发该帧。这确保了帧将到达其目标，但代价是会有一些不必要的传输。这些不必要的传输只会持续到目标发送其第一个帧。多播和广播帧也以类似的方式转发。
- en: '[PRE2]'
  id: totrans-264
  prefs: []
  type: TYPE_PRE
  zh: '[PRE2]'
- en: Note
  id: totrans-265
  prefs: []
  type: TYPE_NORMAL
  zh: 注意
- en: Security issues with Ethernet hubs and switches
  id: totrans-266
  prefs: []
  type: TYPE_NORMAL
  zh: 以太网集线器和交换机的安全问题
- en: From a security perspective, Ethernet hubs have the same drawbacks as the older
    coaxial cable. A host attached to a hub will be able to capture all the frames
    exchanged between any pair of hosts attached to the same hub. Ethernet switches
    are much better from this perspective thanks to the selective forwarding, a host
    will usually only receive the frames destined to itself as well as the multicast,
    broadcast and unknown frames. However, this does not imply that switches are completely
    secure. There are, unfortunately, attacks against Ethernet switches. From a security
    perspective, the MAC address table is one of the fragile elements of an Ethernet
    switch. This table has a fixed size. Some low-end switches can store a few tens
    or a few hundreds of addresses while higher-end switches can store tens of thousands
    of addresses or more. From a security point of view, a limited resource can be
    the target of Denial of Service attacks. Unfortunately, such attacks are also
    possible on Ethernet switches. A malicious host could overflow the MAC address
    table of the switch by generating thousands of frames with random source addresses.
    Once the MAC address table is full, the switch needs to broadcast all the frames
    that it receives. At this point, an attacker will receive unicast frames that
    are not destined to its address. The ARP attack discussed in the previous chapter
    could also occur with Ethernet switches [[Vyncke2007]](../bibliography.html#vyncke2007).
    Recent switches implement several types of defenses against these attacks, but
    they need to be carefully configured by the network administrator. See [[Vyncke2007]](../bibliography.html#vyncke2007)
    for a detailed discussion on security issues with Ethernet switches.
  id: totrans-267
  prefs: []
  type: TYPE_NORMAL
  zh: 从安全角度来看，以太网集线器与较老的同轴电缆有相同的缺点。连接到集线器的主机将能够捕获连接到同一集线器的任何一对主机之间交换的所有帧。由于选择性地转发，主机通常只会接收到目的地为自身的帧以及多播、广播和未知帧。然而，这并不意味着交换机是完全安全的。不幸的是，存在针对以太网交换机的攻击。从安全角度来看，MAC地址表是以太网交换机的一个脆弱元素。这个表有固定的大小。一些低端交换机可以存储几十个或几百个地址，而高端交换机可以存储成千上万个地址或更多。从安全角度来看，有限的资源可能成为拒绝服务攻击的目标。不幸的是，这种攻击在以太网交换机上也是可能的。恶意主机可以通过生成带有随机源地址的数千个帧来溢出交换机的MAC地址表。一旦MAC地址表满了，交换机需要广播它接收到的所有帧。此时，攻击者将接收到不是发送给其地址的单播帧。上一章讨论的ARP攻击也可能发生在以太网交换机上
    [[Vyncke2007]](../bibliography.html#vyncke2007)。最近的交换机实现了多种防御这些攻击的类型，但它们需要网络管理员仔细配置。参见
    [[Vyncke2007]](../bibliography.html#vyncke2007) 以了解以太网交换机安全问题的详细讨论。
- en: The MAC address learning algorithm combined with the forwarding algorithm work
    well in a tree-shaped network such as the one shown above. However, to deal with
    link and switch failures, network administrators often add redundant links to
    ensure that their network remains connected even after a failure. Let us consider
    what happens in the Ethernet network shown in figure [Fig. 175](#fig-ethernet-loop).
  id: totrans-268
  prefs: []
  type: TYPE_NORMAL
  zh: MAC地址学习算法与转发算法结合在树形网络中如上图所示的工作良好。然而，为了处理链路和交换机故障，网络管理员通常会添加冗余链路以确保网络在故障后仍然保持连接。让我们考虑一下图[图
    175](#fig-ethernet-loop)中所示以太网网络会发生什么。
- en: '[![../_images/datalink-fig-014-c.png](../Images/e8f49a8642a420b51358c162a7018bf9.png)](../_images/datalink-fig-014-c.png)'
  id: totrans-269
  prefs: []
  type: TYPE_NORMAL
  zh: '[![../_images/datalink-fig-014-c.png](../Images/e8f49a8642a420b51358c162a7018bf9.png)](../_images/datalink-fig-014-c.png)'
- en: Fig. 175 Ethernet switches in a loop[#](#fig-ethernet-loop "Link to this image")
  id: totrans-270
  prefs: []
  type: TYPE_NORMAL
  zh: 图 175 环形网络中的以太网交换机[#](#fig-ethernet-loop "链接到这张图片")
- en: When all switches boot, their MAC address table is empty. Assume that host A
    sends a frame towards host C. Upon reception of this frame, switch1 updates its
    MAC address table to remember that address A is reachable via its West port. As
    there is no entry for address C in switch1’s MAC address table, the frame is forwarded
    to both switch2 and switch3\. When switch2 receives the frame, its updates its
    MAC address table for address A and forwards the frame to host C as well as to
    switch3\. switch3 has thus received two copies of the same frame. As switch3 does
    not know how to reach the destination address, it forwards the frame received
    from switch1 to switch2 and the frame received from switch2 to switch1… The single
    frame sent by host A will be continuously duplicated by the switches until their
    MAC address table contains an entry for address C. Quickly, all the available
    link bandwidth will be used to forward all the copies of this frame. As Ethernet
    does not contain any TTL or HopLimit, this loop will never stop.
  id: totrans-271
  prefs: []
  type: TYPE_NORMAL
  zh: 当所有交换机启动时，它们的MAC地址表为空。假设主机A向主机C发送一个帧。在接收到这个帧后，switch1更新其MAC地址表以记住地址A可以通过其西端口到达。由于switch1的MAC地址表中没有地址C的条目，因此该帧被转发到switch2和switch3。当switch2接收到帧时，它更新地址A的MAC地址表并将帧转发到主机C以及switch3。因此，switch3收到了两个相同的帧副本。由于switch3不知道如何到达目标地址，它将来自switch1的帧转发到switch2，并将来自switch2的帧转发到switch1……主机A发送的单个帧将由交换机不断复制，直到它们的MAC地址表中包含地址C的条目。很快，所有可用的链路带宽都将用于转发该帧的所有副本。由于以太网不包含任何TTL或跳数限制，这个循环永远不会停止。
- en: The MAC address learning algorithm allows switches to be plug-and-play. Unfortunately,
    the loops that arise when the network topology is not a tree are a severe problem.
    Forcing the switches to only be used in tree-shaped networks as hubs would be
    a severe limitation. To solve this problem, the inventors of Ethernet switches
    have developed the Spanning Tree Protocol. This protocol allows switches to automatically
    disable ports on Ethernet switches to ensure that the network does not contain
    any cycle that could cause frames to loop forever.
  id: totrans-272
  prefs: []
  type: TYPE_NORMAL
  zh: MAC地址学习算法允许交换机即插即用。不幸的是，当网络拓扑不是树形时产生的循环是一个严重的问题。强迫交换机只能像集线器一样在树形网络中使用将是一个严重的限制。为了解决这个问题，以太网交换机的发明者开发了广播树协议。该协议允许交换机自动关闭以太网交换机上的端口，以确保网络不包含任何可能导致帧无限循环的循环。
- en: Footnotes
  id: totrans-273
  prefs: []
  type: TYPE_NORMAL
  zh: 脚注
- en: The Spanning Tree Protocol (802.1d)[#](#the-spanning-tree-protocol-802-1d "Link
    to this heading")
  id: totrans-274
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 广播树协议（802.1d）[#](#the-spanning-tree-protocol-802-1d "链接到这个标题")
- en: The Spanning Tree Protocol (STP), proposed in [[Perlman1985]](../bibliography.html#perlman1985),
    is a distributed protocol that is used by switches to reduce the network topology
    to a spanning tree, so that there are no cycles in the topology. For example,
    consider the network shown in figure [Fig. 176](#fig-ethernet-spanning). In this
    figure, each bold line corresponds to an Ethernet to which two Ethernet switches
    are attached. This network contains several cycles that must be broken to allow
    Ethernet switches, using the MAC address learning algorithm, to exchange frames.
  id: totrans-275
  prefs: []
  type: TYPE_NORMAL
  zh: 广播树协议（STP），由[[Perlman1985]](../bibliography.html#perlman1985)提出，是一种分布式协议，交换机使用它将网络拓扑简化为广播树，从而在拓扑中消除循环。例如，考虑图[图.
    176](#fig-ethernet-spanning)。在此图中，每条粗线对应一个连接了两个以太网交换机的以太网。这个网络包含几个必须断开的循环，以便以太网交换机使用MAC地址学习算法交换帧。
- en: '[![../_images/datalink-fig-015-c.png](../Images/5a29a9d52b3209b13650c40e94203b2e.png)](../_images/datalink-fig-015-c.png)'
  id: totrans-276
  prefs: []
  type: TYPE_NORMAL
  zh: '![../_images/datalink-fig-015-c.png](../Images/5a29a9d52b3209b13650c40e94203b2e.png)'
- en: Fig. 176 Spanning tree computed in a switched Ethernet network[#](#fig-ethernet-spanning
    "Link to this image")
  id: totrans-277
  prefs: []
  type: TYPE_NORMAL
  zh: 图. 176 在交换式以太网网络中计算的广播树[#](#fig-ethernet-spanning "链接到这个图像")
- en: In this network, the STP will compute the following spanning tree. Switch1 will
    be the root of the tree. All the interfaces of Switch1, Switch2 and Switch7 are
    part of the spanning tree. Only the interface connected to LAN B will be active
    on Switch9. LAN H will only be served by Switch7 and the port of Switch44 on LAN
    G will be disabled. A frame originating on LAN B and destined for LAN A will be
    forwarded by Switch7 on LAN C, then by Switch1 on LAN E, then by Switch44 on LAN
    F and eventually by Switch2 on LAN A.
  id: totrans-278
  prefs: []
  type: TYPE_NORMAL
  zh: 在这个网络中，STP 将计算以下生成树。Switch1 将成为树的根。Switch1、Switch2 和 Switch7 的所有接口都是生成树的一部分。只有连接到
    LAN B 的接口将在 Switch9 上激活。LAN H 只由 Switch7 服务，而 LAN G 上 Switch44 的端口将被禁用。一个起源于 LAN
    B 并指向 LAN A 的帧将通过 LAN C 上的 Switch7 转发，然后通过 LAN E 上的 Switch1 转发，然后通过 LAN F 上的 Switch44
    转发，最终通过 LAN A 上的 Switch2 转发。
- en: Switches running the Spanning Tree Protocol exchange BPDUs. These BPDUs are
    always sent as frames with destination MAC address as the ALL_BRIDGES reserved
    multicast MAC address. Each switch has a unique 64 bit identifier. To ensure uniqueness,
    the lower 48 bits of the identifier are set to the unique MAC address allocated
    to the switch by its manufacturer. The high order 16 bits of the switch identifier
    can be configured by the network administrator to influence the topology of the
    spanning tree. The default value for these high order bits is 32768.
  id: totrans-279
  prefs: []
  type: TYPE_NORMAL
  zh: 运行生成树协议的交换机交换 BPDUs。这些 BPDUs 总是以帧的形式发送，目标 MAC 地址为 ALL_BRIDGES 保留的组播 MAC 地址。每个交换机都有一个唯一的
    64 位标识符。为确保唯一性，标识符的低位 48 位被设置为交换机制造商分配给交换机的唯一 MAC 地址。交换机标识符的高位 16 位可以由网络管理员配置，以影响生成树的拓扑结构。这些高位位的默认值是
    32768。
- en: 'The switches exchange BPDUs to build the spanning tree. Intuitively, the spanning
    tree is built by first selecting the switch with the smallest identifier as the
    root of the tree. The branches of the spanning tree are then composed of the shortest
    paths that allow all of the switches that compose the network to be reached. The
    BPDUs exchanged by the switches contain the following information :'
  id: totrans-280
  prefs: []
  type: TYPE_NORMAL
  zh: 交换机交换 BPDUs 以构建生成树。直观地说，生成树是通过首先选择具有最小标识符的交换机作为树的根来构建的。生成树的分支由允许访问构成网络的全部交换机的最短路径组成。交换机之间交换的
    BPDUs 包含以下信息：
- en: the identifier of the root switch (R)
  id: totrans-281
  prefs:
  - PREF_BQ
  - PREF_UL
  type: TYPE_NORMAL
  zh: 根交换机的标识符（R）
- en: ''
  id: totrans-282
  prefs:
  - PREF_BQ
  - PREF_IND
  type: TYPE_NORMAL
- en: ''
  id: totrans-283
  prefs:
  - PREF_BQ
  - PREF_IND
  type: TYPE_NORMAL
- en: the cost of the shortest path between the switch that sent the BPDU and the
    root switch (c)
  id: totrans-284
  prefs:
  - PREF_BQ
  - PREF_UL
  type: TYPE_NORMAL
  zh: 发送 BPDU 的交换机与根交换机之间的最短路径的成本（c）
- en: ''
  id: totrans-285
  prefs:
  - PREF_BQ
  - PREF_IND
  type: TYPE_NORMAL
- en: ''
  id: totrans-286
  prefs:
  - PREF_BQ
  - PREF_IND
  type: TYPE_NORMAL
- en: the identifier of the switch that sent the BPDU (T)
  id: totrans-287
  prefs:
  - PREF_BQ
  - PREF_UL
  type: TYPE_NORMAL
  zh: 发送 BPDU 的交换机的标识符（T）
- en: ''
  id: totrans-288
  prefs:
  - PREF_BQ
  - PREF_IND
  type: TYPE_NORMAL
- en: ''
  id: totrans-289
  prefs:
  - PREF_BQ
  - PREF_IND
  type: TYPE_NORMAL
- en: the number of the switch port over which the BPDU was sent (p)
  id: totrans-290
  prefs:
  - PREF_BQ
  - PREF_UL
  type: TYPE_NORMAL
  zh: 发送 BPDU 的交换机端口的数量（p）
- en: We will use the notation <R,c,T,p> to represent a BPDU whose root identifier
    is R, cost is c and that was sent from the port p of switch T. The construction
    of the spanning tree depends on an ordering relationship among the BPDUs. This
    ordering relationship could be implemented by the Python function below.
  id: totrans-291
  prefs: []
  type: TYPE_NORMAL
  zh: 我们将使用 <R,c,T,p> 的表示法来表示一个根标识符为 R、成本为 c 并且是从交换机 T 的端口 p 发送的 BPDU。生成树的构建取决于 BPDUs
    之间的排序关系。这种排序关系可以通过下面的 Python 函数实现。
- en: '[PRE3]'
  id: totrans-292
  prefs: []
  type: TYPE_PRE
  zh: '[PRE3]'
- en: In addition to the identifier discussed above, the network administrator can
    also configure a cost to be associated to each switch port. Usually, the cost
    of a port depends on its bandwidth and the [[IEEE802.1d]](../bibliography.html#ieee802-1d)
    standard recommends the values below. Of course, the network administrator may
    choose other values. We will use the notation cost[p] to indicate the cost associated
    to port p in this section.
  id: totrans-293
  prefs: []
  type: TYPE_NORMAL
  zh: 除了上述的标识符之外，网络管理员还可以为每个交换机端口配置一个与之关联的成本。通常，端口的成本取决于其带宽，IEEE802.1d 标准建议以下值。当然，网络管理员可以选择其他值。我们将使用
    cost[p] 的表示法来表示本节中与端口 p 相关的成本。
- en: '| Bandwidth | Cost |'
  id: totrans-294
  prefs: []
  type: TYPE_TB
  zh: '| 带宽 | 成本 |'
- en: '| --- | --- |'
  id: totrans-295
  prefs: []
  type: TYPE_TB
  zh: '| --- | --- |'
- en: '| 10 Mbps | 2000000 |'
  id: totrans-296
  prefs: []
  type: TYPE_TB
  zh: '| 10 Mbps | 2000000 |'
- en: '| 100 Mbps | 200000 |'
  id: totrans-297
  prefs: []
  type: TYPE_TB
  zh: '| 100 Mbps | 200000 |'
- en: '| 1 Gbps | 20000 |'
  id: totrans-298
  prefs: []
  type: TYPE_TB
  zh: '| 1 Gbps | 20000 |'
- en: '| 10 Gbps | 2000 |'
  id: totrans-299
  prefs: []
  type: TYPE_TB
  zh: '| 10 Gbps | 2000 |'
- en: '| 100 Gbps | 200 |'
  id: totrans-300
  prefs: []
  type: TYPE_TB
  zh: '| 100 Gbps | 200 |'
- en: 'The Spanning Tree Protocol uses its own terminology that we illustrate in the
    figure above. A switch port can be in three different states : Root, Designated
    and Blocked. All the ports of the root switch are in the Designated state. The
    state of the ports on the other switches is determined based on the BPDU received
    on each port.'
  id: totrans-301
  prefs: []
  type: TYPE_NORMAL
  zh: 生成树协议使用其自己的术语，我们在上面的图中进行了说明。交换机端口可以处于三种不同的状态：根、指定和阻塞。根交换机的所有端口都处于指定状态。其他交换机端口的状况基于每个端口接收到的
    BPDU 确定。
- en: 'The Spanning Tree Protocol uses the ordering relationship to build the spanning
    tree. Each switch listens to BPDUs on its ports. When BPDU = <R,c,T,p> is received
    on port q, the switch computes the port’s root priority vector: V[q] = <R,c+cost[q],T,p,q>
    , where cost[q] is the cost associated to the port over which the BPDU was received.
    The switch stores in a table the last root priority vector received on each port.
    The switch then compares its own identifier with the smallest root identifier
    stored in this table. If its own identifier is smaller, then the switch is the
    root of the spanning tree and is, by definition, at a distance 0 of the root.
    The BPDU of the switch is then <R,0,R,p>, where R is the switch identifier and
    p will be set to the port number over which the BPDU is sent.'
  id: totrans-302
  prefs: []
  type: TYPE_NORMAL
  zh: 生成树协议使用排序关系来构建生成树。每个交换机在其端口上监听 BPDUs。当在端口 q 上接收到 BPDU = <R,c,T,p> 时，交换机计算端口的根优先级向量：V[q]
    = <R,c+cost[q],T,p,q>，其中 cost[q] 是与接收 BPDU 的端口相关的成本。交换机在表中存储每个端口上接收到的最后一个根优先级向量。然后，交换机将其自己的标识符与表中存储的最小根标识符进行比较。如果其自己的标识符更小，则该交换机是生成树的根，并且根据定义，距离根的距离为
    0。交换机的 BPDU 是 <R,0,R,p>，其中 R 是交换机标识符，p 将设置为发送 BPDU 的端口号。
- en: Otherwise, the switch chooses the best priority vector from its table, bv =
    <R,c+cost[q’],T,p,q’>. The port q’, over which this best root priority vector
    was learned, is the switch port that is closest to the root switch. This port
    becomes the Root port of the switch. There is only one Root port per switch (except
    for the Root switches whose ports are all Designated). The switch can then compute
    its own BPDU as BPDU = <R,c’,S,p> , where R is the root identifier, c’ the cost
    of the best root priority vector, S the identifier of the switch and p will be
    replaced by the number of the port over which the BPDU will be sent.
  id: totrans-303
  prefs: []
  type: TYPE_NORMAL
  zh: 否则，交换机从其表中选择最佳优先级向量，bv = <R,c+cost[q’],T,p,q’>。通过此最佳根优先级向量学习到的端口 q’，是距离根交换机最近的交换机端口。该端口成为交换机的根端口。每个交换机只有一个根端口（除了所有端口都是指定的根交换机）。然后，交换机可以计算自己的
    BPDU 作为 BPDU = <R,c’，S,p>，其中 R 是根标识符，c’ 是最佳根优先级向量的成本，S 是交换机标识符，p 将被替换为发送 BPDU
    的端口号。
- en: To determine the state of its other ports, the switch compares its own BPDU
    with the last BPDU received on each port. Note that the comparison is done by
    using the BPDUs and not the root priority vectors. If the switch’s BPDU is better
    than the last BPDU of this port, the port becomes a Designated port. Otherwise,
    the port becomes a Blocked port.
  id: totrans-304
  prefs: []
  type: TYPE_NORMAL
  zh: 为了确定其其他端口的状况，交换机将其自己的 BPDU 与每个端口上接收到的最后一个 BPDU 进行比较。请注意，比较是通过 BPDUs 而不是根优先级向量进行的。如果交换机的
    BPDU 比此端口的最后一个 BPDU 更好，则该端口成为指定端口。否则，该端口成为阻塞端口。
- en: The state of each port is important when considering the transmission of BPDUs.
    The root switch regularly sends its own BPDU over all of its (Designated) ports.
    This BPDU is received on the Root port of all the switches that are directly connected
    to the root switch. Each of these switches computes its own BPDU and sends this
    BPDU over all its Designated ports. These BPDUs are then received on the Root
    port of downstream switches, which then compute their own BPDU, etc. When the
    network topology is stable, switches send their own BPDU on all their Designated
    ports, once they receive a BPDU on their Root port. No BPDU is sent on a Blocked
    port. Switches listen for BPDUs on their Blocked and Designated ports, but no
    BPDU should be received over these ports when the topology is stable. The utilization
    of the ports for both BPDUs and data frames is summarized in the table below.
  id: totrans-305
  prefs: []
  type: TYPE_NORMAL
  zh: 在考虑 BPDUs 传输时，每个端口的状况都很重要。根交换机定期通过其所有（指定的）端口发送自己的 BPDU。这个 BPDU 被连接到根交换机的所有交换机的根端口接收。每个这样的交换机计算自己的
    BPDU 并通过其所有指定的端口发送这个 BPDU。然后，这些 BPDUs 被接收在下游交换机的根端口上，然后这些交换机计算自己的 BPDU，等等。当网络拓扑稳定时，交换机在其所有指定的端口上发送自己的
    BPDU，一旦它们在根端口上接收到 BPDU。阻塞端口上不发送 BPDU。交换机在其阻塞和指定端口上监听 BPDUs，但在拓扑稳定时不应通过这些端口接收 BPDUs。端口用于
    BPDUs 和数据帧的利用率总结在下表。
- en: '| Port state | Receives BPDUs | Sends BPDU | Handles data frames |'
  id: totrans-306
  prefs: []
  type: TYPE_TB
  zh: '| 端口状态 | 接收 BPDUs | 发送 BPDU | 处理数据帧 |'
- en: '| --- | --- | --- | --- |'
  id: totrans-307
  prefs: []
  type: TYPE_TB
  zh: '| --- | --- | --- | --- |'
- en: '| Blocked | yes | no | no |'
  id: totrans-308
  prefs: []
  type: TYPE_TB
  zh: '| 阻塞 | 是 | 否 | 否 |'
- en: '| Root | yes | no | yes |'
  id: totrans-309
  prefs: []
  type: TYPE_TB
  zh: '| 根 | 是 | 否 | 是 |'
- en: '| Designated | yes | yes | yes |'
  id: totrans-310
  prefs: []
  type: TYPE_TB
  zh: '| 指定 | 是 | 是 | 是 |'
- en: To illustrate the operation of the Spanning Tree Protocol, let us consider the
    simple network topology in the figure [Fig. 177](#fig-stp-example).
  id: totrans-311
  prefs: []
  type: TYPE_NORMAL
  zh: 为了说明生成树协议的操作，让我们考虑图 [图 177](#fig-stp-example) 中的简单网络拓扑。
- en: '[![../_images/datalink-fig-016-c.svg](../Images/400b4ebfa6c09b6f49710e52c919a9a1.png)](../_images/datalink-fig-016-c.svg)'
  id: totrans-312
  prefs: []
  type: TYPE_NORMAL
  zh: '[![../_images/datalink-fig-016-c.svg](../Images/400b4ebfa6c09b6f49710e52c919a9a1.png)](../_images/datalink-fig-016-c.svg)'
- en: Fig. 177 A simple Spanning tree computed in a switched Ethernet network[#](#fig-stp-example
    "Link to this image")
  id: totrans-313
  prefs: []
  type: TYPE_NORMAL
  zh: 图177 在交换式以太网网络中计算的简单生成树[#](#fig-stp-example "链接到这张图片")
- en: Assume that Switch4 is the first to boot. It sends its own BPDU = <4,0,4,1>
    (resp. BPDU = <4,0,4,2>) on port 1 (resp. port 2). When Switch1 boots, it sends
    BPDU = <1,0,1,1>. This BPDU is received by Switch4, which updates its BPDU and
    root priority vector tables and computes a new BPDU = <1,3,4,1> (resp. BPDU =
    <1,3,4,2>) on port 1 (resp. port 2). Indeed, there is only one root priority vector
    and hence, it is the best one. Port 1 of Switch4 becomes the Root port while its
    second port is still in the Designated state.
  id: totrans-314
  prefs: []
  type: TYPE_NORMAL
  zh: 假设Switch4是第一个启动的。它会在端口1（resp. 端口2）发送自己的BPDU = <4,0,4,1>（resp. BPDU = <4,0,4,2>）。当Switch1启动时，它会发送BPDU
    = <1,0,1,1>。这个BPDU被Switch4接收，Switch4更新其BPDU和根优先级向量表，并在端口1（resp. 端口2）计算新的BPDU =
    <1,3,4,1>（resp. BPDU = <1,3,4,2>）。实际上，只有一个根优先级向量，因此它是最好的。Switch4的端口1成为根端口，而其第二个端口仍然处于指定状态。
- en: Assume now that Switch9 boots and immediately receives Switch1 ‘s BPDU on port
    1\. Switch9 computes its own BPDU = <1,1,9,1> (resp. BPDU = <1,1,9,2>) on port
    1 (resp. port 2) and port 1 becomes the Root port of this switch. The BPDU is
    sent on port 2 of Switch9 and reaches Switch4. Switch4 compares the priority vectors.
    It notices that the last computed vector (i.e., V[2] = <1,2,9,2,2>) is better
    than V[1] = <1,3,1,1,1>. Thus, Switch4’s BPDU is recomputed and port 2 becomes
    the Root port of Switch4. Switch4 compares its new BPDU = <1,2,4,p> with the last
    BPDU received on each port (except for the Root port). Port 1 becomes a Blocked
    port on Switch4 because the BPDU=<1,0,1,1> received on this port is better.
  id: totrans-315
  prefs: []
  type: TYPE_NORMAL
  zh: 现在假设Switch9启动，并立即在端口1上接收Switch1的BPDU。Switch9在端口1（resp. 端口2）计算自己的BPDU = <1,1,9,1>（resp.
    BPDU = <1,1,9,2>）并在端口1（resp. 端口2）上，端口1成为此交换机的根端口。BPDU在Switch9的端口2上发送并到达Switch4。Switch4比较优先级向量。它注意到最后计算的向量（即V[2]
    = <1,2,9,2,2>）比V[1] = <1,3,1,1,1>更好。因此，Switch4的BPDU被重新计算，端口2成为Switch4的根端口。Switch4将其新的BPDU
    = <1,2,4,p>与每个端口上接收到的最后BPDU（除了根端口）进行比较。端口1在Switch4上成为阻塞端口，因为在此端口上接收到的BPDU=<1,0,1,1>更好。
- en: During the computation of the spanning tree, switches discard all received data
    frames, as at that time the network topology is not guaranteed to be loop-free.
    Once that topology has been stable for some time, the switches again start to
    use the MAC learning algorithm to forward data frames. Only the Root and Designated
    ports are used to forward data frames. Switches discard all the data frames received
    on their Blocked ports and never forward frames on these ports.
  id: totrans-316
  prefs: []
  type: TYPE_NORMAL
  zh: 在计算生成树的过程中，交换机会丢弃所有接收到的数据帧，因为那时网络拓扑结构不一定是无环的。一旦拓扑结构稳定了一段时间，交换机再次开始使用MAC学习算法来转发数据帧。只有根端口和指定端口用于转发数据帧。交换机会丢弃在其阻塞端口上接收到的所有数据帧，并且永远不会在这些端口上转发帧。
- en: 'Switches, ports and links can fail in a switched Ethernet network. When a failure
    occurs, the switches must be able to recompute the spanning tree to recover from
    the failure. The Spanning Tree Protocol relies on regular transmissions of the
    BPDUs to detect these failures. A BPDU contains two additional fields : the Age
    of the BPDU and the Maximum Age. The Age contains the amount of time that has
    passed since the root switch initially originated the BPDU. The root switch sends
    its BPDU with an Age of zero and each switch that computes its own BPDU increments
    its Age by one. The Age of the BPDUs stored on a switch’s table is also incremented
    every second. A BPDU expires when its Age reaches the Maximum Age. When the network
    is stable, this does not happen as BPDU s are regularly sent by the root switch
    and downstream switches. However, if the root fails or the network becomes partitioned,
    BPDU will expire and switches will recompute their own BPDU and restart the Spanning
    Tree Protocol. Once a topology change has been detected, the forwarding of the
    data frames stops as the topology is not guaranteed to be loop-free. Additional
    details about the reaction to failures may be found in [[IEEE802.1d]](../bibliography.html#ieee802-1d).'
  id: totrans-317
  prefs: []
  type: TYPE_NORMAL
  zh: 在交换式以太网网络中，交换机、端口和链路可能会出现故障。当发生故障时，交换机必须能够重新计算生成树以从故障中恢复。生成树协议依赖于 BPDUs 的定期传输来检测这些故障。BPDU
    包含两个附加字段：BPDU 的年龄和最大年龄。年龄表示自根交换机最初生成 BPDU 以来经过的时间量。根交换机发送其 BPDU 时年龄为零，每个计算其自身
    BPDU 的交换机都会将其年龄增加一。存储在交换机表中的 BPDU 年龄也会每秒增加一次。当 BPDU 的年龄达到最大年龄时，BPDU 将过期。当网络稳定时，这不会发生，因为
    BPDU 由根交换机和下游交换机定期发送。然而，如果根交换机出现故障或网络发生分区，BPDU 将过期，交换机将重新计算其自身的 BPDU 并重新启动生成树协议。一旦检测到拓扑结构发生变化，数据帧的转发就会停止，因为无法保证拓扑结构是无环的。有关对故障的反应的更多详细信息，请参阅
    [[IEEE802.1d]](../bibliography.html#ieee802-1d)。
- en: '### Virtual LANs[#](#virtual-lans "Link to this heading")'
  id: totrans-318
  prefs: []
  type: TYPE_NORMAL
  zh: '### 虚拟局域网[#](#virtual-lans "链接到本标题")'
- en: Another important advantage of Ethernet switches is the ability to create Virtual
    Local Area Networks (VLANs). A virtual LAN can be defined as a set of ports attached
    to one or more Ethernet switches. A switch can support several VLANs and it runs
    one MAC learning algorithm for each Virtual LAN. When a switch receives a frame
    with an unknown or a multicast destination, it forwards it over all the ports
    that belong to the same Virtual LAN but not over the ports that belong to other
    Virtual LANs. Similarly, when a switch learns a source address on a port, it associates
    it to the Virtual LAN of this port and uses this information only when forwarding
    frames on this Virtual LAN.
  id: totrans-319
  prefs: []
  type: TYPE_NORMAL
  zh: 以太网交换机的另一个重要优点是能够创建虚拟局域网 (VLAN)。虚拟局域网可以定义为连接到一个或多个以太网交换机的一组端口。交换机可以支持多个 VLAN，并为每个虚拟局域网运行一个
    MAC 学习算法。当交换机收到一个具有未知或组播目的地的帧时，它会将该帧转发到属于同一虚拟局域网的端口上，而不是转发到属于其他虚拟局域网的端口上。同样，当交换机在端口上学习到一个源地址时，它会将其与该端口的虚拟局域网关联起来，并在转发该虚拟局域网上的帧时仅使用此信息。
- en: Figure [Fig. 178](#fig-vlan) illustrates a switched Ethernet network with three
    Virtual LANs. VLAN2 and VLAN3 only require a local configuration of switch S1.
    Host C can exchange frames with host D, but not with hosts that are outside of
    its VLAN. VLAN1 is more complex as there are ports of this VLAN on several switches.
    To support such VLANs, local configuration is not sufficient anymore. When a switch
    receives a frame from another switch, it must be able to determine the VLAN in
    which the frame originated to use the correct MAC table to forward the frame.
    This is done by assigning an identifier to each Virtual LAN and placing this identifier
    inside the headers of the frames that are exchanged between switches.
  id: totrans-320
  prefs: []
  type: TYPE_NORMAL
  zh: 图 [图 178](#fig-vlan) 展示了一个具有三个虚拟局域网的交换式以太网网络。VLAN2 和 VLAN3 只需要交换机 S1 的本地配置。主机
    C 可以与主机 D 交换帧，但不能与位于其 VLAN 外的主机交换帧。VLAN1 更复杂，因为这个 VLAN 的端口分布在几个交换机上。为了支持这样的 VLAN，本地配置不再足够。当交换机从另一个交换机接收帧时，它必须能够确定帧的起源
    VLAN，以便使用正确的 MAC 表来转发帧。这是通过为每个虚拟局域网分配一个标识符并将此标识符放置在交换机之间交换的帧的头部中实现的。
- en: '[![../_images/datalink-fig-017-c.png](../Images/2d641cc82f586881a3a072f7fc5bfdc8.png)](../_images/datalink-fig-017-c.png)'
  id: totrans-321
  prefs: []
  type: TYPE_NORMAL
  zh: '[![../_images/datalink-fig-017-c.png](../Images/2d641cc82f586881a3a072f7fc5bfdc8.png)](../_images/datalink-fig-017-c.png)'
- en: Fig. 178 Virtual Local Area Networks in a switched Ethernet network[#](#fig-vlan
    "Link to this image")
  id: totrans-322
  prefs: []
  type: TYPE_NORMAL
  zh: 图 178 交换式以太网网络中的虚拟局域网[#](#fig-vlan "链接到此图像")
- en: IEEE defined in the [[IEEE802.1q]](../bibliography.html#ieee802-1q) standard
    a special header to encode the VLAN identifiers. This 32 bit header includes a
    12 bit VLAN field that contains the VLAN identifier of each frame. The format
    of the [[IEEE802.1q]](../bibliography.html#ieee802-1q) header is shown in figure
    [Fig. 179](#fig-8021q).
  id: totrans-323
  prefs: []
  type: TYPE_NORMAL
  zh: IEEE 在 [[IEEE802.1q]](../bibliography.html#ieee802-1q) 标准中定义了一个特殊的报头来编码 VLAN
    标识符。这个 32 位报头包括一个 12 位的 VLAN 字段，它包含每个帧的 VLAN 标识符。802.1q 报头的格式如图 [图 179](#fig-8021q)
    所示。
- en: '[![../_images/8021q.svg](../Images/a5322aedde97417cdbe8bf165a0df75e.png)](../_images/8021q.svg)'
  id: totrans-324
  prefs: []
  type: TYPE_NORMAL
  zh: '[![../_images/8021q.svg](../Images/a5322aedde97417cdbe8bf165a0df75e.png)](../_images/8021q.svg)'
- en: Fig. 179 Format of the 802.1q header[#](#fig-8021q "Link to this image")
  id: totrans-325
  prefs: []
  type: TYPE_NORMAL
  zh: 图 179 802.1q 报头格式[#](#fig-8021q "链接到此图像")
- en: The [[IEEE802.1q]](../bibliography.html#ieee802-1q) header is inserted immediately
    after the source MAC address in the Ethernet frame (i.e. before the EtherType
    field). The maximum frame size is increased by 4 bytes. It is encoded in 32 bits
    and contains four fields. The Tag Protocol Identifier is set to 0x8100 to allow
    the receiver to detect the presence of this additional header. The Priority Code
    Point (PCP) is a three bit field that is used to support different transmission
    priorities for the frame. Value 0 is the lowest priority and value 7 the highest.
    Frames with a higher priority can expect to be forwarded earlier than frames having
    a lower priority. The C bit is used for compatibility between Ethernet and Token
    Ring networks. The last 12 bits of the 802.1q header contain the VLAN identifier.
    Value 0 indicates that the frame does not belong to any VLAN while value 0xFFF
    is reserved. This implies that 4094 different VLAN identifiers can be used in
    an Ethernet network.
  id: totrans-326
  prefs: []
  type: TYPE_NORMAL
  zh: '[[IEEE802.1q]](../bibliography.html#ieee802-1q) 报头被插入到以太网帧中的源 MAC 地址之后（即在 EtherType
    字段之前）。最大帧大小增加了 4 字节。它以 32 位编码，包含四个字段。标签协议标识符设置为 0x8100，以便接收器检测到这个附加报头。优先级代码点 (PCP)
    是一个三位字段，用于支持帧的不同传输优先级。值 0 是最低优先级，值 7 是最高优先级。具有较高优先级的帧可以期望比具有较低优先级的帧更早地转发。C 位用于以太网和令牌环网络之间的兼容性。802.1q
    报头的最后 12 位包含 VLAN 标识符。值 0 表示帧不属于任何 VLAN，而值 0xFFF 是保留的。这意味着在以太网网络中可以使用 4094 个不同的
    VLAN 标识符。'
- en: Ethernet Switches[#](#ethernet-switches "Link to this heading")
  id: totrans-327
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 以太网交换机[#](#ethernet-switches "链接到此标题")
- en: Increasing the physical layer bandwidth as in Fast Ethernet was only one of
    the solutions to improve the performance of Ethernet LANs. A second solution was
    to replace the hubs with more intelligent devices. As Ethernet hubs operate in
    the physical layer, they can only regenerate the electrical signal to extend the
    geographical reach of the network. From a performance perspective, it would be
    more interesting to have devices that operate in the datalink layer and can analyze
    the destination address of each frame and forward the frames selectively on the
    link that leads to the destination. Such devices are usually called Ethernet switches
    [[9]](#fbridges). An Ethernet switch is a relay that operates in the datalink
    layer as is illustrated in figure [Fig. 173](#fig-switch-ref-model).
  id: totrans-328
  prefs: []
  type: TYPE_NORMAL
  zh: 在快速以太网中增加物理层带宽只是提高以太网局域网性能的解决方案之一。第二个解决方案是用更智能的设备替换集线器。由于以太网集线器在物理层工作，它们只能再生电信号以扩展网络的地理范围。从性能角度来看，拥有在数据链路层工作并能分析每个帧的目的地址并选择性地在通往目的地的链路上转发帧的设备会更感兴趣。这类设备通常被称为以太网交换机
    [[9]](#fbridges)。以太网交换机是一种在数据链路层工作的中继器，如图 [图 173](#fig-switch-ref-model) 所示。
- en: '![Figure made with TikZ](../Images/3ec5ee9e5eca2555bf183e60ae86fbcd.png)'
  id: totrans-329
  prefs:
  - PREF_BQ
  type: TYPE_IMG
  zh: '![使用 TikZ 制作的图](../Images/3ec5ee9e5eca2555bf183e60ae86fbcd.png)'
- en: ''
  id: totrans-330
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: Fig. 173 Ethernet switches in the reference model
  id: totrans-331
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
  zh: 图 173 参考模型中的以太网交换机
- en: An Ethernet switch understands the format of the Ethernet frames and can selectively
    forward frames over each interface. For this, each Ethernet switch maintains a
    MAC address table. This table contains, for each MAC address known by the switch,
    the identifier of the switch’s port over which a frame sent towards this address
    must be forwarded to reach its destination. This is illustrated in figure [Fig.
    174](#fig-operation-switch) with the MAC address table of the bottom switch. When
    the switch receives a frame destined to address B, it forwards the frame on its
    South port. If it receives a frame destined to address D, it forwards it only
    on its North port.
  id: totrans-332
  prefs: []
  type: TYPE_NORMAL
  zh: 以太网交换机理解以太网帧的格式，并且可以针对每个接口选择性地转发帧。为此，每个以太网交换机维护一个MAC地址表。该表包含，对于交换机所知的每个MAC地址，都有一个标识符，表示发送到该地址的帧必须通过交换机的哪个端口转发才能到达目的地。这如图[图.
    174](#fig-operation-switch)中所示，展示了底部交换机的MAC地址表。当交换机收到一个目的地为B的帧时，它会在其南端口上转发该帧。如果它收到一个目的地为D的帧，它只会在其北端口上转发。
- en: '[![../_images/datalink-fig-013-c.png](../Images/dea7b4a82ab8e1e49a6b3ef793fecc58.png)](../_images/datalink-fig-013-c.png)'
  id: totrans-333
  prefs: []
  type: TYPE_NORMAL
  zh: '![../_images/datalink-fig-013-c.png](../Images/dea7b4a82ab8e1e49a6b3ef793fecc58.png)(../_images/datalink-fig-013-c.png)'
- en: Fig. 174 Operation of Ethernet switches[#](#fig-operation-switch "Link to this
    image")
  id: totrans-334
  prefs: []
  type: TYPE_NORMAL
  zh: 图. 174 以太网交换机的工作原理[#](#fig-operation-switch "链接到这张图片")
- en: One of the selling points of Ethernet networks is that, thanks to the utilization
    of 48 bits MAC addresses, an Ethernet LAN is plug and play at the datalink layer.
    When two hosts are attached to the same Ethernet segment or hub, they can immediately
    exchange Ethernet frames without requiring any configuration. It is important
    to retain this plug and play capability for Ethernet switches as well. This implies
    that Ethernet switches must be able to build their MAC address table automatically
    without requiring any manual configuration. This automatic configuration is performed
    by the MAC address learning algorithm that runs on each Ethernet switch. This
    algorithm extracts the source address of the received frames and remembers the
    port over which a frame from each source Ethernet address has been received. This
    information is inserted into the MAC address table that the switch uses to forward
    frames. This allows the switch to automatically learn the ports that it can use
    to reach each destination address, provided that this host has previously sent
    at least one frame. This is not a problem since most upper layer protocols use
    acknowledgments at some layer and thus even an Ethernet printer sends Ethernet
    frames as well.
  id: totrans-335
  prefs: []
  type: TYPE_NORMAL
  zh: 以太网网络的一个卖点在于，由于使用了48位的MAC地址，以太网局域网在数据链路层上可以实现即插即用。当两个主机连接到同一个以太网段或集线器时，它们可以立即交换以太网帧，而无需任何配置。对于以太网交换机来说，保留这种即插即用能力也很重要。这意味着以太网交换机必须能够自动构建它们的MAC地址表，而无需任何手动配置。这种自动配置是通过运行在每个以太网交换机上的MAC地址学习算法来完成的。该算法提取接收到的帧的源地址，并记住每个源以太网地址的帧是通过哪个端口接收到的。这些信息被插入到交换机使用的MAC地址表中，用于转发帧。这使得交换机能够自动学习它可以使用哪些端口来到达每个目的地地址，前提是此主机之前至少发送了一个帧。这并不是问题，因为大多数上层协议在某个层使用确认，因此即使是以太网打印机也会发送以太网帧。
- en: The pseudo-code below details how an Ethernet switch forwards Ethernet frames.
    It first updates its MAC address table with the source address of the frame. The
    MAC address table used by some switches also contains a timestamp that is updated
    each time a frame is received from each known source address. This timestamp is
    used to remove from the MAC address table entries that have not been active during
    the last n minutes. This limits the growth of the MAC address table, but also
    allows hosts to move from one port to another. The switch uses its MAC address
    table to forward the received unicast frame. If there is an entry for the frame’s
    destination address in the MAC address table, the frame is forwarded selectively
    on the port listed in this entry. Otherwise, the switch does not know how to reach
    the destination address and it must forward the frame on all its ports except
    the port from which the frame has been received. This ensures that the frame will
    reach its destination, at the expense of some unnecessary transmissions. These
    unnecessary transmissions will only last until the destination has sent its first
    frame. Multicast and Broadcast frames are also forwarded in a similar way.
  id: totrans-336
  prefs: []
  type: TYPE_NORMAL
  zh: 下面的伪代码详细说明了以太网交换机如何转发以太网帧。它首先使用帧的源地址更新其MAC地址表。一些交换机使用的MAC地址表还包含一个时间戳，每次从每个已知源地址接收帧时都会更新这个时间戳。这个时间戳用于从MAC地址表中删除在过去n分钟内未活跃的条目。这限制了MAC地址表的增长，但也允许主机从一个端口移动到另一个端口。交换机使用其MAC地址表来转发接收到的单播帧。如果MAC地址表中存在帧目标地址的条目，则该帧将根据此条目中列出的端口进行选择性转发。否则，交换机不知道如何到达目标地址，它必须在除了接收帧的端口之外的所有端口上转发该帧。这确保了帧将到达其目的地，但代价是会有一些不必要的传输。这些不必要的传输只会持续到目标发送其第一个帧。多播和广播帧也以类似的方式转发。
- en: '[PRE4]'
  id: totrans-337
  prefs: []
  type: TYPE_PRE
  zh: '[PRE4]'
- en: Note
  id: totrans-338
  prefs: []
  type: TYPE_NORMAL
  zh: 注意
- en: Security issues with Ethernet hubs and switches
  id: totrans-339
  prefs: []
  type: TYPE_NORMAL
  zh: 以太网集线器和交换机的安全问题
- en: From a security perspective, Ethernet hubs have the same drawbacks as the older
    coaxial cable. A host attached to a hub will be able to capture all the frames
    exchanged between any pair of hosts attached to the same hub. Ethernet switches
    are much better from this perspective thanks to the selective forwarding, a host
    will usually only receive the frames destined to itself as well as the multicast,
    broadcast and unknown frames. However, this does not imply that switches are completely
    secure. There are, unfortunately, attacks against Ethernet switches. From a security
    perspective, the MAC address table is one of the fragile elements of an Ethernet
    switch. This table has a fixed size. Some low-end switches can store a few tens
    or a few hundreds of addresses while higher-end switches can store tens of thousands
    of addresses or more. From a security point of view, a limited resource can be
    the target of Denial of Service attacks. Unfortunately, such attacks are also
    possible on Ethernet switches. A malicious host could overflow the MAC address
    table of the switch by generating thousands of frames with random source addresses.
    Once the MAC address table is full, the switch needs to broadcast all the frames
    that it receives. At this point, an attacker will receive unicast frames that
    are not destined to its address. The ARP attack discussed in the previous chapter
    could also occur with Ethernet switches [[Vyncke2007]](../bibliography.html#vyncke2007).
    Recent switches implement several types of defenses against these attacks, but
    they need to be carefully configured by the network administrator. See [[Vyncke2007]](../bibliography.html#vyncke2007)
    for a detailed discussion on security issues with Ethernet switches.
  id: totrans-340
  prefs: []
  type: TYPE_NORMAL
  zh: 从安全角度来看，以太网集线器与较老的同轴电缆具有相同的缺点。连接到集线器的主机将能够捕获连接到同一集线器的任何一对主机之间交换的所有帧。由于选择性转发，主机通常只会接收到目的地为自身的帧以及多播、广播和未知帧。然而，这并不意味着交换机是完全安全的。不幸的是，存在针对以太网交换机的攻击。从安全角度来看，MAC地址表是以太网交换机的一个脆弱元素。这个表有固定的大小。一些低端交换机可以存储几十个或几百个地址，而高端交换机可以存储数万个或更多的地址。从安全角度来看，有限的资源可能成为拒绝服务攻击的目标。不幸的是，这种攻击在以太网交换机上也是可能的。恶意主机可以通过生成具有随机源地址的数千个帧来溢出交换机的MAC地址表。一旦MAC地址表满了，交换机需要广播它接收到的所有帧。此时，攻击者将接收到不是发送到其地址的单播帧。上一章讨论的ARP攻击也可能发生在以太网交换机上
    [[Vyncke2007]](../bibliography.html#vyncke2007)。最近的交换机实现了多种防御这些攻击的类型，但它们需要由网络管理员仔细配置。参见
    [[Vyncke2007]](../bibliography.html#vyncke2007) 以获取关于以太网交换机安全问题的详细讨论。
- en: The MAC address learning algorithm combined with the forwarding algorithm work
    well in a tree-shaped network such as the one shown above. However, to deal with
    link and switch failures, network administrators often add redundant links to
    ensure that their network remains connected even after a failure. Let us consider
    what happens in the Ethernet network shown in figure [Fig. 175](#fig-ethernet-loop).
  id: totrans-341
  prefs: []
  type: TYPE_NORMAL
  zh: MAC地址学习算法与转发算法在树形网络（如上图所示）中运行良好。然而，为了处理链路和交换机故障，网络管理员通常会添加冗余链路以确保网络在故障后仍然保持连接。让我们考虑一下图[图.
    175](#fig-ethernet-loop)中所示以太网网络会发生什么。
- en: '[![../_images/datalink-fig-014-c.png](../Images/e8f49a8642a420b51358c162a7018bf9.png)](../_images/datalink-fig-014-c.png)'
  id: totrans-342
  prefs: []
  type: TYPE_NORMAL
  zh: '[![../_images/datalink-fig-014-c.png](../Images/e8f49a8642a420b51358c162a7018bf9.png)](../_images/datalink-fig-014-c.png)'
- en: Fig. 175 Ethernet switches in a loop[#](#fig-ethernet-loop "Link to this image")
  id: totrans-343
  prefs: []
  type: TYPE_NORMAL
  zh: 图. 175 环形网络中的以太网交换机[#](#fig-ethernet-loop "链接到此图像")
- en: When all switches boot, their MAC address table is empty. Assume that host A
    sends a frame towards host C. Upon reception of this frame, switch1 updates its
    MAC address table to remember that address A is reachable via its West port. As
    there is no entry for address C in switch1’s MAC address table, the frame is forwarded
    to both switch2 and switch3\. When switch2 receives the frame, its updates its
    MAC address table for address A and forwards the frame to host C as well as to
    switch3\. switch3 has thus received two copies of the same frame. As switch3 does
    not know how to reach the destination address, it forwards the frame received
    from switch1 to switch2 and the frame received from switch2 to switch1… The single
    frame sent by host A will be continuously duplicated by the switches until their
    MAC address table contains an entry for address C. Quickly, all the available
    link bandwidth will be used to forward all the copies of this frame. As Ethernet
    does not contain any TTL or HopLimit, this loop will never stop.
  id: totrans-344
  prefs: []
  type: TYPE_NORMAL
  zh: 当所有交换机启动时，它们的MAC地址表都是空的。假设主机A向主机C发送一个帧。在接收到这个帧后，switch1更新其MAC地址表以记住地址A可以通过其西端口到达。由于switch1的MAC地址表中没有地址C的条目，因此该帧被转发到switch2和switch3。当switch2接收到帧时，它更新了地址A的MAC地址表并将帧转发到主机C以及switch3。因此，switch3收到了两个相同的帧。由于switch3不知道如何到达目标地址，它将来自switch1的帧转发到switch2，将来自switch2的帧转发到switch1……主机A发送的单个帧将被交换机不断复制，直到它们的MAC地址表中包含地址C的条目。很快，所有可用的链路带宽都将用于转发该帧的所有副本。由于以太网不包含任何TTL或HopLimit，这个环路将永远不会停止。
- en: The MAC address learning algorithm allows switches to be plug-and-play. Unfortunately,
    the loops that arise when the network topology is not a tree are a severe problem.
    Forcing the switches to only be used in tree-shaped networks as hubs would be
    a severe limitation. To solve this problem, the inventors of Ethernet switches
    have developed the Spanning Tree Protocol. This protocol allows switches to automatically
    disable ports on Ethernet switches to ensure that the network does not contain
    any cycle that could cause frames to loop forever.
  id: totrans-345
  prefs: []
  type: TYPE_NORMAL
  zh: MAC地址学习算法允许交换机即插即用。不幸的是，当网络拓扑不是树形时，产生的环路是一个严重的问题。强迫交换机只能作为树形网络的中心使用将是一个严重的限制。为了解决这个问题，以太网交换机的发明者开发了生成树协议。该协议允许交换机自动关闭以太网交换机上的端口，以确保网络不包含任何可能导致帧无限循环的环路。
- en: Footnotes
  id: totrans-346
  prefs: []
  type: TYPE_NORMAL
  zh: 脚注
- en: The Spanning Tree Protocol (802.1d)[#](#the-spanning-tree-protocol-802-1d "Link
    to this heading")
  id: totrans-347
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 生成树协议（802.1d）[#](#the-spanning-tree-protocol-802-1d "链接到本标题")
- en: The Spanning Tree Protocol (STP), proposed in [[Perlman1985]](../bibliography.html#perlman1985),
    is a distributed protocol that is used by switches to reduce the network topology
    to a spanning tree, so that there are no cycles in the topology. For example,
    consider the network shown in figure [Fig. 176](#fig-ethernet-spanning). In this
    figure, each bold line corresponds to an Ethernet to which two Ethernet switches
    are attached. This network contains several cycles that must be broken to allow
    Ethernet switches, using the MAC address learning algorithm, to exchange frames.
  id: totrans-348
  prefs: []
  type: TYPE_NORMAL
  zh: 生成树协议（STP），由[[Perlman1985]](../bibliography.html#perlman1985)提出，是一种分布式协议，交换机使用该协议将网络拓扑简化为生成树，从而在拓扑中不存在环路。例如，考虑图[图.
    176](#fig-ethernet-spanning)中所示的网络。在此图中，每条粗线对应一个连接了两个以太网交换机的以太网。该网络包含几个必须断开的环路，以便使用MAC地址学习算法的以太网交换机交换帧。
- en: '[![../_images/datalink-fig-015-c.png](../Images/5a29a9d52b3209b13650c40e94203b2e.png)](../_images/datalink-fig-015-c.png)'
  id: totrans-349
  prefs: []
  type: TYPE_NORMAL
  zh: '[![../_images/datalink-fig-015-c.png](../Images/5a29a9d52b3209b13650c40e94203b2e.png)](../_images/datalink-fig-015-c.png)'
- en: Fig. 176 Spanning tree computed in a switched Ethernet network[#](#fig-ethernet-spanning
    "Link to this image")
  id: totrans-350
  prefs: []
  type: TYPE_NORMAL
  zh: 图 176 在交换式以太网网络中计算的生成树[#](#fig-ethernet-spanning "链接到这张图片")
- en: In this network, the STP will compute the following spanning tree. Switch1 will
    be the root of the tree. All the interfaces of Switch1, Switch2 and Switch7 are
    part of the spanning tree. Only the interface connected to LAN B will be active
    on Switch9. LAN H will only be served by Switch7 and the port of Switch44 on LAN
    G will be disabled. A frame originating on LAN B and destined for LAN A will be
    forwarded by Switch7 on LAN C, then by Switch1 on LAN E, then by Switch44 on LAN
    F and eventually by Switch2 on LAN A.
  id: totrans-351
  prefs: []
  type: TYPE_NORMAL
  zh: 在这个网络中，STP 将计算以下生成树。Switch1 将成为树的根。Switch1、Switch2 和 Switch7 的所有接口都是生成树的一部分。只有连接到
    LAN B 的接口将在 Switch9 上激活。LAN H 只由 Switch7 服务，而 LAN G 上 Switch44 的端口将被禁用。从 LAN B
    发起并指向 LAN A 的帧将由 Switch7 在 LAN C 上转发，然后由 Switch1 在 LAN E 上转发，然后由 Switch44 在 LAN
    F 上转发，最终由 Switch2 在 LAN A 上转发。
- en: Switches running the Spanning Tree Protocol exchange BPDUs. These BPDUs are
    always sent as frames with destination MAC address as the ALL_BRIDGES reserved
    multicast MAC address. Each switch has a unique 64 bit identifier. To ensure uniqueness,
    the lower 48 bits of the identifier are set to the unique MAC address allocated
    to the switch by its manufacturer. The high order 16 bits of the switch identifier
    can be configured by the network administrator to influence the topology of the
    spanning tree. The default value for these high order bits is 32768.
  id: totrans-352
  prefs: []
  type: TYPE_NORMAL
  zh: 运行生成树协议的交换机交换 BPDUs。这些 BPDUs 总是以目标 MAC 地址为 ALL_BRIDGES 保留的组播 MAC 地址的帧发送。每个交换机都有一个唯一的
    64 位标识符。为了确保唯一性，标识符的低位 48 位被设置为制造商分配给交换机的唯一 MAC 地址。交换机标识符的高位 16 位可以由网络管理员配置，以影响生成树的结构。这些高位位的默认值是
    32768。
- en: 'The switches exchange BPDUs to build the spanning tree. Intuitively, the spanning
    tree is built by first selecting the switch with the smallest identifier as the
    root of the tree. The branches of the spanning tree are then composed of the shortest
    paths that allow all of the switches that compose the network to be reached. The
    BPDUs exchanged by the switches contain the following information :'
  id: totrans-353
  prefs: []
  type: TYPE_NORMAL
  zh: 交换机通过交换 BPDUs 来构建生成树。直观上，生成树的构建首先选择具有最小标识符的交换机作为树的根。生成树的分支由允许访问组成网络的全部交换机的最短路径组成。交换机之间交换的
    BPDUs 包含以下信息：
- en: the identifier of the root switch (R)
  id: totrans-354
  prefs:
  - PREF_BQ
  - PREF_UL
  type: TYPE_NORMAL
  zh: 根交换机的标识符（R）
- en: ''
  id: totrans-355
  prefs:
  - PREF_BQ
  - PREF_IND
  type: TYPE_NORMAL
- en: ''
  id: totrans-356
  prefs:
  - PREF_BQ
  - PREF_IND
  type: TYPE_NORMAL
- en: the cost of the shortest path between the switch that sent the BPDU and the
    root switch (c)
  id: totrans-357
  prefs:
  - PREF_BQ
  - PREF_UL
  type: TYPE_NORMAL
  zh: 发送 BPDU 的交换机与根交换机之间最短路径的成本（c）
- en: ''
  id: totrans-358
  prefs:
  - PREF_BQ
  - PREF_IND
  type: TYPE_NORMAL
- en: ''
  id: totrans-359
  prefs:
  - PREF_BQ
  - PREF_IND
  type: TYPE_NORMAL
- en: the identifier of the switch that sent the BPDU (T)
  id: totrans-360
  prefs:
  - PREF_BQ
  - PREF_UL
  type: TYPE_NORMAL
  zh: 发送 BPDU 的交换机标识符（T）
- en: ''
  id: totrans-361
  prefs:
  - PREF_BQ
  - PREF_IND
  type: TYPE_NORMAL
- en: ''
  id: totrans-362
  prefs:
  - PREF_BQ
  - PREF_IND
  type: TYPE_NORMAL
- en: the number of the switch port over which the BPDU was sent (p)
  id: totrans-363
  prefs:
  - PREF_BQ
  - PREF_UL
  type: TYPE_NORMAL
  zh: 发送 BPDU 的交换机端口号（p）
- en: We will use the notation <R,c,T,p> to represent a BPDU whose root identifier
    is R, cost is c and that was sent from the port p of switch T. The construction
    of the spanning tree depends on an ordering relationship among the BPDUs. This
    ordering relationship could be implemented by the Python function below.
  id: totrans-364
  prefs: []
  type: TYPE_NORMAL
  zh: 我们将使用表示法 <R,c,T,p> 来表示根标识符为 R、成本为 c 且从交换机 T 的端口 p 发送的 BPDU。生成树的构建取决于 BPDUs 之间的排序关系。这种排序关系可以通过下面的
    Python 函数实现。
- en: '[PRE5]'
  id: totrans-365
  prefs: []
  type: TYPE_PRE
  zh: '[PRE5]'
- en: In addition to the identifier discussed above, the network administrator can
    also configure a cost to be associated to each switch port. Usually, the cost
    of a port depends on its bandwidth and the [[IEEE802.1d]](../bibliography.html#ieee802-1d)
    standard recommends the values below. Of course, the network administrator may
    choose other values. We will use the notation cost[p] to indicate the cost associated
    to port p in this section.
  id: totrans-366
  prefs: []
  type: TYPE_NORMAL
  zh: 除了上述标识符之外，网络管理员还可以为每个交换机端口配置一个与之关联的成本。通常，端口的成本取决于其带宽，[[IEEE802.1d]](../bibliography.html#ieee802-1d)
    标准推荐以下值。当然，网络管理员可以选择其他值。在本节中，我们将使用表示法 cost[p] 来表示与端口 p 关联的成本。
- en: '| Bandwidth | Cost |'
  id: totrans-367
  prefs: []
  type: TYPE_TB
  zh: '| 带宽 | 成本 |'
- en: '| --- | --- |'
  id: totrans-368
  prefs: []
  type: TYPE_TB
  zh: '| --- | --- |'
- en: '| 10 Mbps | 2000000 |'
  id: totrans-369
  prefs: []
  type: TYPE_TB
  zh: '| 10 Mbps | 2000000 |'
- en: '| 100 Mbps | 200000 |'
  id: totrans-370
  prefs: []
  type: TYPE_TB
  zh: '| 100 Mbps | 200000 |'
- en: '| 1 Gbps | 20000 |'
  id: totrans-371
  prefs: []
  type: TYPE_TB
  zh: '| 1 Gbps | 20000 |'
- en: '| 10 Gbps | 2000 |'
  id: totrans-372
  prefs: []
  type: TYPE_TB
  zh: '| 10 Gbps | 2000 |'
- en: '| 100 Gbps | 200 |'
  id: totrans-373
  prefs: []
  type: TYPE_TB
  zh: '| 100 Gbps | 200 |'
- en: 'The Spanning Tree Protocol uses its own terminology that we illustrate in the
    figure above. A switch port can be in three different states : Root, Designated
    and Blocked. All the ports of the root switch are in the Designated state. The
    state of the ports on the other switches is determined based on the BPDU received
    on each port.'
  id: totrans-374
  prefs: []
  type: TYPE_NORMAL
  zh: 生成树协议使用其自己的术语，我们在上图中进行说明。交换机端口可以处于三种不同的状态：根、指定和阻塞。根交换机的所有端口都处于指定状态。其他交换机端口的状况是基于每个端口接收到的
    BPDU 来确定的。
- en: 'The Spanning Tree Protocol uses the ordering relationship to build the spanning
    tree. Each switch listens to BPDUs on its ports. When BPDU = <R,c,T,p> is received
    on port q, the switch computes the port’s root priority vector: V[q] = <R,c+cost[q],T,p,q>
    , where cost[q] is the cost associated to the port over which the BPDU was received.
    The switch stores in a table the last root priority vector received on each port.
    The switch then compares its own identifier with the smallest root identifier
    stored in this table. If its own identifier is smaller, then the switch is the
    root of the spanning tree and is, by definition, at a distance 0 of the root.
    The BPDU of the switch is then <R,0,R,p>, where R is the switch identifier and
    p will be set to the port number over which the BPDU is sent.'
  id: totrans-375
  prefs: []
  type: TYPE_NORMAL
  zh: 生成树协议使用排序关系来构建生成树。每个交换机都会在其端口上监听 BPDUs。当在端口 q 上接收到 BPDU = <R,c,T,p> 时，交换机计算该端口的根优先级向量：V[q]
    = <R,c+cost[q],T,p,q>，其中 cost[q] 是与接收 BPDU 的端口相关的成本。交换机将每个端口上接收到的最后一个根优先级向量存储在表中。然后，交换机将其自己的标识符与表中存储的最小根标识符进行比较。如果其自己的标识符更小，则该交换机是生成树的根，并且根据定义，距离根的距离为
    0。该交换机的 BPDU 则为 <R,0,R,p>，其中 R 是交换机标识符，p 将被设置为发送 BPDU 的端口编号。
- en: Otherwise, the switch chooses the best priority vector from its table, bv =
    <R,c+cost[q’],T,p,q’>. The port q’, over which this best root priority vector
    was learned, is the switch port that is closest to the root switch. This port
    becomes the Root port of the switch. There is only one Root port per switch (except
    for the Root switches whose ports are all Designated). The switch can then compute
    its own BPDU as BPDU = <R,c’,S,p> , where R is the root identifier, c’ the cost
    of the best root priority vector, S the identifier of the switch and p will be
    replaced by the number of the port over which the BPDU will be sent.
  id: totrans-376
  prefs: []
  type: TYPE_NORMAL
  zh: 否则，交换机从其表中选择最佳优先级向量，bv = <R,c+cost[q’],T,p,q’>。学习到这个最佳根优先级向量的端口 q’，是该交换机端口，它距离根交换机最近。这个端口成为交换机的根端口。每个交换机只有一个根端口（除了根交换机的端口都是指定的）。然后，交换机可以计算自己的
    BPDU，BPDU = <R,c’，S,p>，其中 R 是根标识符，c’ 是最佳根优先级向量的成本，S 是交换机标识符，p 将被替换为发送 BPDU 的端口编号。
- en: To determine the state of its other ports, the switch compares its own BPDU
    with the last BPDU received on each port. Note that the comparison is done by
    using the BPDUs and not the root priority vectors. If the switch’s BPDU is better
    than the last BPDU of this port, the port becomes a Designated port. Otherwise,
    the port becomes a Blocked port.
  id: totrans-377
  prefs: []
  type: TYPE_NORMAL
  zh: 为了确定其其他端口的状况，交换机将其自己的 BPDU 与每个端口上接收到的最后一个 BPDU 进行比较。请注意，比较是通过使用 BPDUs 而不是根优先级向量进行的。如果交换机的
    BPDU 比此端口的最后一个 BPDU 更好，则该端口变为指定端口。否则，该端口变为阻塞端口。
- en: The state of each port is important when considering the transmission of BPDUs.
    The root switch regularly sends its own BPDU over all of its (Designated) ports.
    This BPDU is received on the Root port of all the switches that are directly connected
    to the root switch. Each of these switches computes its own BPDU and sends this
    BPDU over all its Designated ports. These BPDUs are then received on the Root
    port of downstream switches, which then compute their own BPDU, etc. When the
    network topology is stable, switches send their own BPDU on all their Designated
    ports, once they receive a BPDU on their Root port. No BPDU is sent on a Blocked
    port. Switches listen for BPDUs on their Blocked and Designated ports, but no
    BPDU should be received over these ports when the topology is stable. The utilization
    of the ports for both BPDUs and data frames is summarized in the table below.
  id: totrans-378
  prefs: []
  type: TYPE_NORMAL
  zh: 在考虑 BPDUs 传输时，每个端口的状况都很重要。根交换机定期将其自己的 BPDU 通过其所有（指定）端口发送。这个 BPDU 被所有直接连接到根交换机的交换机的根端口接收。这些交换机的每一个都会计算自己的
    BPDU，并通过其所有指定端口发送这个 BPDU。然后，这些 BPDU 被下游交换机的根端口接收，这些交换机随后计算自己的 BPDU，等等。当网络拓扑稳定时，交换机在其所有指定端口上发送自己的
    BPDU，一旦它们在其根端口上接收到 BPDU。在阻塞端口上不会发送 BPDU。交换机在其阻塞和指定端口上监听 BPDUs，但在拓扑稳定时，不应通过这些端口接收任何
    BPDU。端口用于 BPDUs 和数据帧的利用率总结在下表之中。
- en: '| Port state | Receives BPDUs | Sends BPDU | Handles data frames |'
  id: totrans-379
  prefs: []
  type: TYPE_TB
  zh: '| 端口状态 | 接收 BPDUs | 发送 BPDU | 处理数据帧 |'
- en: '| --- | --- | --- | --- |'
  id: totrans-380
  prefs: []
  type: TYPE_TB
  zh: '| --- | --- | --- | --- |'
- en: '| Blocked | yes | no | no |'
  id: totrans-381
  prefs: []
  type: TYPE_TB
  zh: '| 阻塞端口 | 是 | 否 | 否 |'
- en: '| Root | yes | no | yes |'
  id: totrans-382
  prefs: []
  type: TYPE_TB
  zh: '| 根端口 | 是 | 否 | 是 |'
- en: '| Designated | yes | yes | yes |'
  id: totrans-383
  prefs: []
  type: TYPE_TB
  zh: '| 指定端口 | 是 | 是 | 是 |'
- en: To illustrate the operation of the Spanning Tree Protocol, let us consider the
    simple network topology in the figure [Fig. 177](#fig-stp-example).
  id: totrans-384
  prefs: []
  type: TYPE_NORMAL
  zh: 为了说明生成树协议的操作，让我们考虑图 [图 177](#fig-stp-example) 中的简单网络拓扑。
- en: '[![../_images/datalink-fig-016-c.svg](../Images/400b4ebfa6c09b6f49710e52c919a9a1.png)](../_images/datalink-fig-016-c.svg)'
  id: totrans-385
  prefs: []
  type: TYPE_NORMAL
  zh: '[![../_images/datalink-fig-016-c.svg](../Images/400b4ebfa6c09b6f49710e52c919a9a1.png)](../_images/datalink-fig-016-c.svg)'
- en: Fig. 177 A simple Spanning tree computed in a switched Ethernet network[#](#fig-stp-example
    "Link to this image")
  id: totrans-386
  prefs: []
  type: TYPE_NORMAL
  zh: 图 177 在交换式以太网网络中计算的简单生成树[#](#fig-stp-example "链接到这张图片")
- en: Assume that Switch4 is the first to boot. It sends its own BPDU = <4,0,4,1>
    (resp. BPDU = <4,0,4,2>) on port 1 (resp. port 2). When Switch1 boots, it sends
    BPDU = <1,0,1,1>. This BPDU is received by Switch4, which updates its BPDU and
    root priority vector tables and computes a new BPDU = <1,3,4,1> (resp. BPDU =
    <1,3,4,2>) on port 1 (resp. port 2). Indeed, there is only one root priority vector
    and hence, it is the best one. Port 1 of Switch4 becomes the Root port while its
    second port is still in the Designated state.
  id: totrans-387
  prefs: []
  type: TYPE_NORMAL
  zh: 假设 Switch4 是第一个启动的。它在端口 1 上发送自己的 BPDU = <4,0,4,1>（或 BPDU = <4,0,4,2>）。当 Switch1
    启动时，它发送 BPDU = <1,0,1,1>。这个 BPDU 被 Switch4 接收，Switch4 更新其 BPDU 和根优先级向量表，并在端口 1
    上（或端口 2）计算新的 BPDU = <1,3,4,1>（或 BPDU = <1,3,4,2>）。实际上，只有一个根优先级向量，因此它是最好的。Switch4
    的端口 1 成为根端口，而其第二个端口仍然处于指定状态。
- en: Assume now that Switch9 boots and immediately receives Switch1 ‘s BPDU on port
    1\. Switch9 computes its own BPDU = <1,1,9,1> (resp. BPDU = <1,1,9,2>) on port
    1 (resp. port 2) and port 1 becomes the Root port of this switch. The BPDU is
    sent on port 2 of Switch9 and reaches Switch4. Switch4 compares the priority vectors.
    It notices that the last computed vector (i.e., V[2] = <1,2,9,2,2>) is better
    than V[1] = <1,3,1,1,1>. Thus, Switch4’s BPDU is recomputed and port 2 becomes
    the Root port of Switch4. Switch4 compares its new BPDU = <1,2,4,p> with the last
    BPDU received on each port (except for the Root port). Port 1 becomes a Blocked
    port on Switch4 because the BPDU=<1,0,1,1> received on this port is better.
  id: totrans-388
  prefs: []
  type: TYPE_NORMAL
  zh: 假设现在 Switch9 启动并立即在端口 1 上接收到 Switch1 的 BPDU。Switch9 在端口 1 上计算自己的 BPDU = <1,1,9,1>（或
    BPDU = <1,1,9,2>）并在端口 2 上（或端口 2）发送 BPDU，端口 1 成为该交换机的根端口。BPDU 在 Switch9 的端口 2 上发送并到达
    Switch4。Switch4 比较优先级向量。它注意到最后一个计算的向量（即 V[2] = <1,2,9,2,2>）比 V[1] = <1,3,1,1,1>
    更好。因此，Switch4 的 BPDU 重新计算，端口 2 成为 Switch4 的根端口。Switch4 将其新的 BPDU = <1,2,4,p> 与每个端口上接收到的最后一个
    BPDU（除了根端口）进行比较。端口 1 在 Switch4 上成为阻塞端口，因为在此端口上接收到的 BPDU=<1,0,1,1> 更好。
- en: During the computation of the spanning tree, switches discard all received data
    frames, as at that time the network topology is not guaranteed to be loop-free.
    Once that topology has been stable for some time, the switches again start to
    use the MAC learning algorithm to forward data frames. Only the Root and Designated
    ports are used to forward data frames. Switches discard all the data frames received
    on their Blocked ports and never forward frames on these ports.
  id: totrans-389
  prefs: []
  type: TYPE_NORMAL
  zh: 在计算生成树期间，交换机丢弃所有接收到的数据帧，因为那时网络拓扑不保证是无环的。一旦拓扑稳定了一段时间，交换机再次开始使用 MAC 学习算法转发数据帧。只有根端口和指定端口用于转发数据帧。交换机丢弃其阻塞端口上接收到的所有数据帧，并且从不在这类端口上转发帧。
- en: 'Switches, ports and links can fail in a switched Ethernet network. When a failure
    occurs, the switches must be able to recompute the spanning tree to recover from
    the failure. The Spanning Tree Protocol relies on regular transmissions of the
    BPDUs to detect these failures. A BPDU contains two additional fields : the Age
    of the BPDU and the Maximum Age. The Age contains the amount of time that has
    passed since the root switch initially originated the BPDU. The root switch sends
    its BPDU with an Age of zero and each switch that computes its own BPDU increments
    its Age by one. The Age of the BPDUs stored on a switch’s table is also incremented
    every second. A BPDU expires when its Age reaches the Maximum Age. When the network
    is stable, this does not happen as BPDU s are regularly sent by the root switch
    and downstream switches. However, if the root fails or the network becomes partitioned,
    BPDU will expire and switches will recompute their own BPDU and restart the Spanning
    Tree Protocol. Once a topology change has been detected, the forwarding of the
    data frames stops as the topology is not guaranteed to be loop-free. Additional
    details about the reaction to failures may be found in [[IEEE802.1d]](../bibliography.html#ieee802-1d).'
  id: totrans-390
  prefs: []
  type: TYPE_NORMAL
  zh: 在交换式以太网网络中，交换机、端口和链路可能会出现故障。当发生故障时，交换机必须能够重新计算生成树以从故障中恢复。生成树协议依赖于 BPDUs 的定期传输来检测这些故障。BPDU
    包含两个附加字段：BPDU 的年龄和最大年龄。年龄包含自根交换机最初生成 BPDU 以来经过的时间量。根交换机以其年龄为零发送其 BPDU，并计算其自己的
    BPDU 的每个交换机将其年龄增加一。存储在交换机表上的 BPDU 的年龄也会每秒增加。当 BPDU 的年龄达到最大年龄时，BPDU 将过期。当网络稳定时，这不会发生，因为
    BPDU 由根交换机和下游交换机定期发送。然而，如果根交换机失败或网络变得分裂，BPDU 将过期，交换机将重新计算自己的 BPDU 并重新启动生成树协议。一旦检测到拓扑变化，数据帧的转发将停止，因为无法保证拓扑是无环的。有关对故障的反应的更多详细信息，请参阅
    [[IEEE802.1d]](../bibliography.html#ieee802-1d)。
- en: '### Virtual LANs[#](#virtual-lans "Link to this heading")'
  id: totrans-391
  prefs: []
  type: TYPE_NORMAL
  zh: '### 虚拟局域网[#](#virtual-lans "链接到本标题")'
- en: Another important advantage of Ethernet switches is the ability to create Virtual
    Local Area Networks (VLANs). A virtual LAN can be defined as a set of ports attached
    to one or more Ethernet switches. A switch can support several VLANs and it runs
    one MAC learning algorithm for each Virtual LAN. When a switch receives a frame
    with an unknown or a multicast destination, it forwards it over all the ports
    that belong to the same Virtual LAN but not over the ports that belong to other
    Virtual LANs. Similarly, when a switch learns a source address on a port, it associates
    it to the Virtual LAN of this port and uses this information only when forwarding
    frames on this Virtual LAN.
  id: totrans-392
  prefs: []
  type: TYPE_NORMAL
  zh: 以太网交换机的另一个重要优点是能够创建虚拟局域网（VLAN）。虚拟局域网可以被定义为连接到一个或多个以太网交换机的一组端口。一个交换机可以支持多个 VLAN，并为每个虚拟局域网运行一个
    MAC 学习算法。当一个交换机收到一个具有未知或组播目的地的帧时，它会将该帧转发到属于同一虚拟局域网的全部端口，但不会转发到属于其他虚拟局域网的端口。同样，当一个交换机在端口上学习到一个源地址时，它会将该地址关联到该端口的虚拟局域网，并在转发该虚拟局域网的帧时使用此信息。
- en: Figure [Fig. 178](#fig-vlan) illustrates a switched Ethernet network with three
    Virtual LANs. VLAN2 and VLAN3 only require a local configuration of switch S1.
    Host C can exchange frames with host D, but not with hosts that are outside of
    its VLAN. VLAN1 is more complex as there are ports of this VLAN on several switches.
    To support such VLANs, local configuration is not sufficient anymore. When a switch
    receives a frame from another switch, it must be able to determine the VLAN in
    which the frame originated to use the correct MAC table to forward the frame.
    This is done by assigning an identifier to each Virtual LAN and placing this identifier
    inside the headers of the frames that are exchanged between switches.
  id: totrans-393
  prefs: []
  type: TYPE_NORMAL
  zh: 图 [图 178](#fig-vlan) 展示了一个具有三个虚拟局域网（VLAN）的交换式以太网网络。VLAN2 和 VLAN3 只需要交换机 S1 的本地配置。主机
    C 可以与主机 D 交换帧，但不能与它所在 VLAN 外的主机交换帧。VLAN1 更为复杂，因为这个 VLAN 的端口分布在几个交换机上。为了支持这样的 VLAN，本地配置已不再足够。当一个交换机从另一个交换机接收一个帧时，它必须能够确定该帧起源于哪个
    VLAN，以便使用正确的 MAC 表来转发该帧。这是通过为每个虚拟局域网分配一个标识符，并将此标识符放置在交换机之间交换的帧的头部来实现的。
- en: '[![../_images/datalink-fig-017-c.png](../Images/2d641cc82f586881a3a072f7fc5bfdc8.png)](../_images/datalink-fig-017-c.png)'
  id: totrans-394
  prefs: []
  type: TYPE_NORMAL
  zh: '![../_images/datalink-fig-017-c.png](../Images/2d641cc82f586881a3a072f7fc5bfdc8.png)'
- en: Fig. 178 Virtual Local Area Networks in a switched Ethernet network[#](#fig-vlan
    "Link to this image")
  id: totrans-395
  prefs: []
  type: TYPE_NORMAL
  zh: 图 178 交换式以太网网络中的虚拟局域网[#](#fig-vlan "链接到本图像")
- en: IEEE defined in the [[IEEE802.1q]](../bibliography.html#ieee802-1q) standard
    a special header to encode the VLAN identifiers. This 32 bit header includes a
    12 bit VLAN field that contains the VLAN identifier of each frame. The format
    of the [[IEEE802.1q]](../bibliography.html#ieee802-1q) header is shown in figure
    [Fig. 179](#fig-8021q).
  id: totrans-396
  prefs: []
  type: TYPE_NORMAL
  zh: IEEE 在 [[IEEE802.1q]](../bibliography.html#ieee802-1q) 标准中定义了一个特殊的头部来编码 VLAN
    标识符。这个 32 位的头部包含一个 12 位的 VLAN 字段，它包含每个帧的 VLAN 标识符。[[IEEE802.1q]](../bibliography.html#ieee802-1q)
    头部的格式如图 [图 179](#fig-8021q) 所示。
- en: '[![../_images/8021q.svg](../Images/a5322aedde97417cdbe8bf165a0df75e.png)](../_images/8021q.svg)'
  id: totrans-397
  prefs: []
  type: TYPE_NORMAL
  zh: '[![../_images/8021q.svg](../Images/a5322aedde97417cdbe8bf165a0df75e.png)](../_images/8021q.svg)'
- en: Fig. 179 Format of the 802.1q header[#](#fig-8021q "Link to this image")
  id: totrans-398
  prefs: []
  type: TYPE_NORMAL
  zh: 图 179 802.1q 头部格式[#](#fig-8021q "链接到这个图像")
- en: The [[IEEE802.1q]](../bibliography.html#ieee802-1q) header is inserted immediately
    after the source MAC address in the Ethernet frame (i.e. before the EtherType
    field). The maximum frame size is increased by 4 bytes. It is encoded in 32 bits
    and contains four fields. The Tag Protocol Identifier is set to 0x8100 to allow
    the receiver to detect the presence of this additional header. The Priority Code
    Point (PCP) is a three bit field that is used to support different transmission
    priorities for the frame. Value 0 is the lowest priority and value 7 the highest.
    Frames with a higher priority can expect to be forwarded earlier than frames having
    a lower priority. The C bit is used for compatibility between Ethernet and Token
    Ring networks. The last 12 bits of the 802.1q header contain the VLAN identifier.
    Value 0 indicates that the frame does not belong to any VLAN while value 0xFFF
    is reserved. This implies that 4094 different VLAN identifiers can be used in
    an Ethernet network.
  id: totrans-399
  prefs: []
  type: TYPE_NORMAL
  zh: '[[IEEE802.1q]](../bibliography.html#ieee802-1q) 头部被插入到以太网帧中的源 MAC 地址之后（即在 EtherType
    字段之前）。最大帧大小增加了 4 个字节。它以 32 位编码，包含四个字段。标签协议标识符被设置为 0x8100，以便接收器检测到这个附加头部的存在。优先级代码点（PCP）是一个三位字段，用于支持帧的不同传输优先级。值
    0 是最低优先级，值 7 是最高优先级。具有较高优先级的帧可以期望比具有较低优先级的帧更早地转发。C 位用于以太网和令牌环网络之间的兼容性。802.1q 头部的最后
    12 位包含 VLAN 标识符。值 0 表示帧不属于任何 VLAN，而值 0xFFF 是保留的。这意味着在以太网网络中可以使用 4094 个不同的 VLAN
    标识符。'
- en: 802.11 wireless networks[#](#wireless-networks "Link to this heading")
  id: totrans-400
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 802.11 无线网络[#](#wireless-networks "链接到这个标题")
- en: The radio spectrum is a limited resource that must be shared by everyone. During
    most of the twentieth century, governments and international organizations have
    regulated most of the radio spectrum. This regulation controls the utilization
    of the radio spectrum, in order to prevent interference among different users.
    A company that wants to use a frequency range in a given region must apply for
    a license from the regulator. Most regulators charge a fee for the utilization
    of the radio spectrum and some governments have encouraged competition among companies
    bidding for the same frequency to increase the license fees.
  id: totrans-401
  prefs: []
  type: TYPE_NORMAL
  zh: 无线电频谱是一种有限的资源，必须由每个人共享。在二十世纪的绝大部分时间里，政府和国际组织监管了大部分的无线电频谱。这种监管控制了无线电频谱的利用，以防止不同用户之间的干扰。任何想要在特定区域使用频率范围的公司必须向监管机构申请许可证。大多数监管机构对无线电频谱的利用收取费用，而一些政府鼓励在争夺相同频率的公司之间进行竞争，以提高许可证费用。
- en: 'In the 1970s, after the first experiments with ALOHANet, interest in wireless
    networks grew. Many experiments were done on and outside the ARPANet. One of these
    experiments was the [first mobile phone](http://news.bbc.co.uk/2/hi/programmes/click_online/8639590.stm)
    , which was developed and tested in 1973\. This experimental mobile phone was
    the starting point for the first generation analog mobile phones. Given the growing
    demand for mobile phones, it was clear that the analog mobile phone technology
    was not sufficient to support a large number of users. To support more users and
    new services, researchers in several countries worked on the development of digital
    mobile telephones. In 1987, several European countries decided to develop the
    standards for a common cellular telephone system across Europe : the Global System
    for Mobile Communications (GSM). Since then, the standards have evolved and more
    than three billion users are connected to GSM networks today.'
  id: totrans-402
  prefs: []
  type: TYPE_NORMAL
  zh: 在20世纪70年代，在ALOHA网首次实验之后，对无线网络产生了兴趣。在ARPANet内部和外部进行了许多实验。其中之一是[第一代移动电话](http://news.bbc.co.uk/2/hi/programmes/click_online/8639590.stm)，该手机于1973年开发和测试。这款实验性移动电话是第一代模拟移动电话的起点。鉴于对移动电话不断增长的需求，很明显，模拟移动电话技术不足以支持大量用户。为了支持更多用户和新服务，多个国家的研究人员致力于数字移动电话的开发。1987年，几个欧洲国家决定开发一个覆盖整个欧洲的共同蜂窝电话系统标准：全球移动通信系统（GSM）。从那时起，标准不断发展，今天超过30亿用户已连接到GSM网络。
- en: While most of the frequency ranges of the radio spectrum are reserved for specific
    applications and require a special license, there are a few exceptions. These
    exceptions are known as the [Industrial, Scientific and Medical](http://en.wikipedia.org/wiki/ISM_band)
    (ISM) radio bands. These bands can be used for industrial, scientific and medical
    applications without requiring a license from the regulator. For example, some
    radio-controlled models use the 27 MHz ISM band and some cordless telephones operate
    in the 915 MHz ISM. In 1985, the 2.400-2.500 GHz band was added to the list of
    ISM bands. This frequency range corresponds to the frequencies that are emitted
    by microwave ovens. Sharing this band with licensed applications would have likely
    caused interference, given the large number of microwave ovens that are used.
    Despite the risk of interference with microwave ovens, the opening of the 2.400-2.500
    GHz allowed the networking industry to develop several wireless network techniques
    to allow computers to exchange data without using cables. In this section, we
    discuss in more detail the most popular one, i.e. the WiFi [[IEEE802.11]](../bibliography.html#ieee802-11)
    family of wireless networks. Other wireless networking techniques such as [BlueTooth](http://en.wikipedia.org/wiki/BlueTooth)
    or [HiperLAN](http://en.wikipedia.org/wiki/HiperLAN) use the same frequency range.
  id: totrans-403
  prefs: []
  type: TYPE_NORMAL
  zh: 尽管无线电频谱的大部分频段被预留用于特定应用并需要特殊许可证，但仍有一些例外。这些例外被称为[工业、科学和医疗](http://en.wikipedia.org/wiki/ISM_band)（ISM）无线电频段。这些频段可用于工业、科学和医疗应用，无需从监管机构获得许可证。例如，一些无线电遥控模型使用27
    MHz ISM频段，一些无绳电话在915 MHz ISM频段工作。1985年，2.400-2.500 GHz频段被添加到ISM频段列表中。这个频段对应于微波炉发出的频率。考虑到大量使用的微波炉，与许可应用共享这个频段可能会引起干扰。尽管存在与微波炉干扰的风险，但2.400-2.500
    GHz频段的开放使得网络行业能够开发出几种无线网络技术，允许计算机无需使用电缆交换数据。在本节中，我们将更详细地讨论最受欢迎的一种，即WiFi [[IEEE802.11]](../bibliography.html#ieee802-11)无线网络家族。其他无线网络技术，如[蓝牙](http://en.wikipedia.org/wiki/BlueTooth)或[HiperLAN](http://en.wikipedia.org/wiki/HiperLAN)，也使用相同的频段。
- en: Today, WiFi is a very popular wireless networking technology. There are more
    than several hundreds of millions of WiFi devices. The development of this technology
    started in the late 1980s with the [WaveLAN](http://en.wikipedia.org/wiki/WaveLAN)
    proprietary wireless network. WaveLAN operated at 2 Mbps and used different frequency
    bands in different regions of the world. In the early 1990s, the [IEEE](https://www.ieee.org)
    created the [802.11 working group](http://www.ieee802.org/11/) to standardize
    a family of wireless network technologies. This working group was very prolific
    and produced several wireless networking standards that use different frequency
    ranges and different physical layers. The table below provides a summary of the
    main 802.11 standards.
  id: totrans-404
  prefs: []
  type: TYPE_NORMAL
  zh: 今天，WiFi是一种非常流行的无线网络技术。有超过数亿台WiFi设备。这项技术的发展始于20世纪80年代末的[WaveLAN](http://en.wikipedia.org/wiki/WaveLAN)专有无线网络。WaveLAN在2
    Mbps的速度下运行，并在世界不同地区的不同频段使用不同的频率。在20世纪90年代初，[IEEE](https://www.ieee.org)创建了[802.11工作组](http://www.ieee802.org/11/)，以标准化一系列无线网络技术。这个工作组非常富有成效，并产生了几种使用不同频率范围和不同物理层的无线网络标准。下表提供了主要802.11标准的总结。
- en: '| Standard | Frequency | Typical throughput | Max bandwidth | Range (m) indoor/outdoor
    |'
  id: totrans-405
  prefs: []
  type: TYPE_TB
  zh: '| 标准 | 频率 | 典型吞吐量 | 最大带宽 | 范围 (m) 室内/室外 |'
- en: '| --- | --- | --- | --- | --- |'
  id: totrans-406
  prefs: []
  type: TYPE_TB
  zh: '| --- | --- | --- | --- | --- |'
- en: '| 802.11 | 2.4 GHz | 0.9 Mbps | 2 Mbps | 20/100 |'
  id: totrans-407
  prefs: []
  type: TYPE_TB
  zh: '| 802.11 | 2.4 GHz | 0.9 Mbps | 2 Mbps | 20/100 |'
- en: '| 802.11a | 5 GHz | 23 Mbps | 54 Mbps | 35/120 |'
  id: totrans-408
  prefs: []
  type: TYPE_TB
  zh: '| 802.11a | 5 GHz | 23 Mbps | 54 Mbps | 35/120 |'
- en: '| 802.11b | 2.4 GHz | 4.3 Mbps | 11 Mbps | 38/140 |'
  id: totrans-409
  prefs: []
  type: TYPE_TB
  zh: '| 802.11b | 2.4 GHz | 4.3 Mbps | 11 Mbps | 38/140 |'
- en: '| 802.11g | 2.4 GHz | 19 Mbps | 54 Mbps | 38/140 |'
  id: totrans-410
  prefs: []
  type: TYPE_TB
  zh: '| 802.11g | 2.4 GHz | 19 Mbps | 54 Mbps | 38/140 |'
- en: '| 802.11n | 2.4/5 GHz | 74 Mbps | 150 Mbps | 70/250 |'
  id: totrans-411
  prefs: []
  type: TYPE_TB
  zh: '| 802.11n | 2.4/5 GHz | 74 Mbps | 150 Mbps | 70/250 |'
- en: When developing its family of standards, the [IEEE 802.11 working group](http://www.ieee802.org/11/)
    took a similar approach as the [IEEE 802.3 working group](http://www.ieee802.org/3/)
    that developed various types of physical layers for Ethernet networks. 802.11
    networks use the CSMA/CA Medium Access Control technique described earlier and
    they all assume the same architecture and use the same frame format.
  id: totrans-412
  prefs: []
  type: TYPE_NORMAL
  zh: 在开发其标准系列时，[IEEE 802.11工作组](http://www.ieee802.org/11/)采取了与[IEEE 802.3工作组](http://www.ieee802.org/3/)类似的方法，后者为以太网网络开发了各种类型的物理层。802.11网络使用前面描述的CSMA/CA介质访问控制技术，并且它们都假设相同的架构并使用相同的帧格式。
- en: 'The architecture of WiFi networks is slightly different from the Local Area
    Networks that we have discussed until now. There are, in practice, two main types
    of WiFi networks : independent or adhoc networks and infrastructure networks [[10]](#fbss).
    An independent or adhoc network is composed of a set of devices that communicate
    with each other. These devices play the same role and the adhoc network is usually
    not connected to the global Internet. Adhoc networks are used when for example
    a few laptops need to exchange information or to connect a computer with a WiFi
    printer.'
  id: totrans-413
  prefs: []
  type: TYPE_NORMAL
  zh: WiFi网络的架构与我们至今讨论的局域网略有不同。在实践中，WiFi网络主要有两种类型：独立或临时网络和基础设施网络 [[10]](#fbss)。一个独立或临时网络由一组相互通信的设备组成。这些设备扮演相同的角色，并且临时网络通常不连接到全球互联网。当例如几台笔记本电脑需要交换信息或连接一台WiFi打印机时，会使用临时网络。
- en: '[![../_images/datalink-fig-018-c.png](../Images/04f0be24510b17bef06b3589cb0893eb.png)](../_images/datalink-fig-018-c.png)'
  id: totrans-414
  prefs: []
  type: TYPE_NORMAL
  zh: '[![../_images/datalink-fig-018-c.png](../Images/04f0be24510b17bef06b3589cb0893eb.png)](../_images/datalink-fig-018-c.png)'
- en: Fig. 180 An 802.11 independent or adhoc network[#](#fig-wifi-adhoc "Link to
    this image")
  id: totrans-415
  prefs: []
  type: TYPE_NORMAL
  zh: 图180 802.11独立或临时网络[#](#fig-wifi-adhoc "链接到这张图片")
- en: Most WiFi networks are infrastructure networks. An infrastructure network contains
    one or more access points that are attached to a fixed Local Area Network (usually
    an Ethernet network) that is connected to other networks such as the Internet.
    Figure `fig-wifi-infra` shows such a network with two access points and four WiFi
    devices. Each WiFi device is associated to one access point and uses this access
    point as a relay to exchange frames with the devices that are associated to another
    access point or reachable through the LAN.
  id: totrans-416
  prefs: []
  type: TYPE_NORMAL
  zh: 大多数WiFi网络都是基础设施网络。一个基础设施网络包含一个或多个接入点，这些接入点连接到一个固定的局域网（通常是一个以太网网络），该网络连接到其他网络，如互联网。图`fig-wifi-infra`展示了这样一个网络，有两个接入点和四个WiFi设备。每个WiFi设备都与一个接入点关联，并使用该接入点作为中继，与其他接入点关联的设备或通过局域网可达的设备交换帧。
- en: '[![../_images/datalink-fig-019-c.png](../Images/f0d5e9e6d0d36f1759d63a3558c0f00a.png)](../_images/datalink-fig-019-c.png)'
  id: totrans-417
  prefs: []
  type: TYPE_NORMAL
  zh: '[![../_images/datalink-fig-019-c.png](../Images/f0d5e9e6d0d36f1759d63a3558c0f00a.png)](../_images/datalink-fig-019-c.png)'
- en: Fig. 181 An 802.11 infrastructure network[#](#fig-wifi-infra "Link to this image")
  id: totrans-418
  prefs: []
  type: TYPE_NORMAL
  zh: 图 181 802.11 基础设施网络[#](#fig-wifi-infra "链接到此图像")
- en: An 802.11 access point is a relay that operates in the datalink layer like switches.
    Figure `fig-wifi-ap` represents the layers of the reference model that are involved
    when a WiFi host communicates with a host attached to an Ethernet network through
    an access point.
  id: totrans-419
  prefs: []
  type: TYPE_NORMAL
  zh: 802.11 接入点是一个在数据链路层工作的中继，就像交换机一样。图 `fig-wifi-ap` 表示当 WiFi 主机通过接入点与连接到以太网网络的宿主机通信时涉及的参考模型层。
- en: '![Figure made with TikZ](../Images/0faeff9a8c796e457aba98b2fbbe785f.png)'
  id: totrans-420
  prefs:
  - PREF_BQ
  type: TYPE_IMG
  zh: '![使用 TikZ 制作的图](../Images/0faeff9a8c796e457aba98b2fbbe785f.png)'
- en: ''
  id: totrans-421
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: Fig. 182 An 802.11 access point
  id: totrans-422
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
  zh: 图 182 802.11 接入点
- en: 802.11 devices exchange variable length frames, which have a slightly different
    structure than the simple frame format used in Ethernet LANs. We review the key
    parts of the 802.11 frames. Additional details may be found in [[IEEE802.11]](../bibliography.html#ieee802-11)
    and [[Gast2002]](../bibliography.html#gast2002) . An 802.11 frame contains a fixed
    length header, a variable length payload that may contain up 2324 bytes of user
    data and a 32 bits CRC. Although the payload can contain up to 2324 bytes, most
    802.11 deployments use a maximum payload size of 1500 bytes as they are used in
    infrastructure networks attached to Ethernet LANs. An 802.11 data frame is shown
    in figure `fig-80211-packet`.
  id: totrans-423
  prefs: []
  type: TYPE_NORMAL
  zh: 802.11 设备交换可变长度的帧，其结构略不同于在以太网局域网中使用的简单帧格式。我们回顾了 802.11 帧的关键部分。更多详细信息可以在 [[IEEE802.11]](../bibliography.html#ieee802-11)
    和 [[Gast2002]](../bibliography.html#gast2002) 中找到。一个 802.11 帧包含一个固定长度的头部，一个可变长度的有效载荷，可能包含最多
    2324 字节的用户数据和一个 32 位 CRC。尽管有效载荷可以包含多达 2324 字节，但大多数 802.11 部署使用最大有效载荷大小为 1500 字节，因为它们用于连接到以太网局域网的基础设施网络。802.11
    数据帧如图 `fig-80211-packet` 所示。
- en: '[![../_images/80211.svg](../Images/d4417bb14a34ecaa4ca9eb5590e752b4.png)](../_images/80211.svg)'
  id: totrans-424
  prefs: []
  type: TYPE_NORMAL
  zh: '[![../_images/80211.svg](../Images/d4417bb14a34ecaa4ca9eb5590e752b4.png)](../_images/80211.svg)'
- en: Fig. 183 802.11 data frame format[#](#fig-80211-packet "Link to this image")
  id: totrans-425
  prefs: []
  type: TYPE_NORMAL
  zh: 图 183 802.11 数据帧格式[#](#fig-80211-packet "链接到此图像")
- en: The first part of the 802.11 header is the 16 bit Frame Control field. This
    field contains flags that indicate the type of frame (data frame, RTS/CTS, acknowledgment,
    management frames, etc), whether the frame is sent to or from a fixed LAN, etc
    [[IEEE802.11]](../bibliography.html#ieee802-11). The Duration is a 16 bit field
    that is used to reserve the transmission channel. In data frames, the Duration
    field is usually set to the time required to transmit one acknowledgment frame
    after a SIFS delay. Note that the Duration field must be set to zero in multicast
    and broadcast frames. As these frames are not acknowledged, there is no need to
    reserve the transmission channel after their transmission. The Sequence control
    field contains a 12 bits sequence number that is incremented for each data frame
    and a 4 bits fragment number.
  id: totrans-426
  prefs: []
  type: TYPE_NORMAL
  zh: 802.11 头部的第一部分是 16 位的帧控制字段。该字段包含指示帧类型（数据帧、RTS/CTS、确认、管理帧等）、帧是否发送到或来自固定局域网等标志
    [[IEEE802.11]](../bibliography.html#ieee802-11)。持续时间是一个 16 位的字段，用于保留传输通道。在数据帧中，持续时间字段通常设置为在
    SIFS 延迟后发送一个确认帧所需的时间。请注意，在多播和广播帧中，持续时间字段必须设置为零。因为这些帧不需要确认，所以在它们传输后不需要保留传输通道。序列控制字段包含一个
    12 位的序列号，该序列号在每个数据帧中递增，以及一个 4 位的分段号。
- en: The astute reader may have noticed that the 802.11 data frames contain three
    48-bits address fields [[11]](#f4addresses) . This is surprising compared to other
    protocols in the network and datalink layers whose headers only contain a source
    and a destination address. The need for a third address in the 802.11 header comes
    from the infrastructure networks. In such a network, frames are usually exchanged
    between routers and servers attached to the LAN and WiFi devices attached to one
    of the access points. The role of the three address fields is specified by bit
    flags in the Frame Control field.
  id: totrans-427
  prefs: []
  type: TYPE_NORMAL
  zh: 聪明的读者可能已经注意到，802.11 数据帧包含三个 48 位的地址字段 [[11]](#f4addresses)。与其他网络和数据链路层中的协议相比，这些协议的头部只包含源地址和目的地址，这一点令人惊讶。802.11
    头部中第三个地址的需求来自基础设施网络。在这样的网络中，帧通常在连接到局域网的路由器和服务器以及连接到接入点之一的 WiFi 设备之间交换。三个地址字段的作用由帧控制字段中的位标志指定。
- en: 'When a frame is sent from a WiFi device to a server attached to the same LAN
    as the access point, the first address of the frame is set to the MAC address
    of the access point, the second address is set to the MAC address of the source
    WiFi device and the third address is the address of the final destination on the
    LAN. When the server replies, it sends an Ethernet frame whose source address
    is its MAC address and the destination address is the MAC address of the WiFi
    device. This frame is captured by the access point that converts the Ethernet
    header into an 802.11 frame header. The 802.11 frame sent by the access point
    contains three addresses : the first address is the MAC address of the destination
    WiFi device, the second address is the MAC address of the access point and the
    third address the MAC address of the server that sent the frame.'
  id: totrans-428
  prefs: []
  type: TYPE_NORMAL
  zh: 当一个帧从一个 WiFi 设备发送到连接到同一局域网的接入点服务器时，帧的第一个地址设置为接入点的 MAC 地址，第二个地址设置为源 WiFi 设备的
    MAC 地址，第三个地址是局域网上的最终目的地地址。当服务器回复时，它发送一个以太网帧，其源地址是它的 MAC 地址，目的地址是 WiFi 设备的 MAC
    地址。这个帧被接入点捕获，并将以太网头部转换为 802.11 帧头部。接入点发送的 802.11 帧包含三个地址：第一个地址是目的 WiFi 设备的 MAC
    地址，第二个地址是接入点的 MAC 地址，第三个地址是发送帧的服务器 MAC 地址。
- en: 802.11 control frames are simpler than data frames. They contain a Frame Control,
    a Duration field and one or two addresses. The acknowledgment frames are very
    small. They only contain the address of the destination of the acknowledgment.
    There is no source address and no Sequence Control field in the acknowledgment
    frames. This is because the acknowledgment frame can easily be associated to the
    previous frame that it acknowledges. Indeed, each unicast data frame contains
    a Duration field that is used to reserve the transmission channel to ensure that
    no collision will affect the acknowledgment frame. The Sequence Control field
    is mainly used by the receiver to remove duplicate frames. Duplicate frames are
    detected as follows. Each data frame contains a 12 bits sequence number in the
    Sequence Control field and the Frame Control field contains the Retry bit flag
    that is set when a frame is transmitted. Each 802.11 receiver stores the most
    recent sequence number received from each source address in frames whose Retry
    bit is reset. Upon reception of a frame with the Retry bit set, the receiver verifies
    its sequence number to determine whether it is a duplicated frame or not.
  id: totrans-429
  prefs: []
  type: TYPE_NORMAL
  zh: 802.11 控制帧比数据帧简单。它们包含一个帧控制字段、一个持续时间字段和一个或两个地址。确认帧非常小。它们只包含确认帧目的地的地址。确认帧中没有源地址和序列控制字段。这是因为确认帧可以很容易地与它所确认的上一帧关联。确实，每个单播数据帧都包含一个用于保留传输通道的持续时间字段，以确保不会发生碰撞影响确认帧。序列控制字段主要被接收器用于移除重复帧。重复帧的检测方法如下。每个数据帧在序列控制字段中包含一个
    12 位序列号，帧控制字段包含重试位标志，当帧被发送时设置。每个 802.11 接收器存储来自每个源地址的最新序列号，这些帧的重试位被重置。当接收到重试位被设置的帧时，接收器验证其序列号以确定它是否是重复帧。
- en: '[![../_images/80211-cts.svg](../Images/fdb6baf01dc9eef915a1a9a2b7a211ab.png)](../_images/80211-cts.svg)'
  id: totrans-430
  prefs: []
  type: TYPE_NORMAL
  zh: '![802.11-cts.svg](../Images/fdb6baf01dc9eef915a1a9a2b7a211ab.png)'
- en: Fig. 184 IEEE 802.11 ACK and CTS frames[#](#fig-80211-cts-ack "Link to this
    image")
  id: totrans-431
  prefs: []
  type: TYPE_NORMAL
  zh: 图 184 IEEE 802.11 ACK 和 CTS 帧![IEEE 802.11 ACK 和 CTS 帧链接](#fig-80211-cts-ack
    "链接到这张图片")
- en: 802.11 RTS/CTS frames are used to reserve the transmission channel, in order
    to transmit one data frame and its acknowledgment. The RTS frames contain a Duration
    and the transmitter and receiver addresses. The Duration field of the RTS frame
    indicates the duration of the entire reservation (i.e. the time required to transmit
    the CTS, the data frame, the acknowledgments and the required SIFS delays). The
    CTS frame has the same format as the acknowledgment frame.
  id: totrans-432
  prefs: []
  type: TYPE_NORMAL
  zh: 802.11 RTS/CTS 帧用于保留传输通道，以便传输一个数据帧及其确认帧。RTS 帧包含一个持续时间字段和发送方与接收方地址。RTS 帧的持续时间字段表示整个保留时间（即传输
    CTS、数据帧、确认帧和所需的 SIFS 延迟所需的时间）。CTS 帧的格式与确认帧相同。
- en: '[![../_images/80211-rts.svg](../Images/3e40ea29420fe60b879e78422f5de602.png)](../_images/80211-rts.svg)'
  id: totrans-433
  prefs: []
  type: TYPE_NORMAL
  zh: '![802.11-rts.svg](../Images/3e40ea29420fe60b879e78422f5de602.png)'
- en: Fig. 185 IEEE 802.11 RTS frame format[#](#fig-80211-rst "Link to this image")
  id: totrans-434
  prefs: []
  type: TYPE_NORMAL
  zh: 图 185 IEEE 802.11 RTS 帧格式![IEEE 802.11 RTS 帧格式链接](#fig-80211-rst "链接到这张图片")
- en: Note
  id: totrans-435
  prefs: []
  type: TYPE_NORMAL
  zh: 注意
- en: The 802.11 service
  id: totrans-436
  prefs: []
  type: TYPE_NORMAL
  zh: 802.11 服务
- en: Despite the utilization of acknowledgments, the 802.11 layer only provides an
    unreliable connectionless service like Ethernet networks that do not use acknowledgments.
    The 802.11 acknowledgments are used to minimize the probability of frame duplication.
    They do not guarantee that all frames will be correctly received by their recipients.
    Like Ethernet, 802.11 networks provide a high probability of successful delivery
    of the frames, not a guarantee. Furthermore, it should be noted that 802.11 networks
    do not use acknowledgments for multicast and broadcast frames. This implies that
    in practice such frames are more likely to suffer from transmission errors than
    unicast frames.
  id: totrans-437
  prefs: []
  type: TYPE_NORMAL
  zh: 尽管使用了确认，但802.11层仅提供类似于不使用确认的以太网网络的不可靠无连接服务。802.11确认用于最小化帧重复的概率。它们不能保证所有帧都将被正确接收。像以太网一样，802.11网络提供成功传输帧的高概率，而不是保证。此外，应注意802.11网络不使用确认进行多播和广播帧。这意味着在实践中，此类帧比单播帧更容易出现传输错误。
- en: In addition to the data and control frames that we have briefly described above,
    802.11 networks use several types of management frames. These management frames
    are used for various purposes. We briefly describe some of these frames below.
    A detailed discussion may be found in [[IEEE802.11]](../bibliography.html#ieee802-11)
    and [[Gast2002]](../bibliography.html#gast2002).
  id: totrans-438
  prefs: []
  type: TYPE_NORMAL
  zh: 除了我们上面简要描述的数据和控制帧之外，802.11网络还使用几种类型的管理帧。这些管理帧用于各种目的。以下简要描述了一些这些帧。更详细的讨论可以在[[IEEE802.11]](../bibliography.html#ieee802-11)和[[Gast2002]](../bibliography.html#gast2002)中找到。
- en: A first type of management frames are the beacon frames. These frames are broadcasted
    regularly by access points. Each beacon frame contains information about the capabilities
    of the access point (e.g. the supported 802.11 transmission rates) and a Service
    Set Identity (SSID). The SSID is a null-terminated ASCII string that can contain
    up to 32 characters. An access point may support several SSIDs and announce them
    in beacon frames. An access point may also choose to remain silent and not advertise
    beacon frames. In this case, WiFi stations may send Probe request frames to force
    the available access points to return a Probe response frame.
  id: totrans-439
  prefs: []
  type: TYPE_NORMAL
  zh: 第一种管理帧类型是信标帧。这些帧由接入点定期广播。每个信标帧包含有关接入点功能的信息（例如，支持的802.11传输速率）以及一个服务集标识符（SSID）。SSID是一个以空字符终止的ASCII字符串，可以包含多达32个字符。接入点可能支持多个SSID并在信标帧中宣布它们。接入点也可以选择保持沉默，不广播信标帧。在这种情况下，WiFi站点可能会发送探测请求帧，迫使可用的接入点返回探测响应帧。
- en: Note
  id: totrans-440
  prefs: []
  type: TYPE_NORMAL
  zh: 注意
- en: IP over 802.11
  id: totrans-441
  prefs: []
  type: TYPE_NORMAL
  zh: 802.11上的IP
- en: 'Two types of encapsulation schemes were defined to support IP in Ethernet networks
    : the original encapsulation scheme, built above the Ethernet DIX format is defined
    in [**RFC 894**](https://datatracker.ietf.org/doc/html/rfc894.html) and a second
    encapsulation [**RFC 1042**](https://datatracker.ietf.org/doc/html/rfc1042.html)
    scheme, built above the LLC/SNAP protocol [[IEEE802.2]](../bibliography.html#ieee802-2).
    In 802.11 networks, the situation is simpler and only the [**RFC 1042**](https://datatracker.ietf.org/doc/html/rfc1042.html)
    encapsulation is used. In practice, this encapsulation adds 6 bytes to the 802.11
    header. The first four bytes correspond to the LLC/SNAP header. They are followed
    by the two bytes Ethernet Type field (0x800 for IP and 0x806 for ARP). Figure
    `fig-ip-80211` shows an IP packet encapsulated in an 802.11 frame.'
  id: totrans-442
  prefs: []
  type: TYPE_NORMAL
  zh: 为了在以太网网络中支持IP，定义了两种封装方案：原始封装方案，建立在以太网DIX格式之上，在[**RFC 894**](https://datatracker.ietf.org/doc/html/rfc894.html)中定义，以及第二个封装[**RFC
    1042**](https://datatracker.ietf.org/doc/html/rfc1042.html)方案，建立在LLC/SNAP协议之上[[IEEE802.2]](../bibliography.html#ieee802-2)。在802.11网络中，情况更简单，仅使用[**RFC
    1042**](https://datatracker.ietf.org/doc/html/rfc1042.html)封装。实际上，这种封装在802.11头部增加了6个字节。前四个字节对应于LLC/SNAP头部。它们后面跟着两个字节的以太网类型字段（IP为0x800，ARP为0x806）。图`fig-ip-80211`显示了封装在802.11帧中的IP数据包。
- en: '[![../_images/ip-80211.svg](../Images/67e54b3cd9e60b19209b0a7114c48c39.png)](../_images/ip-80211.svg)'
  id: totrans-443
  prefs: []
  type: TYPE_NORMAL
  zh: '![802.11协议图](../Images/67e54b3cd9e60b19209b0a7114c48c39.png)(../_images/ip-80211.svg)'
- en: Fig. 186 IP over IEEE 802.11[#](#fig-ip-80211 "Link to this image")
  id: totrans-444
  prefs: []
  type: TYPE_NORMAL
  zh: 图186 802.11上的IP[#](#fig-ip-80211 "链接到这张图片")
- en: The second important utilization of the management frames is to allow a WiFi
    station to be associated with an access point. When a WiFi station starts, it
    listens to beacon frames to find the available SSIDs. To be allowed to send and
    receive frames via an access point, a WiFi station must be associated to this
    access point. If the access point does not use any security mechanism to secure
    the wireless transmission, the WiFi station simply sends an Association request
    frame to its preferred access point (usually the access point that it receives
    with the strongest radio signal). This frame contains some parameters chosen by
    the WiFi station and the SSID that it requests to join. The access point replies
    with an Association response frame if it accepts the WiFI station.
  id: totrans-445
  prefs: []
  type: TYPE_NORMAL
  zh: 管理帧的第二项重要用途是允许一个WiFi站点与接入点关联。当一个WiFi站点启动时，它会监听信标帧以查找可用的SSID。要允许通过接入点发送和接收帧，一个WiFi站点必须与该接入点关联。如果接入点不使用任何安全机制来保护无线传输，WiFi站点只需向其首选接入点（通常是它接收到的信号最强的接入点）发送一个关联请求帧。此帧包含WiFi站点选择的某些参数以及它请求加入的SSID。如果接入点接受该WiFi站点，它会用一个关联响应帧回复。
- en: Footnotes
  id: totrans-446
  prefs: []
  type: TYPE_NORMAL
  zh: 脚注
