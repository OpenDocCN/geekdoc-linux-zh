- en: Content Encoding
  id: totrans-0
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 内容编码
- en: About content encodings
  id: totrans-1
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 关于内容编码
- en: '[HTTP/1.1][4] specifies that a client may request that a server encode its
    response. This is usually used to compress a response using one (or more) encodings
    from a set of commonly available compression techniques. These schemes include
    `deflate` (the zlib algorithm), `gzip`, `br` (brotli) and `compress`. A client
    requests that the server perform an encoding by including an `Accept-Encoding`
    header in the request document. The value of the header should be one of the recognized
    tokens `deflate`, … (there is a way to register new schemes/tokens, see sec 3.5
    of the spec). A server MAY honor the client’s encoding request. When a response
    is encoded, the server includes a `Content-Encoding` header in the response. The
    value of the `Content-Encoding` header indicates which encodings were used to
    encode the data, in the order in which they were applied.'
  id: totrans-2
  prefs: []
  type: TYPE_NORMAL
  zh: '[HTTP/1.1][4] 规定，客户端可以请求服务器对响应进行编码。这通常用于使用一组常用压缩技术之一（或多个）压缩响应。这些方案包括 `deflate`（zlib
    算法）、`gzip`、`br`（brotli）和 `compress`。客户端通过在请求文档中包含 `Accept-Encoding` 报头来请求服务器执行编码。报头的值应该是已识别的令牌之一
    `deflate`、…（有一种方法可以注册新的方案/令牌，请参阅规范的第 3.5 节）。服务器可以尊重客户端的编码请求。当响应被编码时，服务器会在响应中包含一个
    `Content-Encoding` 报头。`Content-Encoding` 报头的值指示使用了哪些编码来编码数据，以及它们应用的顺序。'
- en: It is also possible for a client to attach priorities to different schemes so
    that the server knows which it prefers. See sec 14.3 of RFC 2616 for more information
    on the `Accept-Encoding` header. See sec [3.1.2.2 of RFC 7231](https://datatracker.ietf.org/doc/html/rfc7231#section-3.1.2.2)
    for more information on the `Content-Encoding` header.
  id: totrans-3
  prefs: []
  type: TYPE_NORMAL
  zh: 客户端还可以对不同方案附加优先级，以便服务器知道它更喜欢哪一个。有关 `Accept-Encoding` 报头的信息，请参阅 RFC 2616 的第 14.3
    节。有关 `Content-Encoding` 报头的信息，请参阅 RFC 7231 的第 [3.1.2.2](https://datatracker.ietf.org/doc/html/rfc7231#section-3.1.2.2)
    节。
- en: Supported content encodings
  id: totrans-4
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 支持的内容编码
- en: The `deflate`, `gzip`, `zstd` and `br` content encodings are supported by libcurl.
    Both regular and chunked transfers work fine. The zlib library is required for
    the `deflate` and `gzip` encodings, the brotli decoding library is for the `br`
    encoding and not too surprisingly libzstd does `zstd`.
  id: totrans-5
  prefs: []
  type: TYPE_NORMAL
  zh: libcurl 支持 `deflate`、`gzip`、`zstd` 和 `br` 内容编码。常规和分块传输都能正常工作。`deflate` 和 `gzip`
    编码需要 zlib 库，`br` 编码需要 brotli 解码库，而 libzstd 用于 `zstd`。
- en: The libcurl interface
  id: totrans-6
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: libcurl 接口
- en: 'To cause libcurl to request a content encoding use:'
  id: totrans-7
  prefs: []
  type: TYPE_NORMAL
  zh: 要使 libcurl 请求内容编码，请使用：
- en: '[`curl_easy_setopt`][1](curl, [`CURLOPT_ACCEPT_ENCODING`][5], string)'
  id: totrans-8
  prefs: []
  type: TYPE_NORMAL
  zh: 使用 `curl_easy_setopt`[1](curl, `CURLOPT_ACCEPT_ENCODING`[5], string)
- en: where string is the intended value of the `Accept-Encoding` header.
  id: totrans-9
  prefs: []
  type: TYPE_NORMAL
  zh: 其中 string 是 `Accept-Encoding` 报头的预期值。
- en: Currently, libcurl does support multiple encodings but only understands how
    to process responses that use the `deflate`, `gzip`, `zstd` and/or `br` content
    encodings, so the only values for [`CURLOPT_ACCEPT_ENCODING`][5] that work (besides
    `identity`, which does nothing) are `deflate`, `gzip`, `zstd` and `br`. If a response
    is encoded using the `compress` or methods, libcurl returns an error indicating
    that the response could not be decoded. If `<string>` is NULL no `Accept-Encoding`
    header is generated. If `<string>` is a zero-length string, then an `Accept-Encoding`
    header containing all supported encodings is generated.
  id: totrans-10
  prefs: []
  type: TYPE_NORMAL
  zh: 目前，libcurl 支持多种编码，但仅了解如何处理使用 `deflate`、`gzip`、`zstd` 和/或 `br` 内容编码的响应，因此除了 `identity`（它什么都不做）之外，`CURLOPT_ACCEPT_ENCODING`[5]
    的唯一有效值是 `deflate`、`gzip`、`zstd` 和 `br`。如果响应使用 `compress` 或其他方法编码，libcurl 会返回一个错误，指示响应无法解码。如果
    `<string>` 为 NULL，则不生成 `Accept-Encoding` 报头。如果 `<string>` 是零长度字符串，则生成包含所有支持编码的
    `Accept-Encoding` 报头。
- en: The [`CURLOPT_ACCEPT_ENCODING`][5] must be set to any non-NULL value for content
    to be automatically decoded. If it is not set and the server still sends encoded
    content (despite not having been asked), the data is returned in its raw form
    and the `Content-Encoding` type is not checked.
  id: totrans-11
  prefs: []
  type: TYPE_NORMAL
  zh: 必须将 `CURLOPT_ACCEPT_ENCODING`[5] 设置为任何非空值，以便自动解码内容。如果没有设置，并且服务器仍然发送编码内容（尽管没有请求），则数据以原始形式返回，并且不检查
    `Content-Encoding` 类型。
- en: The curl interface
  id: totrans-12
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: curl 接口
- en: Use the [`--compressed`][6] option with curl to cause it to ask servers to compress
    responses using any format supported by curl.
  id: totrans-13
  prefs: []
  type: TYPE_NORMAL
  zh: 使用 curl 的 `--compressed`[6] 选项来指示它请求服务器使用 curl 支持的任何格式压缩响应。
