- en: Chapter 21\. Subshells
  id: totrans-0
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 第21章。子shell
- en: 原文：[https://tldp.org/LDP/abs/html/subshells.html](https://tldp.org/LDP/abs/html/subshells.html)
  id: totrans-1
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
  zh: 原文：[https://tldp.org/LDP/abs/html/subshells.html](https://tldp.org/LDP/abs/html/subshells.html)
- en: Running a shell script launches a new process, a *subshell*.
  id: totrans-2
  prefs: []
  type: TYPE_NORMAL
  zh: 运行shell脚本会启动一个新的进程，一个*子shell*。
- en: '|'
  id: totrans-3
  prefs: []
  type: TYPE_NORMAL
  zh: '|'
- en: '`**Definition:**` A *subshell* is a [child process](othertypesv.html#CHILDREF2)
    launched by a shell (or *shell script*).'
  id: totrans-4
  prefs: []
  type: TYPE_NORMAL
  zh: '`**定义：**` 一个*子shell*是由shell（或*shell脚本*）启动的[子进程](othertypesv.html#CHILDREF2)。'
- en: '|'
  id: totrans-5
  prefs: []
  type: TYPE_NORMAL
  zh: '|'
- en: A subshell is a separate instance of the command processor -- the *shell* that
    gives you the prompt at the console or in an *xterm* window. Just as your commands
    are interpreted at the command-line prompt, similarly does a script [batch-process](timedate.html#BATCHPROCREF)
    a list of commands. Each shell script running is, in effect, a subprocess (*child
    process*) of the [parent](internal.html#FORKREF) shell.
  id: totrans-6
  prefs: []
  type: TYPE_NORMAL
  zh: 子shell是命令处理器的独立实例——在控制台或*xterm*窗口中给你提示的*shell*。就像你的命令在命令行提示符下被解释一样，脚本也会[批量处理](timedate.html#BATCHPROCREF)一系列命令。每个运行的shell脚本实际上都是父shell的子进程（*子进程*）。
- en: A shell script can itself launch subprocesses. These *subshells* let the script
    do parallel processing, in effect executing multiple subtasks simultaneously.
  id: totrans-7
  prefs: []
  type: TYPE_NORMAL
  zh: 一个shell脚本本身可以启动子进程。这些*子shell*允许脚本进行并行处理，实际上同时执行多个子任务。
- en: '|  [PRE0]  |'
  id: totrans-8
  prefs: []
  type: TYPE_TB
  zh: '|  [PRE0]  |'
- en: In general, an [external command](external.html#EXTERNALREF) in a script [forks
    off](internal.html#FORKREF) a subprocess, [[1]](#FTN.AEN18102) whereas a Bash
    [builtin](internal.html#BUILTINREF) does not. For this reason, builtins execute
    more quickly and use fewer system resources than their external command equivalents.
  id: totrans-9
  prefs: []
  type: TYPE_NORMAL
  zh: 通常，脚本中的[外部命令](external.html#EXTERNALREF)会[派生](internal.html#FORKREF)一个子进程，[[1]](#FTN.AEN18102)，而Bash的[内建命令](internal.html#BUILTINREF)则不会。因此，内建命令比它们的外部命令等效物执行得更快，使用的系统资源也更少。
- en: '**Command List within Parentheses**'
  id: totrans-10
  prefs: []
  type: TYPE_NORMAL
  zh: '**括号内的命令列表**'
- en: ( command1; command2; command3; ... )
  id: totrans-11
  prefs: []
  type: TYPE_NORMAL
  zh: ( command1; command2; command3; ... )
- en: A command list embedded between `*parentheses*` runs as a subshell.
  id: totrans-12
  prefs: []
  type: TYPE_NORMAL
  zh: 嵌入在`*括号*`之间的命令列表作为子shell运行。
- en: Variables in a subshell are *not* visible outside the block of code in the subshell.
    They are not accessible to the [parent process](internal.html#FORKREF), to the
    shell that launched the subshell. These are, in effect, variables [local](localvar.html#LOCALREF)
    to the *child process*.
  id: totrans-13
  prefs: []
  type: TYPE_NORMAL
  zh: 子shell中的变量*不在*子shell代码块外部可见。它们不能被[父进程](internal.html#FORKREF)或启动子shell的shell访问。实际上，这些是*子进程*的局部变量。
- en: '**Example 21-1\. Variable scope in a subshell**'
  id: totrans-14
  prefs: []
  type: TYPE_NORMAL
  zh: '**示例 21-1\. 子shell中的变量作用域**'
- en: '|  [PRE1]  |'
  id: totrans-15
  prefs: []
  type: TYPE_TB
  zh: '|  [PRE1]  |'
- en: See also [$BASHPID](internalvariables.html#BASHPIDREF) and [Example 34-2](gotchas.html#SUBPIT).
  id: totrans-16
  prefs: []
  type: TYPE_NORMAL
  zh: 参见[$BASHPID](internalvariables.html#BASHPIDREF)和[示例 34-2](gotchas.html#SUBPIT)。
- en: '|'
  id: totrans-17
  prefs: []
  type: TYPE_NORMAL
  zh: '|'
- en: '`**Definition:**` The *scope* of a variable is the context in which it has
    meaning, in which it has a *value* that can be referenced. For example, the scope
    of a [local variable](localvar.html#LOCALREF1) lies only within the function,
    block of code, or subshell within which it is defined, while the scope of a *global*
    variable is the entire script in which it appears.'
  id: totrans-18
  prefs: []
  type: TYPE_NORMAL
  zh: '`**定义：**` 变量的*作用域*是它有意义的上下文，其中它有一个*值*可以被引用。例如，局部变量[作用域](localvar.html#LOCALREF1)仅限于定义它的函数、代码块或子shell内部，而全局变量的作用域是它出现的整个脚本。'
- en: '|'
  id: totrans-19
  prefs: []
  type: TYPE_NORMAL
  zh: '|'
- en: '| ![Note](../Images/068cd6dc5ba56f1437f9ae6e0cb52ede.png) | While the [$BASH_SUBSHELL](internalvariables.html#BASHSUBSHELLREF)
    internal variable indicates the nesting level of a subshell, the [$SHLVL](internalvariables.html#SHLVLREF)
    variable *shows no change* within a subshell.'
  id: totrans-20
  prefs: []
  type: TYPE_NORMAL
  zh: '| ![注意](../Images/068cd6dc5ba56f1437f9ae6e0cb52ede.png) | 虽然[$BASH_SUBSHELL](internalvariables.html#BASHSUBSHELLREF)内部变量指示子shell的嵌套级别，但[$SHLVL](internalvariables.html#SHLVLREF)变量在子shell内部*没有变化*。'
- en: '&#124;  [PRE2]  &#124;'
  id: totrans-21
  prefs: []
  type: TYPE_NORMAL
  zh: '&#124;  [PRE2]  &#124;'
- en: '|'
  id: totrans-22
  prefs: []
  type: TYPE_NORMAL
  zh: '|'
- en: Directory changes made in a subshell do not carry over to the parent shell.
  id: totrans-23
  prefs: []
  type: TYPE_NORMAL
  zh: 在子shell中做出的目录更改不会传递到父shell。
- en: '**Example 21-2\. List User Profiles**'
  id: totrans-24
  prefs: []
  type: TYPE_NORMAL
  zh: '**示例 21-2\. 列出用户配置文件**'
- en: '|  [PRE3]  |'
  id: totrans-25
  prefs: []
  type: TYPE_TB
  zh: '|  [PRE3]  |'
- en: A subshell may be used to set up a "dedicated environment" for a command group.
  id: totrans-26
  prefs: []
  type: TYPE_NORMAL
  zh: 子shell可以用来为命令组设置一个“专用环境”。
- en: '|  [PRE4]  |'
  id: totrans-27
  prefs: []
  type: TYPE_TB
  zh: '|  [PRE4]  |'
- en: As seen here, the [exit](internal.html#EXITREF) command only terminates the
    subshell in which it is running, *not* the parent shell or script.
  id: totrans-28
  prefs: []
  type: TYPE_NORMAL
  zh: 如此看来，[退出](internal.html#EXITREF)命令只终止它正在运行的子shell，*不会*终止父shell或脚本。
- en: One application of such a "dedicated environment" is testing whether a variable
    is defined.
  id: totrans-29
  prefs: []
  type: TYPE_NORMAL
  zh: 这种“专用环境”的一个应用是测试变量是否已定义。
- en: '|  [PRE5]  |'
  id: totrans-30
  prefs: []
  type: TYPE_TB
  zh: '|  [PRE5]  |'
- en: 'Another application is checking for a lock file:'
  id: totrans-31
  prefs: []
  type: TYPE_NORMAL
  zh: 另一个应用是检查锁文件：
- en: '|  [PRE6]  |'
  id: totrans-32
  prefs: []
  type: TYPE_TB
  zh: '|  [PRE6]  |'
- en: +
  id: totrans-33
  prefs: []
  type: TYPE_NORMAL
  zh: +
- en: Processes may execute in parallel within different subshells. This permits breaking
    a complex task into subcomponents processed concurrently.
  id: totrans-34
  prefs: []
  type: TYPE_NORMAL
  zh: 在不同的子壳中，进程可能可以并行执行。这允许将复杂任务分解为可以并行处理的子组件。
- en: '**Example 21-3\. Running parallel processes in subshells**'
  id: totrans-35
  prefs: []
  type: TYPE_NORMAL
  zh: '**示例 21-3\. 在子壳中运行并行进程**'
- en: '|  [PRE7]  |'
  id: totrans-36
  prefs: []
  type: TYPE_TB
  zh: '|  [PRE7]  |'
- en: Redirecting I/O to a subshell uses the "|" pipe operator, as in `**ls -al |
    (command)**`.
  id: totrans-37
  prefs: []
  type: TYPE_NORMAL
  zh: 将 I/O 重定向到子壳使用 "|" 管道操作符，例如 `**ls -al | (command)**`。
- en: '| ![Note](../Images/068cd6dc5ba56f1437f9ae6e0cb52ede.png) | A code block between
    [curly brackets](special-chars.html#CODEBLOCKREF) does *not* launch a subshell.{
    command1; command2; command3; . . . commandN; }'
  id: totrans-38
  prefs: []
  type: TYPE_NORMAL
  zh: '| ![注意](../Images/068cd6dc5ba56f1437f9ae6e0cb52ede.png) | 在 [花括号](special-chars.html#CODEBLOCKREF)
    之间的代码块 *不会* 启动子壳。{ command1; command2; command3; . . . commandN; }'
- en: '&#124;  [PRE8]  &#124;'
  id: totrans-39
  prefs: []
  type: TYPE_NORMAL
  zh: '&#124;  [PRE8]  &#124;'
- en: '|'
  id: totrans-40
  prefs: []
  type: TYPE_NORMAL
  zh: '|'
- en: Notes
  id: totrans-41
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 备注
- en: '| [[1]](subshells.html#AEN18102) | An external command invoked with an [exec](internal.html#EXECREF)
    does *not* (usually) fork off a subprocess / subshell. |'
  id: totrans-42
  prefs: []
  type: TYPE_TB
  zh: '| [[1]](subshells.html#AEN18102) | 使用 [exec](internal.html#EXECREF) 调用的外部命令
    *通常* 不会（通常）派生子进程/子壳。 |'
