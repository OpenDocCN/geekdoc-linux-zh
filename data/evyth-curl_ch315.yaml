- en: Torture
  id: totrans-0
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 疯狂
- en: When curl is built [debug enabled](ch306.xhtml#internals__tests__debug__md),
    it offers a special kind of testing. The tests we call **torture** tests. Do not
    worry, it is not quite as grim as it may sound.
  id: totrans-1
  prefs: []
  type: TYPE_NORMAL
  zh: 当curl构建时[启用调试](ch306.xhtml#internals__tests__debug__md)，它提供了一种特殊的测试类型。我们称之为**疯狂**测试。不用担心，它并不像听起来那么可怕。
- en: They verify that libcurl and curl exit paths work without any crash or memory
    leak happening,
  id: totrans-2
  prefs: []
  type: TYPE_NORMAL
  zh: 它们验证libcurl和curl的退出路径在没有发生任何崩溃或内存泄漏的情况下工作，
- en: 'The torture tests work like this:'
  id: totrans-3
  prefs: []
  type: TYPE_NORMAL
  zh: 疯狂测试是这样工作的：
- en: run the single test as-is first
  id: totrans-4
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 首先以原样运行单个测试
- en: count the number of invoked *fallible* functions
  id: totrans-5
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 计算调用次数的*可失败*函数数量
- en: rerun the test once for every falling function call
  id: totrans-6
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 为每个下降函数调用重新运行一次测试
- en: make each fallible function call return error, one by one
  id: totrans-7
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 逐个使每个可失败函数调用返回错误
- en: verify that there is no leak or crash
  id: totrans-8
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 验证没有泄漏或崩溃
- en: continue until all fallible functions have been made to fail
  id: totrans-9
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 继续直到所有可失败函数都失败
- en: This way of testing can take a seriously long time. I advise you to switch off
    [valgrind](ch311.xhtml#internals__tests__valgrind__md) when trying this out.
  id: totrans-10
  prefs: []
  type: TYPE_NORMAL
  zh: 这种测试方式可能需要非常长的时间。我建议你在尝试时关闭[Valgrind](ch311.xhtml#internals__tests__valgrind__md)。
- en: Rerun a specific failure
  id: totrans-11
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 重新运行特定的失败测试
- en: If a single test fails, `runtests.pl` identifies exactly which “round” that
    triggered the problem and by using the `-t` as shown, you can run a command line
    that when invoked *only* fails that particular fallible function.
  id: totrans-12
  prefs: []
  type: TYPE_NORMAL
  zh: 如果单个测试失败，`runtests.pl`会精确识别触发问题的“轮次”，并通过使用如所示`-t`选项，你可以运行一个命令行，当调用时只会失败那个特定的可失败函数。
- en: Shallow
  id: totrans-13
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 浅层
- en: To make this way of testing a little more practical, the test suite also provides
    a `--shallow` option. This lets the user set a maximum number of fallible functions
    to fail per test case. If there are more invokes to fail than is set with this
    value, the script randomly selects which ones to fail.
  id: totrans-14
  prefs: []
  type: TYPE_NORMAL
  zh: 为了使这种测试方式更加实用，测试套件还提供了一个`--shallow`选项。这允许用户为每个测试案例设置最大可失败函数的数量。如果失败调用多于这个值，脚本将随机选择哪些函数失败。
- en: As a special feature, as randomizing things in tests can be uncomfortable, the
    script uses a random seed based on year + month, so it remains the same for each
    calendar month. Convenient, as if you rerun the same test with the same `--shallow`
    value it runs the same random tests.
  id: totrans-15
  prefs: []
  type: TYPE_NORMAL
  zh: 作为一项特殊功能，由于在测试中随机化事物可能会感到不舒服，脚本使用基于年份加月份的随机种子，因此对于每个月历月份都是相同的。方便得很，如果你用相同的`--shallow`值重新运行相同的测试，它将运行相同的随机测试。
- en: You can force a different seed with runtests’ `--seed` option.
  id: totrans-16
  prefs: []
  type: TYPE_NORMAL
  zh: 你可以使用runtests的`--seed`选项强制使用不同的种子。
