# `ionice` 命令

`ionice` 命令用于设置或获取进程 I/O 调度类和优先级。

如果没有给出参数，`ionice` 将查询该进程当前的 I/O 调度类和优先级。

## 用法

```sh
      ionice [options] -p <pid> 

```

```sh
      ionice [options] -P <pgid> 

```

```sh
      ionice [options] -u <uid> 

```

```sh
      ionice [options] <command> 

```

## 进程可以是三种调度类之一：

+   ### 空闲

    空闲 I/O 优先级的程序只有在没有其他程序在定义的宽限期请求磁盘 I/O 时才会获得磁盘时间。

    空闲进程对正常系统活动的影响应该是“零”。

    此调度类不接收优先级参数。

    目前，此调度类允许普通用户（自内核 2.6.25 以来）使用。

+   ### 尽力而为

    这是一个适用于任何未请求特定 I/O 优先级的进程的有效调度类。

    此类从 0-7 的优先级参数中获取优先级，数字越低优先级越高。

    具有相同尽力而为优先级的程序将以轮询方式服务。

    注意，在 2.6.26 之前的内核中，未请求 I/O 优先级的进程正式使用“None”作为调度类，但 I/O 调度器会将此类进程视为尽力而为类。

    尽力而为类中的优先级将动态地从进程的 CPU nice 级别中推导出来：io_priority = ( cpu_nice + 20 ) / 5，对于 2.6.26 之后的内核以及 CFQ I/O 调度器的进程，未请求 sn io 优先级的进程将继承 CPU 调度类。

    I/O 优先级来自进程的 CPU nice 级别（在 2.6.26 之前的内核中为 smr sd）。

+   ### 实时

    实时调度类将首先获得对磁盘的访问，无论系统中的其他操作如何。

    因此，实时类需要谨慎使用，因为它可能会影响其他进程。

    与尽力而为类一样，定义了 8 个优先级级别，表示每个调度窗口中给定进程将获得的时间片大小。

    此调度类不允许普通用户（非 root）使用。

## 选项

| 选项 | 描述 |
| --- | --- |
| -c, --class<class></class> | 调度类的名称或编号，0：无，1：实时，2：尽力而为，3：空闲 |
| -n, --classdata | 指定调度类中的优先级（0..7），仅适用于实时和尽力而为类 |
| -p, --pid <pid>...</pid> | 对这些已运行的进程进行操作 |
| -P, --pgid <pgrp>...</pgrp> | 对这些组中已运行的进程进行操作 |
| -t, --ignore | 忽略失败 |
| -u, --uid <uid>...</uid> | 对这些用户拥有的已运行进程进行操作 |
| -h, --help | 显示此帮助 |
| -V, --version | 显示版本 |

更多详细信息请参阅 ionice(1)。

## 示例

| 命令 | 输出 | 说明 |
| --- | --- | --- |
| `$ ionice` | *无：优先级 4* | 单独运行 `ionice` 将给出当前进程的类和优先级 |
| `$ ionice -p 101` | *无：优先级 4* | 给出指定进程 ID 的进程的详细信息（*类：优先级*） |
| `$ ionice -p 2` | *none: prio 4* | 检查具有 pid 2 的进程的类和优先级，它是 none 和 4 相应地 |
| `$ ionice -c2 -n0 -p2` | 2 ( best-effort ) priority 0 process 2 | 现在让我们将进程(pid) 2 设置为具有最高优先级的 best-effort 程序 |
| $ `ionice` -p 2 | best-effort : prio 0 | 现在如果检查进程 2 的详细信息，你可以看到更新后的信息 |
| $ `ionice` /bin/ls |  | 获取/bin/ls 的优先级和类信息 |
| $ `ionice` -n4 -p2 |  | 为进程 2 设置优先级 4 |
| $ `ionice` -p 2 | best-effort: prio 4 | 现在观察上面运行的命令和这个命令之间的区别，我们将优先级从 0 改为 4 |
| $ `ionice` -c0 -n4 -p2 | ionice: ignoring given class data for none class | （注意，在内核 2.6.26 之前，未正式请求 I/O 优先级的进程使用“None”作为调度类， |
|  |  | 但 I/O 调度器将此类进程视为在 best-effort 类中。 ） |
|  |  | -t option : ignore failure |
| $ `ionice` -c0 -n4 -p2 -t |  | 为了忽略上面显示的警告，我们可以使用-t 选项，这样它将忽略失败 |

## 结论

因此，我们已经成功学习了`ionice`命令。
