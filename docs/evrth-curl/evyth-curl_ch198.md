# 缓存

libcurl 缓存不同的信息，以帮助后续传输更快地执行。有四个关键缓存：DNS、连接、TLS 会话和 CA 证书。

当使用多接口时，这些缓存默认情况下会共享给添加到单个多接口的所有 easy handles，而当使用 easy 接口时，它们将保留在该 handle 中。

您可以指示 libcurl 与共享接口共享一些缓存。

## DNS 缓存

当 libcurl 将主机名解析为一个或多个 IP 地址时，这些地址会存储在 DNS 缓存中，以便在近期内的后续传输中无需再次进行相同的解析。名称解析可能需要几百毫秒，有时甚至更长。

默认情况下，每个此类主机名都会在缓存中存储 60 秒（可以通过`CURLOPT_DNS_CACHE_TIMEOUT`进行更改）。

实际上，libcurl 通常不知道 DNS 条目的 TTL（生存时间）值，因为通常在它用于此目的的系统功能调用中不会暴露该值，因此增加此值会带来风险，即 libcurl 可能比必要的更长的时间继续使用过时的地址。

## 连接缓存

也被称为连接池。这是一个之前使用的连接集合，而不是在使用后关闭，而是保持活跃状态，以便后续针对相同主机名且具有其他几个匹配的检查的传输可以使用它们，而不是创建新的连接。

重新使用的连接通常可以节省进行 DNS 查找、设置 TCP 连接、执行 TLS 握手等操作。

只有当名称相同的情况下才会重用连接。即使两个不同的主机名解析到相同的 IP 地址，它们仍然始终使用 libcurl 的两个单独的连接。

由于连接重用基于主机名，并且当重用连接进行传输时，DNS 解析阶段完全跳过，因此 libcurl 不知道主机名在 DNS 中的当前状态，因为实际上 IP 地址可能会随时间变化，而连接可能会在原始 IP 地址上继续被重用。

连接缓存的大小——要保留的活跃连接数量——可以通过`CURLOPT_MAXCONNECTS`（默认为 5）为 easy handles 设置，对于多 handles 使用`CURLMOPT_MAXCONNECTS`。多 handles 的默认大小是 easy handles 数量的 4 倍。

## TLS 会话缓存

TLS 会话 ID 和票据是特殊的 TLS 机制，客户端可以将它们传递给服务器，以简化与之前已建立连接的服务器之间的后续 TLS 握手。

libcurl 缓存与主机名和端口号相关的会话 ID 和票据，因此如果后续连接尝试连接到 libcurl 已缓存的 ID 或票据的主机，使用它们可以大大减少 TLS 握手过程，从而减少完成所需的时间。

## CA 证书缓存

对于 curl 支持的某些 TLS 后端（OpenSSL 和 Schannel），它会在内存中构建 CA 证书存储缓存，并在后续传输中使用它。这使得传输可以跳过加载和处理有时相当大的 CA 证书包所带来的不必要的加载和解析时间。

由于 CA 证书包可能会更新，缓存的生命周期默认设置为 24 小时，这样长时间运行的应用程序至少每天刷新缓存并重新加载文件一次——以便能够加载和使用存储的新版本。

如果默认设置不够好，应用程序可以通过`CURLOPT_CA_CACHE_TIMEOUT`选项更改 CA 证书缓存超时时间。
