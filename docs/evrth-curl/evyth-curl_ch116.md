# HTTP 代理

HTTP 代理是客户端与它通信以完成传输的代理。curl 默认情况下，假设您使用`-x`或`--proxy`指定的主机是 HTTP 代理，除非您也指定端口号，否则默认为端口 1080（而选择该特定端口号的原因纯粹是历史的）。

如果您想通过 192.168.0.1 端口 8080 的代理请求 example.com 网页，命令行可能看起来像这样：

```sh
curl -x 192.168.0.1:8080 http://example.com/
```

回想一下，代理接收您的请求，将其转发到真实服务器，然后从服务器读取响应，并将其返回给客户端。

如果您在与代理通信时启用详细模式`-v`，它将显示 curl 连接到代理而不是远程服务器，并且可能看到它使用了一个略微不同的请求行。

## 通过 HTTP 代理的 HTTPS

HTTPS 被设计成允许并从客户端到服务器（以及返回）提供安全且安全的端到端隐私。为了在通过 HTTP 代理进行通信时提供这一点，HTTP 协议有一个 curl 用来设置通过代理隧道的特殊请求。这个 HTTP 方法被称为`CONNECT`。

当代理在通过 CONNECT 方法设置后通过隧道将加密数据传输到远程服务器时，代理无法看到或修改流量，除非破坏加密：

```sh
curl -x proxy.example.com:80 https://example.com/
```

## 通过 HTTP 代理的非 HTTP 协议

HTTP 代理意味着代理本身说 HTTP。HTTP 代理主要用于代理 HTTP，但它们也相当普遍地支持其他协议。特别是，FTP 相当普遍地得到支持。

当通过 HTTP 代理进行 FTP 通信时，通常是通过或多或少地假装其他协议像 HTTP 一样工作，并要求代理获取此 URL 来完成的，即使该 URL 不是使用 HTTP。这种区别很重要，因为它意味着当通过这样的 HTTP 代理发送时，curl 实际上并没有真正地说 FTP，尽管给出了 FTP URL；因此 FTP 特定的功能不会工作：

```sh
curl -x http://proxy.example.com:80 ftp://ftp.example.com/file.txt
```

那么，您可以做的另一件事就是通过 HTTP 代理隧道。

## HTTP 代理隧道

大多数 HTTP 代理允许客户端通过它隧道到另一侧的服务器。这正是每次您通过 HTTP 代理使用 HTTPS 时所做的。

您可以使用`-p`或`--proxytunnel`通过 curl 通过 HTTP 代理隧道。

当您通过代理进行 HTTPS 时，通常连接到默认的 HTTPS 远程 TCP 端口号 443。大多数 HTTP 代理将白名单和允许连接仅限于该端口号上的主机以及可能的一些其他端口号。大多数代理拒绝客户端连接到任何随机端口（原因只有代理管理员知道）。

尽管如此，假设 HTTP 代理允许这样做，您可以要求它通过任何端口号隧道到远程服务器，这样您就可以在隧道时正常进行其他协议。您可以通过以下方式执行 FTP 隧道：

```sh
curl -p -x http://proxy.example.com:80 ftp://ftp.example.com/file.txt
```

您可以使用`--proxy1.0 [proxy]`而不是`-x`来告诉 curl 在向 HTTP 代理发出的 CONNECT 请求中使用 HTTP/1.0。
