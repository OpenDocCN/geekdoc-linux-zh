# 停止

互联网传输可能很短暂，但也可能需要很长时间。甚至可能是无限长的时间。

libcurl 通常执行传输，直到它们完成或发生错误。如果没有这些事件发生，传输将继续。

有时，你可能想在 libcurl 传输本应停止之前停止它。

## 简单 API

如其他地方所述，`curl_easy_perform()`函数是一个同步函数调用。它在返回之前完成整个传输。

在传输本应结束之前停止传输有几种不同的方法：

1.  从回调返回一个错误

1.  设置一个选项，使传输在固定时间段后停止

每个 callback 都可以返回一个错误，并且当这些函数之一返回错误时，整个传输将停止。例如，读取、写入或进度回调。

第二种方法是设置超时或其他选项，在一段时间后或达到特定条件时停止传输。例如以下之一：

1.  `CURLOPT_TIMEOUT` - 设置整个传输可能的最大时间

1.  `CURLOPT_CONNECTTIMEOUT` - 设置“连接阶段”可能的最大时间

1.  `CURLOPT_LOW_SPEED_LIMIT` - 设置最低可接受的传输速度。如果传输速度低于此速度`CURLOPT_LOW_SPEED_TIME`秒数，则传输停止。

没有提供函数允许你的应用程序从另一个线程停止正在进行的`curl_easy_perform()`调用。因此，常见的建议是私下发出这个意图，你可以在回调中检测到它，并在发生时让该回调返回错误。

## 多个 API

多接口通常是一个非阻塞 API，所以在大多数情况下，你可以通过使用`curl_multi_remove_handle()`从多句柄中移除相应的简单句柄来停止传输。

当你使用多 API 时，你可能会调用 libcurl 来等待与 libcurl 一起工作的套接字上的活动或流量。例如，`curl_multi_poll()`这样的调用可能会在等待某个事件发生（或超时到期）时阻塞。

应用程序可以通过从另一个线程调用`curl_multi_wakeup()`来使阻塞的`curl_multi_poll()`调用唤醒并强制立即返回。
