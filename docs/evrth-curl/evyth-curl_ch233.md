# 本地地址和端口号

在几乎所有情况下，您都希望让系统在设置连接时选择默认的源 IP 地址和本地端口号。

对于那些不够好的罕见情况，libcurl 提供了覆盖功能。

## 本地地址

由 libcurl 创建的连接需要有一个能够路由回此主机的源 IP 地址。应用程序不能随意选择任何它想要的 IP 地址并期望它能够工作。机器中的网络接口需要分配 IP 地址。

您可以使用`CURLOPT_INTERFACE`让 libcurl 使用非默认的 IP 地址。正如其名所示，它是设计用来接收一个命名的网络接口作为输入，然后它会尝试使用该接口的 IP 地址进行出站流量。

然而，名称也可以是一个 IP 地址或主机名，尽管**我们不推荐使用这些版本**。

为了防止 libcurl 猜测提供的输入类型，请在接口名称前加上“if!”前缀，以确保名称不会被误认为是主机名。

类似地，您可以通过在提供的名称前加上“host!”前缀来坚持地址是一个主机名或 IP 号码。

## 本地端口号

默认情况下，连接使用 16 位随机源本地端口号，来自所谓的*临时端口*范围。应用程序可以通过`CURLOPT_LOCALPORT`和`CURLOPT_LOCALPORTRANGE`选项请求使用特定的端口号范围。由于端口号是有限的资源，缩小可选择的端口范围会增加连接无法设置的风险，如果尝试的端口号当前都不可用。
