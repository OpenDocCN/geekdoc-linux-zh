# 退出代码

在该项目中投入了大量努力，以便在出现问题时 curl 能够返回一个可用的退出代码，并且在操作按计划进行时总是返回 0（零）。

如果你编写了一个调用 curl 的 shell 脚本或批处理文件，你可以始终检查返回代码以检测被调用命令中的问题。以下是在撰写本文时找到的返回代码列表。随着时间的推移，我们倾向于逐渐添加新的代码，所以如果你收到这里未列出的代码，请参阅更更新的 curl 文档以获取帮助。

一个基本的 Unix shell 脚本可能看起来像这样：

```sh
#!/bin/sh
curl http://example.com
res=$?
if test "$res" != "0"; then
   echo "the curl command failed with: $res"
fi
```

## 可用的退出代码

1.  不支持的协议。这个 curl 构建不支持此协议。通常这种情况发生是因为 URL 拼写错误，使用了前面有空格的方案部分，或者将`http`拼写为`htpt`或类似的形式。另一个常见错误是，你使用了一个在构建时禁用了一个或多个协议的 libcurl 安装，你现在要求 libcurl 使用在构建时被禁用的那些协议之一。

1.  初始化失败。这通常是一个内部错误或 libcurl 安装或系统 libcurl 运行时的问题。

1.  URL 格式错误。语法不正确。这发生在你输入错误的 URL 导致其最终错误，或者在罕见的情况下，你使用的是 curl 不支持的 URL，因为没有一个所有人都遵守的通用 URL 标准。

1.  需要的功能或选项未启用或是在构建时明确禁用。为了让 curl 能够执行此操作，你可能需要另一个 libcurl 构建。

1.  无法解析代理。给定代理主机的地址无法解析。要么给定的代理名称是错误的，要么 DNS 服务器行为异常，不知道这个名称，或者甚至可能是你在上面运行 curl 的系统配置错误，导致它找不到/不使用正确的 DNS 服务器。

1.  无法解析主机。给定的远程主机地址无法解析。给定服务器的地址无法解析。要么给定的主机名是错误的，要么 DNS 服务器行为异常，不知道这个名称，或者甚至可能是你在上面运行 curl 的系统配置错误，导致它找不到/不使用正确的 DNS 服务器。

1.  无法连接到主机。curl 成功获取了机器的 IP 地址，并尝试设置到主机的 TCP 连接，但失败了。这可能是因为你指定了错误的端口号，输入了错误的域名，错误的协议，或者可能是因为中间有防火墙或其他网络设备阻止了流量通过。

1.  未知 FTP 服务器响应。服务器发送了 curl 无法解析的数据。这可能是由于 curl 或服务器中的错误，或者服务器使用的是 curl 不支持的 FTP 协议扩展。解决这个问题的唯一真正方法是调整 curl 选项，尝试让它使用其他 FTP 命令，这些命令可能不会收到这个未知服务器的响应。

1.  FTP 访问被拒绝。服务器拒绝登录或拒绝访问您想要到达的特定资源或目录。最常见的情况是您尝试切换到服务器上不存在的目录。当然，目录就是您在 URL 中指定的内容。

1.  FTP 接受失败。在使用活动 FTP 会话等待服务器回连时，通过控制连接发送了错误代码或类似情况。

1.  FTP 奇怪的 PASS 回复。Curl 无法解析发送到 PASS 请求的回复。PASS 是 curl 发送到服务器的命令，其中包含密码，即使是匿名连接到 FTP 服务器实际上也发送了一个密码 - 一个固定的匿名字符串。如果 curl 收到它不理解的命令回复，这强烈表明这根本不是 FTP 服务器，或者服务器严重损坏。

1.  在活动 FTP 会话（使用 PORT）等待服务器连接期间，超时已过期。服务器回连花费了太长时间。这通常表明有某些因素阻止服务器成功连接到 curl，例如防火墙或其他网络配置。

1.  对 FTP PASV 命令的未知响应。Curl 无法解析发送到 PASV 请求的回复。这是一个奇怪的服务器。PASV 用于在被动模式下设置第二个数据传输连接，有关更多信息，请参阅 FTP 使用两个连接部分。您可能可以通过使用 PORT 选项来绕过这个问题。

1.  未知 FTP 227 格式。Curl 无法解析服务器发送的 227 行。这肯定是一个损坏的服务器。227 是 FTP 服务器在发送 curl 如何在被动模式下连接回它的信息时的响应。您可能可以通过使用 PORT 选项来绕过这个问题。

1.  FTP 无法获取主机。无法使用我们在 227 行中获取的主机 IP 地址。这很可能是内部错误。

1.  HTTP/2 错误。检测到 HTTP2 封装层存在问题。这相当通用，可能是几个问题中的一个，请参阅错误消息以获取详细信息。

1.  FTP 无法设置二进制。无法将传输方法更改为二进制。此服务器已损坏。curl 需要在开始传输之前将其设置为正确的模式，否则传输无法工作。

1.  文件部分传输。只有文件的一部分被传输。当传输被认为已完成时，curl 会验证它实际上接收到的数据量是否与之前告知的数据量相同。如果这两个数字不匹配，这就是错误代码。这可能意味着 curl 接收到的字节数少于广告的，或者接收到的更多。curl 本身无法知道哪个数字是错误的，或者是否正确，如果有的话。

1.  FTP 无法下载/访问指定的文件。RETR（或类似）命令失败。当尝试下载文件时，curl 从服务器收到了错误。

1.  **未使用**

1.  引号错误。一个引号命令从服务器返回了错误。curl 允许通过几种不同的方式向 IMAP、POP3、SMTP 或 FTP 服务器发送自定义命令，并具有一个通用的检查，以确保命令可以工作。当任何单独发出的命令失败时，这就是返回的退出状态。通常建议查看 FTP 通信中的标题，以更好地理解确切失败的原因和方式。

1.  HTTP 页面未检索到。请求的 URL 未找到或返回了 HTTP 错误代码为 400 或以上的其他错误。此返回代码仅在使用`-f, --fail`时出现。

1.  写入错误。Curl 无法将数据写入本地文件系统或类似的地方。curl 从网络以块的形式接收数据，并像在（或写入 stdout）一样逐块存储它。如果写入操作出现错误，这就是退出状态。

1.  **未使用**

1.  上传失败。服务器拒绝接受或存储 curl 尝试发送给它的文件。这通常是由于服务器上的访问权限错误，但也可能由于磁盘空间不足或其他资源限制而发生。这种错误可能适用于许多协议。

1.  读取错误。各种读取问题。与退出状态 23 相反。当 curl 向服务器发送数据时，它从本地文件或 stdin 或类似的地方逐块读取数据，如果读取以某种方式失败，这就是 curl 返回的退出状态。

1.  内存不足。内存分配请求失败。curl 需要分配比系统愿意提供的更多内存，因此 curl 必须退出。尝试使用较小的文件或确保 curl 有更多的内存来工作。

1.  操作超时。根据条件，达到了指定的超时时间。curl 提供了几个超时，并且这个退出代码告诉其中一个超时限制已达到。延长超时或尝试更改其他允许 curl 更快完成操作的事情。通常，这发生在网络和远程服务器情况下，您无法在本地影响。

1.  **未使用**

1.  FTP PORT 失败。PORT 命令失败。并非所有 FTP 服务器都支持 PORT 命令；尝试使用 PASV 进行传输。PORT 命令用于请求服务器通过*回连*到 curl 来创建数据连接。另请参阅 FTP 使用两个连接部分。

1.  FTP 无法使用 REST。REST 命令失败。此命令用于恢复 FTP 传输。curl 需要发出 REST 命令以执行范围或恢复传输。服务器损坏，尝试不使用范围/恢复作为粗略的解决方案执行相同的操作。

1.  **未使用**

1.  HTTP 范围错误。范围请求未成功。由于 HTTP 请求的恢复不一定被认可或支持，因此此退出代码表示对于此服务器上的此资源，无法进行范围或恢复传输。

1.  HTTP POST 错误。内部 POST 请求生成错误。如果您遇到此错误，请向 curl 项目报告确切情况。

1.  TLS/SSL 连接错误。SSL 握手失败。SSL 握手可能由于许多不同的原因而失败，因此错误消息可能提供一些额外的线索。可能是因为各方无法就 SSL/TLS 版本、可接受的加密套件或类似内容达成一致。

1.  错误的下载恢复。无法继续之前中断的下载。当请求恢复传输而实际上无法完成时，可能会返回此错误。对于 FILE、FTP 或 SFTP。

1.  使用 FILE:// 方案时无法读取给定的文件。无法打开文件。文件可能不存在，或者可能是权限问题？

1.  LDAP 无法绑定。LDAP “绑定”操作失败，这是 LDAP 操作的必要步骤，因此这意味着 LDAP 查询无法执行。这可能是因为用户名或密码错误，或其他原因。

1.  LDAP 搜索失败。给定的搜索条件导致 LDAP 搜索返回错误。

1.  **未使用**

1.  **未使用**

1.  被回调终止。应用程序告诉 libcurl 终止操作。此错误代码通常不会对用户可见，也不会对 curl 工具的用户可见。

1.  函数参数错误。一个函数被一个错误的参数调用 - 此返回代码存在是为了帮助应用程序作者理解为什么 libcurl 无法执行某些操作，并且 curl 工具永远不会返回此错误。如果这种情况发生在您身上，请向 curl 项目提交错误报告。

1.  **未使用**

1.  接口错误。指定的出站网络接口无法使用。curl 通常自行决定出站网络和 IP 地址，但当明确要求使用特定的一个而 curl 无法使用时，可能会发生此错误。

1.  **未使用**

1.  重定向太多。在跟随 HTTP 重定向时，libcurl 达到了应用程序设定的最大数量。libcurl 不会限制重定向的最大数量，但 curl 工具默认设置为 50。此限制是为了防止无限循环的重定向。使用 `--max-redirs` 选项更改限制。

1.  指定了未知的 libcurl 选项。这可能发生在你使用的 curl 版本与底层 libcurl 版本不匹配的情况下。也许你的新版本 curl 试图使用旧版 libcurl 中未引入的选项，而这个选项在你使用的 curl 工具代码中是已知的，因为它是更新的。为了降低这种风险并确保不会发生这种情况：请使用相同版本号的 curl 和 libcurl。

1.  telnet 选项格式不正确。你提供给 curl 的 telnet 选项没有使用正确的语法。

1.  **未使用**

1.  服务器 SSL/TLS 证书或 SSH 指纹验证失败。在这种情况下，curl 无法确定服务器是否是它声称的那个。有关更多详细信息，请参阅使用 curl 的 TLS 和使用 curl 的 SCP 和 SFTP 部分。

1.  服务器没有回复任何内容，这在当前上下文中被视为错误。当一个 HTTP(S)服务器响应 HTTP(S)请求时，只要服务器是活跃和健康的，它总是会返回*某些内容*。所有有效的 HTTP 响应都有一个状态行和响应头。完全没有收到任何内容表明服务器可能出现了故障，或者可能是某些因素阻止 curl 到达正确的服务器，或者你正在尝试连接到错误的端口号等。

1.  未找到 SSL 加密引擎。

1.  无法将 SSL 加密引擎设置为默认。

1.  发送网络数据失败。在网络操作中，发送数据是 curl 操作的关键部分，当 curl 从最低层网络层收到发送失败的错误时，会返回此退出状态。为了确定为什么会发生这种情况，通常需要进行一些深入的挖掘。首先启用详细模式，进行跟踪，并在可能的情况下使用 Wireshark 或类似工具检查网络流量。

1.  接收网络数据失败。在网络操作中，接收数据是 curl 操作的关键部分，当 curl 从最低层网络层收到接收数据失败的错误时，会返回此退出状态。为了确定为什么会发生这种情况，通常需要进行一些深入的挖掘。首先启用详细模式，进行跟踪，并在可能的情况下使用 Wireshark 或类似工具检查网络流量。

1.  **未使用**

1.  本地证书存在问题。客户端证书存在问题，因此无法使用。权限问题？错误的密码短语？

1.  无法使用指定的 SSL 加密密钥。加密密钥的名称需要精确指定，而且不幸的是，它们也特定于 curl 构建时使用的特定 TLS 后端。有关支持的加密密钥列表及其编写方式，请参阅在线文档[`curl.se/docs/ssl-ciphers.html`](https://curl.se/docs/ssl-ciphers.html)。

1.  无法使用已知的 CA 证书验证对等证书。这通常意味着证书是自签名的，或者是由不在 curl 使用的 CA 存储库中的 CA（证书颁发机构）签发的。

1.  传输编码不可识别。从服务器接收到的内容无法被 curl 解析。

1.  **未使用**

1.  文件大小超出最大限制。当 curl 被告知限制下载，如果文件太大则不进行下载时，这是该条件的退出代码。

1.  请求的 SSL（TLS）级别失败。在大多数情况下，这意味着 curl 在请求升级到 TLS 时失败了。

1.  发送数据需要回绕，但失败了。在某些情况下，curl 需要回绕以重新发送数据，如果无法完成，则操作失败。

1.  初始化 OpenSSL SSL 引擎失败。这只有在使用 OpenSSL 时才会发生，并且表示一个严重的内部问题。

1.  用户名、密码或类似信息未被接受，curl 登录失败。请验证凭证是否正确提供，并且它们是否以正确的编码方式。

1.  TFTP 服务器上找不到文件。

1.  TFTP 服务器上的权限问题。

1.  TFTP 服务器磁盘空间不足。

1.  非法 TFTP 操作。

1.  TFTP 传输 ID 未知。

1.  文件已存在（TFTP）。

1.  TFTP 上没有这样的用户。

1.  **未使用**

1.  **未使用**

1.  读取 SSL CA 证书时出现问题。默认或指定的 CA 证书包无法读取/使用以验证服务器证书。

1.  URL 中引用的资源（文件）不存在。

1.  SSH 会话期间发生未指定的错误。这有时表明 curl 使用的 SSH 库与 curl 与服务器通信时使用的 SSH 版本之间存在不兼容性问题。

1.  无法关闭 SSL 连接。

1.  **未使用**

1.  无法加载 CRL 文件，文件缺失或格式错误。

1.  TLS 证书颁发者检查失败。这种情况最常见的原因是服务器在 TLS 握手过程中没有发送适当的中间证书。

1.  FTP `PRET` 命令失败。这是一个非标准命令，并非所有服务器都支持它。

1.  RTSP：CSeq 编号不匹配。

1.  RTSP：会话标识符不匹配。

1.  无法解析 FTP 文件列表。服务器使用的 FTP 目录列表格式无法被 curl 解析。此服务器上不能使用 FTP 通配符。

1.  FTP 块回调报告错误。

1.  没有可用的连接，会话正在排队。

1.  SSL 公钥与已固定的公钥不匹配。要么你提供了错误的公钥，要么服务器已更改。

1.  SSL 证书状态无效。服务器在 TLS 握手过程中没有提供有效的证书。

1.  HTTP/2 帧层中的流错误。这通常是一个无法恢复的错误，但尝试强制 curl 使用 HTTP/1 可能绕过它。

1.  在回调内部调用了 API 函数。如果 curl 工具返回此错误，则表示内部出现了问题。

1.  认证错误。

1.  HTTP/3 层错误。这是一个相当通用的错误，可能是几个问题之一，请参阅错误消息以获取详细信息。

1.  QUIC 连接错误。这个错误可能是由 TLS 库错误引起的。QUIC 是用于 HTTP/3 的传输协议。

1.  代理握手错误。通常这意味着 SOCKS 代理没有配合。

1.  需要 TLS 客户端证书，但未提供。

1.  内部对 poll()或 select()的调用返回了无法恢复的错误。

## 错误消息

当 curl 以非零代码退出时，它也会输出一个错误消息（除非使用了`--silent`）。这个错误消息可能会向退出状态数字本身添加一些额外的信息或情况，因此相同的错误编号可以得到不同的错误消息。

用户还可以使用–write-out 自定义错误消息。伪变量`%{onerror}`允许您设置仅在错误时显示的消息，并提供`%{errormsg}`和`%{exitcode}`等变量。

例如：

```sh
curl --write-out "%{onerror}curl says: (%{exitcode}) %{errormsg}" \
  https://curl.se/
```

## “未使用”

上面的退出代码列表包含了一些标记为“未使用”的值。这些是 curl 现代版本中未使用的退出状态代码，但在过去曾被使用或打算使用。它们可能在 curl 的将来版本中使用。

此外，在此列表中使用的最高错误状态是 99，但未来的 curl 版本可能会在该数字之后添加更多的退出代码。
