# 重试

通常，curl 只会尝试一次执行传输，如果失败则返回错误。使用`--retry`选项，你可以告诉 curl 重试某些失败的传输。

当 curl 尝试执行传输时，如果返回一个短暂错误，它会在放弃之前重试这个次数。将数字设置为 0 会使 curl 不进行重试（这是默认设置）。短暂错误意味着以下情况之一：超时、FTP 4xx 响应代码或 HTTP 5xx 响应代码。

## 调整你的重试

当 curl 即将重试传输时，它首先等待一秒钟，然后对于所有后续的重试，它会将等待时间加倍，直到达到 10 分钟，然后这是其余重试之间的延迟。使用`--retry-delay`，你可以禁用这种指数退避算法并设置尝试之间的自己的延迟。使用`--retry-max-time`，你可以限制允许的重试总时间。`--max-time`选项仍然指定了这些传输中任何一个允许花费的最长时间。

让 curl 最多重试 5 次，但不超过两分钟：

```sh
curl --retry 5 --retry-max-time 120 https://example.com
```

## 连接被拒绝

默认的重试机制只对被认为是短暂错误的传输进行重试。这些错误是服务器本身提示并确认现在存在的，但可能在稍后消失。

有时候，作为用户，你对情况了解得更多，你可以帮助 curl 进行更好的重试。首先，你可以告诉 curl 将“连接被拒绝”视为一个短暂错误。也许你知道你正在通信的服务器是不稳定的，或者也许你知道当你尝试从它重新启动或类似的情况下下载时，它有时会出现问题。你可以使用`--retry-connrefused`来做到这一点。

例如：重试最多 5 次，并将`ECONNREFUSED`视为重试的理由：

```sh
curl --retry 5 --retry-connrefused https://example.com
```

## 对任何和所有错误进行重试

最激进的重试形式是针对那些你知道 URL 应该可以正常工作，并且你不能容忍任何失败的情况。使用`--retry-all-errors`会让 curl 将所有传输失败视为重试的理由。

例如：对所有错误重试最多 12 次：

```sh
curl --retry 12 --retry-all-errors https://example.com
```
