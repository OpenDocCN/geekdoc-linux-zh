# 响应

当一个 HTTP 客户端与服务器进行 HTTP 通信时，服务器会以 HTTP 响应消息响应，或者 curl 将其视为错误并返回 52，错误信息为“从服务器收到空回复”。

## HTTP 响应的大小

HTTP 响应有一个确定的大小，curl 需要找出它。有几种不同的方式来表示 HTTP 响应的结束，但最基本的方式是使用响应中的`Content-Length:`头，并指定响应体的确切字节数。

一些早期的 HTTP 服务器实现存在文件大小超过 2GB 的问题，并错误地发送了带有负大小的`Content-Length:`头或其他错误数据。curl 可以被告知完全忽略`Content-Length:`头，使用`--ignore-content-length`。这样做可能会有一些其他负面影响，但至少应该让你得到数据。

## HTTP 响应代码

HTTP 传输在第一行响应中会收到一个三位数的响应代码。响应代码是服务器向客户端提供有关请求处理方式的提示的方式。

重要的一点是，即使响应代码表明请求的文档无法提供（或类似情况），curl 也不会将其视为错误。curl 认为成功发送和接收 HTTP 是好的。

HTTP 响应代码的第一位数字是一种错误类别：

+   1xx：短暂响应，还有更多内容

+   2xx：成功

+   3xx：重定向

+   4xx：客户端请求了服务器无法或不愿意提供的内容

+   5xx：服务器存在问题

记住，你可以使用 curl 的`--write-out`选项来提取响应代码。请参阅–write-out 部分。

要使 curl 对于响应代码>=400 返回错误，你需要使用`--fail`或`--fail-with-body`。然后 curl 会以错误代码 22 退出，表示此类情况。

## CONNECT 响应代码

由于在同一个 curl 传输中可能存在 HTTP 请求和单独的 CONNECT 请求，我们通常将 CONNECT 响应（来自代理）与远程服务器的 HTTP 响应分开。

CONNECT 也是一个 HTTP 请求，因此它会在相同的数字范围内获得响应代码，你也可以使用`--write-out`来提取该代码。

## 分块传输编码

HTTP 1.1 服务器可以选择以分块编码的响应来响应，这是 HTTP 1.0 中不存在的一个特性。

当接收到分块响应时，响应中没有 Content-Length:来指示其大小。相反，有一个`Transfer-Encoding: chunked`头信息告诉 curl 即将接收分块数据，然后在响应体中，数据以一系列数据块的形式出现。每个单独的数据块以该特定数据块的大小（十六进制表示）开始，然后是一个换行符，接着是数据块的内容。这个过程会一直重复，直到响应结束，响应结束的信号是一个零大小的数据块。这种响应编码的目的是让客户端能够确定响应何时结束，即使服务器在开始发送之前并不知道完整的响应大小。这通常发生在响应是动态生成，且在请求到达时生成的情况下。

客户端如 curl 会解码数据块，但不会向用户显示数据块的大小。

## 压缩传输

通过 HTTP 发送的响应可以是压缩格式。这通常是在服务器在响应中包含`Content-Encoding: gzip`时完成的，作为向客户端的提示。当发送静态资源（之前已压缩）或在运行时 CPU 功率大于带宽时，压缩响应非常有意义。发送更少的数据量通常更受欢迎。

您可以要求 curl 请求压缩内容，并在接收到内容编码为 gzip（或实际上 curl 理解的任何其他压缩算法）时自动和透明地解压缩数据，使用`--compressed`：

```sh
curl --compressed http://example.com/
```

## 传输编码

与传输编码一起使用的较少见的功能是压缩。

压缩本身很常见。随着时间的推移，HTTP 压缩的主要和兼容网络的方式已经变成了使用上面章节中描述的`Content-Encoding`。但 HTTP 最初旨在并指定允许透明压缩作为传输编码，curl 支持这一功能。

客户端随后简单地要求服务器执行压缩传输编码，如果服务器接受，它会以一个头信息响应表示它执行了压缩，curl 随后在到达时透明地解压缩这些数据。curl 用户请求压缩传输编码使用`--tr-encoding`：

```sh
curl --tr-encoding http://example.com/
```

应该注意的是，野外中支持这一功能的 HTTP 服务器并不多。

## 传递传输编码

在某些情况下，您可能希望将 curl 用作代理或其他中间软件。在这些情况下，curl 处理传输编码头信息并透明解码实际数据的方式可能不受期望，如果最终接收者*也*期望做同样的事情。

然后，您可以要求 curl 传递接收到的数据，而不对其进行解码。这意味着在分块编码格式或压缩格式中传递大小，当使用压缩传输编码时等。

```sh
curl --raw http://example.com/
```
