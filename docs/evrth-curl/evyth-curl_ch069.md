# URL globbing

有时你想要获取一系列大部分相同的 URL，其中只有一小部分在请求之间发生变化。这可能是一个数字范围，也可能是一组名称。curl 提供“globbing”作为指定这种类型多个 URL 的简便方法。

globbing 使用保留符号[]和{}来实现这一点，这些符号通常不能作为合法 URL 的一部分（除了数字 IPv6 地址，但 curl 仍然可以很好地处理它们）。如果 globbing 妨碍了你，可以使用`-g, --globoff`禁用它。

当从命令行提示符调用时使用[]或{}序列，你可能必须将完整的 URL 放在双引号内，以避免 shell 干扰它。这也适用于其他特殊处理的字符，例如‘&’，‘？’和‘*’。

虽然 curl 中的大多数传输相关功能都由 libcurl 库提供，但 URL globbing 功能不是。

## 数字范围

你可以使用[N-M]语法请求数字范围，其中 N 是起始索引，它向上到并包括 M。例如，你可以请求 100 个按数字命名的图片：

```sh
curl -O "http://example.com/[1-100].png"
```

它甚至可以处理没有前缀的范围，比如如果数字始终是三位数：

```sh
curl -O "http://example.com/[001-100].png"
```

或者你可能只想下载偶数编号的图片，所以你告诉 curl 一个步进计数器。这个例子中的范围从 0 到 100，步长为 2：

```sh
curl -O "http://example.com/[0-100:2].png"
```

## 字母范围

curl 还可以进行字母范围的遍历，比如当一个网站有从 a 到 z 命名的部分：

```sh
curl -O "http://example.com/section[a-z].html"
```

## 列表

有时候部分并不遵循这样的简单模式，然后你可以自己提供完整的列表，但然后在花括号内而不是用于范围的括号内：

```sh
curl -O "http://example.com/{one,two,three,alpha,beta}.html"
```

## 组合

你可以在同一个 URL 中使用多个 glob，这样 curl 也会遍历这些 URL。要下载 Ben、Alice 和 Frank 的图片，两种分辨率 100 x 100 和 1000 x 1000，命令行可能看起来像这样：

```sh
curl -O "http://example.com/{Ben,Alice,Frank}-{100x100,1000x1000}.jpg"
```

或者下载棋盘上所有图片，通过两个坐标范围 0 到 7 进行索引：

```sh
curl -O "http://example.com/chess-[0-7]x[0-7].jpg"
```

当然，你也可以混合范围和序列。获取 Web 服务器和邮件服务器一周的日志：

```sh
curl -O "http://example.com/{web,mail}-log[0-6].txt"
```

## globbing 的输出变量

在本章前面所有的 globbing 示例中，我们选择使用`-O / --remote-name`选项，这使得 curl 使用使用的 URL 的文件名部分保存目标文件。

有时候这还不够。你正在下载多个文件，也许你想要将它们保存在不同的子目录中，或者以不同的方式创建保存的文件名。curl 当然也有针对这些情况的解决方案：输出文件名变量。

在 URL 中使用的每个“glob”都会得到一个单独的变量。它们被引用为`#[num]` - 这意味着单个字符`#`后跟 glob 编号，第一个 glob 从 1 开始，最后一个 glob 结束。

保存两个不同网站的主页：

```sh
curl "http://{one,two}.example.com" -o "file_#1.txt"
```

将带有两个 glob 的命令行输出的结果保存在子目录中：

```sh
curl "http://{site,host}.host[1-5].example.com" -o "subdir/#1_#2"
```

## 在 URL 中使用`[]{}`

当在 1990 年代 curl 中引入通配符概念时，我们所有人都使用相同的互联网标准来定义 URL 语法，在这个标准中，这四个符号被记录为*保留*。如果你想在 URL 中使用它们（使用`%HH`样式进行 URL 编码），你必须对它们进行 URL 编码。因此，这些符号没有在 URL 中使用，并且对于通配符用途来说非常吸引人。

后来，URL 语法逐渐放宽并发生变化，如今我们时不时地看到 URL 被使用，其中四个符号`[]{}`之一被直接使用，而没有进行 URL 编码。将这样的 URL 传递给 curl 会导致当通配符解析器疯狂时，curl 会输出语法错误。

为了解决这个问题，你有两个独立的选项。你可以自己编码这些符号，或者关闭通配符匹配。

按照以下方式对符号进行编码：

| 符号 | 编码 |
| --- | --- |
| `[` | `%5b` |
| `]` | `%5d` |
| `{` | `%7b` |
| `}` | `%7d` |

或者使用 `-g` 或 `--globoff` 来关闭通配符匹配。
