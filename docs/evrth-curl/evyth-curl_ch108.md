# Keep alive

当不使用时，TCP 连接在两个方向上都可以完全没有流量。因此，一个完全空闲的连接无法与因网络或服务器问题而完全停滞的连接明显区分开来。

同时，如今许多网络设备，如防火墙或 NAT，都在跟踪 TCP 连接，以便它们可以转换地址、阻止“错误”的传入数据包等。这些设备通常在 N 分钟后将完全空闲的连接视为已死亡，其中 N 在不同设备之间有所不同，有时短至 10 分钟甚至更少。

避免一个真正缓慢的连接（或一个空闲的连接）被错误地视为已死亡并错误地终止的一种方法，是确保使用 TCP keepalive。TCP keepalive 是 TCP 协议中的一个功能，它在其他情况下完全空闲时会发送“ping frames”来回。它帮助空闲连接检测到断开，即使在没有任何流量通过它的情况下，也帮助中间系统不认为连接已死亡。

curl 默认使用 TCP keepalive，原因如下。但有时你可能想*禁用* keepalive，或者你可能想改变 TCP “ping” 之间的间隔（curl 默认为 60 秒）。你可以通过以下方式关闭 keepalive：

```sh
curl --no-keepalive https://example.com/
```

或者将间隔改为 5 分钟（300 秒）：

```sh
curl --keepalive-time 300 https://example.com/
```
