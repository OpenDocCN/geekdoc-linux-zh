# 期待 100-continue

HTTP/1 没有一种适当的方式来停止正在进行的传输（在任何方向上）同时保持连接。因此，如果我们确定传输应该在传输开始后停止，那么只有两种方法可以继续：切断连接并支付重新建立连接的代价，或者继续传输并浪费带宽，但下次能够重用连接。

这种情况的一个例子是，当您通过 HTTP 发送一个大型文件时，却发现服务器需要认证，并立即发送回 401 响应代码。

为了使这种情况不那么频繁，存在一种缓解措施，即 curl 传递一个额外的头`Expect: 100-continue`，这给了服务器在发送大量数据之前拒绝请求的机会。如果 curl 执行的 POST 操作已知或怀疑大于一兆字节，curl 会默认发送这个`Expect:`头。curl 也会为 PUT 请求执行此操作。

当服务器收到一个带有 100-continue 的请求并认为请求是合理的，它会用一个使客户端继续的 100 响应来响应。如果服务器不喜欢该请求，它会发送回它认为的错误响应代码。

不幸的是，世界上许多服务器都没有正确支持 Expect:头，或者没有正确处理它，因此 curl 在继续之前只等待 1000 毫秒的第一个响应。

您可以使用`--expect100-timeout <seconds>`来更改 curl 等待 Expect 响应的时间。您可以通过使用`-H Expect:`来完全避免等待，从而移除该头：

```sh
curl -H Expect: -d "payload to send" http://example.com
```

在某些情况下，如果 curl 即将发送的内容很小（小于一兆字节），它会抑制使用`Expect`头，因为浪费如此小的数据块被认为不是什么大问题。

## HTTP/2 及以后版本

HTTP/2 及 HTTP 的后续版本可以在不关闭连接的情况下停止正在进行的传输，这使得`Expect:`变得没有意义。
