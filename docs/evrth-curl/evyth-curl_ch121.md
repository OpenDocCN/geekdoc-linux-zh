# 代理环境变量

curl 在运行之前检查是否存在特别命名的环境变量，以查看是否请求使用代理。

您可以通过设置一个名为`[scheme]_proxy`的变量来指定代理主机名（与您使用`-x`指定主机的方式相同）。如果您想告诉 curl 在访问 HTTP 服务器时使用代理，请设置`http_proxy`环境变量。如下所示：

```sh
http_proxy=http://proxy.example.com:80
curl -v www.example.com
```

虽然上述示例显示了 HTTP，当然也可以设置`ftp_proxy`、`https_proxy`等。除了`http_proxy`之外，所有这些代理环境变量名称也可以指定为大写，如`HTTPS_PROXY`。

要设置一个控制**所有**协议的单个变量，存在`ALL_PROXY`。如果存在特定的协议变量，则该变量具有优先级。

## 无代理

有时您会遇到一种情况，其中一个或几个主机名应该被排除在通常使用的代理之外。这可以通过`NO_PROXY`变量来完成。将其设置为不应使用代理的主机名的逗号分隔列表。可以将`NO_PROXY`设置为单个星号（`*`）以匹配所有主机。

如果排除列表中的名称以点（`.`）开头，则该名称匹配整个域名。例如，`.example.com`匹配`www.example.com`和`home.example.com`，但不匹配`nonexample.com`。

作为`NO_PROXY`变量的替代，还有一个`--noproxy`命令行选项，它具有相同的目的并以相同的方式工作。

自 curl 7.86.0 版本起，用户可以使用 CIDR 表示法排除一个 IP 网络：在 IP 地址后附加一个斜杠和位数来指定网络的位数。例如，通过提供模式`192.168.0.0/16`来匹配以`192.168`开头的整个 16 位网络。

## `http_proxy` 仅小写

代理环境变量的 HTTP 版本与其他版本的处理方式不同。由于 CGI 协议，它允许用户在 HTTP 服务器调用时在服务器上运行脚本，因此它只接受其小写版本。当服务器通过 HTTP 服务器调用 CGI 脚本时，它会自动根据请求中的传入头信息为脚本创建环境变量。这些环境变量以前缀大写`HTTP_`开头。

因此，使用类似`Proxy: yada`的请求头向 HTTP 服务器发送的请求会在启动 CGI 脚本之前创建一个名为`HTTP_PROXY`的环境变量，并将其设置为包含`yada`。如果这样的 CGI 脚本运行 curl，那么 curl 不将其视为要使用的代理是很重要的。

接受此环境变量的大写版本在许多软件中已成为许多安全问题的来源。
