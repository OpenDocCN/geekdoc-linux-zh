# 调试构建

当我们提到 *调试构建* 时，通常指的是带有调试代码和符号的 curl 构建。我们强烈建议您这样做，如果您想与 curl 开发工作，因为它使得测试和调试变得更加容易。

您可以使用如下方式使用 configure 来进行调试构建：

```sh
./configure --enable-debug
```

使用 runtests.pl，调试构建可以运行单个测试用例，并与 gdb 一起使用，这很方便——例如，如果您能让它崩溃在某处，那么 gdb 可以捕获它并显示它发生的确切位置等。

与常规 *发布构建* 相比，调试构建有一些不同的构建方式，其中包含一些使 curl 更容易测试的代码片段。例如，它允许测试套件覆盖随机数生成器，以便测试那些在其他情况下是随机的值实际上可以工作。此外，单元测试仅在调试构建上运行。

## Memdebug

调试构建还启用了 *memdebug* 内部内存跟踪和调试系统。

当启用时，memdebug 系统会将大量与内存相关的选项的详细信息输出到日志文件中，以便事后进行分析和验证。验证所有内存都已释放，所有文件都已关闭等。

这是一个简化的 valgrind 版本，但它的功能远不如 valgrind。然而，它相当便携且影响较小。

在调试构建中，如果将 `CURL_MEMDEBUG` 环境变量设置为文件名，curl 会启用 memdebug 系统进行内存调试。测试套件会为我们设置此变量（参见 `tests/log/memdump`），并在每次测试运行后验证它（如果存在）。
