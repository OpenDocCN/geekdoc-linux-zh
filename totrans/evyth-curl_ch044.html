<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xmlns:epub="http://www.idpf.org/2007/ops" xml:lang="en-US">
<head>
  <meta charset="utf-8" />
  <meta name="generator" content="pandoc" />
  <title>ch044.xhtml</title>
  <link rel="stylesheet" type="text/css" href="../styles/stylesheet1.css" />
</head>
<body epub:type="bodymatter">
<section id="build__autotools__md-_-_-autotools" class="level1" data-number="43">
<h1 data-number="43">Autotools</h1>
<p>The Autotools are a collection of different tools that are used together to generate the <code>configure</code> script. The configure script is run by the user who wants to build curl and it does a whole bunch of things:</p>
<ul>
<li><p>It checks for features and functions present in your system.</p></li>
<li><p>It offers command-line options so that you as a builder can decide what to enable and disable in the build. Features and protocols, etc., can be toggled on/off, even compiler warning levels and more.</p></li>
<li><p>It offers command-line options to let the builder point to specific installation paths for various third-party dependencies that curl can be built to use.</p></li>
<li><p>It specifies on which file path the generated installation should be placed when ultimately the build is made and <code>make install</code> is invoked.</p></li>
</ul>
<p>In the most basic usage, just running <code>./configure</code> in the source directory is enough. When the script completes, it outputs a summary of what options it has detected/enabled and what features that are still disabled, some of which possibly because it failed to detect the presence of necessary third-party dependencies that are needed for those functions to work. If the summary is not what you expected it to be, invoke configure again with new options or with the previously used options adjusted.</p>
<p>After configure has completed, you invoke <code>make</code> to build the entire thing and then finally <code>make install</code> to install curl, libcurl and associated things. <code>make install</code> requires that you have the correct rights in your system to create and write files in the installation directory or you get an error displayed.</p>
<section id="build__autotools__md-_-_-cross-compiling" class="level2" data-number="43.1">
<h2 data-number="43.1">Cross-compiling</h2>
<p>Cross-compiling means that you build the source on one architecture but the output is created to be run on a different one. For example, you could build the source on a Linux machine but have the output work on a Windows machine.</p>
<p>For cross-compiling to work, you need a dedicated compiler and build system setup for the particular target system for which you want to build. How to get and install that system is not covered in this book.</p>
<p>Once you have a cross compiler, you can instruct configure to use that compiler instead of the native compiler when it builds curl so that the end result then can be moved over and used on the other machine.</p>
</section>
<section id="build__autotools__md-_-_-static-linking" class="level2" data-number="43.2">
<h2 data-number="43.2">Static linking</h2>
<p>By default, configure setups the build files so that the following ‘make’ command creates both shared and static versions of libcurl. You can change that with the <code>--disable-static</code> or <code>--disable-shared</code> options to configure.</p>
<p>If you instead want to build with static versions of third party libraries instead of shared libraries, you need to prepare yourself for an uphill battle. curl’s configure script is focused on setting up and building with shared libraries.</p>
<p>One of the differences between linking with a static library compared to linking with a shared one is in how shared libraries handle their own dependencies while static ones do not. In order to link with library <code>xyz</code> as a shared library, it is basically a matter of adding <code>-lxyz</code> to the linker command line no matter which other libraries <code>xyz</code> itself was built to use. But, if that <code>xyz</code> is instead a static library we also need to specify each dependency of <code>xyz</code> on the linker command line. curl’s configure cannot keep up with or know all possible dependencies for all the libraries it can be made to build with, so users wanting to build with static libs mostly need to provide that list of libraries to link with.</p>
</section>
<section id="build__autotools__md-_-_-select-tls-backend" class="level2" data-number="43.3">
<h2 data-number="43.3">Select TLS backend</h2>
<p>The configure-based build offers the user to select from a wide variety of different TLS libraries when building. You select them by using the correct command line options. Before curl 7.77.0, the configure script would automatically check for OpenSSL, but modern versions do not.</p>
<ul>
<li>AmiSSL: <code>--with-amissl</code></li>
<li>AWS-LC: <code>--with-openssl</code></li>
<li>BearSSL: <code>--with-bearssl</code></li>
<li>BoringSSL: <code>--with-openssl</code></li>
<li>GnuTLS: <code>--with-gnutls</code></li>
<li>LibreSSL: <code>--with-openssl</code></li>
<li>mbedTLS: <code>--with-mbedtls</code></li>
<li>OpenSSL: <code>--with-openssl</code></li>
<li>Rustls: <code>--with-rustls</code> (point to the rustls-ffi install path)</li>
<li>Schannel: <code>--with-schannel</code></li>
<li>Secure Transport: <code>--with-secure-transport</code></li>
<li>wolfSSL: <code>--with-wolfssl</code></li>
</ul>
<p>If you do not specify which TLS library to use, the configure script fails. If you want to build <em>without</em> TLS support, you must explicitly ask for that with <code>--without-ssl</code>.</p>
<p>These <code>--with-*</code> options also allow you to provide the install prefix so that configure searches for the specific library where you tell it to. Like this:</p>
<pre><code>./configure --with-gnutls=/home/user/custom-gnutls</code></pre>
<p>You can opt to build with support for <strong>multiple</strong> TLS libraries by specifying multiple <code>--with-*</code> options on the configure command line. Pick which one to make the default TLS backend with <code>--with-default-ssl-backend=[NAME]</code>. For example, build with support for both GnuTLS and OpenSSL and default to OpenSSL:</p>
<pre><code>./configure --with-openssl --with-gnutls \
  --with-default-ssl-backend=openssl</code></pre>
</section>
<section id="build__autotools__md-_-_-select-ssh-backend" class="level2" data-number="43.4">
<h2 data-number="43.4">Select SSH backend</h2>
<p>The configure-based build offers the user to select from a variety of different SSH libraries when building. You select them by using the correct command-line options.</p>
<ul>
<li>libssh2: <code>--with-libssh2</code></li>
<li>libssh: <code>--with-libssh</code></li>
<li>wolfSSH: <code>--with-wolfssh</code></li>
</ul>
<p>These <code>--with-*</code> options also allow you to provide the install prefix so that configure searches for the specific library where you tell it to. Like this:</p>
<pre><code>./configure --with-libssh2=/home/user/custom-libssh2</code></pre>
</section>
<section id="build__autotools__md-_-_-select-http-slash-3-backend" class="level2" data-number="43.5">
<h2 data-number="43.5">Select HTTP/3 backend</h2>
<p>The configure-based build offers the user to select different HTTP/3 libraries when building. You select them by using the correct command-line options.</p>
<ul>
<li>quiche: <code>--with-quiche</code></li>
<li>ngtcp2: <code>--with-ngtcp2 --with-nghttp3</code></li>
<li>msh3: <code>--with-msh3</code></li>
</ul>
<p><span id="build__cmake__md"></span></p>
</section>
</section>
</body>
</html>
