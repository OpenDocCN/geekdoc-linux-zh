- en: Chapter 34\. Gotchas
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: 原文：[https://tldp.org/LDP/abs/html/gotchas.html](https://tldp.org/LDP/abs/html/gotchas.html)
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: '|   |  **Turandot: *Gli enigmi sono tre, la morte una!**'
  prefs: []
  type: TYPE_NORMAL
- en: '*Caleph: *No, no! Gli enigmi sono tre, una la vita!**'
  prefs: []
  type: TYPE_NORMAL
- en: '*--Puccini**  |'
  prefs: []
  type: TYPE_NORMAL
- en: Here are some (non-recommended!) scripting practices that will bring excitement
    into an otherwise dull life.
  prefs: []
  type: TYPE_NORMAL
- en: Assigning reserved words or characters to variable names.
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '|  [PRE0]  |'
  prefs:
  - PREF_IND
  type: TYPE_TB
- en: Using a hyphen or other reserved characters in a variable name (or function
    name).
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '|  [PRE1]  |'
  prefs:
  - PREF_IND
  type: TYPE_TB
- en: Using the same name for a variable and a function. This can make a script difficult
    to understand.
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '|  [PRE2]  |'
  prefs:
  - PREF_IND
  type: TYPE_TB
- en: Using [whitespace](special-chars.html#WHITESPACEREF) inappropriately. In contrast
    to other programming languages, Bash can be quite finicky about whitespace.
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '|  [PRE3]  |'
  prefs:
  - PREF_IND
  type: TYPE_TB
- en: Not terminating with a [semicolon](special-chars.html#SEMICOLONREF) the final
    command in a [code block within curly brackets](special-chars.html#CODEBLOCKREF).
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '|  [PRE4]  |'
  prefs:
  - PREF_IND
  type: TYPE_TB
- en: Assuming uninitialized variables (variables before a value is assigned to them)
    are "zeroed out". An uninitialized variable has a value of *null*, *not* zero.
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '|  [PRE5]  |'
  prefs:
  - PREF_IND
  type: TYPE_TB
- en: Mixing up *=* and *-eq* in a test. Remember, *=* is for comparing literal variables
    and *-eq* for integers.
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '|  [PRE6]  |'
  prefs:
  - PREF_IND
  type: TYPE_TB
- en: Misusing [string comparison](comparison-ops.html#SCOMPARISON1) operators.
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '**Example 34-1\. Numerical and string comparison are not equivalent**'
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
- en: '|  [PRE7]  |'
  prefs:
  - PREF_IND
  type: TYPE_TB
- en: Attempting to use [let](internal.html#LETREF) to set string variables.
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '|  [PRE8]  |'
  prefs:
  - PREF_IND
  type: TYPE_TB
- en: Sometimes variables within "test" brackets ([ ]) need to be quoted (double quotes).
    Failure to do so may cause unexpected behavior. See [Example 7-6](comparison-ops.html#STRTEST),
    [Example 20-5](redircb.html#REDIR2), and [Example 9-6](internalvariables.html#ARGLIST).
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Quoting a variable containing whitespace [prevents splitting](quotingvar.html#WSQUO).
    Sometimes this produces [unintended consequences](quotingvar.html#VARSPLITTING).
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Commands issued from a script may fail to execute because the script owner lacks
    execute permission for them. If a user cannot invoke a command from the command-line,
    then putting it into a script will likewise fail. Try changing the attributes
    of the command in question, perhaps even setting the suid bit (as *root*, of course).
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Attempting to use **-** as a redirection operator (which it is not) will usually
    result in an unpleasant surprise.
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '|  [PRE9]  |'
  prefs:
  - PREF_IND
  type: TYPE_TB
- en: Using Bash [version 2+](bashver2.html#BASH2REF) functionality may cause a bailout
    with error messages. Older Linux machines may have version 1.XX of Bash as the
    default installation.
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '|  [PRE10]  |'
  prefs:
  - PREF_IND
  type: TYPE_TB
- en: Using Bash-specific functionality in a [Bourne shell](why-shell.html#BASHDEF)
    script (`**#!/bin/sh**`) on a non-Linux machine [may cause unexpected behavior](gotchas.html#BINSH).
    A Linux system usually aliases **sh** to **bash**, but this does not necessarily
    hold true for a generic UNIX machine.
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Using undocumented features in Bash turns out to be a dangerous practice. In
    previous releases of this book there were several scripts that depended on the
    "feature" that, although the maximum value of an [exit](exit-status.html#EXITSTATUSREF)
    or [return](complexfunct.html#RETURNREF) value was 255, that limit did not apply
    to *negative* integers. Unfortunately, in version 2.05b and later, that loophole
    disappeared. See [Example 24-9](complexfunct.html#RETURNTEST).
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: In certain contexts, a misleading [exit status](exit-status.html#EXITSTATUSREF)
    may be returned. This may occur when [setting a local variable within a function](localvar.html#EXITVALANOMALY01)
    or when [assigning an arithmetic value to a variable](internal.html#EXITVALANOMALY02).
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: The [exit status of an arithmetic expression](testconstructs.html#ARXS) is *not*
    equivalent to an *error code*.
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '|  [PRE11]  |'
  prefs:
  - PREF_IND
  type: TYPE_TB
- en: A script with DOS-type newlines (`*\r\n*`) will fail to execute, since `**#!/bin/bash\r\n**`
    is *not* recognized, *not* the same as the expected `**#!/bin/bash\n**`. The fix
    is to convert the script to UNIX-style newlines.
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '|  [PRE12]  |'
  prefs:
  - PREF_IND
  type: TYPE_TB
- en: A shell script headed by `**#!/bin/sh**` will not run in full Bash-compatibility
    mode. Some Bash-specific functions might be disabled. Scripts that need complete
    access to all the Bash-specific extensions should start with `**#!/bin/bash**`.
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '[Putting whitespace in front of the terminating limit string](here-docs.html#INDENTEDLS)
    of a [here document](here-docs.html#HEREDOCREF) will cause unexpected behavior
    in a script.'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Putting more than one *echo* statement in a function [whose output is captured](assortedtips.html#RVT).
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '|  [PRE13]  |'
  prefs:
  - PREF_IND
  type: TYPE_TB
- en: This [will not work](assortedtips.html#RVTCAUTION).
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
- en: A script may not **export** variables back to its [parent process](internal.html#FORKREF),
    the shell, or to the environment. Just as we learned in biology, a child process
    can inherit from a parent, but not vice versa.
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '|  [PRE14]  |'
  prefs:
  - PREF_IND
  type: TYPE_TB
- en: '|  [PRE15]  |'
  prefs:
  - PREF_IND
  type: TYPE_TB
- en: Sure enough, back at the command prompt, $WHATEVER remains unset.
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
- en: Setting and manipulating variables in a [subshell](subshells.html#SUBSHELLSREF),
    then attempting to use those same variables outside the scope of the subshell
    will result an unpleasant surprise.
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '**Example 34-2\. Subshell Pitfalls**'
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
- en: '|  [PRE16]  |'
  prefs:
  - PREF_IND
  type: TYPE_TB
- en: '[Piping](special-chars.html#PIPEREF) **echo** output to a [read](internal.html#READREF)
    may produce unexpected results. In this scenario, the **read** acts as if it were
    running in a subshell. Instead, use the [set](internal.html#SETREF) command (as
    in [Example 15-18](internal.html#SETPOS)).'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '**Example 34-3\. Piping the output of *echo* to a *read***'
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
- en: '|  [PRE17]  |'
  prefs:
  - PREF_IND
  type: TYPE_TB
- en: In fact, as Anthony Richardson points out, piping to *any* loop can cause a
    similar problem.
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
- en: '|  [PRE18]  |'
  prefs:
  - PREF_IND
  type: TYPE_TB
- en: A lookalike problem occurs when trying to write the `stdout` of a **tail -f**
    piped to [grep](textproc.html#GREPREF).
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
- en: '|  [PRE19]  |'
  prefs:
  - PREF_IND
  type: TYPE_TB
- en: Using "suid" commands within scripts is risky, as it may compromise system security.
    [[1]](#FTN.AEN19993)
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Using shell scripts for CGI programming may be problematic. Shell script variables
    are not "typesafe," and this can cause undesirable behavior as far as CGI is concerned.
    Moreover, it is difficult to "cracker-proof" shell scripts.
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Bash does not handle the [double slash (//) string](internal.html#DOUBLESLASHREF)
    correctly.
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Bash scripts written for Linux or BSD systems may need fixups to run on a commercial
    UNIX machine. Such scripts often employ the GNU set of commands and filters, which
    have greater functionality than their generic UNIX counterparts. This is particularly
    true of such text processing utilites as [tr](textproc.html#TRREF).
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Sadly, updates to Bash itself have broken older scripts that [used to work perfectly
    fine](string-manipulation.html#PARAGRAPHSPACE). Let us recall [how risky it is
    to use undocumented Bash features](gotchas.html#UNDOCF).
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '|   |  **Danger is near thee --*'
  prefs: []
  type: TYPE_NORMAL
- en: '*Beware, beware, beware, beware.*'
  prefs: []
  type: TYPE_NORMAL
- en: '*Many brave hearts are asleep in the deep.*'
  prefs: []
  type: TYPE_NORMAL
- en: '*So beware --*'
  prefs: []
  type: TYPE_NORMAL
- en: '*Beware.*'
  prefs: []
  type: TYPE_NORMAL
- en: '*--A.J. Lamb and H.W. Petrie**  |'
  prefs: []
  type: TYPE_NORMAL
- en: Notes
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: '| [[1]](gotchas.html#AEN19993) | Setting the [suid](fto.html#SUIDREF) permission
    on the script itself has no effect in Linux and most other UNIX flavors. |'
  prefs: []
  type: TYPE_TB
