<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xmlns:epub="http://www.idpf.org/2007/ops" xml:lang="en-US">
<head>
  <meta charset="utf-8" />
  <meta name="generator" content="pandoc" />
  <title>ch128.xhtml</title>
  <link rel="stylesheet" type="text/css" href="../styles/stylesheet1.css" />
</head>
<body epub:type="bodymatter">
<section id="usingcurl__tls__verify__md-_-_-verifying-server-certificates" class="level1" data-number="127">
<h1 data-number="127">Verifying server certificates</h1>
<p>Having a secure connection to a server is not worth a lot if you cannot also be certain that you are communicating with the <strong>correct</strong> host. If we do not know that, we could just as well be talking with an impostor that just <em>appears</em> to be who we think it is.</p>
<p>To check that it communicates with the right TLS server, curl uses a CA store - a set of certificates to verify the signature of the server’s certificate. All servers provide a certificate to the client as part of the TLS handshake and all public TLS-using servers have acquired that certificate from an established Certificate Authority.</p>
<p>After some applied crypto magic, curl knows that the server is in fact the correct one that acquired that certificate for the hostname that curl used to connect to it. Failing to verify the server’s certificate is a TLS handshake failure and curl exits with an error.</p>
<p>In rare circumstances, you may decide that you still want to communicate with a TLS server even if the certificate verification fails. You then accept the fact that your communication may be subject to Man-In-The-Middle attacks. You lower your guards with the <code>-k</code> or <code>--insecure</code> option.</p>
<section id="usingcurl__tls__verify__md-_-_-native-ca-stores" class="level2" data-number="127.1">
<h2 data-number="127.1">Native CA stores</h2>
<p>Operating systems like Windows and macOS tend to have their own CA stores.</p>
<p>If you run curl with Schannel on Windows, curl uses Windows’ own CA store by default.</p>
<p>If you run curl with Secure Transport on macOS, curl uses macOS’ own CA store by default.</p>
<p>If you use curl with any other TLS backend than Schannel or Secure Transport, it uses a CA store provided in a separate file or directory, independently of the native CA store. However, for some of them you can still ask curl to instead prefer the native CA store using the <code>--ca-native</code> command line option. This option is supported with OpenSSL (and forks), wolfSSL and GnuTLS.</p>
<p>For HTTPS proxies, the corresponding option is called <code>--proxy-ca-native</code>.</p>
</section>
<section id="usingcurl__tls__verify__md-_-_-ca-store-in-files" class="level2" data-number="127.2">
<h2 data-number="127.2">CA store in file(s)</h2>
<p>If curl is not built to use a TLS library that is native to your platform (like Schannel or Secure Transport), it has to either have been built to know where the local CA store is, or users need to provide a path to the CA store when curl is invoked.</p>
<p>You can point out a specific CA bundle to use in the TLS handshake with the <code>--cacert</code> command line option. That bundle needs to be in PEM format. You can also set the environment variable <code>CURL_CA_BUNDLE</code> to the full path.</p>
</section>
<section id="usingcurl__tls__verify__md-_-_-ca-store-on-windows" class="level2" data-number="127.3">
<h2 data-number="127.3">CA store on windows</h2>
<p>curl built on windows that is not using the native TLS library (Schannel), have an extra sequence for how the CA store can be found and used.</p>
<p>curl searches for a CA cert file named <code>curl-ca-bundle.crt</code> in these directories and in this order:</p>
<ol type="1">
<li>application’s directory</li>
<li>current working directory</li>
<li>Windows System directory (e.g. <code>C:\windows\system32</code>)</li>
<li>Windows Directory (e.g. <code>C:\windows</code>)</li>
<li>all directories along <code>%PATH%</code></li>
</ol>
<p><span id="usingcurl__tls__pinning__md"></span></p>
</section>
</section>
</body>
</html>
