<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xmlns:epub="http://www.idpf.org/2007/ops" xml:lang="en-US">
<head>
  <meta charset="utf-8" />
  <meta name="generator" content="pandoc" />
  <title>ch137.xhtml</title>
  <link rel="stylesheet" type="text/css" href="../styles/stylesheet1.css" />
</head>
<body epub:type="bodymatter">
<section id="usingcurl__smtp__md-_-_-sending-email" class="level1" data-number="136">
<h1 data-number="136">Sending email</h1>
<p>Sending email with curl is done with the SMTP protocol. SMTP stands for <a href="https://en.wikipedia.org/wiki/Simple_Mail_Transfer_Protocol">Simple Mail Transfer Protocol</a>.</p>
<p>curl supports sending data to an SMTP server, which combined with the right set of command line options makes an email get sent to a set of receivers of your choice.</p>
<p>When sending SMTP with curl, there are two necessary command line options that <strong>must</strong> be used.</p>
<ul>
<li><p>You need to tell the server at least one recipient with <code>--mail-rcpt</code>. You can use this option several times and then curl tells the server that all those email addresses should receive the email.</p></li>
<li><p>You need to tell the server which email address that is the sender of the email with <code>--mail-from</code>. It is important to realize that this email address is not necessarily the same as is shown in the <code>From:</code> line of the email text.</p></li>
</ul>
<p>Then, you need to provide the actual email data. This is a (text) file formatted according to <a href="https://tools.ietf.org/html/rfc5322.html">RFC 5322</a>. It is a set of headers and a body. Both the headers and the body need to be correctly encoded. The headers typically include <code>To:</code>, <code>From:</code>, <code>Subject:</code>, <code>Date:</code> etc.</p>
<p>A basic command to send an email:</p>
<pre><code>curl smtp://mail.example.com --mail-from myself@example.com --mail-rcpt \
receiver@example.com --upload-file email.txt</code></pre>
<p>An example <code>email.txt</code> could look like this:</p>
<pre><code>From: John Smith &lt;john@example.com&gt;
To: Joe Smith &lt;smith@example.com&gt;
Subject: an example.com example email
Date: Mon, 7 Nov 2016 08:45:16

Dear Joe,
Welcome to this example email. What a lovely day.</code></pre>
<section id="usingcurl__smtp__md-_-_-secure-mail-transfer" class="level2" data-number="136.1">
<h2 data-number="136.1">Secure mail transfer</h2>
<p>Some mail providers allow or require using SSL for SMTP. They may use a dedicated port for SSL or allow SSL upgrading over a clear-text connection.</p>
<p>If your mail provider has a dedicated SSL port you can use smtps:// instead of smtp://, which uses the SMTP SSL port of 465 by default and requires the entire connection to be SSL. For example smtps://smtp.gmail.com/.</p>
<p>However, if your provider allows upgrading from clear-text to secure transfers you can use one of these options:</p>
<pre><code>--ssl           Try SSL/TLS (FTP, IMAP, POP3, SMTP)
--ssl-reqd      Require SSL/TLS (FTP, IMAP, POP3, SMTP)</code></pre>
<p>You can tell curl to <em>try</em> but not require upgrading to secure transfers by adding <code>--ssl</code> to the command:</p>
<pre><code>curl --ssl smtp://mail.example.com --mail-from myself@example.com \
     --mail-rcpt receiver@example.com --upload-file email.txt \
     --user &#39;user@your-account.com:your-account-password&#39;</code></pre>
<p>You can tell curl to <em>require</em> upgrading to using secure transfers by adding <code>--ssl-reqd</code> to the command:</p>
<pre><code>curl --ssl-reqd smtp://mail.example.com --mail-from myself@example.com \
     --mail-rcpt receiver@example.com --upload-file email.txt \
     --user &#39;user@your-account.com:your-account-password&#39;</code></pre>
</section>
<section id="usingcurl__smtp__md-_-_-the-smtp-url" class="level2" data-number="136.2">
<h2 data-number="136.2">The SMTP URL</h2>
<p>The path part of a SMTP request specifies the hostname to present during communication with the mail server. If the path is omitted then curl attempts to figure out the local computer’s hostname and use that. However, this may not return the fully qualified domain name that is required by some mail servers and specifying this path allows you to set an alternative name, such as your machine’s fully qualified domain name, which you might have obtained from an external function such as gethostname or getaddrinfo.</p>
<p>To connect to the mail server at <code>mail.example.com</code> and send your local computer’s hostname in the <code>HELO</code> or <code>EHLO</code> command:</p>
<pre><code>curl smtp://mail.example.com</code></pre>
<p>You can of course as always use the <code>-v</code> option to get to see the client-server communication.</p>
<p>To instead have curl send <code>client.example.com</code> in the <code>HELO</code> / <code>EHLO</code> command to the mail server at <code>mail.example.com</code>, use:</p>
<pre><code>curl smtp://mail.example.com/client.example.com</code></pre>
</section>
<section id="usingcurl__smtp__md-_-_-no-mx-lookup" class="level2" data-number="136.3">
<h2 data-number="136.3">No MX lookup!</h2>
<p>When you send email with an ordinary mail client, it first checks for an MX record for the particular domain you want to send email to. If you send an email to <code>joe@example.com</code>, the client gets the MX records for <code>example.com</code> to learn which mail server(s) to use when sending email to example.com users.</p>
<p>curl does no MX lookups by itself. If you want to figure out which server to send an email to for a particular domain, we recommend you figure that out first and then call curl to use those servers. Useful command line tools to get MX records include ‘dig’ and ‘nslookup’.</p>
<p><span id="usingcurl__dict__md"></span></p>
</section>
</section>
</body>
</html>
