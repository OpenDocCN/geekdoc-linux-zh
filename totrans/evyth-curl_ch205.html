<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xmlns:epub="http://www.idpf.org/2007/ops" xml:lang="en-US">
<head>
  <meta charset="utf-8" />
  <meta name="generator" content="pandoc" />
  <title>ch205.xhtml</title>
  <link rel="stylesheet" type="text/css" href="../styles/stylesheet1.css" />
</head>
<body epub:type="bodymatter">
<section id="transfers__options__strings__md-_-_-set-string-options" class="level1" data-number="204">
<h1 data-number="204">Set string options</h1>
<p>There are currently over 80 options for <code>curl_easy_setopt()</code> that accept a string as its third argument.</p>
<p>When a string is set in a handle, libcurl immediately copies that data so that the application does not have to keep the data around for the time the transfer is being done - <strong>with one notable exception</strong>: <code>CURLOPT_POSTFIELDS</code>.</p>
<p>Set a URL in the handle:</p>
<pre><code>curl_easy_setopt(handle, CURLOPT_URL, &quot;https://example.com&quot;);</code></pre>
<section id="transfers__options__strings__md-_-_-curlopt_postfields" class="level2" data-number="204.1">
<h2 data-number="204.1"><code>CURLOPT_POSTFIELDS</code></h2>
<p>The exception to the rule that libcurl always copies data, <code>CURLOPT_POSTFIELDS</code> only stores the pointer to the data, meaning an application using this option <strong>must</strong> keep the memory around for the entire duration of the associated transfer.</p>
<p>If that is problematic, an alternative is to instead use <code>CURLOPT_COPYPOSTFIELDS</code> which copies the data. If the data is binary and does not stop at the first presence of a null byte, make sure that <code>CURLOPT_POSTFIELDSIZE</code> is set <em>before</em> this option is used.</p>
<section id="transfers__options__strings__md-_-_-why" class="level3" data-number="204.1.1">
<h3 data-number="204.1.1">Why?</h3>
<p>The reason <code>CURLOPT_POSTFIELDS</code> is an exception is due to legacy. Originally (before curl 7.17.0), libcurl did not copy <em>any</em> string arguments and when this current behavior was introduced, this option could not be converted over without breaking behavior so it had to keep working like before. Which now sticks out, as no other option doesâ€¦</p>
</section>
</section>
<section id="transfers__options__strings__md-_-_-c" class="level2" data-number="204.2">
<h2 data-number="204.2">C++</h2>
<p>If you use libcurl from a C++ program, it is important to remember that you cannot pass in a string object where libcurl expects a string. It has to be a null terminated C string. Usually you can make this happen with the <code>c_str()</code> method.</p>
<p>For example, keep the URL in a string object and set that in the handle:</p>
<pre><code>std::string url(&quot;https://example.com/&quot;);
curl_easy_setopt(curl, CURLOPT_URL, url.c_str());</code></pre>
<p><span id="transfers__options__tls__md"></span></p>
</section>
</section>
</body>
</html>
