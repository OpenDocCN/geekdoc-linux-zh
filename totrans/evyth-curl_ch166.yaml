- en: Multipart formposts
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: A multipart formpost is what an HTTP client sends when an HTML form is submitted
    with *enctype* set to `multipart/form-data`. It is an HTTP POST request sent with
    the request body specially formatted as a series of parts, separated with MIME
    boundaries.
  prefs: []
  type: TYPE_NORMAL
- en: 'An example piece of HTML would look like this:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE0]'
  prefs: []
  type: TYPE_PRE
- en: 'Which could look something like this in a web browser:'
  prefs: []
  type: TYPE_NORMAL
- en: '![](../media/file12.png)'
  prefs: []
  type: TYPE_IMG
- en: a multipart form
  prefs: []
  type: TYPE_NORMAL
- en: A user can fill in text in the ‘Name’ field and by pressing the `Browse` button
    a local file can be selected that is uploaded when `Submit` is pressed.
  prefs: []
  type: TYPE_NORMAL
- en: Sending such a form with curl
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: With curl, you add each separate multipart with one `-F` (or `--form`) flag
    and you then continue and add one -F for every input field in the form that you
    want to send.
  prefs: []
  type: TYPE_NORMAL
- en: The above small example form has two parts, one named ‘person’ that is a plain
    text field and one named ‘secret’ that is a file.
  prefs: []
  type: TYPE_NORMAL
- en: 'Send your data to that form like this:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE1]'
  prefs: []
  type: TYPE_PRE
- en: The HTTP this generates
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: The **action** specifies where the POST is sent. **method** says it is a POST
    and **enctype** tells us it is a multipart formpost.
  prefs: []
  type: TYPE_NORMAL
- en: 'With the fields filled in as shown above, curl generates and sends these HTTP
    request headers to the host example.com:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE2]'
  prefs: []
  type: TYPE_PRE
- en: '**Content-Length**, of course, tells the server how much data to expect. This
    example’s 313 bytes is really small.'
  prefs: []
  type: TYPE_NORMAL
- en: The **Expect** header is explained in the [Expect 100 continue](ch160.xhtml#http__post__expect100__md)
    chapter.
  prefs: []
  type: TYPE_NORMAL
- en: The **Content-Type** header is a bit special. It tells that this is a multipart
    formpost and then it sets the boundary string. The boundary string is a line of
    characters with a bunch of random digits somewhere in it, that serves as a separator
    between the different parts of the form that is submitted. The particular boundary
    you see in this example has the random part `d74496d66958873e` but you, of course,
    get something different when you run curl (or when you submit such a form with
    a browser).
  prefs: []
  type: TYPE_NORMAL
- en: So after that initial set of headers follows the request body
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE3]'
  prefs: []
  type: TYPE_PRE
- en: Here you clearly see the two parts sent, separated with the boundary strings.
    Each part starts with one or more headers describing the individual part with
    its name and possibly some more details. Then after the part’s headers come the
    actual data of the part, without any sort of encoding.
  prefs: []
  type: TYPE_NORMAL
- en: The last boundary string has two extra dashes `--` appended to signal the end.
  prefs: []
  type: TYPE_NORMAL
- en: Content-Type
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: POSTing with curl’s `-F` option makes it include a default `Content-Type` header
    in its request, as shown in the above example. This says `multipart/form-data`
    and then specifies the MIME boundary string. That `Content-Type` is the default
    for multipart formposts but you can, of course, still modify that for your own
    commands and if you do, curl is clever enough to still append the boundary magic
    to the replaced header. You cannot really alter the boundary string, since curl
    needs that for producing the POST stream.
  prefs: []
  type: TYPE_NORMAL
- en: 'To replace the header, use `-H` like this:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE4]'
  prefs: []
  type: TYPE_PRE
- en: Converting a web form
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: There are a few different ways to figure out how to write a curl command line
    to submit a multipart form as seen in HTML.
  prefs: []
  type: TYPE_NORMAL
- en: Save the HTML locally, run `nc` locally to listen on a chosen port number, change
    the `action` URL to submit the POST to your local `nc` instance. Submit the form
    and watch how `nc` shows it. Then translate into a curl command line.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Use the development tools in your favorite browser and inspect the POST request
    in the network tab after you have submitted it. Then convert that HTTP data to
    a curl command line. Unfortunately, the [copy as curl](ch077.xhtml#cmdline__copyas__md)
    feature in the browsers usually do not actually do multipart formposts particularly
    well.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Inspect the source HTML and convert into a curl command line directly from that.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: From `<form>` to -F
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: In a `<form>` that uses `enctype="multipart/form-data"`, the first step is to
    find the `action=` property as that tells the target for the POST. You need to
    convert that into a full URL for your curl command line.
  prefs: []
  type: TYPE_NORMAL
- en: 'An example action looks like this:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE5]'
  prefs: []
  type: TYPE_PRE
- en: If the form is found in a webpage hosted on a URL like for example `https://example.com/user/login`
    the `action=submit.cgi` is a relative path within the same directory as the form
    itself. The full URL to submit this form thus becomes `https://example.com/user/submit.cgi`.
    That is the URL to use in the curl command line.
  prefs: []
  type: TYPE_NORMAL
- en: Next, you must identify every `<input>` tag used within the form, including
    the ones that are marked as hidden. Hidden just means that they are not shown
    in the webpage, but they should still be sent in the POST.
  prefs: []
  type: TYPE_NORMAL
- en: For every `<input>` in the form there should be a corresponding `-F` in the
    command line.
  prefs: []
  type: TYPE_NORMAL
- en: text input
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: A regular tag using type text in the style like
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE6]'
  prefs: []
  type: TYPE_PRE
- en: 'should then set the field name with content like this:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE7]'
  prefs: []
  type: TYPE_PRE
- en: file input
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: 'When the input type is set to a file, like in:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE8]'
  prefs: []
  type: TYPE_PRE
- en: 'You provide a file for this part by specifying the filename and use `@` and
    the path to the file to include:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE9]'
  prefs: []
  type: TYPE_PRE
- en: hidden input
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: 'A common technique to pass on state from a form is to set a number of `<input>`
    tags as `type="hidden"`. This is basically the same thing as an already filled
    in form field, so you convert this to a command line by using the name and value.
    For example:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE10]'
  prefs: []
  type: TYPE_PRE
- en: 'This is converted like for the normal text field, and here you know what the
    content should be:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE11]'
  prefs: []
  type: TYPE_PRE
- en: All fields at once
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: 'If we toy with the idea that all the three different `<input>` tags showed
    in the examples above were used in the same `<form>`, then a complete curl command
    line to send, including the correct URL as extracted above, would look like:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE12]'
  prefs: []
  type: TYPE_PRE
