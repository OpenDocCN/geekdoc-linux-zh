<html><head></head><body>
    <div style="page-break-after: always;"/>
    <h1>The <code>cpio</code> command</h1>
    <p>The <code>cpio</code> (copy in, copy out) command is a versatile archiving utility that can create and extract archives, copy files, and handle special file types. It's particularly useful for system backups, creating initramfs images, and working with tape archives.</p>
    <h2>Syntax</h2>
    <pre>
      <code class="language-php hljs php" data-lang="php">cpio [options] &lt; name-<span class="hljs-keyword">list</span>
cpio [options] -i [patterns] &lt; archive
cpio [options] -o &gt; archive
cpio [options] -p destination-directory
</code>
    </pre>
    <h2>Operating Modes</h2>
    <h3>1. Copy-out mode (-o)</h3>
    <pre>
      <code class="language-bash hljs bash" data-lang="bash"><span class="hljs-comment"># Create archive from file list</span>
find . -name <span class="hljs-string">"*.txt"</span> | cpio -o &gt; archive.cpio

<span class="hljs-comment"># Create compressed archive</span>
find . -<span class="hljs-built_in">type</span> f | cpio -o | gzip &gt; archive.cpio.gz

<span class="hljs-comment"># Verbose output</span>
find . -name <span class="hljs-string">"*.conf"</span> | cpio -ov &gt; config_backup.cpio
</code>
    </pre>
    <h3>2. Copy-in mode (-i)</h3>
    <pre>
      <code class="language-bash hljs bash" data-lang="bash"><span class="hljs-comment"># Extract archive</span>
cpio -i &lt; archive.cpio

<span class="hljs-comment"># Extract to specific directory</span>
<span class="hljs-built_in">cd</span> /restore &amp;&amp; cpio -i &lt; /backup/archive.cpio

<span class="hljs-comment"># Extract specific files</span>
cpio -i <span class="hljs-string">"*.txt"</span> &lt; archive.cpio
</code>
    </pre>
    <h3>3. Pass-through mode (-p)</h3>
    <pre>
      <code class="language-bash hljs bash" data-lang="bash"><span class="hljs-comment"># Copy files to another directory</span>
find /<span class="hljs-built_in">source</span> -<span class="hljs-built_in">type</span> f | cpio -p /destination

<span class="hljs-comment"># Preserve attributes while copying</span>
find /etc -name <span class="hljs-string">"*.conf"</span> | cpio -pdm /backup/configs
</code>
    </pre>
    <h2>Common Options</h2>
    <h3>Basic Options</h3>
    <pre>
      <code class="language-bash hljs bash" data-lang="bash"><span class="hljs-comment"># -o: Copy-out (create archive)</span>
find . | cpio -o &gt; archive.cpio

<span class="hljs-comment"># -i: Copy-in (extract archive)</span>
cpio -i &lt; archive.cpio

<span class="hljs-comment"># -p: Pass-through (copy files)</span>
find . | cpio -p /destination

<span class="hljs-comment"># -v: Verbose output</span>
find . | cpio -ov &gt; archive.cpio

<span class="hljs-comment"># -t: List archive contents</span>
cpio -tv &lt; archive.cpio
</code>
    </pre>
    <h3>Advanced Options</h3>
    <pre>
      <code class="language-bash hljs bash" data-lang="bash"><span class="hljs-comment"># -d: Create directories as needed</span>
cpio -id &lt; archive.cpio

<span class="hljs-comment"># -m: Preserve modification times</span>
cpio -im &lt; archive.cpio

<span class="hljs-comment"># -u: Unconditional extraction (overwrite)</span>
cpio -iu &lt; archive.cpio

<span class="hljs-comment"># -H: Specify archive format</span>
cpio -oH newc &gt; archive.cpio

<span class="hljs-comment"># -B: Use 5120-byte blocks</span>
cpio -oB &gt; archive.cpio
</code>
    </pre>
    <h2>Archive Formats</h2>
    <h3>Available Formats</h3>
    <pre>
      <code class="language-bash hljs bash" data-lang="bash"><span class="hljs-comment"># Binary format (default, obsolete)</span>
cpio -o &gt; archive.cpio

<span class="hljs-comment"># New ASCII format (recommended)</span>
cpio -oH newc &gt; archive.cpio

<span class="hljs-comment"># Old ASCII format</span>
cpio -oH odc &gt; archive.cpio

<span class="hljs-comment"># CRC format</span>
cpio -oH crc &gt; archive.cpio

<span class="hljs-comment"># TAR format</span>
cpio -oH tar &gt; archive.tar

<span class="hljs-comment"># USTAR format</span>
cpio -oH ustar &gt; archive.tar
</code>
    </pre>
    <h2>Practical Examples</h2>
    <h3>1. System Backup</h3>
    <pre>
      <code class="language-bash hljs bash" data-lang="bash"><span class="hljs-comment"># Backup entire system (excluding certain directories)</span>
find / -path /proc -prune -o -path /sys -prune -o -path /dev -prune -o -<span class="hljs-built_in">print</span> | \
sudo cpio -oH newc | gzip &gt; system_backup.cpio.gz

<span class="hljs-comment"># Backup specific directories</span>
find /etc /home /var -<span class="hljs-built_in">type</span> f | cpio -oH newc &gt; important_files.cpio

<span class="hljs-comment"># Backup with verbose output</span>
find /home/user -<span class="hljs-built_in">type</span> f | cpio -ovH newc &gt; user_backup.cpio
</code>
    </pre>
    <h3>2. Creating initramfs</h3>
    <pre>
      <code class="language-bash hljs bash" data-lang="bash"><span class="hljs-comment"># Create initramfs image (common in Linux boot process)</span><span class="hljs-built_in">cd</span> /tmp/initramfs
find . | cpio -oH newc | gzip &gt; /boot/initramfs.img

<span class="hljs-comment"># Extract existing initramfs</span>
<span class="hljs-built_in">cd</span> /tmp/extract
zcat /boot/initramfs.img | cpio -id
</code>
    </pre>
    <h3>3. Selective File Operations</h3>
    <pre>
      <code class="language-bash hljs bash" data-lang="bash"><span class="hljs-comment"># Archive only configuration files</span>
find /etc -name <span class="hljs-string">"*.conf"</span> -o -name <span class="hljs-string">"*.cfg"</span> | cpio -oH newc &gt; configs.cpio

<span class="hljs-comment"># Archive files modified in last 7 days</span>
find /home -<span class="hljs-built_in">type</span> f -mtime -7 | cpio -oH newc &gt; recent_files.cpio

<span class="hljs-comment"># Archive files larger than 1MB</span>
find /var/<span class="hljs-built_in">log</span> -<span class="hljs-built_in">type</span> f -size +1M | cpio -oH newc &gt; large_logs.cpio
</code>
    </pre>
    <h3>4. Working with Compressed Archives</h3>
    <pre>
      <code class="language-bash hljs bash" data-lang="bash"><span class="hljs-comment"># Create compressed archive</span>
find . -<span class="hljs-built_in">type</span> f | cpio -oH newc | gzip &gt; archive.cpio.gz
find . -<span class="hljs-built_in">type</span> f | cpio -oH newc | bzip2 &gt; archive.cpio.bz2
find . -<span class="hljs-built_in">type</span> f | cpio -oH newc | xz &gt; archive.cpio.xz

<span class="hljs-comment"># Extract compressed archives</span>
zcat archive.cpio.gz | cpio -id
bzcat archive.cpio.bz2 | cpio -id
xzcat archive.cpio.xz | cpio -id
</code>
    </pre>
    <h2>Special File Types</h2>
    <h3>1. Device Files and Special Files</h3>
    <pre>
      <code class="language-bash hljs bash" data-lang="bash"><span class="hljs-comment"># Archive including device files</span>
find /dev -<span class="hljs-built_in">type</span> c -o -<span class="hljs-built_in">type</span> b | sudo cpio -oH newc &gt; device_files.cpio

<span class="hljs-comment"># Archive symbolic links</span>
find . -<span class="hljs-built_in">type</span> l | cpio -oH newc &gt; symlinks.cpio

<span class="hljs-comment"># Archive with all file types preserved</span>
find . | sudo cpio -oH newc &gt; complete_backup.cpio
</code>
    </pre>
    <h3>2. Preserving Attributes</h3>
    <pre>
      <code class="language-bash hljs bash" data-lang="bash"><span class="hljs-comment"># Preserve ownership and permissions</span>
find . | sudo cpio -oH newc &gt; backup.cpio
sudo cpio -idm &lt; backup.cpio

<span class="hljs-comment"># Preserve modification times</span>
cpio -im &lt; archive.cpio

<span class="hljs-comment"># Preserve all attributes in pass-through mode</span>
find /<span class="hljs-built_in">source</span> | sudo cpio -pdm /destination
</code>
    </pre>
    <h2>File Filtering and Selection</h2>
    <h3>1. Pattern Matching</h3>
    <pre>
      <code class="language-bash hljs bash" data-lang="bash"><span class="hljs-comment"># Extract specific file patterns</span>
cpio -i <span class="hljs-string">"*.txt"</span> <span class="hljs-string">"*.conf"</span> &lt; archive.cpio

<span class="hljs-comment"># Extract files in specific directory</span>
cpio -i <span class="hljs-string">"etc/*"</span> &lt; archive.cpio

<span class="hljs-comment"># Extract with shell globbing</span>
cpio -i <span class="hljs-string">"*backup*"</span> &lt; archive.cpio
</code>
    </pre>
    <h3>2. Exclude Patterns</h3>
    <pre>
      <code class="language-bash hljs bash" data-lang="bash"><span class="hljs-comment"># Create archive excluding certain files</span>
find . -<span class="hljs-built_in">type</span> f ! -name <span class="hljs-string">"*.tmp"</span> ! -name <span class="hljs-string">"*.log"</span> | cpio -oH newc &gt; clean_archive.cpio

<span class="hljs-comment"># Use grep to filter</span>
find . -<span class="hljs-built_in">type</span> f | grep -v -E <span class="hljs-string">'\.(tmp|log|cache)$'</span> | cpio -oH newc &gt; filtered.cpio
</code>
    </pre>
    <h2>Network Operations</h2>
    <h3>1. Remote Backup</h3>
    <pre>
      <code class="language-bash hljs bash" data-lang="bash"><span class="hljs-comment"># Send archive over network</span>
find /home | cpio -oH newc | ssh user@remote <span class="hljs-string">"cat &gt; backup.cpio"</span>

<span class="hljs-comment"># Compressed network backup</span>
find /data | cpio -oH newc | gzip | ssh user@remote <span class="hljs-string">"cat &gt; data_backup.cpio.gz"</span>

<span class="hljs-comment"># Receive archive from network</span>
ssh user@remote <span class="hljs-string">"cat backup.cpio"</span> | cpio -id
</code>
    </pre>
    <h3>2. Tape Operations</h3>
    <pre>
      <code class="language-bash hljs bash" data-lang="bash"><span class="hljs-comment"># Write to tape device</span>
find /home | cpio -oH newc &gt; /dev/st0

<span class="hljs-comment"># Read from tape</span>
cpio -itv &lt; /dev/st0  <span class="hljs-comment"># List contents</span>
cpio -id &lt; /dev/st0   <span class="hljs-comment"># Extract</span>

<span class="hljs-comment"># Multi-volume archives</span>
find /large_dataset | cpio -oH newc --split-at=700M &gt; /dev/st0
</code>
    </pre>
    <h2>Archive Management</h2>
    <h3>1. Listing Archive Contents</h3>
    <pre>
      <code class="language-bash hljs bash" data-lang="bash"><span class="hljs-comment"># List all files in archive</span>
cpio -tv &lt; archive.cpio

<span class="hljs-comment"># List with detailed information</span>
cpio -itv &lt; archive.cpio

<span class="hljs-comment"># Count files in archive</span>
cpio -it &lt; archive.cpio | wc -l

<span class="hljs-comment"># Search for specific files</span>
cpio -it &lt; archive.cpio | grep <span class="hljs-string">"filename"</span>
</code>
    </pre>
    <h3>2. Verifying Archives</h3>
    <pre>
      <code class="language-bash hljs bash" data-lang="bash"><span class="hljs-comment"># Test archive integrity</span>
cpio -it &lt; archive.cpio &gt; /dev/null

<span class="hljs-comment"># Compare with filesystem</span>
find . | cpio -oH newc | cpio -it | sort &gt; archive_list.txt
find . | sort &gt; filesystem_list.txt
diff archive_list.txt filesystem_list.txt
</code>
    </pre>
    <h3>3. Updating Archives</h3>
    <pre>
      <code class="language-bash hljs bash" data-lang="bash"><span class="hljs-comment"># Append to existing archive (not directly supported)</span><span class="hljs-comment"># Workaround: extract, add files, recreate</span>
mkdir /tmp/archive_work
<span class="hljs-built_in">cd</span> /tmp/archive_work
cpio -id &lt; /path/to/archive.cpio
<span class="hljs-comment"># Add new files</span>
find . | cpio -oH newc &gt; /path/to/new_archive.cpio
</code>
    </pre>
    <h2>Performance Optimization</h2>
    <h3>1. Block Size Tuning</h3>
    <pre>
      <code class="language-bash hljs bash" data-lang="bash"><span class="hljs-comment"># Use larger block size for better performance</span>
cpio -oB &gt; archive.cpio          <span class="hljs-comment"># 5120 bytes</span>
cpio -o --block-size=32768 &gt; archive.cpio  <span class="hljs-comment"># 32KB blocks</span>

<span class="hljs-comment"># For tape drives</span>
cpio -o --block-size=65536 &gt; /dev/st0  <span class="hljs-comment"># 64KB blocks</span>
</code>
    </pre>
    <h3>2. Compression Strategies</h3>
    <pre>
      <code class="language-bash hljs bash" data-lang="bash"><span class="hljs-comment"># Different compression methods</span>
find . | cpio -oH newc | gzip -1 &gt; fast_compress.cpio.gz    <span class="hljs-comment"># Fast</span>
find . | cpio -oH newc | gzip -9 &gt; best_compress.cpio.gz    <span class="hljs-comment"># Best ratio</span>
find . | cpio -oH newc | lz4 &gt; lz4_compress.cpio.lz4        <span class="hljs-comment"># Very fast</span>
find . | cpio -oH newc | xz -9 &gt; xz_compress.cpio.xz        <span class="hljs-comment"># Best ratio</span>
</code>
    </pre>
    <h3>3. Parallel Processing</h3>
    <pre>
      <code class="language-bash hljs bash" data-lang="bash"><span class="hljs-comment"># Use parallel compression</span>
find . | cpio -oH newc | pigz &gt; parallel_compressed.cpio.gz

<span class="hljs-comment"># Parallel decompression</span>
pigz -dc archive.cpio.gz | cpio -id
</code>
    </pre>
    <h2>Integration with Other Tools</h2>
    <h3>1. With find</h3>
    <pre>
      <code class="language-bash hljs bash" data-lang="bash"><span class="hljs-comment"># Complex find expressions</span>
find /var/<span class="hljs-built_in">log</span> -name <span class="hljs-string">"*.log"</span> -size +10M -mtime +30 | cpio -oH newc &gt; old_large_logs.cpio

<span class="hljs-comment"># Execute commands during find</span>
find . -name <span class="hljs-string">"*.txt"</span> -<span class="hljs-built_in">exec</span> grep -l <span class="hljs-string">"important"</span> {} \; | cpio -oH newc &gt; important_texts.cpio
</code>
    </pre>
    <h3>2. With rsync</h3>
    <pre>
      <code class="language-bash hljs bash" data-lang="bash"><span class="hljs-comment"># Create incremental backups</span>
rsync -av --link-dest=/backup/previous /<span class="hljs-built_in">source</span>/ /backup/current/
find /backup/current -<span class="hljs-built_in">type</span> f | cpio -oH newc &gt; incremental.cpio
</code>
    </pre>
    <h3>3. With tar compatibility</h3>
    <pre>
      <code class="language-bash hljs bash" data-lang="bash"><span class="hljs-comment"># Convert tar to cpio</span>
tar -cf - files | cpio -oH tar &gt; archive.tar

<span class="hljs-comment"># Convert cpio to tar</span>
cpio -it &lt; archive.cpio | tar -cf archive.tar -T -
</code>
    </pre>
    <h2>Troubleshooting</h2>
    <h3>1. Common Errors</h3>
    <pre>
      <code class="language-bash hljs bash" data-lang="bash"><span class="hljs-comment"># "Premature end of file" error</span><span class="hljs-comment"># Check if archive is complete or corrupted</span>
file archive.cpio

<span class="hljs-comment"># Permission denied errors</span>
<span class="hljs-comment"># Use sudo for system files</span>
sudo cpio -id &lt; archive.cpio

<span class="hljs-comment"># "Cannot create directory" errors</span>
<span class="hljs-comment"># Use -d option</span>
cpio -id &lt; archive.cpio
</code>
    </pre>
    <h3>2. Debugging</h3>
    <pre>
      <code class="language-bash hljs bash" data-lang="bash"><span class="hljs-comment"># Verbose mode for debugging</span>
cpio -idv &lt; archive.cpio

<span class="hljs-comment"># Check archive format</span>
file archive.cpio
hexdump -C archive.cpio | head

<span class="hljs-comment"># Test archive before extraction</span>
cpio -it &lt; archive.cpio &gt; /dev/null
<span class="hljs-built_in">echo</span> $?  <span class="hljs-comment"># Should return 0 for success</span>
</code>
    </pre>
    <h3>3. Recovery</h3>
    <pre>
      <code class="language-bash hljs bash" data-lang="bash"><span class="hljs-comment"># Partial archive recovery</span>
dd <span class="hljs-keyword">if</span>=damaged_archive.cpio of=partial.cpio bs=512 count=1000
cpio -id &lt; partial.cpio

<span class="hljs-comment"># Skip damaged portions</span>
cpio -id --only-verify-crc &lt; archive.cpio
</code>
    </pre>
    <h2>Scripting and Automation</h2>
    <h3>1. Backup Scripts</h3>
    <pre>
      <code class="language-bash hljs bash" data-lang="bash"><span class="hljs-meta">#!/bin/bash</span><span class="hljs-comment"># Automated backup script</span>
BACKUP_DIR=<span class="hljs-string">"/backup/<span class="hljs-variable">$(date +%Y%m%d)</span>"</span>
SOURCE=<span class="hljs-string">"/home /etc /var/log"</span>

mkdir -p <span class="hljs-string">"<span class="hljs-variable">$BACKUP_DIR</span>"</span>
<span class="hljs-keyword">for</span> dir <span class="hljs-keyword">in</span> <span class="hljs-variable">$SOURCE</span>; <span class="hljs-keyword">do</span>
    find <span class="hljs-string">"<span class="hljs-variable">$dir</span>"</span> -<span class="hljs-built_in">type</span> f | cpio -oH newc | gzip &gt; <span class="hljs-string">"<span class="hljs-variable">$BACKUP_DIR</span>/<span class="hljs-variable">$(basename $dir)</span>.cpio.gz"</span>
<span class="hljs-keyword">done</span>
</code>
    </pre>
    <h3>2. Restoration Scripts</h3>
    <pre>
      <code class="language-bash hljs bash" data-lang="bash"><span class="hljs-meta">#!/bin/bash</span><span class="hljs-comment"># Automated restoration script</span>
ARCHIVE=<span class="hljs-string">"<span class="hljs-variable">$1</span>"</span>
DEST=<span class="hljs-string">"<span class="hljs-variable">${2:-/restore}</span>"</span>

<span class="hljs-keyword">if</span> [ ! -f <span class="hljs-string">"<span class="hljs-variable">$ARCHIVE</span>"</span> ]; <span class="hljs-keyword">then</span>
    <span class="hljs-built_in">echo</span> <span class="hljs-string">"Archive not found: <span class="hljs-variable">$ARCHIVE</span>"</span>
    <span class="hljs-built_in">exit</span> 1
<span class="hljs-keyword">fi</span>

mkdir -p <span class="hljs-string">"<span class="hljs-variable">$DEST</span>"</span>
<span class="hljs-built_in">cd</span> <span class="hljs-string">"<span class="hljs-variable">$DEST</span>"</span>

<span class="hljs-keyword">if</span> [[ <span class="hljs-string">"<span class="hljs-variable">$ARCHIVE</span>"</span> =~ \.gz$ ]]; <span class="hljs-keyword">then</span>
    zcat <span class="hljs-string">"<span class="hljs-variable">$ARCHIVE</span>"</span> | cpio -idm
<span class="hljs-keyword">else</span>
    cpio -idm &lt; <span class="hljs-string">"<span class="hljs-variable">$ARCHIVE</span>"</span>
<span class="hljs-keyword">fi</span>
</code>
    </pre>
    <h2>Best Practices</h2>
    <h3>1. Archive Naming</h3>
    <pre>
      <code class="language-bash hljs bash" data-lang="bash"><span class="hljs-comment"># Use descriptive names with dates</span>
backup_$(hostname)_$(date +%Y%m%d_%H%M%S).cpio.gz

<span class="hljs-comment"># Include source information</span>
home_backup_$(date +%Y%m%d).cpio
etc_configs_$(date +%Y%m%d).cpio
</code>
    </pre>
    <h3>2. Verification</h3>
    <pre>
      <code class="language-bash hljs bash" data-lang="bash"><span class="hljs-comment"># Always verify critical archives</span>
find /important | cpio -oH newc &gt; critical.cpio
cpio -it &lt; critical.cpio | wc -l
find /important | wc -l
</code>
    </pre>
    <h3>3. Documentation</h3>
    <pre>
      <code class="language-bash hljs bash" data-lang="bash"><span class="hljs-comment"># Document archive contents</span>
cpio -itv &lt; archive.cpio &gt; archive_contents.txt
<span class="hljs-built_in">echo</span> <span class="hljs-string">"Created: <span class="hljs-variable">$(date)</span>"</span> &gt;&gt; archive_info.txt
<span class="hljs-built_in">echo</span> <span class="hljs-string">"Source: /path/to/source"</span> &gt;&gt; archive_info.txt
</code>
    </pre>
    <h2>Important Notes</h2>
    <ul>
      <li><strong>Choose appropriate format</strong>: Use <code>newc</code> format for modern systems</li>
      <li><strong>Preserve permissions</strong>: Use <code>-m</code> and run as appropriate user</li>
      <li><strong>Test archives</strong>: Always verify archive integrity</li>
      <li><strong>Use compression</strong>: Combine with gzip/bzip2/xz for space efficiency</li>
      <li><strong>Handle special files</strong>: Be careful with device files and symlinks</li>
      <li><strong>Network security</strong>: Use secure channels for remote operations</li>
      <li><strong>Backup strategy</strong>: Regular backups with verification</li>
    </ul>
    <p>The <code>cpio</code> command is powerful for creating flexible archives and system backups, especially when combined with find and compression tools.</p>
    <p>For more details, check the manual: <code>man cpio</code></p>
  </body></html>