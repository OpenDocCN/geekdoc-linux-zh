- en: MSYS2
  id: totrans-0
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: MSYS2
- en: '[MSYS2](https://www.msys2.org/) is a popular build system for Windows based
    on [mingw-w64](https://www.mingw-w64.org/) and includes both gcc and clang compilers.
    MSYS2 uses a package manager named `pacman` (a port from arch-linux) and has about
    2000 precompiled [mingw-packages](https://github.com/msys2/MINGW-packages). MSYS2
    is designed to build standalone software: the binaries built with mingw-w64 compilers
    do not depend on MSYS2 itself[^1].'
  id: totrans-1
  prefs: []
  type: TYPE_NORMAL
  zh: '[MSYS2](https://www.msys2.org/)是基于[mingw-w64](https://www.mingw-w64.org/)的流行Windows构建系统，包括gcc和clang编译器。MSYS2使用名为`pacman`（从arch-linux移植而来）的包管理器，并拥有大约2000个预编译的[mingw-packages](https://github.com/msys2/MINGW-packages)。MSYS2旨在构建独立软件：使用mingw-w64编译器构建的二进制文件不依赖于MSYS2本身[^1]。'
- en: Get curl and libcurl on MSYS2
  id: totrans-2
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 在MSYS2上获取curl和libcurl
- en: 'Current information about the [`mingw-w64-curl`](https://github.com/msys2/MINGW-packages/blob/master/mingw-w64-curl/PKGBUILD)
    package can be found on the msys2 website: https://packages.msys2.org/base/mingw-w64-curl.
    Here we can also find installation instructions for the various available flavors.
    For example to install the default x64 binary for curl we run:'
  id: totrans-3
  prefs: []
  type: TYPE_NORMAL
  zh: 关于[`mingw-w64-curl`](https://github.com/msys2/MINGW-packages/blob/master/mingw-w64-curl/PKGBUILD)包的当前信息可以在msys2网站上找到：https://packages.msys2.org/base/mingw-w64-curl。我们还可以在此找到各种可用版本的安装说明。例如，要安装curl的默认x64二进制文件，我们运行：
- en: '[PRE0]'
  id: totrans-4
  prefs: []
  type: TYPE_PRE
  zh: '[PRE0]'
- en: This package contains both the `curl` command line tool as well as libcurl headers
    and shared libraries. The default `curl` packages are built with the OpenSSL backend
    and hence depend on `mingw-w64-x86_64-openssl`. There are also `mingw-w64-x86_64-curl-gnutls`
    and `mingw-w64-x86_64-curl-gnutls` packages, refer to the [msys2 website](https://packages.msys2.org/base/mingw-w64-curl)
    for more details.
  id: totrans-5
  prefs: []
  type: TYPE_NORMAL
  zh: 此包包含`curl`命令行工具以及libcurl头文件和共享库。默认的`curl`包使用OpenSSL后端构建，因此依赖于`mingw-w64-x86_64-openssl`。还有`mingw-w64-x86_64-curl-gnutls`和`mingw-w64-x86_64-curl-gnutls`包，有关更多详细信息，请参阅[msys2网站](https://packages.msys2.org/base/mingw-w64-curl)。
- en: 'Just like on Linux, we can use `pkg-config` to query the flags needed to build
    against libcurl. Start msys2 using the mingw64 shell (which automatically sets
    the path to include `/mingw64`) and run:'
  id: totrans-6
  prefs: []
  type: TYPE_NORMAL
  zh: 就像在Linux上一样，我们可以使用`pkg-config`来查询构建针对libcurl所需的标志。使用mingw64 shell（它会自动设置路径以包含`/mingw64`）启动msys2并运行：
- en: '[PRE1]'
  id: totrans-7
  prefs: []
  type: TYPE_PRE
  zh: '[PRE1]'
- en: The pacman package manager installs precompiled binaries. Next up we explain
    how to use pacman to build curl locally, for example to customize the configuration.
  id: totrans-8
  prefs: []
  type: TYPE_NORMAL
  zh: pacman包管理器安装预编译的二进制文件。接下来，我们将解释如何使用pacman本地构建curl，例如自定义配置。
- en: Building libcurl on MSYS2
  id: totrans-9
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 在MSYS2上构建libcurl
- en: Building packages with pacman is almost just as simple as installing. The entire
    process is contained in the [PKGBUILD](https://github.com/msys2/MINGW-packages/blob/master/mingw-w64-curl/PKGBUILD)
    file from the `mingw-w64-curl` package. We can easily modify the file to rebuild
    the package ourselves.
  id: totrans-10
  prefs: []
  type: TYPE_NORMAL
  zh: 使用pacman构建包几乎和安装一样简单。整个流程都包含在`mingw-w64-curl`包的[PKGBUILD](https://github.com/msys2/MINGW-packages/blob/master/mingw-w64-curl/PKGBUILD)文件中。我们可以轻松修改该文件以自行重新构建包。
- en: 'If we start with a clean msys2 installation, we first want to install some
    build tools, like `autoconf`, `patch` and `git`. Start the msys2 shell and run:'
  id: totrans-11
  prefs: []
  type: TYPE_NORMAL
  zh: 如果我们从干净的msys2安装开始，我们首先想要安装一些构建工具，如`autoconf`、`patch`和`git`。启动msys2 shell并运行：
- en: '[PRE2]'
  id: totrans-12
  prefs: []
  type: TYPE_PRE
  zh: '[PRE2]'
- en: 'Now clone the `mingw-packages` repository and go to the `mingw-w64-curl` package:'
  id: totrans-13
  prefs: []
  type: TYPE_NORMAL
  zh: 现在克隆`mingw-packages`仓库并转到`mingw-w64-curl`包：
- en: '[PRE3]'
  id: totrans-14
  prefs: []
  type: TYPE_PRE
  zh: '[PRE3]'
- en: 'This directory contains the PKGBUILD file and patches that are used for building
    curl. Have a look at the PKGBUILD file to see what is going on. Now to compile
    it, we can do:'
  id: totrans-15
  prefs: []
  type: TYPE_NORMAL
  zh: 此目录包含用于构建curl的PKGBUILD文件和补丁。查看PKGBUILD文件以了解发生了什么。现在要编译它，我们可以这样做：
- en: '[PRE4]'
  id: totrans-16
  prefs: []
  type: TYPE_PRE
  zh: '[PRE4]'
- en: 'That is it. The `--syncdeps` parameter automatically checks and prompts to
    install dependencies of `mingw-w64-curl` if these are not yet installed. Once
    the process is complete you have 3 new files in the current directory, for example:'
  id: totrans-17
  prefs: []
  type: TYPE_NORMAL
  zh: 就这样。`--syncdeps`参数会自动检查并提示安装`mingw-w64-curl`的依赖项（如果尚未安装）。一旦过程完成，当前目录中就会有3个新文件，例如：
- en: '`pacman -U mingw-w64-x86_64-curl-7.80.0-1-any.pkg.tar.zst`'
  id: totrans-18
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`pacman -U mingw-w64-x86_64-curl-7.80.0-1-any.pkg.tar.zst`'
- en: '`pacman -U mingw-w64-x86_64-curl-gnutls-7.80.0-1-any.pkg.tar.zst`'
  id: totrans-19
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`pacman -U mingw-w64-x86_64-curl-gnutls-7.80.0-1-any.pkg.tar.zst`'
- en: '`pacman -U mingw-w64-x86_64-curl-winssl-7.80.0-1-any.pkg.tar.zst`'
  id: totrans-20
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`pacman -U mingw-w64-x86_64-curl-winssl-7.80.0-1-any.pkg.tar.zst`'
- en: 'Use the `pacman -u` command to install such a local package file:'
  id: totrans-21
  prefs: []
  type: TYPE_NORMAL
  zh: 使用`pacman -u`命令安装此类本地包文件：
- en: '[PRE5]'
  id: totrans-22
  prefs: []
  type: TYPE_PRE
  zh: '[PRE5]'
- en: Have a look at the [msys2 docs](https://www.msys2.org/docs/package-management/)
    or join the [gitter](https://gitter.im/msys2/msys2) to learn more about building
    with pacman and msys2.
  id: totrans-23
  prefs: []
  type: TYPE_NORMAL
  zh: 查看 [msys2 文档](https://www.msys2.org/docs/package-management/) 或加入 [gitter](https://gitter.im/msys2/msys2)
    以了解更多关于使用 pacman 和 msys2 进行构建的信息。
- en: '[^1]: Be careful not to confuse the [mingw-package](https://github.com/msys2/MINGW-packages)
    `mingw-w64-curl` with the [msys-packages](https://github.com/msys2/MSYS2-packages)
    `curl` and `curl-devel`. The latter are part of msys2 environment itself (e.g. to
    support pacman downloads), but not suitable for redistribution. To build redistributable
    software that does not depend on MSYS2 itself, you always need `mingw-w64-…` packages
    and toolchains.'
  id: totrans-24
  prefs: []
  type: TYPE_NORMAL
  zh: '[^1]: 请注意不要将 [mingw-package](https://github.com/msys2/MINGW-packages) 的 `mingw-w64-curl`
    与 [msys-packages](https://github.com/msys2/MSYS2-packages) 的 `curl` 和 `curl-devel`
    混淆。后者是 msys2 环境本身的一部分（例如，用于支持 pacman 下载），但不适合分发。要构建不依赖于 MSYS2 本身的可分发软件，你始终需要 `mingw-w64-…`
    软件包和工具链。'
