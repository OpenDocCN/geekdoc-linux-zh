- en: Autotools
  id: totrans-0
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: Autotools
- en: 'The Autotools are a collection of different tools that are used together to
    generate the `configure` script. The configure script is run by the user who wants
    to build curl and it does a whole bunch of things:'
  id: totrans-1
  prefs: []
  type: TYPE_NORMAL
  zh: Autotools 是一组不同的工具集合，它们一起使用来生成 `configure` 脚本。`configure` 脚本由想要构建 curl 的用户运行，它执行一系列操作：
- en: It checks for features and functions present in your system.
  id: totrans-2
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 它检查你的系统中存在的特性和功能。
- en: It offers command-line options so that you as a builder can decide what to enable
    and disable in the build. Features and protocols, etc., can be toggled on/off,
    even compiler warning levels and more.
  id: totrans-3
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 它提供了命令行选项，以便你作为构建者可以决定在构建过程中启用或禁用哪些功能。特性和协议等可以切换开启/关闭，甚至编译器警告级别等。
- en: It offers command-line options to let the builder point to specific installation
    paths for various third-party dependencies that curl can be built to use.
  id: totrans-4
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 它提供了命令行选项，让构建者指定 curl 构建时可以使用的各种第三方依赖项的特定安装路径。
- en: It specifies on which file path the generated installation should be placed
    when ultimately the build is made and `make install` is invoked.
  id: totrans-5
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 它指定了在最终构建完成并调用 `make install` 时，生成的安装文件应该放置在哪个文件路径上。
- en: In the most basic usage, just running `./configure` in the source directory
    is enough. When the script completes, it outputs a summary of what options it
    has detected/enabled and what features that are still disabled, some of which
    possibly because it failed to detect the presence of necessary third-party dependencies
    that are needed for those functions to work. If the summary is not what you expected
    it to be, invoke configure again with new options or with the previously used
    options adjusted.
  id: totrans-6
  prefs: []
  type: TYPE_NORMAL
  zh: 在最基本的使用中，只需在源目录中运行 `./configure` 就足够了。当脚本完成后，它会输出一个总结，说明它检测/启用了哪些选项，以及哪些功能仍然被禁用，其中一些可能是因为它未能检测到那些功能正常工作所需的必要第三方依赖项的存在。如果总结不是你所期望的，请再次调用
    `configure`，使用新的选项或调整之前使用的选项。
- en: After configure has completed, you invoke `make` to build the entire thing and
    then finally `make install` to install curl, libcurl and associated things. `make
    install` requires that you have the correct rights in your system to create and
    write files in the installation directory or you get an error displayed.
  id: totrans-7
  prefs: []
  type: TYPE_NORMAL
  zh: 在 `configure` 完成后，你调用 `make` 来构建整个项目，然后最终调用 `make install` 来安装 curl、libcurl
    以及相关内容。`make install` 需要你拥有在系统中的正确权限，以便在安装目录中创建和写入文件，否则会显示错误。
- en: Cross-compiling
  id: totrans-8
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 交叉编译
- en: Cross-compiling means that you build the source on one architecture but the
    output is created to be run on a different one. For example, you could build the
    source on a Linux machine but have the output work on a Windows machine.
  id: totrans-9
  prefs: []
  type: TYPE_NORMAL
  zh: 交叉编译意味着你在一种架构上构建源代码，但输出是为了在另一种架构上运行而创建的。例如，你可以在 Linux 机器上构建源代码，但输出可以在 Windows
    机器上运行。
- en: For cross-compiling to work, you need a dedicated compiler and build system
    setup for the particular target system for which you want to build. How to get
    and install that system is not covered in this book.
  id: totrans-10
  prefs: []
  type: TYPE_NORMAL
  zh: 为了使交叉编译工作，你需要为特定目标系统设置一个专门的编译器和构建系统。如何获取和安装该系统，本书不涉及。
- en: Once you have a cross compiler, you can instruct configure to use that compiler
    instead of the native compiler when it builds curl so that the end result then
    can be moved over and used on the other machine.
  id: totrans-11
  prefs: []
  type: TYPE_NORMAL
  zh: 一旦你有了交叉编译器，你可以指示 `configure` 在构建 curl 时使用该编译器而不是本地编译器，这样最终结果就可以移动到另一台机器上并使用。
- en: Static linking
  id: totrans-12
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 静态链接
- en: By default, configure setups the build files so that the following ‘make’ command
    creates both shared and static versions of libcurl. You can change that with the
    `--disable-static` or `--disable-shared` options to configure.
  id: totrans-13
  prefs: []
  type: TYPE_NORMAL
  zh: 默认情况下，`configure` 设置构建文件，以便以下 `make` 命令创建 libcurl 的共享和静态版本。你可以使用 `--disable-static`
    或 `--disable-shared` 选项来更改这一点。
- en: If you instead want to build with static versions of third party libraries instead
    of shared libraries, you need to prepare yourself for an uphill battle. curl’s
    configure script is focused on setting up and building with shared libraries.
  id: totrans-14
  prefs: []
  type: TYPE_NORMAL
  zh: 如果你想要使用第三方库的静态版本而不是共享库来构建，你需要准备好进行一场艰难的战斗。curl 的 `configure` 脚本专注于设置和构建共享库。
- en: One of the differences between linking with a static library compared to linking
    with a shared one is in how shared libraries handle their own dependencies while
    static ones do not. In order to link with library `xyz` as a shared library, it
    is basically a matter of adding `-lxyz` to the linker command line no matter which
    other libraries `xyz` itself was built to use. But, if that `xyz` is instead a
    static library we also need to specify each dependency of `xyz` on the linker
    command line. curl’s configure cannot keep up with or know all possible dependencies
    for all the libraries it can be made to build with, so users wanting to build
    with static libs mostly need to provide that list of libraries to link with.
  id: totrans-15
  prefs: []
  type: TYPE_NORMAL
  zh: 与静态库链接相比，与共享库链接的一个不同之处在于共享库如何处理自己的依赖项，而静态库则不这样做。为了将库 `xyz` 作为共享库链接，基本上只需在链接器命令行中添加
    `-lxyz`，无论 `xyz` 本身是用哪些其他库构建的。但是，如果 `xyz` 是一个静态库，我们还需要在链接器命令行中指定 `xyz` 的每个依赖项。curl
    的配置脚本无法跟上或知道所有可能的依赖项，因此想要使用静态库的用户通常需要提供要链接的库列表。
- en: Select TLS backend
  id: totrans-16
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 选择 TLS 后端
- en: The configure-based build offers the user to select from a wide variety of different
    TLS libraries when building. You select them by using the correct command line
    options. Before curl 7.77.0, the configure script would automatically check for
    OpenSSL, but modern versions do not.
  id: totrans-17
  prefs: []
  type: TYPE_NORMAL
  zh: 基于配置的构建为用户提供在构建时从多种不同的 TLS 库中进行选择。您可以通过使用正确的命令行选项来选择它们。在 curl 7.77.0 之前，配置脚本会自动检查
    OpenSSL，但现代版本不再这样做。
- en: 'AmiSSL: `--with-amissl`'
  id: totrans-18
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 'AmiSSL: `--with-amissl`'
- en: 'AWS-LC: `--with-openssl`'
  id: totrans-19
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 'AWS-LC: `--with-openssl`'
- en: 'BearSSL: `--with-bearssl`'
  id: totrans-20
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 'BearSSL: `--with-bearssl`'
- en: 'BoringSSL: `--with-openssl`'
  id: totrans-21
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 'BoringSSL: `--with-openssl`'
- en: 'GnuTLS: `--with-gnutls`'
  id: totrans-22
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 'GnuTLS: `--with-gnutls`'
- en: 'LibreSSL: `--with-openssl`'
  id: totrans-23
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 'LibreSSL: `--with-openssl`'
- en: 'mbedTLS: `--with-mbedtls`'
  id: totrans-24
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 'mbedTLS: `--with-mbedtls`'
- en: 'OpenSSL: `--with-openssl`'
  id: totrans-25
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 'OpenSSL: `--with-openssl`'
- en: 'Rustls: `--with-rustls` (point to the rustls-ffi install path)'
  id: totrans-26
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 'Rustls: `--with-rustls` (指向 rustls-ffi 安装路径)'
- en: 'Schannel: `--with-schannel`'
  id: totrans-27
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 'Schannel: `--with-schannel`'
- en: 'Secure Transport: `--with-secure-transport`'
  id: totrans-28
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '安全传输: `--with-secure-transport`'
- en: 'wolfSSL: `--with-wolfssl`'
  id: totrans-29
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 'wolfSSL: `--with-wolfssl`'
- en: If you do not specify which TLS library to use, the configure script fails.
    If you want to build *without* TLS support, you must explicitly ask for that with
    `--without-ssl`.
  id: totrans-30
  prefs: []
  type: TYPE_NORMAL
  zh: 如果您没有指定要使用哪个 TLS 库，配置脚本将失败。如果您想构建**不**支持 TLS 的版本，您必须明确使用 `--without-ssl` 来请求。
- en: 'These `--with-*` options also allow you to provide the install prefix so that
    configure searches for the specific library where you tell it to. Like this:'
  id: totrans-31
  prefs: []
  type: TYPE_NORMAL
  zh: 这些 `--with-*` 选项还允许您提供安装前缀，以便配置脚本在您指定的位置搜索特定库。例如：
- en: '[PRE0]'
  id: totrans-32
  prefs: []
  type: TYPE_PRE
  zh: '[PRE0]'
- en: 'You can opt to build with support for **multiple** TLS libraries by specifying
    multiple `--with-*` options on the configure command line. Pick which one to make
    the default TLS backend with `--with-default-ssl-backend=[NAME]`. For example,
    build with support for both GnuTLS and OpenSSL and default to OpenSSL:'
  id: totrans-33
  prefs: []
  type: TYPE_NORMAL
  zh: 您可以选择构建支持**多个**TLS库的版本，通过在配置命令行上指定多个 `--with-*` 选项。使用 `--with-default-ssl-backend=[NAME]`
    指定哪个作为默认TLS后端。例如，构建支持 GnuTLS 和 OpenSSL，并默认使用 OpenSSL：
- en: '[PRE1]'
  id: totrans-34
  prefs: []
  type: TYPE_PRE
  zh: '[PRE1]'
- en: Select SSH backend
  id: totrans-35
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 选择 SSH 后端
- en: The configure-based build offers the user to select from a variety of different
    SSH libraries when building. You select them by using the correct command-line
    options.
  id: totrans-36
  prefs: []
  type: TYPE_NORMAL
  zh: 基于配置的构建为用户提供在构建时从多种不同的 SSH 库中进行选择。您可以通过使用正确的命令行选项来选择它们。
- en: 'libssh2: `--with-libssh2`'
  id: totrans-37
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 'libssh2: `--with-libssh2`'
- en: 'libssh: `--with-libssh`'
  id: totrans-38
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 'libssh: `--with-libssh`'
- en: 'wolfSSH: `--with-wolfssh`'
  id: totrans-39
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 'wolfSSH: `--with-wolfssh`'
- en: 'These `--with-*` options also allow you to provide the install prefix so that
    configure searches for the specific library where you tell it to. Like this:'
  id: totrans-40
  prefs: []
  type: TYPE_NORMAL
  zh: 这些 `--with-*` 选项还允许您提供安装前缀，以便配置脚本在您指定的位置搜索特定库。例如：
- en: '[PRE2]'
  id: totrans-41
  prefs: []
  type: TYPE_PRE
  zh: '[PRE2]'
- en: Select HTTP/3 backend
  id: totrans-42
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 选择 HTTP/3 后端
- en: The configure-based build offers the user to select different HTTP/3 libraries
    when building. You select them by using the correct command-line options.
  id: totrans-43
  prefs: []
  type: TYPE_NORMAL
  zh: 基于配置的构建为用户提供在构建时选择不同的 HTTP/3 库。您可以通过使用正确的命令行选项来选择它们。
- en: 'quiche: `--with-quiche`'
  id: totrans-44
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 'quiche: `--with-quiche`'
- en: 'ngtcp2: `--with-ngtcp2 --with-nghttp3`'
  id: totrans-45
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 'ngtcp2: `--with-ngtcp2 --with-nghttp3`'
- en: 'msh3: `--with-msh3`'
  id: totrans-46
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 'msh3: `--with-msh3`'
