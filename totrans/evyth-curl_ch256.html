<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xmlns:epub="http://www.idpf.org/2007/ops" xml:lang="en-US">
<head>
  <meta charset="utf-8" />
  <meta name="generator" content="pandoc" />
  <title>ch256.xhtml</title>
  <link rel="stylesheet" type="text/css" href="../styles/stylesheet1.css" />
</head>
<body epub:type="bodymatter">
<section id="libcurl-http__alt-svc__md-_-_-alt-svc" class="level1" data-number="255">
<h1 data-number="255">alt-svc</h1>
<p>Alternative Services, aka alt-svc, is an HTTP header that lets a server tell the client that there is one or more <em>alternatives</em> for that server at another place with the use of the <code>Alt-Svc:</code> response header.</p>
<p>The <em>alternatives</em> the server suggests can include a server running on another port on the same host, on another completely different hostname and it can also offer the service <em>over another protocol</em>.</p>
<section id="libcurl-http__alt-svc__md-_-_-enable" class="level2" data-number="255.1">
<h2 data-number="255.1">Enable</h2>
<p>To make libcurl consider any offered alternatives by serves, you must first enable it in the handle. You do this by setting the correct bitmask to the <code>CURLOPT_ALTSVC_CTRL</code> option. The bitmask allows the application to limit what HTTP versions to allow, and if the cache file on disk should only be used to read from (not write).</p>
<p>Enable alt-svc and allow it to switch to either HTTP/1 or HTTP/2:</p>
<pre><code>curl_easy_setopt(curl, CURLOPT_ALTSVC_CTRL, CURLALTSVC_H1|CURLALTSVC_H2);</code></pre>
<p>Tell libcurl to use a specific alt-svc cache file like this:</p>
<pre><code>curl_easy_setopt(curl, CURLOPT_ALTSVC, &quot;altsvc-cache.txt&quot;);</code></pre>
<p>libcurl holds the list of alternatives in a memory-based cache, but loads all already existing alternative service entries from the alt-svc file at start-up and consider those when doing its subsequent HTTP requests. If servers responds with new or updated <code>Alt-Svc:</code> headers, libcurl stores those in the cache file at exit (unless the <code>CURLALTSVC_READONLYFILE</code> bit was set).</p>
</section>
<section id="libcurl-http__alt-svc__md-_-_-the-alt-svc-cache" class="level2" data-number="255.2">
<h2 data-number="255.2">The alt-svc cache</h2>
<p>The alt-svc cache is similar to a cookie jar. It is a text based file that stores one alternative per line and each entry also has an expiry time for which duration that particular alternative is valid.</p>
</section>
<section id="libcurl-http__alt-svc__md-_-_-https-only" class="level2" data-number="255.3">
<h2 data-number="255.3">HTTPS only</h2>
<p><code>Alt-Svc:</code> is only trusted and parsed from servers when connected to over HTTPS.</p>
</section>
<section id="libcurl-http__alt-svc__md-_-_-http-slash-3" class="level2" data-number="255.4">
<h2 data-number="255.4">HTTP/3</h2>
<p>The use of <code>Alt-Svc:</code> headers is as of March 2022 still the only defined way to bootstrap a client and server into using HTTP/3. The server then hints to the client over HTTP/1 or HTTP/2 that it also is available over HTTP/3 and then curl can connect to it using HTTP/3 in the subsequent request if the alt-svc cache says so.</p>
<p><span id="helpers__README__md"></span></p>
</section>
</section>
</body>
</html>
