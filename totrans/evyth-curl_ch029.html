<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xmlns:epub="http://www.idpf.org/2007/ops" xml:lang="en-US">
<head>
  <meta charset="utf-8" />
  <meta name="generator" content="pandoc" />
  <title>ch029.xhtml</title>
  <link rel="stylesheet" type="text/css" href="../styles/stylesheet1.css" />
</head>
<body epub:type="bodymatter">
<section id="install__windows__win-msys2__md-_-_-msys2" class="level1" data-number="28">
<h1 data-number="28">MSYS2</h1>
<p><a href="https://www.msys2.org/">MSYS2</a> is a popular build system for Windows based on <a href="https://www.mingw-w64.org/">mingw-w64</a> and includes both gcc and clang compilers. MSYS2 uses a package manager named <code>pacman</code> (a port from arch-linux) and has about 2000 precompiled <a href="https://github.com/msys2/MINGW-packages">mingw-packages</a>. MSYS2 is designed to build standalone software: the binaries built with mingw-w64 compilers do not depend on MSYS2 itself[^1].</p>
<section id="install__windows__win-msys2__md-_-_-get-curl-and-libcurl-on-msys2" class="level2" data-number="28.1">
<h2 data-number="28.1">Get curl and libcurl on MSYS2</h2>
<p>Current information about the <a href="https://github.com/msys2/MINGW-packages/blob/master/mingw-w64-curl/PKGBUILD"><code>mingw-w64-curl</code></a> package can be found on the msys2 website: https://packages.msys2.org/base/mingw-w64-curl. Here we can also find installation instructions for the various available flavors. For example to install the default x64 binary for curl we run:</p>
<pre><code>pacman -Sy mingw-w64-x86_64-curl</code></pre>
<p>This package contains both the <code>curl</code> command line tool as well as libcurl headers and shared libraries. The default <code>curl</code> packages are built with the OpenSSL backend and hence depend on <code>mingw-w64-x86_64-openssl</code>. There are also <code>mingw-w64-x86_64-curl-gnutls</code> and <code>mingw-w64-x86_64-curl-gnutls</code> packages, refer to the <a href="https://packages.msys2.org/base/mingw-w64-curl">msys2 website</a> for more details.</p>
<p>Just like on Linux, we can use <code>pkg-config</code> to query the flags needed to build against libcurl. Start msys2 using the mingw64 shell (which automatically sets the path to include <code>/mingw64</code>) and run:</p>
<pre><code>pkg-config --cflags libcurl
# -IC:/msys64/mingw64/include

pkg-config --libs libcurl
# -LC:/msys64/mingw64/lib -lcurl</code></pre>
<p>The pacman package manager installs precompiled binaries. Next up we explain how to use pacman to build curl locally, for example to customize the configuration.</p>
</section>
<section id="install__windows__win-msys2__md-_-_-building-libcurl-on-msys2" class="level2" data-number="28.2">
<h2 data-number="28.2">Building libcurl on MSYS2</h2>
<p>Building packages with pacman is almost just as simple as installing. The entire process is contained in the <a href="https://github.com/msys2/MINGW-packages/blob/master/mingw-w64-curl/PKGBUILD">PKGBUILD</a> file from the <code>mingw-w64-curl</code> package. We can easily modify the file to rebuild the package ourselves.</p>
<p>If we start with a clean msys2 installation, we first want to install some build tools, like <code>autoconf</code>, <code>patch</code> and <code>git</code>. Start the msys2 shell and run:</p>
<pre><code># Sync the repositories
pacman -Syu

# Install git, autoconf, patch, etc
pacman -S git base-devel

# Install GCC for x86_64
pacman -S mingw-w64-x86_64-toolchain</code></pre>
<p>Now clone the <code>mingw-packages</code> repository and go to the <code>mingw-w64-curl</code> package:</p>
<pre><code>git clone https://github.com/msys2/MINGW-packages
cd MINGW-packages/mingw-w64-curl</code></pre>
<p>This directory contains the PKGBUILD file and patches that are used for building curl. Have a look at the PKGBUILD file to see what is going on. Now to compile it, we can do:</p>
<pre><code>makepkg-mingw --syncdeps --skippgpcheck</code></pre>
<p>That is it. The <code>--syncdeps</code> parameter automatically checks and prompts to install dependencies of <code>mingw-w64-curl</code> if these are not yet installed. Once the process is complete you have 3 new files in the current directory, for example:</p>
<ul>
<li><code>pacman -U mingw-w64-x86_64-curl-7.80.0-1-any.pkg.tar.zst</code></li>
<li><code>pacman -U mingw-w64-x86_64-curl-gnutls-7.80.0-1-any.pkg.tar.zst</code></li>
<li><code>pacman -U mingw-w64-x86_64-curl-winssl-7.80.0-1-any.pkg.tar.zst</code></li>
</ul>
<p>Use the <code>pacman -u</code> command to install such a local package file:</p>
<pre><code>pacman -U mingw-w64-x86_64-curl-winssl-7.80.0-1-any.pkg.tar.zst</code></pre>
<p>Have a look at the <a href="https://www.msys2.org/docs/package-management/">msys2 docs</a> or join the <a href="https://gitter.im/msys2/msys2">gitter</a> to learn more about building with pacman and msys2.</p>
<p>[^1]: Be careful not to confuse the <a href="https://github.com/msys2/MINGW-packages">mingw-package</a> <code>mingw-w64-curl</code> with the <a href="https://github.com/msys2/MSYS2-packages">msys-packages</a> <code>curl</code> and <code>curl-devel</code>. The latter are part of msys2 environment itself (e.g. to support pacman downloads), but not suitable for redistribution. To build redistributable software that does not depend on MSYS2 itself, you always need <code>mingw-w64-…</code> packages and toolchains.</p>
<p><span id="install__windows__win-vcpkg__md"></span></p>
</section>
</section>
</body>
</html>
