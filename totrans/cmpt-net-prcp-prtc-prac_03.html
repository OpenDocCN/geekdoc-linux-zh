<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.1//EN"
  "http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<title>Networked applications#</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1>Networked applications#</h1>
<blockquote>原文：<a href="https://4ed.computer-networking.info/syllabus/default/hosts/applications.html">https://4ed.computer-networking.info/syllabus/default/hosts/applications.html</a></blockquote>

<p>There are two important models used to organize a networked application. The first and oldest model is the client-server model. In this model, a server provides services to clients that exchange information with it. This model is highly asymmetrical: clients send requests and servers perform actions and return responses. It is illustrated in the <a class="reference internal" href="#fig-client-server"><span class="std std-numref">Fig. 20</span></a>.</p>
<blockquote>
<div><div class="figure" id="id48" style="text-align: center">
<span id="fig-client-server"/><p><img src="../Images/35b8e8bfa62002005d31831c316d5073.png" alt="Figure made with TikZ" data-original-src="https://4ed.computer-networking.info/syllabus/default/_images/tikz-3cbdb4bd2db8c8e00f8656c28fc6db7be48d9714.png"/></p>
<p><span class="caption-number">Fig. 20 </span><span class="caption-text">The client-server model</span></p>
</div></div></blockquote>
<p>The client-server model was the first model to be used to develop networked applications. This model comes naturally from the mainframes and minicomputers that were the only networked computers used until the 1980s. A <a class="reference external" href="https://en.wikipedia.org/wiki/Minicomputer">minicomputer</a> is a multi-user system that is used by tens or more users at the same time. Each user interacts with the minicomputer by using a terminal. Such a terminal was mainly a screen, a keyboard and a cable directly connected to the minicomputer.</p>
<p>There are various types of servers as well as various types of clients. A web server provides information in response to the query sent by its clients. A print server prints documents sent as queries by the client. An email server forwards towards their recipient the email messages sent as queries while a music server delivers the music requested by the client. From the viewpoint of the application developer, the client and the server applications directly exchange messages (the horizontal arrows labeled <cite>Queries</cite> and <cite>Responses</cite> in the above figure), but in practice these messages are exchanged thanks to the underlying layers (the vertical arrows in the above figure). In this chapter, we focus on these horizontal exchanges of messages.</p>
<p>Networked applications do not exchange random messages. In order to ensure that the server is able to understand the queries sent by a client, and also that the client is able to understand the responses sent by the server, they must both agree on a set of syntactical and semantic rules. These rules define the format of the messages exchanged as well as their ordering. This set of rules is called an application-level <cite>protocol</cite>.</p>
<p>An <cite>application-level protocol</cite> is similar to a structured conversation between humans. Assume that Alice wants to know the current time but does not have a watch. If Bob passes close by, the following conversation could take place :</p>
<blockquote>
<div><ul class="simple">
<li><p>Alice : <cite>Hello</cite></p></li>
<li><p>Bob : <cite>Hello</cite></p></li>
<li><p>Alice : <cite>What time is it ?</cite></p></li>
<li><p>Bob : <cite>11:55</cite></p></li>
<li><p>Alice : <cite>Thank you</cite></p></li>
<li><p>Bob : <cite>You’re welcome</cite></p></li>
</ul>
</div></blockquote>
<p>Such a conversation succeeds if both Alice and Bob speak the same language. If Alice meets Tchang who only speaks Chinese, she won’t be able to ask him the current time. A conversation between humans can be more complex. For example, assume that Bob is a security guard whose duty is to only allow trusted secret agents to enter a meeting room. If all agents know a secret password, the conversation between Bob and Trudy could be as follows :</p>
<blockquote>
<div><ul class="simple">
<li><p>Bob : <cite>What is the secret password ?</cite></p></li>
<li><p>Trudy : <cite>1234</cite></p></li>
<li><p>Bob : <cite>This is the correct password, you’re welcome</cite></p></li>
</ul>
</div></blockquote>
<p>If Alice wants to enter the meeting room but does not know the password, her conversation could be as follows :</p>
<blockquote>
<div><ul class="simple">
<li><p>Bob : <cite>What is the secret password ?</cite></p></li>
<li><p>Alice : <cite>3.1415</cite></p></li>
<li><p>Bob : <cite>This is not the correct password.</cite></p></li>
</ul>
</div></blockquote>
<p>Human conversations can be very formal, e.g. when soldiers communicate with their hierarchy, or informal such as when friends discuss. Computers that communicate are more akin to soldiers and require well-defined rules to ensure a successful exchange of information.  There are two types of rules that define how information can be exchanged between computers :</p>
<blockquote>
<div><ul class="simple">
<li><p>Syntactical rules that precisely define the format of the messages that are exchanged. As computers only process bits, the syntactical rules specify how information is encoded as bit strings.</p></li>
<li><p>Organization of the information flow. For many applications, the flow of information must be structured and there are precedence relationships between the different types of information. In the time example above, Alice must greet Bob before asking for the current time. Alice would not ask for the current time first and greet Bob afterwards. Such precedence relationships exist in networked applications as well. For example, a server must receive a username and a valid password before accepting more complex commands from its clients.</p></li>
</ul>
</div></blockquote>
<p>Let us first discuss the syntactical rules. We will later explain how the information flow can be organized by analyzing real networked applications.</p>
<p>Application-layer protocols exchange two types of messages. Some protocols such as those used to support electronic mail exchange messages expressed as strings or lines of characters. As the transport layer allows hosts to exchange bytes, they need to agree on a common representation of the characters. The first and simplest method to encode characters is to use the <a class="reference internal" href="../glossary.html#term-ASCII"><span class="xref std std-term">ASCII</span></a> table. <span class="target" id="index-0"/><a class="rfc reference external" href="https://datatracker.ietf.org/doc/html/rfc20.html"><strong>RFC 20</strong></a> provides the ASCII table that is used by many protocols on the Internet. For example, the table defines the following binary representations :</p>
<blockquote>
<div><ul class="simple">
<li><p><cite>A</cite> : <cite>1000011b</cite></p></li>
<li><p><cite>0</cite> : <cite>0110000b</cite></p></li>
<li><p><cite>z</cite> : <cite>1111010b</cite></p></li>
<li><p><cite>@</cite> : <cite>1000000b</cite></p></li>
<li><p><cite>space</cite> : <cite>0100000b</cite></p></li>
</ul>
</div></blockquote>
<p>In addition, the <a class="reference internal" href="../glossary.html#term-ASCII"><span class="xref std std-term">ASCII</span></a> table also defines several non-printable or control characters. These characters were designed to allow an application to control a printer or a terminal. These control characters include <cite>CR</cite> and <cite>LF</cite>, that are used to terminate a line, and the <cite>Bell</cite> character which causes the terminal to emit a sound.</p>
<blockquote>
<div><ul class="simple">
<li><p><cite>carriage return</cite> (<cite>CR</cite>) : <cite>0001101b</cite></p></li>
<li><p><cite>line feed</cite> (<cite>LF</cite>) : <cite>0001010b</cite></p></li>
<li><p><cite>Bell</cite>: <cite>0000111b</cite></p></li>
</ul>
</div></blockquote>
<p>The <a class="reference internal" href="../glossary.html#term-ASCII"><span class="xref std std-term">ASCII</span></a> characters are encoded as a seven bits field, but transmitted as an eight-bits byte whose high order bit is usually set to <cite>0</cite>. Bytes are always transmitted starting from the high order or most significant bit.</p>
<p>Most applications exchange strings that are composed of fixed or variable numbers of characters. A common solution to define the character strings that are acceptable is to define them as a grammar using a Backus-Naur Form (<a class="reference internal" href="../glossary.html#term-BNF"><span class="xref std std-term">BNF</span></a>) such as the Augmented BNF defined in <span class="target" id="index-1"/><a class="rfc reference external" href="https://datatracker.ietf.org/doc/html/rfc5234.html"><strong>RFC 5234</strong></a>. A BNF is a set of production rules that generate all valid character strings. For example, consider a networked application that uses two commands, where the user can supply a username and a password. The BNF for this application could be defined as shown in <a class="reference internal" href="#fig-bnf"><span class="std std-numref">Fig. 21</span></a>.</p>
<figure class="align-center" id="id49">
<span id="fig-bnf"/><a class="reference internal image-reference" href="../_images/bnf.svg"><img alt="../_images/bnf.svg" src="../Images/c52c85ae5fb49120fd6b41bb42c81402.png" style="width: 596.0px; height: 176.0px;" data-original-src="https://4ed.computer-networking.info/syllabus/default/_images/bnf.svg"/>
</a>
<figcaption>
<p><span class="caption-number">Fig. 21 </span><span class="caption-text">A simple BNF specification</span><a class="headerlink" href="#id49" title="Link to this image">#</a></p>
</figcaption>
</figure>
<p>The example above defines several terminals and two commands : <cite>usercommand</cite> and <cite>passwordcommand</cite>. The <cite>ALPHA</cite> terminal contains all letters in upper and lower case. In the <cite>ALPHA</cite> rule, <cite>%x41</cite> corresponds to ASCII character code 41 in hexadecimal, i.e. capital <cite>A</cite>.  The <cite>CR</cite> and <cite>LF</cite> terminals correspond to the carriage return and linefeed control characters. The <cite>CRLF</cite> rule concatenates these two terminals to match the standard end of line termination. The <cite>DIGIT</cite> terminal contains all digits. The <cite>SP</cite> terminal corresponds to the white space characters. The <cite>usercommand</cite> is composed of two strings separated by white space. In the ABNF rules that define the messages used by Internet applications, the commands are case-insensitive. The rule <cite>“user”</cite> corresponds to all possible cases of the letters that compose the word between brackets, e.g. <cite>user</cite>, <cite>uSeR</cite>, <cite>USER</cite>, <cite>usER</cite>, … A <cite>username</cite> contains at least one letter and up to 8 letters. User names are case-sensitive as they are not defined as a string between brackets. The <cite>password</cite> rule indicates that a password starts with a letter and can contain any number of letters or digits. The white space and the control characters cannot appear in a <cite>password</cite> defined by the above rule.</p>
<p>Besides character strings, some applications also need to exchange 16 bits and 32 bits fields such as integers. A naive solution would have been to send the 16- or 32-bits field as it is encoded in the host’s memory. Unfortunately, there are different methods to store 16- or 32-bits fields in memory. Some CPUs store the most significant byte of a 16-bits field in the first address of the field while others store the least significant byte at this location. When networked applications running on different CPUs exchange 16 bits fields, there are two possibilities to transfer them over the transport service :</p>
<blockquote>
<div><ul class="simple">
<li><p>send the most significant byte followed by the least significant byte</p></li>
<li><p>send the least significant byte followed by the most significant byte</p></li>
</ul>
</div></blockquote>
<p>The first possibility was named  <cite>big-endian</cite> in a note written by Cohen <a class="reference internal" href="../bibliography.html#cohen1980" id="id1"><span>[Cohen1980]</span></a> while the second was named <cite>little-endian</cite>. Vendors of CPUs that used <cite>big-endian</cite> in memory insisted on using <cite>big-endian</cite> encoding in networked applications while vendors of CPUs that used <cite>little-endian</cite> recommended the opposite. Several studies were written on the relative merits of each type of encoding, but the discussion became almost a religious issue <a class="reference internal" href="../bibliography.html#cohen1980" id="id2"><span>[Cohen1980]</span></a>. Eventually, the Internet chose the <cite>big-endian</cite> encoding, i.e. multi-byte fields are always transmitted by sending the most significant byte first, <span class="target" id="index-2"/><a class="rfc reference external" href="https://datatracker.ietf.org/doc/html/rfc791.html"><strong>RFC 791</strong></a> refers to this encoding as the <a class="reference internal" href="../glossary.html#term-network-byte-order"><span class="xref std std-term">network-byte order</span></a>. Most libraries <a class="footnote-reference brackets" href="#fhtonl" id="id3" role="doc-noteref"><span class="fn-bracket">[</span>9<span class="fn-bracket">]</span></a> used to write networked applications contain functions to convert multi-byte fields from memory to the network byte order and the reverse.</p>
<p>Besides 16 and 32 bit words, some applications need to exchange data structures containing bit fields of various lengths. For example, a message may be composed of a 16 bits field followed by eight, one bit flags, a 24 bits field and two 8 bits bytes. Internet protocol specifications will define such a message by using a representation such as <a class="reference internal" href="#fig-internet-packet"><span class="std std-numref">Fig. 22</span></a>. In this representation, each line corresponds to 32 bits and the vertical lines are used to delineate fields. The numbers above the lines indicate the bit positions in the 32-bits word, with the high order bit at position <cite>0</cite>.</p>
<figure class="align-center" id="id50">
<span id="fig-internet-packet"/><a class="reference internal image-reference" href="../_images/message.svg"><img alt="../_images/message.svg" src="../Images/1e419bbcd4d8ea7928e96e2cb5aacb0b.png" style="width: 571.0px; height: 128.0px;" data-original-src="https://4ed.computer-networking.info/syllabus/default/_images/message.svg"/>
</a>
<figcaption>
<p><span class="caption-number">Fig. 22 </span><span class="caption-text">Message format</span><a class="headerlink" href="#id50" title="Link to this image">#</a></p>
</figcaption>
</figure>
<p>The message mentioned above will be transmitted starting from the upper 32-bits word in network byte order. The first field is encoded in 16 bits. It is followed by eight one bit flags (<cite>A-H</cite>), a 24 bits field whose high order byte is shown in the first line and the two low order bytes appear in the second line followed by two one byte fields. This ASCII representation is frequently used when defining binary protocols. We will use it for all the binary protocols that are discussed in this book.</p>
<p id="index-3">The peer-to-peer model emerged during the last ten years as another possible architecture for networked applications. In the traditional client-server model, hosts act either as servers or as clients and a server serves a large number of clients. In the peer-to-peer model, all hosts act as both servers and clients and they play both roles. The peer-to-peer model has been used to develop various networked applications, ranging from Internet telephony to file sharing or Internet-wide filesystems. A detailed description of peer-to-peer applications may be found in <a class="reference internal" href="../bibliography.html#byl2008" id="id4"><span>[BYL2008]</span></a>. Surveys of peer-to-peer protocols and applications may be found in <a class="reference internal" href="../bibliography.html#as2004" id="id5"><span>[AS2004]</span></a> and <a class="reference internal" href="../bibliography.html#lcp2005" id="id6"><span>[LCP2005]</span></a>.</p>
<section id="naming-and-addressing">
<span id="naming"/><span id="index-4"/><h2>Naming and addressing<a class="headerlink" href="#naming-and-addressing" title="Link to this heading">#</a></h2>
<p>The network and the transport layers rely on addresses that are encoded as fixed-size bit strings. A network layer address uniquely identifies a host. Several transport layer entities can use the service of the same network layer. For example, a reliable transport protocol and a connectionless transport protocol can coexist on the same host. In this case, the network layer multiplexes the segments produced by these two protocols. This multiplexing is usually achieved by placing in the network packet header a field that indicates which transport protocol should process the segment. Given that there are few different transport protocols, this field does not need to be long. The port numbers play a similar role in the transport layer since they enable it to multiplex data from several application processes.</p>
<p>While addresses are natural for the network and transport layer entities, humans prefer to use names when interacting with network services. Names can be encoded as a character string, and a mapping service allows applications to map a name into the corresponding address. Using names is friendlier for humans, but it also provides a level of indirection which is very useful in many situations.</p>
<p>In the early days of the Internet, only a few hosts (mainly minicomputers) were connected to the network. The most popular applications were <a class="reference internal" href="../glossary.html#term-remote-login"><span class="xref std std-term">remote login</span></a> and file transfer. By 1983, there were already five hundred hosts attached to the Internet <a class="reference internal" href="../bibliography.html#zakon" id="id7"><span>[Zakon]</span></a>. Each of these hosts was identified by a unique address. Forcing human users to remember the addresses of the hosts that they wanted to use was not user-friendly. Humans prefer to remember names and use them when needed. Using names as aliases for addresses is a common technique in Computer Science. It simplifies the development of applications and allows the developer to ignore the low-level details. For example, by using a programming language instead of writing machine code, a developer can write software without knowing whether the variables that it uses are stored in memory or inside registers.</p>
<p>Because names are at a higher level than addresses, they allow (both in the example of programming above and on the Internet) to treat addresses as mere technical identifiers, which can change at will. Only the names are stable.</p>
<p id="index-5">The first solution that allowed applications to use names was the <a class="reference internal" href="../glossary.html#term-hosts.txt"><span class="xref std std-term">hosts.txt</span></a> file. This file is similar to the symbol table found in compiled code. It contains the mapping between the name of each Internet host and its associated address <a class="footnote-reference brackets" href="#fhosts" id="id8" role="doc-noteref"><span class="fn-bracket">[</span>1<span class="fn-bracket">]</span></a>. It was maintained by the SRI International Network Information Center (NIC). When a new host was connected to the network, the system administrator had to register its name and address at the NIC. The NIC updated the <a class="reference internal" href="../glossary.html#term-hosts.txt"><span class="xref std std-term">hosts.txt</span></a> file on its server. All Internet hosts regularly retrieved the updated <a class="reference internal" href="../glossary.html#term-hosts.txt"><span class="xref std std-term">hosts.txt</span></a> file from the <a class="reference external" href="https://www.sri.com">SRI</a> server. This file was stored at a well-known location on each Internet host (see <span class="target" id="index-6"/><a class="rfc reference external" href="https://datatracker.ietf.org/doc/html/rfc952.html"><strong>RFC 952</strong></a>) and networked applications could use it to find the address corresponding to a name.</p>
<p>A <a class="reference internal" href="../glossary.html#term-hosts.txt"><span class="xref std std-term">hosts.txt</span></a> file can be used when there are up to a few hundred hosts on the network. However, it is clearly not suitable for a network containing thousands or millions of hosts. A key issue in a large network is to define a suitable naming scheme. The ARPANet initially used a flat naming space, i.e. each host was assigned a unique name. To limit collisions between names, these names usually contained the name of the institution and a suffix to identify the host inside the institution (a kind of poor man’s hierarchical naming scheme). On the ARPANet, few institutions had several hosts connected to the network.</p>
<p>However, the limitations of a flat naming scheme became clear before the end of the ARPANet, and <span class="target" id="index-7"/><a class="rfc reference external" href="https://datatracker.ietf.org/doc/html/rfc819.html"><strong>RFC 819</strong></a> proposed a hierarchical naming scheme. While <span class="target" id="index-8"/><a class="rfc reference external" href="https://datatracker.ietf.org/doc/html/rfc819.html"><strong>RFC 819</strong></a> discussed the possibility of organizing the names as a directed graph, the Internet opted for a tree structure capable of containing all names. In this tree, the top-level domains are those that are directly attached to the root. The first top-level domain was <cite>.arpa</cite> <a class="footnote-reference brackets" href="#fdnstimeline" id="id9" role="doc-noteref"><span class="fn-bracket">[</span>2<span class="fn-bracket">]</span></a>. This top-level name was initially added as a suffix to the names of the hosts attached to the ARPANet and listed in the <cite>hosts.txt</cite> file. In 1984, the <cite>.gov</cite>, <cite>.edu</cite>, <cite>.com</cite>, <cite>.mil</cite>, and <cite>.org</cite> generic top-level domain names were added. <span class="target" id="index-9"/><a class="rfc reference external" href="https://datatracker.ietf.org/doc/html/rfc1032.html"><strong>RFC 1032</strong></a> proposed the utilization of the two-letter <a class="reference internal" href="../glossary.html#term-ISO-3166"><span class="xref std std-term">ISO-3166</span></a> country codes as top-level domain names. Since <a class="reference internal" href="../glossary.html#term-ISO-3166"><span class="xref std std-term">ISO-3166</span></a> defines a two-letter code for each country recognized by the United Nations, this allowed all countries to automatically have a top-level domain. These domains include <cite>.be</cite> for Belgium, <cite>.fr</cite> for France, <cite>.us</cite> for the USA, <cite>.ie</cite> for Ireland, or <cite>.tv</cite> for Tuvalu, a group of small islands in the Pacific, or <cite>.tm</cite> for Turkmenistan. The set of top-level domain names is managed by the Internet Corporation for Assigned Names and Numbers (<a class="reference internal" href="../glossary.html#term-ICANN"><span class="xref std std-term">ICANN</span></a>). <a class="reference internal" href="../glossary.html#term-ICANN"><span class="xref std std-term">ICANN</span></a> adds generic top-level domains that are not related to a country, and the <cite>.cat</cite> top-level domain has been registered for the Catalan language. There are ongoing discussions within <a class="reference internal" href="../glossary.html#term-ICANN"><span class="xref std std-term">ICANN</span></a> to increase the number of top-level domains.</p>
<p>Each top-level domain is managed by an organization that decides how subdomain names can be registered. Most top-level domain names use a first-come, first-served system and allow anyone to register domain names, but there are some exceptions. For example, <cite>.gov</cite> is reserved for the US government, <cite>.int</cite> is reserved for international organizations, and names in the <cite>.ca</cite> are mainly <a class="reference external" href="http://en.wikipedia.org/wiki/.ca">reserved</a> for companies or users that are present in Canada.</p>
<div class="figure" id="id51" style="text-align: center"><p><img src="../Images/28e49f48398377711717aaa96d6ec501.png" alt="Figure made with TikZ" data-original-src="https://4ed.computer-networking.info/syllabus/default/_images/tikz-265d61a849902ef0108e787463bece1439793242.png"/></p>
<p><span class="caption-number">Fig. 23 </span><span class="caption-text">The tree of domain names</span></p>
</div><p>The syntax of the domain names has been defined more precisely in
<span class="target" id="index-10"/><a class="rfc reference external" href="https://datatracker.ietf.org/doc/html/rfc1035.html"><strong>RFC 1035</strong></a>. This document recommends
the following <a class="reference internal" href="../glossary.html#term-BNF"><span class="xref std std-term">BNF</span></a> for fully qualified
domain names (the domain names themselves have a much richer syntax).</p>
<div class="literal-block-wrapper docutils container" id="id52">
<div class="code-block-caption"><span class="caption-number">Listing 1 </span><span class="caption-text">BNF of the fully qualified host names</span><a class="headerlink" href="#id52" title="Link to this code">#</a></div>
<div class="highlight-abnf notranslate"><div class="highlight"><pre><span/><span class="nc">domain</span><span class="w"> </span>::<span class="o">=</span><span class="w"> </span><span class="nc">subdomain</span><span class="w"> </span>|<span class="w"> </span><span class="l">" "</span>
<span class="nc">subdomain</span><span class="w"> </span>::<span class="o">=</span><span class="w"> </span><span class="nc">label</span><span class="w"> </span>|<span class="w"> </span><span class="nc">subdomain</span><span class="w"> </span><span class="l">"."</span><span class="w"> </span><span class="nc">label</span>
<span class="nc">label</span><span class="w"> </span>::<span class="o">=</span><span class="w"> </span><span class="nc">letter</span><span class="w"> </span><span class="p">[</span><span class="w"> </span><span class="p">[</span><span class="w"> </span><span class="nc">ldh-str</span><span class="w"> </span><span class="p">]</span><span class="w"> </span><span class="nc">let-dig</span><span class="w"> </span><span class="p">]</span>
<span class="nc">ldh-str</span><span class="w"> </span>::<span class="o">=</span><span class="w"> </span><span class="nc">let-dig-hyp</span><span class="w"> </span>|<span class="w"> </span><span class="nc">let-dig-hyp</span><span class="w"> </span><span class="nc">ldh-str</span>
<span class="nc">let-dig-hyp</span><span class="w"> </span>::<span class="o">=</span><span class="w"> </span><span class="nc">let-dig</span><span class="w"> </span>|<span class="w"> </span><span class="l">"-"</span>
<span class="nc">let-dig</span><span class="w"> </span>::<span class="o">=</span><span class="w"> </span><span class="nc">letter</span><span class="w"> </span>|<span class="w"> </span><span class="nc">digit</span>
<span class="nc">letter</span><span class="w"> </span>::<span class="o">=</span><span class="w"> </span><span class="nc">any</span><span class="w"> </span><span class="nc">one</span><span class="w"> </span><span class="nc">of</span><span class="w"> </span><span class="nc">the</span><span class="w"> </span><span class="o">52</span><span class="w"> </span><span class="nc">alphabetic</span><span class="w"> </span><span class="nc">characters</span><span class="w"> </span><span class="nc">A</span><span class="w"> </span><span class="nc">through</span><span class="w"> </span><span class="nc">Z</span><span class="w"> </span><span class="nc">in</span><span class="w"> </span><span class="nc">upper</span><span class="w"> </span><span class="nc">case</span><span class="w"> </span><span class="nc">and</span><span class="w"> </span><span class="nc">a</span><span class="w"> </span><span class="nc">through</span><span class="w"> </span><span class="nc">z</span><span class="w"> </span><span class="nc">in</span><span class="w"> </span><span class="nc">lower</span><span class="w"> </span><span class="nc">case</span>
<span class="nc">digit</span><span class="w"> </span>::<span class="o">=</span><span class="w"> </span><span class="nc">any</span><span class="w"> </span><span class="nc">one</span><span class="w"> </span><span class="nc">of</span><span class="w"> </span><span class="nc">the</span><span class="w"> </span><span class="nc">ten</span><span class="w"> </span><span class="nc">digits</span><span class="w"> </span><span class="o">0</span><span class="w"> </span><span class="nc">through</span><span class="w"> </span><span class="o">9</span>
</pre></div>
</div>
</div>
<p>This grammar specifies that a host name is an ordered list of labels separated by the dot (<cite>.</cite>) character. Each label can contain letters, numbers, and the hyphen character (<cite>-</cite>) <a class="footnote-reference brackets" href="#fidn" id="id10" role="doc-noteref"><span class="fn-bracket">[</span>3<span class="fn-bracket">]</span></a>. Fully qualified domain names are read from left to right. The first label is a hostname or a domain name followed by the hierarchy of domains and ending with the root implicitly at the right. The top-level domain name must be one of the registered TLDs <a class="footnote-reference brackets" href="#ftld" id="id11" role="doc-noteref"><span class="fn-bracket">[</span>4<span class="fn-bracket">]</span></a>. For example, in the above figure, <cite>www.computer-networking.info</cite> corresponds to a host named <cite>www</cite> inside the <cite>computer-networking</cite> domain that belongs to the <cite>info</cite> top-level domain.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Some visually similar characters have different character codes</p>
<p>The Domain Name System was created at a time when the Internet was mainly used in North America. The initial design assumed that all domain names would be composed of letters and digits <span class="target" id="index-11"/><a class="rfc reference external" href="https://datatracker.ietf.org/doc/html/rfc1035.html"><strong>RFC 1035</strong></a>. As Internet usage grew in other parts of the world, it became important to support non-ASCII characters. For this, extensions have been proposed to the Domain Name System <span class="target" id="index-12"/><a class="rfc reference external" href="https://datatracker.ietf.org/doc/html/rfc3490.html"><strong>RFC 3490</strong></a>. In a nutshell, the solution that is used to support Internationalized Domain Names works as follows. First, it is possible to use most of the Unicode characters to encode domain names and hostnames, with a few exceptions (for example, the dot character cannot be part of a name since it is used as a separator). Once a domain name has been encoded as a series of Unicode characters, it is then converted into a string that contains the <code class="docutils literal notranslate"><span class="pre">xn--</span></code> prefix and a sequence of ASCII characters. More details on these algorithms can be found in <span class="target" id="index-13"/><a class="rfc reference external" href="https://datatracker.ietf.org/doc/html/rfc3490.html"><strong>RFC 3490</strong></a> and <span class="target" id="index-14"/><a class="rfc reference external" href="https://datatracker.ietf.org/doc/html/rfc3492.html"><strong>RFC 3492</strong></a>.</p>
<p>The possibility of using all Unicode characters to create domain names opened a new form of attack called the <a class="reference external" href="https://en.wikipedia.org/wiki/IDN_homograph_attack">homograph attack</a>. This attack occurs when two character strings or domain names are visually similar but do not correspond to the same server. A simple example is <a class="reference external" href="https://G00GLE.COM">https://G00GLE.COM</a> and <a class="reference external" href="https://GOOGLE.COM">https://GOOGLE.COM</a>. These two URLs are visually close but they correspond to different names (the first one does not point to a valid server <a class="footnote-reference brackets" href="#fg00gle" id="id12" role="doc-noteref"><span class="fn-bracket">[</span>5<span class="fn-bracket">]</span></a>). With other Unicode characters, it is possible to construct domain names that are visually equivalent to existing ones. See <a class="reference internal" href="../bibliography.html#zhe2017" id="id13"><span>[Zhe2017]</span></a> for additional details on this attack.</p>
</div>
<p>This hierarchical naming scheme is a key component of the Domain Name System (DNS). The DNS is a distributed database that contains mappings between fully qualified domain names and addresses. The DNS uses the client-server model. The clients are hosts or applications that need to retrieve the mapping for a given name. Each <a class="reference internal" href="../glossary.html#term-nameserver"><span class="xref std std-term">nameserver</span></a> stores part of the distributed database and answers the queries sent by clients. There is at least one <a class="reference internal" href="../glossary.html#term-nameserver"><span class="xref std std-term">nameserver</span></a> that is responsible for each domain. In the figure below, domains are represented by circles and there are three hosts inside domain <cite>dom</cite> (<cite>h1</cite>, <cite>h2</cite>, and <cite>h3</cite>) and three hosts inside domain <cite>a.sdom1.dom</cite>. As shown in the figure below, a sub-domain may contain both host names and sub-domains.</p>
<div class="figure" id="id53" style="text-align: center"><p><img src="../Images/7989bbb8be7d75c8e85246fc80c86c13.png" alt="Figure made with TikZ" data-original-src="https://4ed.computer-networking.info/syllabus/default/_images/tikz-d7ddf201364b12c4f9f6121e1c3a4ee07870ed7f.png"/></p>
<p><span class="caption-number">Fig. 24 </span><span class="caption-text">A simple tree of domain names</span></p>
</div><p>A <a class="reference internal" href="../glossary.html#term-nameserver"><span class="xref std std-term">nameserver</span></a> that is responsible for domain <cite>dom</cite> can directly answer the following queries :</p>
<blockquote>
<div><ul class="simple">
<li><p>the address of any host residing directly inside domain <cite>dom</cite> (e.g. <cite>h2.dom</cite> in the figure above)</p></li>
<li><p>the nameserver(s) that are responsible for any direct sub-domain of domain <cite>dom</cite> (i.e. <cite>sdom1.dom</cite> and <cite>sdom2.dom</cite> in the figure above, but not <cite>z.sdom1.dom</cite>)</p></li>
</ul>
</div></blockquote>
<p>To retrieve the mapping for host <cite>h2.dom</cite>, a client sends its query to the name server that is responsible for the domain <cite>.dom</cite>. The name server directly answers the query. To retrieve a mapping for <cite>h3.a.sdom1.dom</cite>, a DNS client first sends a query to the name server that is responsible for the <cite>.dom</cite> domain. This nameserver returns the nameserver that is responsible for the <cite>sdom1.dom</cite> domain. This nameserver can now be contacted to obtain the nameserver that is responsible for the <cite>a.sdom1.dom</cite> domain. This nameserver can be contacted to retrieve the mapping for the <cite>h3.a.sdom1.dom</cite> name. Thanks to this structure, it is possible for a DNS client to obtain the mapping of any host inside the <cite>.dom</cite> domain or any of its subdomains. To ensure that any DNS client will be able to resolve any fully qualified domain name, there are special nameservers that are responsible for the root of the domain name hierarchy. These nameservers are called <a class="reference internal" href="../glossary.html#term-root-nameserver"><span class="xref std std-term">root nameserver</span></a>.</p>
<p>Each root nameserver maintains the list <a class="footnote-reference brackets" href="#froot" id="id14" role="doc-noteref"><span class="fn-bracket">[</span>6<span class="fn-bracket">]</span></a> of all the nameservers that are responsible for each of the top-level domain names and their addresses <a class="footnote-reference brackets" href="#frootv6" id="id15" role="doc-noteref"><span class="fn-bracket">[</span>7<span class="fn-bracket">]</span></a>. All root nameservers cooperate and provide the same answers. By querying any of the root nameservers, a DNS client can obtain the nameserver that is responsible for any top-level-domain name. From this nameserver, it is possible to resolve any domain name.</p>
<p>To be able to contact the root nameservers, each DNS client must know their addresses. This implies that DNS clients must maintain an up-to-date list of the addresses of the root nameservers. Without this list, it is impossible to contact the root nameservers. Forcing all Internet hosts to maintain the most recent version of this list would be difficult from an operational point of view. To solve this problem, the designers of the DNS introduced a special type of DNS server : the DNS resolvers. A <a class="reference internal" href="../glossary.html#term-resolver"><span class="xref std std-term">resolver</span></a> is a server that provides the name resolution service for a set of clients. A network usually contains a few resolvers. Each host in these networks is configured to send all its DNS queries via one of its local resolvers. These queries are called <cite>recursive queries</cite> as the <a class="reference internal" href="../glossary.html#term-resolver"><span class="xref std std-term">resolver</span></a> must recursively send requests through the hierarchy of nameservers to obtain the <cite>answer</cite>.</p>
<p>DNS resolvers have several advantages over letting each Internet host query directly nameservers. Firstly, regular Internet hosts do not need to maintain the up-to-date list of the addresses of the root servers. Secondly, regular Internet hosts do not need to send queries to nameservers all over the Internet. Furthermore, as a DNS resolver serves a large number of hosts, it can cache the received answers. This allows the resolver to quickly return answers for popular DNS queries and reduces the load on all DNS servers <a class="reference internal" href="../bibliography.html#jsbm2002" id="id16"><span>[JSBM2002]</span></a>.</p>
<section id="benefits-of-names">
<h3>Benefits of names<a class="headerlink" href="#benefits-of-names" title="Link to this heading">#</a></h3>
<p>In addition to being more human-friendly, using names instead of addresses inside applications has several important benefits. To understand them, let us consider a popular application that provides information stored on servers. This application involves clients and servers. The server provides information upon requests from client processes. A first deployment of this application would be to rely only on addresses. In this case, the server process would be installed on one host, and the clients would connect to this server to retrieve information. Such a deployment has several drawbacks :</p>
<blockquote>
<div><ul class="simple">
<li><p>if the server process moves to another physical server, all clients must be informed about the new server address.</p></li>
<li><p>if there are many concurrent clients, the load of the server will increase without any possibility of adding another server without changing the server addresses used by the clients.</p></li>
</ul>
</div></blockquote>
<p>Using names solves these problems and provides additional benefits. If the clients are configured with the name of the server, they will query the name service before contacting the server. The name service will resolve the name into the corresponding address. If a server process needs to move from one physical server to another, it suffices to update the name-to-address mapping on the name service to allow all clients to connect to the new server. The name service also enables the servers to better sustain the load. Assume a very popular server which is accessed by millions of users. This service cannot be provided by a single physical server due to performance limitations. Thanks to the utilization of names, it is possible to scale this service by mapping a given name to a set of addresses. When a client queries the name service for the server’s name, the name service returns one of the addresses in the set. Various strategies can be used to select one particular address inside the set of addresses. A first strategy is to select a random address in the set. A second strategy is to maintain information about the load on the servers and return the address of the less loaded server. Note that the list of server addresses does not need to remain fixed. It is possible to add and remove addresses from the list to cope with load fluctuations. Another strategy is to infer the location of the client from the name request and return the address of the closest server.</p>
<p>Mapping a single name onto a set of addresses allows popular servers to dynamically scale. There are also benefits in mapping multiple names, possibly a large number of them, onto a single address. Consider the case of information servers run by individuals or SMEs. Some of these servers attract only a few clients per day. Using a single physical server for each of these services would be a waste of resources. A better approach is to use a single server for a set of services that are all identified by different names. This enables service providers to support a large number of server processes, identified by different names, onto a single physical server. If one of these server processes becomes very popular, it will be possible to map its name onto a set of addresses to be able to sustain the load. There are some deployments where this mapping is done dynamically in function of the load.</p>
<p>Names provide a lot of flexibility compared to addresses. For the network, they play a similar role as variables in programming languages. No programmer using a high-level programming language would consider using hardcoded values instead of variables. For the same reasons, all networked applications should depend on names and avoid dealing with addresses as much as possible.</p>
</section>
<section id="the-domain-name-system">
<span id="dns"/><h3>The Domain Name System<a class="headerlink" href="#the-domain-name-system" title="Link to this heading">#</a></h3>
<p>The last component of the Domain Name System is the DNS protocol. The original DNS protocol runs above both the datagram and the bytestream services. In practice, the datagram service is used when short queries and responses are exchanged, and the bytestream service is used when longer responses are expected. In this section, we first focus on the utilization of the DNS protocol above the datagram service. We will discuss later other recently proposed protocols to carry DNS information.</p>
<p id="index-15">DNS messages are composed of five parts that are named sections in RFC :<cite>1035</cite>. The first three sections are mandatory, and the last two sections are optional. The first section of a DNS message is its <cite>Header</cite>. It contains information about the message type and the content of the other sections. The second section contains the <cite>Question</cite> sent to the nameserver or resolver. The third section contains the <cite>Answer</cite> to the <cite>Question</cite>. When a client sends a DNS query, the <cite>Answer</cite> section is empty. The fourth section, named <cite>Authority</cite>, contains information about the servers that can provide an authoritative answer if required. The last section contains additional information that is supplied by the resolver or nameserver but was not requested in the question.</p>
<p>The header of DNS messages is composed of 12 bytes. The figure below presents its structure.</p>
<figure class="align-center" id="id54">
<a class="reference internal image-reference" href="../_images/dnsheader.svg"><img alt="../_images/dnsheader.svg" src="../Images/21a7bad41190434264bf8afe39a2de6a.png" style="width: 445.0px; height: 256.0px;" data-original-src="https://4ed.computer-networking.info/syllabus/default/_images/dnsheader.svg"/>
</a>
<figcaption>
<p><span class="caption-number">Fig. 25 </span><span class="caption-text">The DNS header</span><a class="headerlink" href="#id54" title="Link to this image">#</a></p>
</figcaption>
</figure>
<p>The <cite>Transaction ID</cite> (transaction identifier) is a 16-bit random value chosen by the client.
When a client sends a question to a DNS server, it remembers the question and its identifier. When a server returns an answer, it returns in the <cite>Transaction ID</cite> field the identifier chosen by the client. Thanks to this identifier, the client can match the received answer with the question that it sent.</p>
<p>The DNS header contains a series of flags. The <cite>QR</cite> flag is used to distinguish between queries and responses. It is set to <cite>0</cite> in DNS queries and <cite>1</cite> in DNS answers. The <cite>Opcode</cite> is used to specify the query type. For instance, a <a class="reference internal" href="../glossary.html#term-standard-query"><span class="xref std std-term">standard query</span></a> is used when a client sends a <cite>name</cite> and the server returns the corresponding <cite>data</cite>. An update request is used when the client sends a <cite>name</cite> and new <cite>data</cite>, and the server then updates its database.</p>
<p>The <cite>AA</cite> bit is set when the server that sent the response has <cite>authority</cite> for the domain name found in the question section. In the original DNS deployments, two types of servers were considered : <cite>authoritative</cite> servers and <cite>non-authoritative</cite> servers. The <cite>authoritative</cite> servers are managed by the system administrators responsible for a given domain. They always store the most recent information about a domain. <cite>Non-authoritative</cite> servers are servers or resolvers that store DNS information about external domains without being managed by the owners of a domain. They may thus provide answers that are out of date. From a security point of view, the <cite>authoritative</cite> bit is not an absolute indication about the validity of an answer. Securing the Domain Name System is a complex problem that was only addressed satisfactorily recently by the utilization of cryptographic signatures in the DNSSEC extensions to DNS described in : RFC:<cite>4033</cite>.</p>
<p>The <cite>RD</cite> (recursion desired) bit is set by a client when it sends a query to a resolver. Such a query is said to be <cite>recursive</cite> because the resolver will recursively traverse the DNS hierarchy to retrieve the answer on behalf of the client. In the past, all resolvers were configured to perform recursive queries on behalf of any Internet host. However, this exposes the resolvers to several security risks. The simplest one is that the resolver could become overloaded by having too many recursive queries to process. Most resolvers <a class="footnote-reference brackets" href="#f8888" id="id17" role="doc-noteref"><span class="fn-bracket">[</span>8<span class="fn-bracket">]</span></a> only allow recursive queries from clients belonging to their company or network and discard all other recursive queries. The <cite>RA</cite> bit indicates whether the server supports recursion. The <cite>RCODE</cite> is used to distinguish between different types of errors. See : RFC:<cite>1035</cite> for additional details. The last four fields indicate the size of the <cite>Question</cite>, <cite>Answer</cite>, <cite>Authority</cite>, and <cite>Additional</cite> sections of the DNS message.</p>
<p>The last four sections of the DNS message contain <cite>Resource Records</cite> (RR).  All RRs have the same top-level format shown in the figure below.</p>
<figure class="align-center" id="id55">
<a class="reference internal image-reference" href="../_images/dnsrr.svg"><img alt="../_images/dnsrr.svg" src="../Images/a838af70f19f03e6cc3645b1c9e8591e.png" style="width: 445.0px; height: 320.0px;" data-original-src="https://4ed.computer-networking.info/syllabus/default/_images/dnsrr.svg"/>
</a>
<figcaption>
<p><span class="caption-number">Fig. 26 </span><span class="caption-text">DNS Resource Records</span><a class="headerlink" href="#id55" title="Link to this image">#</a></p>
</figcaption>
</figure>
<p>In a <cite>Resource Record</cite> (<cite>RR</cite>), the <cite>Name</cite> indicates the name of the node to which this resource record pertains. The two-byte <cite>Type</cite> field indicates the type of resource record. The <cite>Class</cite> field was used to support the utilization of the DNS in other environments than the Internet. The <cite>IN</cite> <cite>Class</cite> refers to Internet names.</p>
<p>The <cite>TTL</cite> field indicates the lifetime of the <cite>Resource Record</cite> in seconds. This field is set by the server that returns an answer and indicates for how long a client or a resolver can store the <cite>Resource Record</cite> inside its cache. A long <cite>TTL</cite> indicates a stable <cite>RR</cite>. Some companies use short <cite>TTL</cite> values for mobile hosts and also for popular servers. For example, a web hosting company that wants to spread the load over a pool of hundred servers can configure its nameservers to return different answers to different clients. If each answer has a small <cite>TTL</cite>, the clients will be forced to send DNS queries regularly. The nameserver will reply to these queries by supplying the address of the less loaded server.</p>
<p>The <cite>RDLength</cite> field is the length of the <cite>RData</cite> field that contains the information of the type specified in the <cite>Type</cite> field.</p>
<p>Several types of DNS RR are used in practice. The <cite>A</cite> type encodes the IPv4 address that corresponds to the specified name. The <cite>AAAA</cite> type encodes the IPv6 address that corresponds to the specified name. A <cite>NS</cite> record contains the name of the DNS server that is responsible for a given domain. For example, a query for the <cite>AAAA</cite> record associated with the <cite>www.ietf.org</cite> name returned the following answer:</p>
<figure class="align-center" id="id56">
<img alt="../_images/dns6-www-ietf-org.svg" src="../Images/2a132b4acb2d03e996f683289606e16b.png" data-original-src="https://4ed.computer-networking.info/syllabus/default/_images/dns6-www-ietf-org.svg"/>
<figcaption>
<p><span class="caption-number">Fig. 27 </span><span class="caption-text">Query for the <cite>AAAA</cite> record of <cite>www.ietf.org</cite></span><a class="headerlink" href="#id56" title="Link to this image">#</a></p>
</figcaption>
</figure>
<p>This answer contains several pieces of information. First, the name <cite>www.ietf.org</cite> is associated with the IP address <cite>2001:1890:123a::1:1e</cite>. Second, the <cite>ietf.org</cite> domain is managed by six different nameservers. Five of these nameservers are reachable via IPv4 and IPv6.</p>
<p><cite>CNAME</cite> (or canonical names) are used to define aliases. For example, <cite>www.example.com</cite> could be a <cite>CNAME</cite> for <cite>pc12.example.com</cite>, which is the actual name of the server on which the web server for <cite>www.example.com</cite> runs.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Reverse DNS</p>
<p>The DNS is mainly used to find the address that corresponds to a given name. However, it is sometimes useful to obtain the name that corresponds to an IP address. This is done by using the <cite>PTR</cite> (<cite>pointer</cite>) <cite>RR</cite>. The <cite>RData</cite> part of a <cite>PTR</cite> <cite>RR</cite> contains the name while the <cite>Name</cite> part of the <cite>RR</cite> contains the IP address encoded in the <cite>in-addr.arpa</cite> domain. IPv4 addresses are encoded in the <cite>in-addr.arpa</cite> by reversing the four digits that compose the dotted decimal representation of the address. For example, consider IPv4 address <cite>192.0.2.11</cite>. The hostname associated to this address can be found by requesting the <cite>PTR</cite> <cite>RR</cite> that corresponds to <cite>11.2.0.192.in-addr.arpa</cite>.
A similar solution is used to support IPv6 addresses : RFC:<cite>3596</cite>, but slightly more complex given the length of the IPv6 addresses. For example, consider IPv6 address <cite>2001:1890:123a::1:1e</cite>. To obtain the name that corresponds to this address, we need first to convert it in a reverse dotted decimal notation : <cite>e.1.0.0.1.0.0.0.0.0.0.0.0.0.0.0.0.0.0.a.3.2.1.0.9.8.1.1.0.0.2</cite>. In this notation, each character between dots corresponds to one nibble, i.e. four bits. The low-order byte (<cite>e</cite>) appears first and the high order (<cite>2</cite>) last. To obtain the name that corresponds to this address, one needs to append the <cite>ip6.arpa</cite> domain name and query for <cite>e.1.0.0.1.0.0.0.0.0.0.0.0.0.0.0.0.0.0.0.a.3.2.1.0.9.8.1.1.0.0.2.ip6.arpa</cite>. In practice, tools and libraries do the conversion automatically and the user does not need to worry about it.</p>
</div>
<p>An important point to note regarding the Domain Name System is that it is extensible. Thanks to the <cite>Type</cite> and <cite>RDLength</cite> fields, the format of the Resource Records can easily be extended. Furthermore, a DNS implementation that receives a new Resource Record that it does not understand can ignore the record while still being able to process the other parts of the message. This allows, for example, a DNS server that only supports IPv6 to
safely ignore the IPv4 addresses listed in the DNS reply for <cite>www.ietf.org</cite> while still being able to correctly parse the Resource Records that it understands. This allowed the Domain Name System to evolve over the years while still preserving the backward compatibility with already deployed DNS implementations.</p>
</section>
</section>
<section id="electronic-mail">
<span id="email"/><h2>Electronic mail<a class="headerlink" href="#electronic-mail" title="Link to this heading">#</a></h2>
<p>Electronic mail, or email, is a very popular application in computer networks such as the Internet. Email <a class="reference external" href="http://openmap.bbn.com/~tomlinso/ray/firstemailframe.html">appeared</a> in the early 1970s and allows users to exchange text based messages. Initially, it was mainly used to exchange short messages, but over the years its usage has grown. It is now not only used to exchange small, but also long messages that can be composed of several parts as we will see later.</p>
<p>Before looking at the details of Internet email, let us consider a simple scenario illustrated in <a class="reference internal" href="#fig-email-arch"><span class="std std-numref">Fig. 28</span></a>, where Alice sends an email to Bob. Alice prepares her email by using an <a class="reference external" href="https://en.wikipedia.org/wiki/Comparison_of_email_clients">email clients</a> and sends it to her email server. Alice’s <a class="reference external" href="http://en.wikipedia.org/wiki/Comparison_of_mail_servers">email server</a> extracts Bob’s address from the email and delivers the message to Bob’s server. Bob retrieves Alice’s message on his server and reads it by using his favorite email client or through his webmail interface.</p>
<blockquote>
<div><div class="figure" id="id57" style="text-align: center">
<span id="fig-email-arch"/><p><img src="../Images/1de029c587cbf6cfd571cb993682463a.png" alt="Figure made with TikZ" data-original-src="https://4ed.computer-networking.info/syllabus/default/_images/tikz-d532eeba6ea7ce06137fa6534176a8b85b2baf8e.png"/></p>
<p><span class="caption-number">Fig. 28 </span><span class="caption-text">Simplified architecture of the Internet email</span></p>
</div></div></blockquote>
<p>The email system that we consider in this book is composed of four components :</p>
<blockquote>
<div><ul class="simple">
<li><p>a message format, that defines how valid email messages are encoded</p></li>
<li><p>protocols, that allow hosts and servers to exchange email messages</p></li>
<li><p>client software, that allows users to easily create and read email messages</p></li>
<li><p>software, that allows servers to efficiently exchange email messages</p></li>
</ul>
</div></blockquote>
<p>We first discuss the format of email messages followed by the protocols that are used on today’s Internet to exchange and retrieve emails. Other email systems have been developed in the past <a class="reference internal" href="../bibliography.html#bush1993" id="id18"><span>[Bush1993]</span></a> <a class="reference internal" href="../bibliography.html#genilloud1990" id="id19"><span>[Genilloud1990]</span></a> <a class="reference internal" href="../bibliography.html#gc2000" id="id20"><span>[GC2000]</span></a>, but today most email solutions have migrated to the Internet email. Information about the software that is used to compose and deliver emails may be found on <a class="reference external" href="https://en.wikipedia.org">wikipedia</a> among others, for both <a class="reference external" href="https://en.wikipedia.org/wiki/Comparison_of_email_clients">email clients</a> and <a class="reference external" href="http://en.wikipedia.org/wiki/Comparison_of_mail_servers">email servers</a>. More detailed information about the full Internet Mail Architecture may be found in <span class="target" id="index-16"/><a class="rfc reference external" href="https://datatracker.ietf.org/doc/html/rfc5598.html"><strong>RFC 5598</strong></a>.</p>
<p id="index-17">Email messages, like postal mail, are composed of two parts :</p>
<blockquote>
<div><ul class="simple">
<li><p>a <cite>header</cite> that plays the same role as the letterhead in regular mail. It contains metadata about the message.</p></li>
<li><p>the <cite>body</cite> that contains the message itself.</p></li>
</ul>
</div></blockquote>
<p>Email messages are entirely composed of lines of ASCII characters. Each line can contain up to 998 characters and is terminated by the <cite>CR</cite> and <cite>LF</cite> control characters <span class="target" id="index-18"/><a class="rfc reference external" href="https://datatracker.ietf.org/doc/html/rfc5322.html"><strong>RFC 5322</strong></a>. The lines that compose the <cite>header</cite> appear before the message <cite>body</cite>. An empty line, containing only the <cite>CR</cite> and <cite>LF</cite> characters, marks the end of the <cite>header</cite>. This is illustrated in <a class="reference internal" href="#fig-email-msg"><span class="std std-numref">Fig. 29</span></a>.</p>
<blockquote>
<div><div class="figure" id="id58" style="text-align: center">
<span id="fig-email-msg"/><p><img src="../Images/8a178944414537a08bc98dae0cf87286.png" alt="Figure made with TikZ" data-original-src="https://4ed.computer-networking.info/syllabus/default/_images/tikz-414a73216cd7c532e0153815e9553d0dd93a9cdc.png"/></p>
<p><span class="caption-number">Fig. 29 </span><span class="caption-text">The structure of email messages</span></p>
</div></div></blockquote>
<p>The email header contains several lines that all begin with a keyword followed by a colon and additional information. The format of email messages and the different types of header lines are defined in <span class="target" id="index-19"/><a class="rfc reference external" href="https://datatracker.ietf.org/doc/html/rfc5322.html"><strong>RFC 5322</strong></a>. Two of these header lines are mandatory and must appear in all email messages :</p>
<blockquote>
<div><ul class="simple">
<li><p>The sender address. This header line starts with <cite>From:</cite>. This contains the (optional) name of the sender followed by its email address between <cite>&lt;</cite> and <cite>&gt;</cite>. Email addresses are always composed of a username followed by the <cite>@</cite> sign and a domain name.</p></li>
<li><p>The date. This header line starts with <cite>Date:</cite>. <span class="target" id="index-20"/><a class="rfc reference external" href="https://datatracker.ietf.org/doc/html/rfc5322.html"><strong>RFC 5322</strong></a> precisely defines the format used to encode a date.</p></li>
</ul>
</div></blockquote>
<p>Other header lines appear in most email messages. The <cite>Subject:</cite> header line allows the sender to indicate the topic discussed in the email. Three types of header lines can be used to specify the recipients of a message :</p>
<blockquote>
<div><ul class="simple">
<li><p>the <cite>To:</cite> header line contains the email addresses of the primary recipients of the message <a class="footnote-reference brackets" href="#fto" id="id21" role="doc-noteref"><span class="fn-bracket">[</span>10<span class="fn-bracket">]</span></a>. Several addresses can be separated by using commas.</p></li>
<li><p>the <cite>cc:</cite> header line is used by the sender to provide a list of email addresses that must receive a carbon copy of the message. Several addresses can be listed in this header line, separated by commas. All recipients of the email message receive the <cite>To:</cite> and <cite>cc:</cite> header lines.</p></li>
<li><p>the <cite>bcc:</cite> header line is used by the sender to provide a list of comma separated email addresses that must receive a blind carbon copy of the message. The <cite>bcc:</cite> header line is not delivered to the recipients of the email message.</p></li>
</ul>
</div></blockquote>
<p>A simple email message containing the <cite>From:</cite>, <cite>To:</cite>, <cite>Subject:</cite> and <cite>Date:</cite> header lines and two lines of body is shown below.</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span/>From: Bob Smith &lt;Bob@machine.example&gt;
To: Alice Doe &lt;alice@example.net&gt;, Alice Smith &lt;Alice@machine.example&gt;
Subject: Hello
Date: Mon, 8 Mar 2010 19:55:06 -0600

This is the "Hello world" of email messages.
This is the second line of the body
</pre></div>
</div>
<p>Note the empty line after the <cite>Date:</cite> header line; this empty line contains only the <cite>CR</cite> and <cite>LF</cite> characters, and marks the boundary between the header and the body of the message.</p>
<p>Several other optional header lines are defined in <span class="target" id="index-21"/><a class="rfc reference external" href="https://datatracker.ietf.org/doc/html/rfc5322.html"><strong>RFC 5322</strong></a> and elsewhere <a class="footnote-reference brackets" href="#femailheaders" id="id22" role="doc-noteref"><span class="fn-bracket">[</span>11<span class="fn-bracket">]</span></a>. Furthermore, many email clients and servers define their own header lines starting from <cite>X-</cite>. Several of the optional header lines defined in <span class="target" id="index-22"/><a class="rfc reference external" href="https://datatracker.ietf.org/doc/html/rfc5322.html"><strong>RFC 5322</strong></a> are worth being discussed here :</p>
<blockquote>
<div><ul class="simple">
<li><p>the <cite>Message-Id:</cite> header line is used to associate a “unique” identifier to each email. Email identifiers are usually structured like <cite>string@domain</cite> where <cite>string</cite> is a unique character string or sequence number chosen by the sender of the email and <cite>domain</cite> the domain name of the sender. Since domain names are unique, a host can generate globally unique message identifiers concatenating a locally unique identifier with its domain name.</p></li>
<li><p>the <cite>In-reply-to:</cite> header line is used when a message was created in reply to a previous message. In this case, the end of the <cite>In-reply-to:</cite> line contains the identifier of the original message.</p></li>
<li><p>the <cite>Received:</cite> header line is used when an email message is processed by several servers before reaching its destination. Each intermediate email server adds a <cite>Received:</cite> header line. These header lines are useful to debug problems in delivering email messages.</p></li>
</ul>
</div></blockquote>
<p>The figure below shows the header lines of one email message. The message originated at a host named <cite>wira.firstpr.com.au</cite> and was received by <cite>smtp3.sgsi.ucl.ac.be</cite>. The <cite>Received:</cite> lines have been wrapped for readability.</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span/>Received: from smtp3.sgsi.ucl.ac.be (Unknown [10.1.5.3])
    by mmp.sipr-dc.ucl.ac.be
    (Sun Java(tm) System Messaging Server 7u3-15.01 64bit (built Feb 12 2010))
    with ESMTP id &lt;0KYY00L85LI5JLE0@mmp.sipr-dc.ucl.ac.be&gt;; Mon,
    08 Mar 2010 11:37:17 +0100 (CET)
Received: from mail.ietf.org (mail.ietf.org [64.170.98.32])
    by smtp3.sgsi.ucl.ac.be (Postfix) with ESMTP id B92351C60D7; Mon,
    08 Mar 2010 11:36:51 +0100 (CET)
Received: from [127.0.0.1] (localhost [127.0.0.1])     by core3.amsl.com (Postfix)
    with ESMTP id F066A3A68B9; Mon, 08 Mar 2010 02:36:38 -0800 (PST)
Received: from localhost (localhost [127.0.0.1])       by core3.amsl.com (Postfix)
    with ESMTP id A1E6C3A681B  for &lt;rrg@core3.amsl.com&gt;; Mon,
    08 Mar 2010 02:36:37 -0800 (PST)
Received: from mail.ietf.org ([64.170.98.32])
    by localhost (core3.amsl.com [127.0.0.1]) (amavisd-new, port 10024)
    with ESMTP id erw8ih2v8VQa for &lt;rrg@core3.amsl.com&gt;; Mon,
    08 Mar 2010 02:36:36 -0800 (PST)
Received: from gair.firstpr.com.au (gair.firstpr.com.au [150.101.162.123])
    by core3.amsl.com (Postfix) with ESMTP id 03E893A67ED      for &lt;rrg@irtf.org&gt;; Mon,
    08 Mar 2010 02:36:35 -0800 (PST)
Received: from [10.0.0.6] (wira.firstpr.com.au [10.0.0.6])
    by gair.firstpr.com.au (Postfix) with ESMTP id D0A49175B63; Mon,
    08 Mar 2010 21:36:37 +1100 (EST)
Date: Mon, 08 Mar 2010 21:36:38 +1100
From: Robin Whittle &lt;rw@firstpr.com.au&gt;
Subject: Re: [rrg] Recommendation and what happens next
In-reply-to: &lt;C7B9C21A.4FAB%tony.li@tony.li&gt;
To: RRG &lt;rrg@irtf.org&gt;
Message-id: &lt;4B94D336.7030504@firstpr.com.au&gt;

Message content removed
</pre></div>
</div>
<p>Initially, email was used to exchange small messages of ASCII text between computer scientists. However, with the growth of the Internet, supporting only ASCII text became a severe limitation for two reasons. First of all, non-English speakers wanted to write emails in their native language that often required more characters than those of the ASCII character table. Second, many users wanted to send other content than just ASCII text by email such as binary files, images or sound.</p>
<p>To solve this problem, the <a class="reference external" href="https://www.ietf.org">IETF</a> developed the Multipurpose Internet Mail Extensions (<a class="reference internal" href="../glossary.html#term-MIME"><span class="xref std std-term">MIME</span></a>). These extensions were carefully designed to allow Internet email to carry non-ASCII characters and binary files without breaking the email servers that were deployed at that time. This requirement for backward compatibility forced the MIME designers to develop extensions to the existing email message format <span class="target" id="index-23"/><a class="rfc reference external" href="https://datatracker.ietf.org/doc/html/rfc822.html"><strong>RFC 822</strong></a> instead of defining a completely new format that would have been better suited to support the new types of emails.</p>
<p><span class="target" id="index-24"/><a class="rfc reference external" href="https://datatracker.ietf.org/doc/html/rfc2045.html"><strong>RFC 2045</strong></a> defines three new types of header lines to support MIME :</p>
<blockquote>
<div><ul class="simple">
<li><p>The <cite>MIME-Version:</cite> header line indicates the version of the MIME specification that was used to encode the email message. The current version of MIME is 1.0. Other versions of MIME may be defined in the future. Thanks to this header line, the software that processes email messages will be able to adapt to the MIME version used to encode the message. Messages that do not contain this header are supposed to be formatted according to the original <span class="target" id="index-25"/><a class="rfc reference external" href="https://datatracker.ietf.org/doc/html/rfc822.html"><strong>RFC 822</strong></a> specification.</p></li>
<li><p>The <cite>Content-Type:</cite> header line indicates the type of data that is carried inside the message (see below).</p></li>
<li><p>The <cite>Content-Transfer-Encoding:</cite> header line is used to specify how the message has been encoded. When MIME was designed, some email servers were only able to process messages containing characters encoded using the 7 bits ASCII character set. MIME allows the utilization of other character encodings.</p></li>
</ul>
</div></blockquote>
<p>Inside the email header, the <cite>Content-Type:</cite> header line indicates how the MIME email message is structured. <span class="target" id="index-26"/><a class="rfc reference external" href="https://datatracker.ietf.org/doc/html/rfc2046.html"><strong>RFC 2046</strong></a> defines the utilization of this header line. The two most common structures for MIME messages are :</p>
<blockquote>
<div><ul class="simple">
<li><p><cite>Content-Type: multipart/mixed</cite>. This header line indicates that the MIME message contains several independent parts. For example, such a message may contain a part in plain text and a binary file.</p></li>
<li><p><cite>Content-Type: multipart/alternative</cite>. This header line indicates that the MIME message contains several representations of the same information. For example, a <cite>multipart/alternative</cite> message may contain both a plain text and an HTML version of the same text.</p></li>
</ul>
</div></blockquote>
<p>To support these two types of MIME messages, the recipient of a message must be able to extract the different parts from the message. In <span class="target" id="index-27"/><a class="rfc reference external" href="https://datatracker.ietf.org/doc/html/rfc822.html"><strong>RFC 822</strong></a>, an empty line was used to separate the header lines from the body. Using an empty line to separate the different parts of an email body would be difficult as the body of email messages often contains one or more empty lines. Another possible option would be to define a special line, e.g. <cite>*-LAST_LINE-*</cite> to mark the boundary between two parts of a MIME message. Unfortunately, this is not possible as some emails may contain this string in their body (e.g. emails sent to students to explain the format of MIME messages). To solve this problem, the <cite>Content-Type:</cite> header line contains a second parameter that specifies the string that has been used by the sender of the MIME message to delineate the different parts. In practice, this string is often chosen randomly by the mail client.</p>
<p>The email message below, copied from <span class="target" id="index-28"/><a class="rfc reference external" href="https://datatracker.ietf.org/doc/html/rfc2046.html"><strong>RFC 2046</strong></a> shows a MIME message containing two parts that are both in plain text and encoded using the ASCII character set. The string <cite>simple boundary</cite> is defined in the <cite>Content-Type:</cite> header as the marker for the boundary between two successive parts. Another example of MIME messages may be found in <span class="target" id="index-29"/><a class="rfc reference external" href="https://datatracker.ietf.org/doc/html/rfc2046.html"><strong>RFC 2046</strong></a>.</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span/>Date: Mon, 20 Sep 1999 16:33:16 +0200
From: Nathaniel Borenstein &lt;nsb@bellcore.com&gt;
To: Ned Freed &lt;ned@innosoft.com&gt;
Subject: Test
MIME-Version: 1.0
Content-Type: multipart/mixed; boundary="simple boundary"

preamble, to be ignored

--simple boundary
Content-Type: text/plain; charset=us-ascii

First part

--simple boundary
Content-Type: text/plain; charset=us-ascii

Second part
--simple boundary
</pre></div>
</div>
<p>The <cite>Content-Type:</cite> header can also be used inside a MIME part. In this case, it indicates the type of data placed in this part. Each data type is specified as a type followed by a subtype. A detailed description may be found in <span class="target" id="index-30"/><a class="rfc reference external" href="https://datatracker.ietf.org/doc/html/rfc2046.html"><strong>RFC 2046</strong></a>. Some of the most popular <cite>Content-Type:</cite> header lines are :</p>
<blockquote>
<div><ul class="simple">
<li><p><cite>text</cite>. The message part contains information in textual format. There are several subtypes : <cite>text/plain</cite> for regular ASCII text, <cite>text/html</cite> defined in <span class="target" id="index-31"/><a class="rfc reference external" href="https://datatracker.ietf.org/doc/html/rfc2854.html"><strong>RFC 2854</strong></a> for documents in <a class="reference internal" href="../glossary.html#term-HTML"><span class="xref std std-term">HTML</span></a> format or the <cite>text/enriched</cite> format defined in <span class="target" id="index-32"/><a class="rfc reference external" href="https://datatracker.ietf.org/doc/html/rfc1896.html"><strong>RFC 1896</strong></a>. The <cite>Content-Type:</cite> header line may contain a second parameter that specifies the character set used to encode the text. <cite>charset=us-ascii</cite> is the standard ASCII character table.  Other frequent character sets include <cite>charset=UTF8</cite> or <cite>charset=iso-8859-1</cite>. The <a class="reference external" href="http://www.iana.org/assignments/character-sets">list of standard character sets</a> is maintained by <a class="reference internal" href="../glossary.html#term-IANA"><span class="xref std std-term">IANA</span></a>.</p></li>
<li><p><cite>image</cite>. The message part contains a binary representation of an image. The subtype indicates the format of the image such as <a class="reference external" href="http://en.wikipedia.org/wiki/Graphics_Interchange_Format">gif</a>, <a class="reference external" href="http://en.wikipedia.org/wiki/Jpeg">jpg</a> or <a class="reference external" href="http://en.wikipedia.org/wiki/Portable_Network_Graphics">png</a>.</p></li>
<li><p><cite>audio</cite>. The message part contains an audio clip. The subtype indicates the format of the audio clip like <a class="reference external" href="http://en.wikipedia.org/wiki/Wav">wav</a> or <a class="reference external" href="http://en.wikipedia.org/wiki/Mp3">mp3</a>.</p></li>
<li><p><cite>video</cite>. The message part contains a video clip. The subtype indicates the format of the video clip like <a class="reference external" href="http://en.wikipedia.org/wiki/Audio_Video_Interleave">avi</a> or <a class="reference external" href="http://en.wikipedia.org/wiki/Mp4">mp4</a>.</p></li>
<li><p><cite>application</cite>. The message part contains binary information that was produced by the particular application listed as the subtype. Email clients use the subtype to launch the application that is able to decode the received binary information.</p></li>
</ul>
</div></blockquote>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>From ASCII to Unicode</p>
<p>The first computers used different techniques to represent characters in memory and on disk. During the 1960s, computers began to exchange information via tape or telephone lines. Unfortunately, each vendor had its own proprietary character set and exchanging data between computers from different vendors was often difficult. The 7 bits ASCII character table <span class="target" id="index-33"/><a class="rfc reference external" href="https://datatracker.ietf.org/doc/html/rfc20.html"><strong>RFC 20</strong></a> was adopted by several vendors and by many Internet protocols. However, ASCII became a problem with the internationalization of the Internet and the desire of more and more users to use character sets that support their own written language. A first attempt at solving this problem was the definition of the <a class="reference external" href="https://en.wikipedia.org/wiki/ISO_8859">ISO-8859</a> character sets by <a class="reference internal" href="../glossary.html#term-ISO"><span class="xref std std-term">ISO</span></a>. This family of standards specified various character sets that allowed the representation of many European written languages by using 8 bits characters. Unfortunately, an 8-bits character set is not sufficient to support some widely used languages, such as those used in Asian countries. Fortunately, at the end of the 1980s, several computer scientists proposed to develop a standard that supports all written languages used on Earth today. The Unicode standard <a class="reference internal" href="../bibliography.html#unicode" id="id23"><span>[Unicode]</span></a> has now been adopted by most computer and software vendors. For example, Java always uses Unicode to manipulate characters, Python can handle both ASCII and Unicode characters. Internet applications are slowly moving towards complete support for the Unicode character sets, but moving from ASCII to Unicode is an important change that can have a huge impact on current deployed implementations. See, for example, the work to completely internationalize email <span class="target" id="index-34"/><a class="rfc reference external" href="https://datatracker.ietf.org/doc/html/rfc4952.html"><strong>RFC 4952</strong></a> and domain names <span class="target" id="index-35"/><a class="rfc reference external" href="https://datatracker.ietf.org/doc/html/rfc5890.html"><strong>RFC 5890</strong></a>.</p>
</div>
<p>The last MIME header line is <cite>Content-Transfer-Encoding:</cite>. This header line is used after the <cite>Content-Type:</cite> header line, within a message part, and specifies how the message part has been encoded. The default encoding is to use 7 bits ASCII. The most frequent encodings are <cite>quoted-printable</cite> and <cite>Base64</cite>. Both support encoding a sequence of bytes into a set of ASCII lines that can be safely transmitted by email servers. <cite>quoted-printable</cite> is defined in <span class="target" id="index-36"/><a class="rfc reference external" href="https://datatracker.ietf.org/doc/html/rfc2045.html"><strong>RFC 2045</strong></a>. We briefly describe <cite>base64</cite> which is defined in <span class="target" id="index-37"/><a class="rfc reference external" href="https://datatracker.ietf.org/doc/html/rfc2045.html"><strong>RFC 2045</strong></a> and <span class="target" id="index-38"/><a class="rfc reference external" href="https://datatracker.ietf.org/doc/html/rfc4648.html"><strong>RFC 4648</strong></a>.</p>
<p id="index-39"><cite>Base64</cite> divides the sequence of bytes to be encoded into groups of three bytes (with the last group possibly being partially filled). Each group of three bytes is then divided into four six-bit fields and each six bit field is encoded as a character from the table below.</p>
<div class="pst-scrollable-table-container"><table class="table">
<tbody>
<tr class="row-odd"><td><p>Value</p></td>
<td><p>Encoding</p></td>
<td><p>Value</p></td>
<td><p>Encoding</p></td>
<td><p>Value</p></td>
<td><p>Encoding</p></td>
<td><p>Value</p></td>
<td><p>Encoding</p></td>
</tr>
<tr class="row-even"><td><p>0</p></td>
<td><p>A</p></td>
<td><p>17</p></td>
<td><p>R</p></td>
<td><p>34</p></td>
<td><p>i</p></td>
<td><p>51</p></td>
<td><p>z</p></td>
</tr>
<tr class="row-odd"><td><p>1</p></td>
<td><p>B</p></td>
<td><p>18</p></td>
<td><p>S</p></td>
<td><p>35</p></td>
<td><p>j</p></td>
<td><p>52</p></td>
<td><p>0</p></td>
</tr>
<tr class="row-even"><td><p>2</p></td>
<td><p>C</p></td>
<td><p>19</p></td>
<td><p>T</p></td>
<td><p>36</p></td>
<td><p>k</p></td>
<td><p>53</p></td>
<td><p>1</p></td>
</tr>
<tr class="row-odd"><td><p>3</p></td>
<td><p>D</p></td>
<td><p>20</p></td>
<td><p>U</p></td>
<td><p>37</p></td>
<td><p>l</p></td>
<td><p>54</p></td>
<td><p>2</p></td>
</tr>
<tr class="row-even"><td><p>4</p></td>
<td><p>E</p></td>
<td><p>21</p></td>
<td><p>V</p></td>
<td><p>38</p></td>
<td><p>m</p></td>
<td><p>55</p></td>
<td><p>3</p></td>
</tr>
<tr class="row-odd"><td><p>5</p></td>
<td><p>F</p></td>
<td><p>22</p></td>
<td><p>W</p></td>
<td><p>39</p></td>
<td><p>n</p></td>
<td><p>56</p></td>
<td><p>4</p></td>
</tr>
<tr class="row-even"><td><p>6</p></td>
<td><p>G</p></td>
<td><p>23</p></td>
<td><p>X</p></td>
<td><p>40</p></td>
<td><p>o</p></td>
<td><p>57</p></td>
<td><p>5</p></td>
</tr>
<tr class="row-odd"><td><p>7</p></td>
<td><p>H</p></td>
<td><p>24</p></td>
<td><p>Y</p></td>
<td><p>41</p></td>
<td><p>p</p></td>
<td><p>58</p></td>
<td><p>6</p></td>
</tr>
<tr class="row-even"><td><p>8</p></td>
<td><p>I</p></td>
<td><p>25</p></td>
<td><p>Z</p></td>
<td><p>42</p></td>
<td><p>q</p></td>
<td><p>59</p></td>
<td><p>7</p></td>
</tr>
<tr class="row-odd"><td><p>9</p></td>
<td><p>J</p></td>
<td><p>26</p></td>
<td><p>a</p></td>
<td><p>43</p></td>
<td><p>r</p></td>
<td><p>60</p></td>
<td><p>8</p></td>
</tr>
<tr class="row-even"><td><p>10</p></td>
<td><p>K</p></td>
<td><p>27</p></td>
<td><p>b</p></td>
<td><p>44</p></td>
<td><p>s</p></td>
<td><p>61</p></td>
<td><p>9</p></td>
</tr>
<tr class="row-odd"><td><p>11</p></td>
<td><p>L</p></td>
<td><p>28</p></td>
<td><p>c</p></td>
<td><p>45</p></td>
<td><p>t</p></td>
<td><p>62</p></td>
<td><p>+</p></td>
</tr>
<tr class="row-even"><td><p>12</p></td>
<td><p>M</p></td>
<td><p>29</p></td>
<td><p>d</p></td>
<td><p>46</p></td>
<td><p>u</p></td>
<td><p>63</p></td>
<td><p>/</p></td>
</tr>
<tr class="row-odd"><td><p>13</p></td>
<td><p>N</p></td>
<td><p>30</p></td>
<td><p>e</p></td>
<td><p>47</p></td>
<td><p>v</p></td>
<td/>
<td/>
</tr>
<tr class="row-even"><td><p>14</p></td>
<td><p>O</p></td>
<td><p>31</p></td>
<td><p>f</p></td>
<td><p>48</p></td>
<td><p>w</p></td>
<td/>
<td/>
</tr>
<tr class="row-odd"><td><p>15</p></td>
<td><p>P</p></td>
<td><p>32</p></td>
<td><p>g</p></td>
<td><p>49</p></td>
<td><p>x</p></td>
<td/>
<td/>
</tr>
<tr class="row-even"><td><p>16</p></td>
<td><p>Q</p></td>
<td><p>33</p></td>
<td><p>h</p></td>
<td><p>50</p></td>
<td><p>y</p></td>
<td/>
<td/>
</tr>
</tbody>
</table>
</div>
<p>The example below, from <span class="target" id="index-40"/><a class="rfc reference external" href="https://datatracker.ietf.org/doc/html/rfc4648.html"><strong>RFC 4648</strong></a>, illustrates the <cite>Base64</cite> encoding.</p>
<blockquote>
<div><div class="pst-scrollable-table-container"><table class="table">
<tbody>
<tr class="row-odd"><td><p>Input data</p></td>
<td><p><cite>0x14fb9c03d97e</cite></p></td>
</tr>
<tr class="row-even"><td><p>8-bit</p></td>
<td><p>00010100 11111011 10011100   00000011 11011001 01111110</p></td>
</tr>
<tr class="row-odd"><td><p>6-bit</p></td>
<td><p>000101 001111 101110 011100  000000 111101 100101 111110</p></td>
</tr>
<tr class="row-even"><td><p>Decimal</p></td>
<td><p>5      15     46     28      0     61     37     62</p></td>
</tr>
<tr class="row-odd"><td><p>Encoding</p></td>
<td><p>F      P      u      c       A      9      l      +</p></td>
</tr>
</tbody>
</table>
</div>
</div></blockquote>
<p>The last point to be discussed about <cite>base64</cite> is what happens when the length of the sequence of bytes to be encoded is not a multiple of three. In this case, the last group of bytes may contain one or two bytes instead of three. <cite>Base64</cite> reserves the <cite>=</cite> character as a padding character. This character is used once when the last group contains two bytes and twice when it contains one byte as illustrated by the two examples below.</p>
<blockquote>
<div><div class="pst-scrollable-table-container"><table class="table">
<tbody>
<tr class="row-odd"><td><p>Input data</p></td>
<td><p>0x14</p></td>
</tr>
<tr class="row-even"><td><p>8-bit</p></td>
<td><p>00010100</p></td>
</tr>
<tr class="row-odd"><td><p>6-bit</p></td>
<td><p>000101 000000</p></td>
</tr>
<tr class="row-even"><td><p>Decimal</p></td>
<td><p>5     0</p></td>
</tr>
<tr class="row-odd"><td><p>Encoding</p></td>
<td><p>F     A    =  =</p></td>
</tr>
</tbody>
</table>
</div>
<div class="pst-scrollable-table-container"><table class="table">
<tbody>
<tr class="row-odd"><td><p>Input data</p></td>
<td><p>0x14b9</p></td>
</tr>
<tr class="row-even"><td><p>8-bit</p></td>
<td><p>00010100  11111011</p></td>
</tr>
<tr class="row-odd"><td><p>6-bit</p></td>
<td><p>000101 001111 101100</p></td>
</tr>
<tr class="row-even"><td><p>Decimal</p></td>
<td><p>5    15      44</p></td>
</tr>
<tr class="row-odd"><td><p>Encoding</p></td>
<td><p>F     P       s     =</p></td>
</tr>
</tbody>
</table>
</div>
</div></blockquote>
<p>Now that we have explained the format of the email messages, we can discuss how these messages can be exchanged through the Internet. <a class="reference internal" href="#fig-email-protocols"><span class="std std-numref">Fig. 30</span></a> illustrates the protocols that are used when <cite>Alice</cite> sends an email message to <cite>Bob</cite>. <cite>Alice</cite> prepares her email with an email client or on a webmail interface. To send her email to <cite>Bob</cite>, <cite>Alice</cite>’s client will use the Simple Mail Transfer Protocol (<a class="reference internal" href="../glossary.html#term-SMTP"><span class="xref std std-term">SMTP</span></a>) to deliver her message to her SMTP server. <cite>Alice</cite>’s email client is configured with the name of the default SMTP server for her domain. There is usually at least one SMTP server per domain. To deliver the message, <cite>Alice</cite>’s SMTP server must find the SMTP server that contains <cite>Bob</cite>’s mailbox. This can be done by using the Mail eXchange (MX) records of the DNS. A set of MX records can be associated to each domain. Each MX record contains a numerical preference and the fully qualified domain name of a SMTP server that is able to deliver email messages destined to all valid email addresses of this domain. The DNS can return several MX records for a given domain. In this case, the server with the lowest numerical preference is used first <span class="target" id="index-41"/><a class="rfc reference external" href="https://datatracker.ietf.org/doc/html/rfc2821.html"><strong>RFC 2821</strong></a>. If this server is not reachable, the second most preferred server is used etc. <cite>Bob</cite>’s SMTP server will store the message sent by <cite>Alice</cite> until <cite>Bob</cite> retrieves it using a webmail interface or protocols such as the Post Office Protocol (<a class="reference internal" href="../glossary.html#term-POP"><span class="xref std std-term">POP</span></a>) or the Internet Message Access Protocol (<a class="reference internal" href="../glossary.html#term-IMAP"><span class="xref std std-term">IMAP</span></a>).</p>
<blockquote>
<div><div class="figure" id="id59" style="text-align: center">
<span id="fig-email-protocols"/><p><img src="../Images/1016e46afc46c3c3a2098ab7047067a3.png" alt="Figure made with TikZ" data-original-src="https://4ed.computer-networking.info/syllabus/default/_images/tikz-6b8b294c11dc4ed409ed6c4e2c92703b4c094393.png"/></p>
<p><span class="caption-number">Fig. 30 </span><span class="caption-text">Email delivery protocols</span></p>
</div></div></blockquote>
<section id="the-simple-mail-transfer-protocol">
<span id="smtp"/><h3>The Simple Mail Transfer Protocol<a class="headerlink" href="#the-simple-mail-transfer-protocol" title="Link to this heading">#</a></h3>
<p>The Simple Mail Transfer Protocol (<a class="reference internal" href="../glossary.html#term-SMTP"><span class="xref std std-term">SMTP</span></a>) defined in <span class="target" id="index-42"/><a class="rfc reference external" href="https://datatracker.ietf.org/doc/html/rfc5321.html"><strong>RFC 5321</strong></a> is a client-server protocol. The SMTP specification distinguishes between five types of processes involved in the delivery of email messages. Email messages are composed on a Mail User Agent (MUA). The MUA is usually either an email client or a webmail. The MUA sends the email message to a Mail Submission Agent (MSA). The MSA processes the received email and forwards it to the Mail Transmission Agent (MTA). The MTA is responsible for the transmission of the email, directly or via intermediate MTAs to the MTA of the destination domain. This destination MTA will then forward the message to the Mail Delivery Agent (MDA) where it will be accessed by the recipient’s MUA. SMTP is used for the interactions between MUA and MSA <a class="footnote-reference brackets" href="#fsmtpauth" id="id24" role="doc-noteref"><span class="fn-bracket">[</span>12<span class="fn-bracket">]</span></a>, MSA-MTA and MTA-MTA.</p>
<p>SMTP is a text-based protocol like many other application-layer protocols on the Internet. It relies on the byte-stream service. Servers listen on port <cite>25</cite>. Clients send commands that are each composed of one line of ASCII text terminated by <cite>CR+LF</cite>. Servers reply by sending ASCII lines that contain a three digit numerical error/success code and optional comments.</p>
<p>The SMTP protocol, like most text-based protocols, is specified as a <a class="reference internal" href="../glossary.html#term-BNF"><span class="xref std std-term">BNF</span></a>. The full BNF is defined in <span class="target" id="index-43"/><a class="rfc reference external" href="https://datatracker.ietf.org/doc/html/rfc5321.html"><strong>RFC 5321</strong></a>. The main SMTP commands are defined by the BNF rules shown in <a class="reference internal" href="#fig-smtp-bnf"><span class="std std-numref">Fig. 31</span></a>.</p>
<figure class="align-center" id="id60">
<span id="fig-smtp-bnf"/><a class="reference internal image-reference" href="../_images/smtp-bnf.svg"><img alt="../_images/smtp-bnf.svg" src="../Images/c14bdccb9a063300e7e5dc0d244b52c9.png" style="width: 839.8000000000001px; height: 291.2px;" data-original-src="https://4ed.computer-networking.info/syllabus/default/_images/smtp-bnf.svg"/>
</a>
<figcaption>
<p><span class="caption-number">Fig. 31 </span><span class="caption-text">BNF specification of the SMTP commands</span><a class="headerlink" href="#id60" title="Link to this image">#</a></p>
</figcaption>
</figure>
<p>In this BNF, <cite>atext</cite> corresponds to printable ASCII characters. This BNF rule is defined in <span class="target" id="index-44"/><a class="rfc reference external" href="https://datatracker.ietf.org/doc/html/rfc5322.html"><strong>RFC 5322</strong></a>. The five main commands are <cite>EHLO</cite> <a class="footnote-reference brackets" href="#fehlo" id="id25" role="doc-noteref"><span class="fn-bracket">[</span>13<span class="fn-bracket">]</span></a>, <cite>MAIL FROM:</cite>, <cite>RCPT TO:</cite>, <cite>DATA</cite> and <cite>QUIT</cite>. <cite>Postmaster</cite> is the alias of the system administrator who is responsible for a given domain or SMTP server. All domains must have a <cite>Postmaster</cite> alias. The SMTP responses are defined by the BNF shown in <a class="reference internal" href="#fig-smtp-responses"><span class="std std-numref">Fig. 32</span></a>.</p>
<figure class="align-center" id="id61">
<span id="fig-smtp-responses"/><img alt="../_images/smtp-response.svg" src="../Images/699468c24e349ef194f6c3fcb1101a01.png" data-original-src="https://4ed.computer-networking.info/syllabus/default/_images/smtp-response.svg"/>
<figcaption>
<p><span class="caption-number">Fig. 32 </span><span class="caption-text">BNF specification of the SMTP responses</span><a class="headerlink" href="#id61" title="Link to this image">#</a></p>
</figcaption>
</figure>
<p>SMTP servers use structured reply codes containing three digits and an optional comment. The first digit of the reply code indicates whether the command was successful or not. A reply code of <cite>2xy</cite> indicates that the command has been accepted. A reply code of <cite>3xy</cite> indicates that the command has been accepted, but additional information from the client is expected. A reply code of <cite>4xy</cite> indicates a transient negative reply. This means that for some reason, which is indicated by either the other digits or the comment, the command cannot be processed immediately, but there is some hope that the problem will only be transient. This is basically telling the client to try the same command again later. In contrast, a reply code of <cite>5xy</cite> indicates a permanent failure or error. In this case, it is useless for the client to retry the same command later. Other application layer protocols such as FTP <span class="target" id="index-45"/><a class="rfc reference external" href="https://datatracker.ietf.org/doc/html/rfc959.html"><strong>RFC 959</strong></a>  or HTTP <span class="target" id="index-46"/><a class="rfc reference external" href="https://datatracker.ietf.org/doc/html/rfc2616.html"><strong>RFC 2616</strong></a> use a similar structure for their reply codes. Additional details about the other reply codes may be found in <span class="target" id="index-47"/><a class="rfc reference external" href="https://datatracker.ietf.org/doc/html/rfc5321.html"><strong>RFC 5321</strong></a>.</p>
<p>Examples of SMTP reply codes include the following :</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span/>220  &lt;domain&gt; Service ready
221  &lt;domain&gt; Service closing transmission channel
250  Requested mail action okay, completed
354  Start mail input; end with &lt;CRLF&gt;.&lt;CRLF&gt;
421  &lt;domain&gt; Service not available, closing transmission channel
450  Requested mail action not taken: mailbox unavailable
452  Requested action not taken: insufficient system storage
500  Syntax error, command unrecognized
501  Syntax error in parameters or arguments
502  Command not implemented
503  Bad sequence of commands
550  Requested action not taken: mailbox unavailable
</pre></div>
</div>
<p>Reply code <cite>220</cite> is used by the server as the first message when it agrees to interact with the client. Reply code <cite>221</cite> is sent by the server before closing the underlying transport connection. Reply code <cite>250</cite> is the standard positive reply that indicates the success of the previous command. Reply code <cite>354</cite> indicates that the client can start transmitting its email message. Reply code <cite>421</cite> is returned when there is a problem (e.g. lack of memory/disk resources) that prevents the server from accepting the transport connection.  Reply codes <cite>450</cite> and <cite>452</cite> indicate that the destination mailbox is temporarily unavailable, for various reasons, while reply code <cite>550</cite> indicates that the mailbox does not exist or cannot be used for policy reasons.  The <cite>500</cite> to <cite>503</cite> reply codes correspond to errors in the commands sent by the client. The <cite>503</cite> reply code would be sent by the server when the client sends commands in an incorrect order (e.g. the client tries to send an email before providing the destination address of the message).</p>
<p>The transfer of an email message is performed in three phases. During the first phase, the client opens a transport connection with the server. Once the connection has been established, the client and the server exchange greetings messages (<cite>EHLO</cite> command). Most servers insist on receiving valid greeting messages and some of them drop the underlying transport connection if they do not receive a valid greeting. Once the greetings have been exchanged, the email transfer phase can start. During this phase, the client transfers one or more email messages by indicating the email address of the sender (<cite>MAIL FROM:</cite> command), the email address of the recipient (<cite>RCPT TO:</cite> command) followed by the headers and the body of the email message (<cite>DATA</cite> command). Once the client has finished sending all its queued email messages to the SMTP server, it terminates the SMTP association (<cite>QUIT</cite> command).</p>
<p>A successful transfer of an email message is shown below</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span/>S: 220 smtp.example.com ESMTP MTA information
C: EHLO mta.example.org
S: 250 Hello mta.example.org, glad to meet you
C: MAIL FROM:&lt;alice@example.org&gt;
S: 250 Ok
C: RCPT TO:&lt;bob@example.com&gt;
S: 250 Ok
C: DATA
S: 354 End data with &lt;CR&gt;&lt;LF&gt;.&lt;CR&gt;&lt;LF&gt;
C: From: "Alice Doe" &lt;alice@example.org&gt;
C: To: Bob Smith &lt;bob@example.com&gt;
C: Date: Mon, 9 Mar 2010 18:22:32 +0100
C: Subject: Hello
C:
C: Hello Bob
C: This is a small message containing 4 lines of text.
C: Best regards,
C: Alice
C: .
S: 250 Ok: queued as 12345
C: QUIT
S: 221 Bye
</pre></div>
</div>
<p>In the example above, the MTA running on <cite>mta.example.org</cite> opens a TCP connection to the SMTP server on host <cite>smtp.example.com</cite>. The lines prefixed with <cite>S:</cite> (resp. <cite>C:</cite>) are the responses sent by the server (resp. the commands sent by the client). The server sends its greetings as soon as the TCP connection has been established. The client then sends the <cite>EHLO</cite> command with its fully qualified domain name. The server replies with reply-code <cite>250</cite> and sends its greetings. The SMTP association can now be used to exchange an email.</p>
<p>To send an email, the client must first provide the address of the recipient with <cite>RCPT TO:</cite>. Then it uses the <cite>MAIL FROM:</cite> with the address of the sender. Both the recipient and the sender are accepted by the server. The client can now issue the <cite>DATA</cite> command to start the transfer of the email message. After having received the <cite>354</cite> reply code, the client sends the headers and the body of its email message. The client indicates the end of the message by sending a line containing only the <cite>.</cite> (dot) character <a class="footnote-reference brackets" href="#fdot" id="id26" role="doc-noteref"><span class="fn-bracket">[</span>14<span class="fn-bracket">]</span></a>. The server confirms that the email message has been queued for delivery or transmission with a reply code of <cite>250</cite>. The client issues the <cite>QUIT</cite> command to close the session and the server confirms with reply-code <cite>221</cite>, before closing the TCP connection.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Open SMTP relays and spam</p>
<p>Since its creation in 1971, email has been a very useful tool that is used by many users to exchange lots of information. In the early days, all SMTP servers were open and anyone could use them to forward emails towards their final destination. Unfortunately, over the years, some unscrupulous users have found ways to use email for marketing purposes or to send malware. The first documented abuse of email for marketing purposes occurred in 1978 when a marketer who worked for a computer vendor sent a <a class="reference external" href="http://www.templetons.com/brad/spamreact.html#msg">marketing email</a> to many ARPANET users. At that time, the ARPANET could only be used for research purposes and this was an abuse of the acceptable use policy. Unfortunately, given the extremely low cost of sending emails, the problem of unsolicited emails has not stopped. Unsolicited emails are now called spam and a <a class="reference external" href="http://www.enisa.europa.eu/act/res/other-areas/anti-spam-measures">study</a> carried out by <a class="reference external" href="https://www.enisa.europa.eu/">ENISA</a> in 2009 reveals that 95% of email was spam and this number seems to continue to grow. This places a burden on the email infrastructure of Internet Service Providers and large companies that need to process many useless messages.</p>
<p>Given the amount of spam messages, SMTP servers are no longer open <span class="target" id="index-48"/><a class="rfc reference external" href="https://datatracker.ietf.org/doc/html/rfc5068.html"><strong>RFC 5068</strong></a>. Several extensions to SMTP have been developed in recent years to deal with this problem. For example, the SMTP authentication scheme defined in <span class="target" id="index-49"/><a class="rfc reference external" href="https://datatracker.ietf.org/doc/html/rfc4954.html"><strong>RFC 4954</strong></a> can be used by an SMTP server to authenticate a client. Several techniques have also been proposed to allow SMTP servers to <cite>authenticate</cite> the messages sent by their users <span class="target" id="index-50"/><a class="rfc reference external" href="https://datatracker.ietf.org/doc/html/rfc4870.html"><strong>RFC 4870</strong></a> <span class="target" id="index-51"/><a class="rfc reference external" href="https://datatracker.ietf.org/doc/html/rfc4871.html"><strong>RFC 4871</strong></a> .</p>
</div>
</section>
<section id="the-post-office-protocol">
<span id="index-52"/><span id="popprotocol"/><h3>The Post Office Protocol<a class="headerlink" href="#the-post-office-protocol" title="Link to this heading">#</a></h3>
<p>When the first versions of SMTP were designed, the Internet was composed of minicomputers that were used by an entire university department or research lab. These minicomputers were used by many users at the same time. Email was mainly used to send messages from a user on a given host to another user on a remote host. At that time, SMTP was the only protocol involved in the delivery of the emails as all hosts attached to the network were running an SMTP server. On such hosts, an email destined to local users was delivered by placing the email in a special directory or file owned by the user. However, the introduction of personal computers in the 1980s changed this environment. Initially, users of these personal computers used applications such as <a class="reference internal" href="../glossary.html#term-telnet"><span class="xref std std-term">telnet</span></a> to open a remote session on the local <a class="reference internal" href="../glossary.html#term-minicomputer"><span class="xref std std-term">minicomputer</span></a> to read their email. This was not user-friendly. A better solution appeared with the development of user friendly email client applications on personal computers. Several protocols were designed to allow these client applications to retrieve the email messages destined to a user from his/her server. Two of these protocols became popular and are still used today. The Post Office Protocol (POP), defined in <span class="target" id="index-53"/><a class="rfc reference external" href="https://datatracker.ietf.org/doc/html/rfc1939.html"><strong>RFC 1939</strong></a>, is the simplest one. It allows a client to download all the messages destined to a given user from his/her email server. We describe POP briefly in this section. The second protocol is the Internet Message Access Protocol (IMAP), defined in <span class="target" id="index-54"/><a class="rfc reference external" href="https://datatracker.ietf.org/doc/html/rfc3501.html"><strong>RFC 3501</strong></a>. IMAP is more powerful, but also more complex than POP. IMAP was designed to allow client applications to efficiently access, in real-time, to messages stored in various folders on servers. IMAP assumes that all the messages of a given user are stored on a server and provides the functions that are necessary to search, download, delete or filter messages.</p>
<p>POP is another example of a simple line-based protocol. POP runs above the bytestream service. A POP server usually listens to port 110. A POP session is composed of three parts : an <cite>authorisation</cite> phase during which the server verifies the client’s credential, a <cite>transaction</cite> phase during which the client downloads messages and an <cite>update</cite> phase that concludes the session. The client sends commands and the server replies are prefixed by <cite>+OK</cite> to indicate a successful command or by <cite>-ERR</cite> to indicate errors.</p>
<p>When a client opens a transport connection with the POP server, the latter sends as banner an ASCII-line starting with <cite>+OK</cite>. The POP session is at that time in the <cite>authorisation</cite> phase. In this phase, the client can send its username (resp. password) with the <cite>USER</cite> (resp. <cite>PASS</cite>) command. The server replies with <cite>+OK</cite> if the username (resp. password) is valid and <cite>-ERR</cite> otherwise.</p>
<p>Once the username and password have been validated, the POP session enters in the <cite>transaction</cite> phase. In this phase, the client can issue several commands. The <cite>STAT</cite> command is used to retrieve the status of the server. Upon reception of this command, the server replies with a line that contains <cite>+OK</cite> followed by the number of messages in the mailbox and the total size of the mailbox in bytes. The <cite>RETR</cite> command, followed by a space and an integer, is used to retrieve the nth message of the mailbox. The <cite>DELE</cite> command is used to mark for deletion the nth message of the mailbox.</p>
<p>Once the client has retrieved and possibly deleted the emails contained in the mailbox, it must issue the <cite>QUIT</cite> command. This command terminates the POP session and allows the server to delete all the messages that have been marked for deletion by using the <cite>DELE</cite> command.</p>
<p>The figure below provides a simple POP session. All lines prefixed with <cite>C:</cite> (resp. <cite>S:</cite>) are sent by the client (resp. server).</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span/>S:    +OK POP3 server ready
C:    USER alice
S:    +OK
C     PASS 12345pass
S:    +OK alice's maildrop has 2 messages (620 octets)
C:    STAT
S:    +OK 2 620
C:    LIST
S:    +OK 2 messages (620 octets)
S:    1 120
S:    2 500
S:    .
C:    RETR 1
S:    +OK 120 octets
S:    &lt;the POP3 server sends message 1&gt;
S:    .
C:    DELE 1
S:    +OK message 1 deleted
C:    QUIT
S:    +OK POP3 server signing off (1 message left)
</pre></div>
</div>
<p>In this example, a POP client contacts a POP server on behalf of the user named <cite>alice</cite>. Note that in this example, Alice’s password is sent in clear by the client. This implies that if someone is able to capture the packets sent by Alice, he will know Alice’s password <a class="footnote-reference brackets" href="#fapop" id="id27" role="doc-noteref"><span class="fn-bracket">[</span>15<span class="fn-bracket">]</span></a>. Then Alice’s client issues the <cite>STAT</cite> command to know the number of messages that are stored in her mailbox. It then retrieves and deletes the first message of the mailbox.</p>
</section>
</section>
<section id="the-world-wide-web">
<span id="http"/><h2>The world wide web<a class="headerlink" href="#the-world-wide-web" title="Link to this heading">#</a></h2>
<p>In the early days, the Internet was mainly used for remote terminal access with <a class="reference external" href="https://en.wikipedia.org/wiki/Telnet">telnet</a>, email and file transfer. The default file transfer protocol, <cite>FTP</cite>, defined in <span class="target" id="index-55"/><a class="rfc reference external" href="https://datatracker.ietf.org/doc/html/rfc959.html"><strong>RFC 959</strong></a> was widely used. <cite>FTP</cite> clients and servers are still included in some operating systems.</p>
<p>Many <cite>FTP</cite> clients offered a user interface similar to a Unix shell and allowed clients to browse the file system on the server and to send and retrieve files. <cite>FTP</cite> servers can be configured in two modes :</p>
<blockquote>
<div><ul class="simple">
<li><p><cite>authenticated</cite> : in this mode, the ftp server only accepts users with a valid user name and password. Once authenticated, they can access the files and directories according to their permissions</p></li>
<li><p><cite>anonymous</cite> : in this mode, clients supply the <cite>anonymous</cite> user identifier and their email address as password. These clients are granted access to a special zone of the file system that only contains public files.</p></li>
</ul>
</div></blockquote>
<p><cite>FTP</cite> was very popular in the 1990s and early 2000s, but today it has mostly been superseded by more recent protocols. Authenticated access to files is mainly done by using the Secure Shell (<a class="reference external" href="https://en.wikipedia.org/wiki/Secure_Shell">ssh</a>) protocol defined in <span class="target" id="index-56"/><a class="rfc reference external" href="https://datatracker.ietf.org/doc/html/rfc4251.html"><strong>RFC 4251</strong></a> and supported by clients such as <a class="reference external" href="https://www.openssh.org">scp</a> or <a class="reference external" href="https://www.openssh.org">sftp</a>. Nowadays, anonymous access is mainly provided by web protocols.</p>
<p>In the late 1980s, high energy physicists working at <a class="reference external" href="https://www.cern.ch">CERN</a> had to efficiently exchange documents about their ongoing and planned experiments. <a class="reference external" href="https://www.w3.org/People/Berners-Lee/">Tim Berners-Lee</a> evaluated several of the documents sharing techniques that were available at that time <a class="reference internal" href="../bibliography.html#b1989" id="id28"><span>[B1989]</span></a>. As none of the existing solutions met CERN’s requirements, they chose to develop a completely new document sharing system. This system was initially called the <cite>mesh</cite>. It was quickly renamed the <cite>world wide web</cite>. The starting point for the <cite>world wide web</cite> are hypertext documents. An hypertext document is a document that contains references (hyperlinks) to other documents that the reader can immediately access. Hypertext was not invented for the world wide web. The idea of hypertext documents was proposed in 1945 <a class="reference internal" href="../bibliography.html#bush1945" id="id29"><span>[Bush1945]</span></a> and the first experiments were done during the 1960s <a class="reference internal" href="../bibliography.html#nelson1965" id="id30"><span>[Nelson1965]</span></a> <a class="reference internal" href="../bibliography.html#myers1998" id="id31"><span>[Myers1998]</span></a> . Compared to the hypertext documents that were used in the late 1980s, the main innovation introduced by the <cite>world wide web</cite> was to allow hyperlinks to reference documents stored on different remote machines. This is illustrated in <a class="reference internal" href="#fig-web"><span class="std std-numref">Fig. 33</span></a>.</p>
<blockquote>
<div><div class="figure" id="id62" style="text-align: center">
<span id="fig-web"/><p><img src="../Images/203e09d617f034ce3c963e378c622093.png" alt="Figure made with TikZ" data-original-src="https://4ed.computer-networking.info/syllabus/default/_images/tikz-0785f7e38adaa09624fe0499a6f30185abeb9a19.png"/></p>
<p><span class="caption-number">Fig. 33 </span><span class="caption-text">World-wide web clients and servers</span></p>
</div></div></blockquote>
<p>A document sharing system such as the <cite>world wide web</cite> is composed of three important parts.</p>
<blockquote>
<div><ol class="arabic simple">
<li><p>A standardized addressing scheme that unambiguously identifies documents</p></li>
<li><p>A standard document format : the <a class="reference external" href="http://www.w3.org/MarkUp">HyperText Markup Language</a></p></li>
<li><p>A standardized protocol to efficiently retrieve the documents stored on a server</p></li>
</ol>
</div></blockquote>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Open standards and open implementations</p>
<p>Open standards play a key role in the success of the <cite>world wide web</cite> as we know it today. Without open standards, the world wide web would have never reached its current size. In addition to open standards, another important factor for the success of the web was the availability of open and efficient implementations of these standards. When CERN started to work on the <cite>web</cite>, their objective was to build a running system that could be used by physicists. They developed open-source implementations of the <a class="reference external" href="http://www.w3.org/Daemon/">first web servers</a> and <a class="reference external" href="http://www.w3.org/Library/Activity.html">web clients</a>. These open-source implementations were powerful and could be used as is, by institutions willing to share information. They were also extended by other developers who contributed to new features. For example, the <a class="reference external" href="https://www.ncsa.illinois.edu">NCSA</a> added support for images in their <a class="reference external" href="http://en.wikipedia.org/wiki/Mosaic_(web_browser)">Mosaic browser</a> that was eventually used to create <a class="reference external" href="http://en.wikipedia.org/wiki/Netscape">Netscape Communications</a> and the first commercial browsers and servers.</p>
</div>
<p>The first components of the <cite>world wide web</cite> are the Uniform Resource Identifiers (URI), defined in <span class="target" id="index-57"/><a class="rfc reference external" href="https://datatracker.ietf.org/doc/html/rfc3986.html"><strong>RFC 3986</strong></a>. A URI is a character string that unambiguously identifies a resource on the world wide web. Here is a subset of the BNF for URIs</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span/><span class="n">URI</span>           <span class="o">=</span> <span class="n">scheme</span> <span class="s2">":"</span> <span class="s2">"//"</span> <span class="n">authority</span> <span class="n">path</span> <span class="p">[</span> <span class="s2">"?"</span> <span class="n">query</span> <span class="p">]</span> <span class="p">[</span> <span class="s2">"#"</span> <span class="n">fragment</span> <span class="p">]</span>
<span class="n">scheme</span>        <span class="o">=</span> <span class="n">ALPHA</span> <span class="o">*</span><span class="p">(</span> <span class="n">ALPHA</span> <span class="o">/</span> <span class="n">DIGIT</span> <span class="o">/</span> <span class="s2">"+"</span> <span class="o">/</span> <span class="s2">"-"</span> <span class="o">/</span> <span class="s2">"."</span> <span class="p">)</span>
<span class="n">authority</span>     <span class="o">=</span> <span class="p">[</span> <span class="n">userinfo</span> <span class="s2">"@"</span> <span class="p">]</span> <span class="n">host</span> <span class="p">[</span> <span class="s2">":"</span> <span class="n">port</span> <span class="p">]</span>
<span class="n">query</span>         <span class="o">=</span> <span class="o">*</span><span class="p">(</span> <span class="n">pchar</span> <span class="o">/</span> <span class="s2">"/"</span> <span class="o">/</span> <span class="s2">"?"</span> <span class="p">)</span>
<span class="n">fragment</span>      <span class="o">=</span> <span class="o">*</span><span class="p">(</span> <span class="n">pchar</span> <span class="o">/</span> <span class="s2">"/"</span> <span class="o">/</span> <span class="s2">"?"</span> <span class="p">)</span>
<span class="n">pchar</span>         <span class="o">=</span> <span class="n">unreserved</span> <span class="o">/</span> <span class="n">pct</span><span class="o">-</span><span class="n">encoded</span> <span class="o">/</span> <span class="n">sub</span><span class="o">-</span><span class="n">delims</span> <span class="o">/</span> <span class="s2">":"</span> <span class="o">/</span> <span class="s2">"@"</span>
<span class="n">query</span>         <span class="o">=</span> <span class="o">*</span><span class="p">(</span> <span class="n">pchar</span> <span class="o">/</span> <span class="s2">"/"</span> <span class="o">/</span> <span class="s2">"?"</span> <span class="p">)</span>
<span class="n">fragment</span>      <span class="o">=</span> <span class="o">*</span><span class="p">(</span> <span class="n">pchar</span> <span class="o">/</span> <span class="s2">"/"</span> <span class="o">/</span> <span class="s2">"?"</span> <span class="p">)</span>
<span class="n">pct</span><span class="o">-</span><span class="n">encoded</span>   <span class="o">=</span> <span class="s2">"%"</span> <span class="n">HEXDIG</span> <span class="n">HEXDIG</span>
<span class="n">unreserved</span>    <span class="o">=</span> <span class="n">ALPHA</span> <span class="o">/</span> <span class="n">DIGIT</span> <span class="o">/</span> <span class="s2">"-"</span> <span class="o">/</span> <span class="s2">"."</span> <span class="o">/</span> <span class="s2">"_"</span> <span class="o">/</span> <span class="s2">"~"</span>
<span class="n">reserved</span>      <span class="o">=</span> <span class="n">gen</span><span class="o">-</span><span class="n">delims</span> <span class="o">/</span> <span class="n">sub</span><span class="o">-</span><span class="n">delims</span>
<span class="n">gen</span><span class="o">-</span><span class="n">delims</span>    <span class="o">=</span> <span class="s2">":"</span> <span class="o">/</span> <span class="s2">"/"</span> <span class="o">/</span> <span class="s2">"?"</span> <span class="o">/</span> <span class="s2">"#"</span> <span class="o">/</span> <span class="s2">"["</span> <span class="o">/</span> <span class="s2">"]"</span> <span class="o">/</span> <span class="s2">"@"</span>
<span class="n">sub</span><span class="o">-</span><span class="n">delims</span>    <span class="o">=</span> <span class="s2">"!"</span> <span class="o">/</span> <span class="s2">"$"</span> <span class="o">/</span> <span class="s2">"&amp;"</span> <span class="o">/</span> <span class="s2">"'"</span> <span class="o">/</span> <span class="s2">"("</span> <span class="o">/</span> <span class="s2">")"</span> <span class="o">/</span> <span class="s2">"*"</span> <span class="o">/</span> <span class="s2">"+"</span> <span class="o">/</span> <span class="s2">","</span> <span class="o">/</span> <span class="s2">";"</span> <span class="o">/</span> <span class="s2">"="</span>
</pre></div>
</div>
<p>The first component of a URI is its <cite>scheme</cite>. A <cite>scheme</cite> can be seen as a selector, indicating the meaning of the fields after it. In practice, the scheme often identifies the application-layer protocol that must be used by the client to retrieve the document, but it is not always the case. Some schemes do not imply a protocol at all and some do not indicate a retrievable document <a class="footnote-reference brackets" href="#furiretrieve" id="id32" role="doc-noteref"><span class="fn-bracket">[</span>16<span class="fn-bracket">]</span></a>. The most frequent schemes are <cite>http</cite> and <cite>https</cite>. We focus on <cite>http</cite> in this section. A URI scheme can be defined for almost any application layer protocol <a class="footnote-reference brackets" href="#furilist" id="id33" role="doc-noteref"><span class="fn-bracket">[</span>17<span class="fn-bracket">]</span></a>. The characters <cite>:</cite> and <cite>//</cite> follow the <cite>scheme</cite> of any URI.</p>
<p>The second part of the URI is the <cite>authority</cite>. With retrievable URIs, this includes the DNS name or the IP address of the server where the document can be retrieved using the protocol specified via the <cite>scheme</cite>. This name can be preceded by some information about the user (e.g. a user name) who is requesting the information. Earlier definitions of the URI allowed the specification of a user name and a password before the <cite>@</cite> character (<span class="target" id="index-58"/><a class="rfc reference external" href="https://datatracker.ietf.org/doc/html/rfc1738.html"><strong>RFC 1738</strong></a>), but this is now deprecated as placing a password inside a URI is insecure. The host name can be followed by the semicolon character and a port number. A default port number is defined for some protocols and the port number should only be included in the URI if a non-default port number is used (for other protocols, techniques like service DNS records can used).</p>
<p>The third part of the URI is the path to the document. This path is structured as filenames on a Unix host (but it does not imply that the files are indeed stored this way on the server). If the path is not specified, the server will return a default document. The last two optional parts of the URI are used to provide a query parameter and indicate a specific part (e.g. a section in an article) of the requested document. Sample URIs are shown below.</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span/>http://tools.ietf.org/html/rfc3986.html
mailto:infobot@example.com?subject=current-issue
http://docs.python.org/library/basehttpserver.html?highlight=http#BaseHTTPServer.BaseHTTPRequestHandler
telnet://[2001:db8:3080:3::2]:2323/
ftp://cnn.example.com&amp;story=breaking_news@10.0.0.1/top_story.htm
</pre></div>
</div>
<p>The first URI corresponds to a document named <cite>rfc3986.html</cite> that is stored on the server named <cite>tools.ietf.org</cite> and can be accessed by using the <cite>http</cite> protocol on its default port. The second URI corresponds to an email message, with subject <cite>current-issue</cite>, that will be sent to user <cite>infobot</cite> in domain <cite>example.com</cite>. The <cite>mailto:</cite> URI scheme is defined in <span class="target" id="index-59"/><a class="rfc reference external" href="https://datatracker.ietf.org/doc/html/rfc2368.html"><strong>RFC 2368</strong></a>. The third URI references the portion <cite>BaseHTTPServer.BaseHTTPRequestHandler</cite> of the document <cite>basehttpserver.html</cite> that is stored in the <cite>library</cite> directory on the <cite>docs.python.org</cite> server. This document can be retrieved by using the <cite>http</cite> protocol. The query parameter <cite>highlight=http</cite> is associated to this URI. The fourth example is a server that operates the <a class="reference external" href="https://en.wikipedia.org/wiki/Telnet">telnet</a> protocol, uses IPv6 address <cite>2001:db8:3080:3::2</cite> and is reachable on port 2323. The last URI is somewhat special. Most users will assume that it corresponds to a document stored on the <cite>cnn.example.com</cite> server. However, to parse this URI, it is important to remember that the <cite>@</cite> character is used to separate the user name from the host name in the authorization part of a URI. This implies that the URI points to a document named <cite>top_story.htm</cite> on the host having IPv4 address <cite>10.0.0.1</cite>. The document will be retrieved by using the <cite>ftp</cite> protocol with the user name set to <cite>cnn.example.com&amp;story=breaking_news</cite>.</p>
<p>The second component of the <cite>word wide web</cite> is the HyperText Markup Language (HTML). HTML defines the format of the documents that are exchanged on the <cite>web</cite>. The <a class="reference external" href="http://www.w3.org/History/19921103-hypertext/hypertext/WWW/MarkUp/Tags.html">first version of HTML</a> was derived from the Standard Generalized Markup Language (SGML) that was standardized in 1986 by <a class="reference internal" href="../glossary.html#term-ISO"><span class="xref std std-term">ISO</span></a>. <a class="reference external" href="https://en.wikipedia.org/wiki/Standard_Generalized_Markup_Language">SGML</a> was designed to support large documents maintained by government, law firms or aerospace companies that must be shared efficiently in a machine-readable manner. These industries require documents to remain readable and editable for tens of years and insisted on a standardized format supported by multiple vendors. Today, <a class="reference external" href="https://en.wikipedia.org/wiki/Standard_Generalized_Markup_Language">SGML</a> is no longer widely used beyond specific applications, but its descendants including <a class="reference internal" href="../glossary.html#term-HTML"><span class="xref std std-term">HTML</span></a> and <a class="reference internal" href="../glossary.html#term-XML"><span class="xref std std-term">XML</span></a> are now widespread.</p>
<p>A markup language is a structured way of adding annotations about the formatting of the document within the document itself. Example markup languages include <a class="reference external" href="https://en.wikipedia.org/wiki/Troff">troff</a>, which is used to write the Unix man pages or <a class="reference external" href="https://en.wikipedia.org/wiki/Latex">Latex</a>. HTML uses markers to annotate text and a document is composed of <cite>HTML elements</cite>. Each element is usually composed of three parts: a start tag that potentially includes some specific attributes, some text (often including other elements), and an end tag. A HTML tag is a keyword enclosed in angle brackets. The generic form of an HTML element is</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span/><span class="o">&lt;</span><span class="n">tag</span><span class="o">&gt;</span><span class="n">Some</span> <span class="n">text</span> <span class="n">to</span> <span class="n">be</span> <span class="n">displayed</span><span class="o">&lt;/</span><span class="n">tag</span><span class="o">&gt;</span>
</pre></div>
</div>
<p>More complex HTML elements can also include optional attributes in the start tag</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span/><span class="o">&lt;</span><span class="n">tag</span> <span class="n">attribute1</span><span class="o">=</span><span class="s2">"value1"</span> <span class="n">attribute2</span><span class="o">=</span><span class="s2">"value2"</span><span class="o">&gt;</span><span class="n">some</span> <span class="n">text</span> <span class="n">to</span> <span class="n">be</span> <span class="n">displayed</span><span class="o">&lt;/</span><span class="n">tag</span><span class="o">&gt;</span>
</pre></div>
</div>
<p>The HTML document shown in <a class="reference internal" href="#fig-html-page"><span class="std std-numref">Fig. 34</span></a> is composed of two parts: a header, delineated by the <cite>&lt;head&gt;</cite> and <cite>&lt;/head&gt;</cite> markers, and a body (between the <cite>&lt;body&gt;</cite> and <cite>&lt;/body&gt;</cite> markers). In the example below, the header only contains a title, but other types of information can be included in the header. The body contains an image, some text and a list with three hyperlinks. The image is included in the web page by indicating its URI between brackets inside the <cite>&lt;img src=”…”&gt;</cite> marker. It is important to note that the image can reside on any server. The client will automatically download it when rendering the web page. The <cite>&lt;h1&gt;…&lt;/h1&gt;</cite> marker is used to specify the first level of headings. The <cite>&lt;ul&gt;</cite> marker indicates an unnumbered list while the <cite>&lt;li&gt;</cite> marker indicates a list item. The <cite>&lt;a href=”URI”&gt;text&lt;/a&gt;</cite> indicates a hyperlink. The <cite>text</cite> will be underlined in the rendered web page and the client will fetch the specified URI when the user clicks on the link.</p>
<figure class="align-center" id="id63">
<span id="fig-html-page"/><a class="reference internal image-reference" href="../_images/html-page.png"><img alt="../_images/html-page.png" src="../Images/44780516838bc54a13c36a8fe2321d96.png" style="width: 525.6999999999999px; height: 201.6px;" data-original-src="https://4ed.computer-networking.info/syllabus/default/_images/html-page.png"/>
</a>
<figcaption>
<p><span class="caption-number">Fig. 34 </span><span class="caption-text">A simple HTML page</span><a class="headerlink" href="#id63" title="Link to this image">#</a></p>
</figcaption>
</figure>
<p>Over the years, various extensions to HTML have been proposed and implemented. These include the specification of style sheets that adjust the layout of the document and the possibility of adding or referencing javascript code. Additional details about the various extensions to HTML may be found in the <a class="reference external" href="http://www.w3.org/MarkUp/">official specifications</a> maintained by <a class="reference external" href="https://www.w3.org">W3C</a>.</p>
<section id="the-hypertext-transfer-protocol">
<h3>The HyperText Transfer Protocol<a class="headerlink" href="#the-hypertext-transfer-protocol" title="Link to this heading">#</a></h3>
<p>The third component of the <cite>world wide web</cite> is the HyperText Transfer Protocol (HTTP). HTTP is a text-based protocol like SMTP. The client sends a request and the server returns a response. HTTP runs above the bytestream service and HTTP servers listen by default on port <cite>80</cite>. The design of HTTP has largely been inspired by the Internet email protocols. Each HTTP request contains three parts :</p>
<blockquote>
<div><ul class="simple">
<li><p>a <cite>method</cite>, that indicates the type of request, a URI, and the version of the HTTP protocol used by the client</p></li>
<li><p>a <cite>header</cite>, that is used by the client to specify optional parameters for the request. An empty line is used to mark the end of the header</p></li>
<li><p>an optional MIME document attached to the request</p></li>
</ul>
</div></blockquote>
<p>The response sent by the server also contains three parts :</p>
<blockquote>
<div><ul class="simple">
<li><p>a <cite>status line</cite> , that indicates whether the request was successful or not</p></li>
<li><p>a <cite>header</cite>, that contains additional information about the response. The response header ends with an empty line.</p></li>
<li><p>a MIME document</p></li>
</ul>
</div></blockquote>
<p>Figure <a class="reference internal" href="#fig-http-req-resp"><span class="std std-numref">Fig. 35</span></a> provides sample HTTP request and response.</p>
<blockquote>
<div><div class="figure" id="id64" style="text-align: center">
<span id="fig-http-req-resp"/><p><img src="../Images/64fd856539fab465e6b2fadde6a8bd15.png" alt="Figure made with TikZ" data-original-src="https://4ed.computer-networking.info/syllabus/default/_images/tikz-75f726be37c1860fd3d926a2afa1f9ab3d360f4d.png"/></p>
<p><span class="caption-number">Fig. 35 </span><span class="caption-text">HTTP requests and responses</span></p>
</div></div></blockquote>
<p>Several types of method can be used in HTTP requests. The three most important ones are :</p>
<blockquote>
<div><ul class="simple">
<li><p>the <cite>GET</cite> method is the most popular one. It is used to retrieve a document from a server. The <cite>GET</cite> method is encoded as <cite>GET</cite> followed by the path of the URI of the requested document and the version of HTTP used by the client. For example, to retrieve the <a class="reference external" href="http://www.w3.org/MarkUp/">http://www.w3.org/MarkUp/</a> URI, a client must open a TCP connection on port <cite>80</cite> with host <cite>www.w3.org</cite> and send a HTTP request containing the following line:</p></li>
</ul>
<div class="highlight-console notranslate"><div class="highlight"><pre><span/><span class="go">GET /MarkUp/ HTTP/1.0</span>
</pre></div>
</div>
<ul class="simple">
<li><p>the <cite>HEAD</cite> method is a variant of the <cite>GET</cite> method that allows the retrieval of the header lines for a given URI without retrieving the entire document. It can be used by a client to verify if a document exists, for instance.</p></li>
<li><p>the <cite>POST</cite> method can be used by a client to send a document to a server. The document is attached to the HTTP request as a MIME document.</p></li>
</ul>
</div></blockquote>
<p>HTTP clients and servers can include different HTTP headers in HTTP requests and responses. Each HTTP header is encoded as a single ASCII-line terminated by <cite>CR</cite> and <cite>LF</cite>. Several of these headers are briefly described below. A detailed discussion of the standard headers may be found in <span class="target" id="index-60"/><a class="rfc reference external" href="https://datatracker.ietf.org/doc/html/rfc1945.html"><strong>RFC 1945</strong></a>. The MIME headers can appear in both HTTP requests and HTTP responses.</p>
<blockquote>
<div><ul class="simple">
<li><p>the <cite>Content-Length:</cite> header is the <a class="reference internal" href="../glossary.html#term-MIME"><span class="xref std std-term">MIME</span></a> header that indicates the length of the MIME document in bytes.</p></li>
<li><p>the <cite>Content-Type:</cite> header is the <a class="reference internal" href="../glossary.html#term-MIME"><span class="xref std std-term">MIME</span></a> header that indicates the type of the attached MIME document. HTML pages use the <cite>text/html</cite> type.</p></li>
<li><p>the <cite>Content-Encoding:</cite> header indicates how the <a class="reference internal" href="../glossary.html#term-MIME-document"><span class="xref std std-term">MIME document</span></a> has been encoded. For example, this header would be set to <cite>x-gzip</cite> for a document compressed using the <a class="reference external" href="https://www.gzip.org">gzip</a> software.</p></li>
</ul>
</div></blockquote>
<p><span class="target" id="index-61"/><a class="rfc reference external" href="https://datatracker.ietf.org/doc/html/rfc1945.html"><strong>RFC 1945</strong></a> and <span class="target" id="index-62"/><a class="rfc reference external" href="https://datatracker.ietf.org/doc/html/rfc2616.html"><strong>RFC 2616</strong></a> define headers that are specific to HTTP responses. These server headers include:</p>
<blockquote>
<div><ul class="simple">
<li><p>the <cite>Server:</cite> header indicates the version of the web server that has generated the HTTP response. Some servers provide information about their software release and optional modules that they use. For security reasons, some system administrators disable these headers to avoid revealing too much information about their server to potential attackers.</p></li>
<li><p>the <cite>Date:</cite> header indicates when the HTTP response has been produced by the server.</p></li>
<li><p>the <cite>Last-Modified:</cite> header indicates the date and time of the last modification of the document attached to the HTTP response.</p></li>
</ul>
</div></blockquote>
<p>Similarly, the following header lines can only appear inside HTTP requests sent by a client:</p>
<blockquote>
<div><ul class="simple">
<li><p>the <cite>User-Agent:</cite> header provides information about the client that has generated the HTTP request. Some servers analyze this header line and return different headers and sometimes different documents for different user agents.</p></li>
<li><p>the <cite>If-Modified-Since:</cite> header is followed by a date. It enables clients to cache in memory or on disk recent or most frequently used documents. When a client needs to request a URI from a server, it first checks whether the document is already in its cache. If it is, the client sends an HTTP request with the <cite>If-Modified-Since:</cite> header indicating the date of the cached document. The server will only return the document attached to the HTTP response if it is newer than the version stored in the client’s cache.</p></li>
<li><p>the <cite>Referrer:</cite> header is followed by a URI. It indicates the URI of the document that the client visited before sending this HTTP request. Thanks to this header, the server can know the URI of the document containing the hyperlink followed by the client, if any. This information is very useful to measure the impact of advertisements containing hyperlinks placed on websites.</p></li>
<li><p>the <cite>Host:</cite> header contains the fully qualified domain name of the URI being requested.</p></li>
</ul>
</div></blockquote>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The importance of the <cite>Host:</cite> header line</p>
<p>The first version of HTTP did not include the <cite>Host:</cite> header line. This was a severe limitation for web hosting companies. For example consider a web hosting company that wants to serve both <cite>web.example.com</cite> and <cite>www.example.net</cite> on the same physical server. Both web sites contain a <cite>/index.html</cite> document. When a client sends a request for either <cite>http://web.example.com/index.html</cite> or <cite>http://www.example.net/index.html</cite>, the HTTP 1.0 request contains the following line :</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span/>GET /index.html HTTP/1.0
</pre></div>
</div>
<p>By parsing this line, a server cannot determine which <cite>index.html</cite> file is requested. Thanks to the <cite>Host:</cite> header line, the server knows whether the request is for <cite>http://web.example.com/index.html</cite> or <cite>http://www.dummy.net/index.html</cite>. Without the <cite>Host:</cite> header, this is impossible. The <cite>Host:</cite> header line allowed web hosting companies to develop their business by supporting a large number of independent web servers on the same physical server.</p>
</div>
<p>The status line of the HTTP response begins with the version of HTTP used by the server (usually <cite>HTTP/1.0</cite> defined in <span class="target" id="index-63"/><a class="rfc reference external" href="https://datatracker.ietf.org/doc/html/rfc1945.html"><strong>RFC 1945</strong></a> or <cite>HTTP/1.1</cite> defined in <span class="target" id="index-64"/><a class="rfc reference external" href="https://datatracker.ietf.org/doc/html/rfc2616.html"><strong>RFC 2616</strong></a>) followed by a three digit status code and additional information in English. HTTP status codes have a similar structure as the reply codes used by SMTP:</p>
<blockquote>
<div><ul class="simple">
<li><p>All status codes starting with digit <cite>2</cite> indicate a valid response. <cite>200 Ok</cite> indicates that the HTTP request was successfully processed by the server and that the response is valid.</p></li>
<li><p>All status codes starting with digit <cite>3</cite> indicate that the requested document is no longer available on the server. <cite>301 Moved Permanently</cite> indicates that the requested document is no longer available on this server. A <cite>Location:</cite> header containing the new URI of the requested document is inserted in the HTTP response. <cite>304 Not Modified</cite> is used in response to an HTTP request containing the <cite>If-Modified-Since:</cite> header. This status line is used by the server if the document stored on the server is not more recent than the date indicated in the <cite>If-Modified-Since:</cite> header.</p></li>
<li><p>All status codes starting with digit <cite>4</cite> indicate that the server has detected an error in the HTTP request sent by the client. <cite>400 Bad Request</cite> indicates a syntax error in the HTTP request. <cite>404 Not Found</cite> indicates that the requested document does not exist on the server.</p></li>
<li><p>All status codes starting with digit <cite>5</cite> indicate an error on the server. <cite>500 Internal Server Error</cite> indicates that the server could not process the request due to an error on the server itself.</p></li>
</ul>
</div></blockquote>
<p>In both HTTP requests and responses, the MIME document refers to a representation of the document with the MIME headers indicating the type of document and its size.</p>
<p>As an illustration of HTTP/1.0, the transcript below shows a HTTP request for <a class="reference external" href="http://www.ietf.org">http://www.ietf.org</a> and the corresponding HTTP response. The HTTP request was sent using the <a class="reference external" href="https://curl.haxx.se/">curl</a> command line tool. The <cite>User-Agent:</cite> header line contains more information about this client software. There is no MIME document attached to this HTTP request, and it ends with a blank line.</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span/>GET / HTTP/1.0
User-Agent: curl/7.19.4 (universal-apple-darwin10.0) libcurl/7.19.4 OpenSSL/0.9.8l zlib/1.2.3
Host: www.ietf.org
</pre></div>
</div>
<p>The HTTP response indicates the version of the server software used with the modules included. The <cite>Last-Modified:</cite> header indicates that the requested document was modified about one week before the request. A HTML document (not shown) is attached to the response. Note the blank line between the header of the HTTP response and the attached MIME document. The <cite>Server:</cite> header line has been truncated in this output.</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span/>HTTP/1.1 200 OK
Date: Mon, 15 Mar 2010 13:40:38 GMT
Server: Apache/2.2.4 (Linux/SUSE) mod_ssl/2.2.4 OpenSSL/0.9.8e (truncated)
Last-Modified: Tue, 09 Mar 2010 21:26:53 GMT
Content-Length: 17019
Content-Type: text/html

&lt;!DOCTYPE HTML PUBLIC .../HTML&gt;
</pre></div>
</div>
<p>HTTP was initially designed to share text documents. For this reason, and to ease the implementation of clients and servers, the designers of HTTP chose to open a TCP connection for each HTTP request. This implies that a client must open one TCP connection for each URI that it wants to retrieve from a server as illustrated on the figure below, showing HTTP 1.0 and the underlying TCP connection. For a web page containing only text documents this was a reasonable design choice as the client usually remains idle while the (human) user is reading the retrieved document.</p>
<p class="mscgen">
<img src="../Images/15f6359ba4c5a3cfe439a837a247edb5.png" alt="msc {&#10;a1 [label=&quot;&quot;, linecolour=white],&#10;a [label=&quot;&quot;, linecolour=white],&#10;b [label=&quot;Client&quot;, linecolour=black],&#10;z [label=&quot;&quot;, linecolour=white],&#10;c [label=&quot;Server&quot;, linecolour=black],&#10;d [label=&quot;&quot;, linecolour=white],&#10;d1 [label=&quot;&quot;, linecolour=white];&#10;&#10;a1=&gt;b [ label = &quot;CONNECT.request&quot; ] ,&#10;b&gt;&gt;c [ label = &quot;&quot;, arcskip=&quot;1&quot;];&#10;c=&gt;d1 [ label = &quot;CONNECT.indication&quot; ];&#10;&#10;d1=&gt;c [ label = &quot;CONNECT.response&quot; ] ,&#10;c&gt;&gt;b [ label = &quot;&quot;, arcskip=&quot;1&quot;];&#10;b=&gt;a1 [ label = &quot;CONNECT.confirm&quot; ];&#10;&#10;a1=&gt;b [ label = &quot;DATA.request(Request)&quot;, linecolour=red, textcolour=red],&#10;b&gt;&gt;c [ linecolour=red, arcskip=&quot;1&quot;];&#10;c==d1 [ label = &quot;DATA.indication(Request)&quot;, linecolour=red, textcolour=red];&#10;&#10;d1=&gt;c [ label = &quot;DATA.request(Response)&quot;, linecolour=blue, textcolour=blue] ,&#10;c&gt;&gt;b [ linecolour=blue, arcskip=&quot;1&quot;];&#10;b=&gt;a1 [ label = &quot;DATA.indication(Response)&quot;, linecolour=blue, textcolour=blue],&#10;d1=&gt;c [ label = &quot;DISCONNECT.request&quot;],&#10;c&gt;&gt;b [ arcskip=&quot;1&quot;];&#10;b=&gt;a1 [ label = &quot;DISCONNECT.indication&quot; ];&#10;&#10;a1=&gt;b [ label = &quot;DISCONNECT.request&quot; ] ,&#10;b&gt;&gt;c [ label = &quot;&quot;, arcskip=&quot;1&quot;];&#10;c=&gt;d1 [ label = &quot;DISCONNECT.indication&quot; ];&#10;}" usemap="#d49bedba389123d38d35a1fef746a30e5445ef03" data-original-src="https://4ed.computer-networking.info/syllabus/default/_images/mscgen-d49bedba389123d38d35a1fef746a30e5445ef03.png"/>
<map id="d49bedba389123d38d35a1fef746a30e5445ef03" name="d49bedba389123d38d35a1fef746a30e5445ef03"/></p>
<p>However, as the web evolved to support richer documents containing images, opening a TCP connection for each URI became a performance problem <a class="reference internal" href="../bibliography.html#mogul1995" id="id34"><span>[Mogul1995]</span></a>. Indeed, besides its HTML part, a web page may include dozens of images or more. Forcing the client to open a TCP connection for each component of a web page has two important drawbacks. First, the client and the server must exchange packets to open and close a TCP connection as we will see later. This increases the network overhead and the total delay of completely retrieving all the components of a web page. Second, a large number of established TCP connections may be a performance bottleneck on servers.</p>
<p>This problem was solved by extending HTTP to support persistent TCP connections <span class="target" id="index-65"/><a class="rfc reference external" href="https://datatracker.ietf.org/doc/html/rfc2616.html"><strong>RFC 2616</strong></a>. A persistent connection is a TCP connection over which a client may send several HTTP requests. This is illustrated in the figure below showing the persistent connection of HTTP 1.1.</p>
<p class="mscgen">
<img src="../Images/1dd234f6259caa842e7721e4f7b6857e.png" alt="msc {&#10;a1 [label=&quot;&quot;, linecolour=white],&#10;a [label=&quot;&quot;, linecolour=white],&#10;b [label=&quot;Client&quot;, linecolour=black],&#10;z [label=&quot;&quot;, linecolour=white],&#10;c [label=&quot;Server&quot;, linecolour=black],&#10;d [label=&quot;&quot;, linecolour=white],&#10;d1 [label=&quot;&quot;, linecolour=white];&#10;&#10;a1=&gt;b [ label = &quot;CONNECT.request&quot; ] ,&#10;b&gt;&gt;c [ label = &quot;&quot;, arcskip=&quot;1&quot;];&#10;c=&gt;d1 [ label = &quot;CONNECT.indication&quot; ];&#10;&#10;d1=&gt;c [ label = &quot;CONNECT.response&quot; ] ,&#10;c&gt;&gt;b [ label = &quot;&quot;, arcskip=&quot;1&quot;];&#10;b=&gt;a1 [ label = &quot;CONNECT.confirm&quot; ];&#10;&#10;a1=&gt;b [ label = &quot;&quot;, linecolour=red, textcolour=red],&#10;b&gt;&gt;c [ linecolour=red, arcskip=&quot;1&quot;];&#10;a1=&gt;b [ label = &quot;GET / HTTP1.1\nConnection: Keep-Alive\n...&quot;, linecolour=white, textcolour=red],&#10;c=&gt;d1 [ label = &quot;&quot;, linecolour=red, textcolour=red];&#10;&#10;d1=&gt;c [ label = &quot;&quot;, linecolour=blue, textcolour=blue] ,&#10;c&gt;&gt;b [ linecolour=blue, arcskip=&quot;1&quot;];&#10;d1=&gt;c [ label = &quot;HTTP/1.1 200 OK\nKeep-Alive: timeout=15, max=100\nConnection: Keep-Alive\n...&quot;, linecolour=white, textcolour=blue],&#10;b=&gt;a1 [ label = &quot;&quot;, linecolour=blue, textcolour=blue];&#10;&#10;a1=&gt;b [ label = &quot;&quot;, linecolour=red, textcolour=red],&#10;b&gt;&gt;c [ linecolour=red, arcskip=&quot;1&quot;];&#10;a1=&gt;b [ label = &quot;GET /images/logo.gif HTTP1.1\nConnection: Keep-Alive\n...&quot;, linecolour=white, textcolour=red],&#10;c=&gt;d1 [ label = &quot;&quot;, linecolour=red, textcolour=red];&#10;&#10;d1=&gt;c [ label = &quot;&quot;, linecolour=blue, textcolour=blue] ,&#10;c&gt;&gt;b [ linecolour=blue, arcskip=&quot;1&quot;];&#10;d1=&gt;c [ label = &quot;HTTP/1.1 200 OK\nKeep-Alive: timeout=15, max=99\nConnection: Keep-Alive\n...&quot;, linecolour=white, textcolour=blue],&#10;b=&gt;a1 [ label = &quot;&quot;, linecolour=blue, textcolour=blue];&#10;&#10;|||;&#10;d1=&gt;c [ label = &quot;DISCONNECT.request&quot;],&#10;c&gt;&gt;b [ arcskip=&quot;1&quot;];&#10;b=&gt;a1 [ label = &quot;DISCONNECT.indication&quot; ];&#10;&#10;&#10;a1=&gt;b [ label = &quot;DISCONNECT.request&quot; ] ,&#10;b&gt;&gt;c [ label = &quot;&quot;, arcskip=&quot;1&quot;];&#10;c=&gt;d1 [ label = &quot;DISCONNECT.indication&quot; ];&#10;}" usemap="#e3a7f46f483e3da6d68605217fa3410d14c6e31b" data-original-src="https://4ed.computer-networking.info/syllabus/default/_images/mscgen-e3a7f46f483e3da6d68605217fa3410d14c6e31b.png"/>
<map id="e3a7f46f483e3da6d68605217fa3410d14c6e31b" name="e3a7f46f483e3da6d68605217fa3410d14c6e31b"/></p>
<p>To allow the clients and servers to control the utilization of these persistent TCP connections, HTTP 1.1 <span class="target" id="index-66"/><a class="rfc reference external" href="https://datatracker.ietf.org/doc/html/rfc2616.html"><strong>RFC 2616</strong></a> defines several new HTTP headers:</p>
<blockquote>
<div><ul class="simple">
<li><p>The <cite>Connection:</cite> header is used with the <cite>Keep-Alive</cite> argument by the client to indicate that it expects the underlying TCP connection to be persistent. When this header is used with the <cite>Close</cite> argument, it indicates that the entity that sent it will close the underlying TCP connection at the end of the HTTP response.</p></li>
<li><p>The <cite>Keep-Alive:</cite> header is used by the server to inform the client about how it agrees to use the persistent connection. A typical <cite>Keep-Alive:</cite> contains two parameters: the maximum number of requests that the server agrees to serve on the underlying TCP connection and the timeout (in seconds) after which the server will close an idle connection</p></li>
</ul>
</div></blockquote>
<p>The example below shows the operation of HTTP/1.1 over a persistent TCP connection to retrieve three URIs stored on the same server. Once the connection has been established, the client sends its first request with the <cite>Connection: Keep-Alive</cite> header to request a persistent connection.</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span/>GET / HTTP/1.1
Host: www.kame.net
User-Agent: Mozilla/5.0 (Macintosh; U; Intel Mac OS X 10_6_2; en-us)
Connection: Keep-Alive
</pre></div>
</div>
<p>The server replies with the <cite>Connection: Keep-Alive</cite> header and indicates that it accepts a maximum of 100 HTTP requests over this connection and that it will close the connection if it remains idle for 15 seconds.</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span/>HTTP/1.1 200 OK
Date: Fri, 19 Mar 2010 09:23:37 GMT
Server: Apache/2.0.63 (FreeBSD) PHP/5.2.12 with Suhosin-Patch
Keep-Alive: timeout=15, max=100
Connection: Keep-Alive
Content-Length: 3462
Content-Type: text/html

&lt;html&gt;...   &lt;/html&gt;
</pre></div>
</div>
<p>The client sends a second request for the style sheet of the retrieved web page.</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span/>GET /style.css HTTP/1.1
Host: www.kame.net
Referer: http://www.kame.net/
User-Agent: Mozilla/5.0 (Macintosh; U; Intel Mac OS X 10_6_2; en-us)
Connection: keep-alive
</pre></div>
</div>
<p>The server replies with the requested style sheet and maintains the persistent connection. Note that the server only accepts 99 remaining HTTP requests over this persistent connection.</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span/>HTTP/1.1 200 OK
Date: Fri, 19 Mar 2010 09:23:37 GMT
Server: Apache/2.0.63 (FreeBSD) PHP/5.2.12 with Suhosin-Patch
Last-Modified: Mon, 10 Apr 2006 05:06:39 GMT
Content-Length: 2235
Keep-Alive: timeout=15, max=99
Connection: Keep-Alive
Content-Type: text/css

...
</pre></div>
</div>
<p>Then the client requested the web server’s icon <a class="footnote-reference brackets" href="#ffavicon" id="id35" role="doc-noteref"><span class="fn-bracket">[</span>18<span class="fn-bracket">]</span></a>. This server does not contain such an icon and thus replies with a <cite>404</cite> HTTP status. However, the underlying TCP connection is not closed immediately.</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span/>GET /favicon.ico HTTP/1.1
Host: www.kame.net
Referer: http://www.kame.net/
User-Agent: Mozilla/5.0 (Macintosh; U; Intel Mac OS X 10_6_2; en-us)
Connection: keep-alive

HTTP/1.1 404 Not Found
Date: Fri, 19 Mar 2010 09:23:40 GMT
Server: Apache/2.0.63 (FreeBSD) PHP/5.2.12 with Suhosin-Patch
Content-Length: 318
Keep-Alive: timeout=15, max=98
Connection: Keep-Alive
Content-Type: text/html; charset=iso-8859-1

&lt;!DOCTYPE HTML PUBLIC "-//IETF//DTD HTML 2.0//EN"&gt; ...
</pre></div>
</div>
<p>As illustrated above, a client can send several HTTP requests over the same persistent TCP connection. However, it is important to note that all of these HTTP requests are considered to be independent by the server. Each HTTP request must be self-contained. This implies that each request must include all the header lines that are required by the server to understand the request. The independence of these requests is one of the key design choices of HTTP. As a consequence of this design choice, when a server processes a HTTP request, it does not use any other information than what is contained in the request itself. This explains why the client adds its <cite>User-Agent:</cite> header in all of the HTTP requests that it sends over the persistent TCP connection.</p>
<p>However, in practice, some servers want to provide content tuned for each user. For example, some servers can provide information in several languages. Other servers want to provide advertisements that are targeted to different types of users. To do this, servers need to maintain some information about the preferences of each user and use this information to produce content matching the user’s preferences. HTTP contains several mechanisms to solve this problem. We discuss three of them below.</p>
<p>A first solution is to force the users to be authenticated. This was the solution used by <cite>FTP</cite> to control the files that each user could access. Initially, user names and passwords could be included inside URIs <span class="target" id="index-67"/><a class="rfc reference external" href="https://datatracker.ietf.org/doc/html/rfc1738.html"><strong>RFC 1738</strong></a>. However, placing passwords in the clear in a potentially publicly visible URI is completely insecure and this usage has now been deprecated <span class="target" id="index-68"/><a class="rfc reference external" href="https://datatracker.ietf.org/doc/html/rfc3986.html"><strong>RFC 3986</strong></a>. HTTP supports several extension headers <span class="target" id="index-69"/><a class="rfc reference external" href="https://datatracker.ietf.org/doc/html/rfc2617.html"><strong>RFC 2617</strong></a> that can be used by a server to request the authentication of the client by providing his/her credentials. However, user names and passwords have not been popular on web servers as they force human users to remember one user name and one password per server. Remembering a password is acceptable when a user needs to access protected content, but users will not accept to remember a unique user name and password for each web sites that they visit.</p>
<p>A second solution to allow servers to tune that content to the needs and capabilities of the user is to rely on the different types of <cite>Accept-*</cite> HTTP headers. For example, the <cite>Accept-Language:</cite> header can be used by the client to indicate its preferred languages. Unfortunately, in practice this header is usually set based on the default language of the browser and it is difficult for a user to indicate the language it prefers by selecting options for each visited web server.</p>
<p>The third and widely adopted solution are HTTP cookies. HTTP cookies were initially developed as a private extension by <a class="reference external" href="https://en.wikipedia.org/wiki/Netscape">Netscape</a>. They are now part of the standard <span class="target" id="index-70"/><a class="rfc reference external" href="https://datatracker.ietf.org/doc/html/rfc6265.html"><strong>RFC 6265</strong></a>. In a nutshell, a cookie is a short string that is chosen by a server to represent a given client. Two HTTP headers are used : <cite>Cookie:</cite> and <cite>Set-Cookie:</cite>. When a server receives an HTTP request from a new client (i.e. an HTTP request that does not contain the <cite>Cookie:</cite> header), it generates a cookie for the client and includes it in the <cite>Set-Cookie:</cite> header of the returned HTTP response. The <cite>Set-Cookie:</cite> header contains several additional parameters including the domain names for which the cookie is valid. The client stores all received cookies on disk and every time it sends an HTTP request, it verifies whether it already knows a cookie for this domain. If so, it attaches the <cite>Cookie:</cite> header to the HTTP request. This is illustrated in the figure below with HTTP 1.1, but cookies also work with HTTP 1.0.</p>
<p class="mscgen">
<img src="../Images/46342147d4ef4a386569e9a3c497ba69.png" alt="msc {&#10;a1 [label=&quot;&quot;, linecolour=white],&#10;a [label=&quot;&quot;, linecolour=white],&#10;b [label=&quot;Client&quot;, linecolour=black],&#10;z [label=&quot;&quot;, linecolour=white],&#10;c [label=&quot;Server&quot;, linecolour=black],&#10;d [label=&quot;&quot;, linecolour=white],&#10;d1 [label=&quot;&quot;, linecolour=white];&#10;&#10;a1=&gt;b [ label = &quot;&quot;, linecolour=red, textcolour=red],&#10;b&gt;&gt;c [ linecolour=red, arcskip=&quot;1&quot;];&#10;a1=&gt;b [ label = &quot;GET / HTTP1.1\n...&quot;, linecolour=white, textcolour=red],&#10;c=&gt;d1 [ label = &quot;&quot;, linecolour=red, textcolour=red];&#10;&#10;d1=&gt;c [ label = &quot;&quot;, linecolour=blue, textcolour=blue] ,&#10;c&gt;&gt;b [ linecolour=blue, arcskip=&quot;1&quot;];&#10;d1=&gt;c [ label = &quot;HTTP/1.1 200 OK\nSet-Cookie: machin\n...&quot;, linecolour=white, textcolour=blue],&#10;b=&gt;a1 [ label = &quot;&quot;, linecolour=blue, textcolour=blue];&#10;a1=&gt;b [ label = &quot;Browser saves cookie&quot;, linecolour=white],&#10;c=&gt;d1 [ label = &quot;Normal response&quot;, linecolour=white];&#10;&#10;a1=&gt;b [ label = &quot;&quot;, linecolour=red, textcolour=red],&#10;b&gt;&gt;c [ linecolour=red, arcskip=&quot;1&quot;];&#10;a1=&gt;b [ label = &quot;GET /doc HTTP1.1\nCookie: machin\n...&quot;, linecolour=white, textcolour=red],&#10;c=&gt;d1 [ label = &quot;&quot;, linecolour=red, textcolour=red];&#10;&#10;d1=&gt;c [ label = &quot;&quot;, linecolour=blue, textcolour=blue] ,&#10;c&gt;&gt;b [ linecolour=blue, arcskip=&quot;1&quot;];&#10;d1=&gt;c [ label = &quot;HTTP/1.1 200 OK\n...&quot;, linecolour=white, textcolour=blue],&#10;b=&gt;a1 [ label = &quot;&quot;, linecolour=blue, textcolour=blue];&#10;c=&gt;d1 [ label = &quot;Response is function\nof URL and cookie&quot;, linecolour=white];&#10;&#10;a1=&gt;b [ label = &quot;&quot;, linecolour=red, textcolour=red],&#10;b&gt;&gt;c [ linecolour=red, arcskip=&quot;1&quot;];&#10;a1=&gt;b [ label = &quot;GET /images/t.gif HTTP1.1\nCookie: machin\n...&quot;, linecolour=white, textcolour=red],&#10;c=&gt;d1 [ label = &quot;&quot;, linecolour=red, textcolour=red];&#10;&#10;d1=&gt;c [ label = &quot;&quot;, linecolour=blue, textcolour=blue] ,&#10;c&gt;&gt;b [ linecolour=blue, arcskip=&quot;1&quot;];&#10;d1=&gt;c [ label = &quot;HTTP/1.1 200 OK\n...&quot;, linecolour=white, textcolour=blue],&#10;b=&gt;a1 [ label = &quot;&quot;, linecolour=blue, textcolour=blue];&#10;a1=&gt;b [ label = &quot;Browser sends cookie in\nall requests sent to server&quot;, linecolour=white];&#10;}" usemap="#577adf721a7a6a7a5af9beec3659eccef6881630" data-original-src="https://4ed.computer-networking.info/syllabus/default/_images/mscgen-577adf721a7a6a7a5af9beec3659eccef6881630.png"/>
<map id="577adf721a7a6a7a5af9beec3659eccef6881630" name="577adf721a7a6a7a5af9beec3659eccef6881630"/></p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Privacy issues with HTTP cookies</p>
<p>The HTTP cookies introduced by <a class="reference external" href="https://en.wikipedia.org/wiki/Netscape">Netscape</a> are key for large e-commerce websites. However, they have also raised many discussions concerning their <a class="reference external" href="http://www.nytimes.com/2001/09/04/technology/04COOK.html">potential misuses</a>. Consider <cite>ad.com</cite>, a company that delivers lots of advertisements on web sites. A web site that wishes to include <cite>ad.com</cite>’s advertisements next to its content will add links to <cite>ad.com</cite> inside its HTML pages. If <cite>ad.com</cite> is used by many web sites, <cite>ad.com</cite> could be able to track the interests of all the users that visit its client websites and use this information to provide targeted advertisements. Privacy advocates have even <a class="reference external" href="http://epic.org/privacy/internet/cookies/">sued</a> online advertisement companies to force them to comply with the privacy regulations. More recent related technologies also raise <a class="reference external" href="http://www.eff.org/deeplinks/2009/09/new-cookie-technologies-harder-see-and-remove-wide">privacy concerns</a>.</p>
</div>
</section>
<section id="http-version-2-0">
<span id="http2"/><h3>HTTP version 2.0<a class="headerlink" href="#http-version-2-0" title="Link to this heading">#</a></h3>
<p>During the last decade, a growing number of services have been supported by world wide web servers. The web protocols are not only used to deliver static documents, they are also used to deliver streaming music or video. They also enable clients to use interactive applications including games or productivity applications. These services and applications have more stringent performance requirements than the delivery of static documents. Many researchers and companies have proposed solutions to improve the performance of web services and protocols during the last decade <a class="reference internal" href="../bibliography.html#kr2001" id="id36"><span>[KR2001]</span></a> <a class="reference internal" href="../bibliography.html#wbk2014" id="id37"><span>[WBK2014]</span></a>. We discuss a subset of them in this section.</p>
<p>A first way to improve the performance of the web protocols is to tune the servers that provide content. In the early days, documents were stored on a single server. Clients established TCP connections to this server to retrieve each document. This architecture evolved in several directions. A first way to speedup web services is to avoid unnecessary transmissions. Thanks to the <cite>HEAD</cite> method and the <cite>If-Modified-Since:</cite> header, web browsers can verify that they have the most recent version of a document in their cache.</p>
<blockquote>
<div><div class="figure" id="id65" style="text-align: center">
<span id="fig-web-proxy"/><p><img src="../Images/e9483f4f858b0589cf3d76890882a4d6.png" alt="Figure made with TikZ" data-original-src="https://4ed.computer-networking.info/syllabus/default/_images/tikz-05c525754f05b235f3df09dac26b1026a2609c06.png"/></p>
<p><span class="caption-number">Fig. 36 </span><span class="caption-text">Proxies relay client requests to servers and return the received responses</span></p>
</div></div></blockquote>
<p>Caches can also be used inside the network. To understand their benefits, let us consider an SME with a dozen of employees that are connected to the Internet through a low-speed link. These employees often access similar web sites. Consider that Alice and Bob want to browse today’s local newspaper. Their browsers will both retrieve the newspaper’s website through the low bandwidth link and store the main documents in their cache. Unfortunately, the same information passes twice over the low-speed link. Some companies have deployed web proxies to cope with this problem. A web proxy is a server that resides in the enterprise network. All the employee’s browsers are configured to send their HTTP requests to this proxy. When such a proxy receives a request, it checks whether the content is already stored inside its own cache. If so, it returns it directly. Otherwise, the request is sent to the remote server and the information is stored in the proxy cache. By reducing the number of web objects that are exchanged over low-speed links, such proxies can significantly improve performance. Some companies also use them to control the websites that are contacted by their employees and sometimes block illegitimate accesses.</p>
<p>Proxies can also be located in front of servers. In this case, they are called reverse-proxies. Consider a dynamic web server that produces web pages by assembling information stored in different databases. When this server receives a request, it must send multiple queries to its databases and then create the HTML document. These queries and the creation of the HTML document take time and this limits the number of requests that our server can sustain. Many content providers would place a reverse proxy in front of such a server. The DNS servers are configured to point to the reverse proxy. Upon reception of a request, the reverse proxy first checks whether the response is already stored in its cache. If so, it can return it to the client without interacting with the official server. Otherwise, the reverse proxy contacts the server and then returns the response to the client.</p>
<p>These reverse proxies can also be used to spread the load among different servers. In the above example, consider that a server needs 10 milliseconds to process each request and that it must handle them sequentially. Such a server cannot support more than 100 requests per second. If the service becomes popular, then the content provider will need to deploy several servers. These servers could serve the same reverse proxy.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Serving content from multiple servers</p>
<p>When a web user interacts with <cite>www.service.net</cite>, she expects that all the information comes from the <cite>www.service.net</cite> server. If the service is popular, there are probably tens, hundreds, thousands or more physical servers that support this service. Still, the user has the illusion that she is interacting with a single server. Several techniques have been deployed by content providers to scale web services. Consider a simple service that serves text documents from <cite>N</cite> different servers. There are different ways to architect such a service.</p>
<p>A first approach is to store all files on each physical server and rely on the DNS to distribute the load among them. Each physical server has its own IP address and when the DNS server receives a query for <cite>www.service.net</cite>, it returns the IP address of one of them. Some DNS servers use Round-Robin to return one of these IP addresses. Others measure the load of the physical servers and return the address of the less loaded one. Another possibility is to locate the physical servers in different regions and configure the DNS server to return the IP address of the server that is geographically closer to the client’s IP address.</p>
<p>A second approach is to rely on <cite>k</cite> reverse proxies and <cite>N-k</cite> servers. The servers store the content and the proxies cache the most frequently used files. The proxies can be geographically close to the clients while the servers can reside in the datacenters of the content provider. The DNS server can also distribute the load among the different proxies or return the geographically closest proxy. An important point to note about reverse proxies is that they receive HTTP requests from clients and send HTTP requests to the original servers that host the content. Several companies, usually called Content Distribution Networks, have deployed such reverse proxies throughout the world to cache web content next to the end-users. A good description of such a CDN may be found in <a class="reference internal" href="../bibliography.html#nss2010" id="id38"><span>[NSS2010]</span></a>.</p>
</div>
<p>A second way to improve the web performance is to reduce the time required to retrieve web objects. While the first web servers returned an HTML documents with possibly a few images, today’s rich web servers return one HTML document with associated style sheets, javascript code, images, fonts, … Some of these web objects come from the original server while others are hosted on different servers. Today, a typical web page contains almost 2 MBytes of data on average. The size of the web pages continues to grow according to statistics collected by <cite>httparchive.org</cite> as shown in <a class="reference internal" href="#fig-httparchive"><span class="std std-numref">Fig. 37</span></a>. Web pages targeted to mobile devices are slightly smaller.</p>
<figure class="align-center" id="id66">
<span id="fig-httparchive"/><a class="reference internal image-reference" href="../_images/httparchive-bytes.png"><img alt="../_images/httparchive-bytes.png" src="../Images/e512429b911bc1ff17df73d156e86ce1.png" style="width: 720.0px; height: 480.0px;" data-original-src="https://4ed.computer-networking.info/syllabus/default/_images/httparchive-bytes.png"/>
</a>
<figcaption>
<p><span class="caption-number">Fig. 37 </span><span class="caption-text">Evolution of the size of the web pages (source: <a class="reference external" href="https://httparchive.org/reports/page-weight">https://httparchive.org/reports/page-weight</a>)</span><a class="headerlink" href="#id66" title="Link to this image">#</a></p>
</figcaption>
</figure>
<p>A closer look at the average web page shows that it contains, on average, 27 KBytes of HTML, 120 KBytes of fonts, 60 KBytes of CSS information, almost 1 MBytes of images and more than 400 KBytes of javascript.  Each of these web page requires about 70 different HTTP requests. In other words, a browser needs to send on average 70 requests to retrieve a complete web page.</p>
<p>Two directions have been explored to improve the delivery of these web pages. The first direction is to tune the HTTP protocol. The second approach is to change the entire network stack. This approach is discussed in the QUIC chapter.</p>
<p>One of the limitations of HTTP from a performance viewpoint is that the requests that are sent by a browser must be sequential. Typically, a browser requests the HTML page. Once the page has been retrieved, the browser parses it to identify all the objects that it references and requests them one after each other. The web page can only be displayed to the user once all the required web objects have been retrieved. This implies that the browser must wait until the reception of each response before sending the next request. Another possibility is to allow the browser to send multiple requests without waiting for their corresponding responses. This approach is called <cite>pipelining</cite> in <span class="target" id="index-71"/><a class="rfc reference external" href="https://datatracker.ietf.org/doc/html/rfc7230.html"><strong>RFC 7230</strong></a>.</p>
<p>To understand the benefits of pipelining, let us consider a simple but illustrative example. A client needs to retrieve 5 web objects that are each 100 bytes. The underlying transport connection has a 1 Gbps bandwidth but a one-way delay of 100 msec. A normal HTTP/1.x client would send the first request, wait 200 msec to receive the answer, then send another request… It would need one entire second to retrieve the five web objects. This is illustrated in <a class="reference internal" href="#fig-http-nopipelining"><span class="std std-numref">Fig. 38</span></a>.</p>
<div class="figure" id="id67" style="text-align: center">
<span id="fig-http-nopipelining"/><p><img src="../Images/902ce8ac285bbf69a2f6e825e8e51419.png" alt="Figure made with TikZ" data-original-src="https://4ed.computer-networking.info/syllabus/default/_images/tikz-ca125cad3bdce90b39b9ded24ca279bf4ba28bf6.png"/></p>
<p><span class="caption-number">Fig. 38 </span><span class="caption-text">A sequence of HTTP requests to a given server</span></p>
</div><p>With <cite>pipelining</cite>, the client sends the five requests immediately and receives the five responses after 200 msec. <a class="reference internal" href="#fig-http-pipelining"><span class="std std-numref">Fig. 39</span></a> illustrates the benefits of <cite>pipelining</cite>.</p>
<div class="figure" id="id68" style="text-align: center">
<span id="fig-http-pipelining"/><p><img src="../Images/d0394b043492534d50c59a67578ea778.png" alt="Figure made with TikZ" data-original-src="https://4ed.computer-networking.info/syllabus/default/_images/tikz-b3813db3df8e3cc996d74f94fe7f87616d863710.png"/></p>
<p><span class="caption-number">Fig. 39 </span><span class="caption-text">A sequence of HTTP requests to a server with pipelining</span></p>
</div><p>However, as explained in <span class="target" id="index-72"/><a class="rfc reference external" href="https://datatracker.ietf.org/doc/html/rfc7230.html"><strong>RFC 7230</strong></a>, there is one important limitation to <cite>pipelining</cite>. It can only be used to serve HTTP requests that are idempotent, i.e. none of the requests must depend on any of the previous requests in the pipeline. It turned out that it was difficult for web browsers to correctly support this requirement and very few of them have implemented <cite>pipelining</cite> <a class="footnote-reference brackets" href="#fpipelining" id="id39" role="doc-noteref"><span class="fn-bracket">[</span>19<span class="fn-bracket">]</span></a>.</p>
<p>Another limitation of HTTP/1.1 is that all commands and parameters are encoded as ASCII strings. Using ASCII strings makes it easy to write simple clients or debug problems by observing packets. Unfortunately, the burden is placed on servers that need to include complex parsers that accept a wide range of partially compliant implementations. Furthermore, the flexibility of the ASCII encoding has enabled some classes of security attacks on servers <a class="reference internal" href="../bibliography.html#cwe444" id="id40"><span>[CWE444]</span></a>.</p>
<p>To cope with these two problems, the IETF HTTP working group developed version 2.0 of HTTP. HTTP/2.0 diverges from HTTP/1.1 in two important ways. First, HTTP/2.0 relies on binary encoding which is both more compact and easier to parse. Second, HTTP/2.0 supports multiple streams, which makes it possible to simultaneously transfer different web objects over a single transport connection. Furthermore, HTTP/2.0 also compresses the HTTP headers to reduce the amount of data transferred. This technique is described in <span class="target" id="index-73"/><a class="rfc reference external" href="https://datatracker.ietf.org/doc/html/rfc7541.html"><strong>RFC 7541</strong></a> but is not discussed in this chapter.</p>
<p>Let us first examine how HTTP/2.0 structures the bytestream of the underlying connection.</p>
<figure class="align-center" id="id69">
<span id="fig-http2-frame"/><a class="reference internal image-reference" href="../_images/http2-frame.svg"><img alt="../_images/http2-frame.svg" src="../Images/70ec7c103b170dfdecf10fd670dc9b85.png" style="width: 579.0px; height: 144.0px;" data-original-src="https://4ed.computer-networking.info/syllabus/default/_images/http2-frame.svg"/>
</a>
<figcaption>
<p><span class="caption-number">Fig. 40 </span><span class="caption-text">The HTTP/2.0 Frame header</span><a class="headerlink" href="#id69" title="Link to this image">#</a></p>
</figcaption>
</figure>
<p>The information exchanged over an HTTP/2.0 session is composed of frames. A frame starts with a 9 bytes-long header that carries several types of information as shown in <a class="reference internal" href="#fig-http2-frame"><span class="std std-numref">Fig. 40</span></a>. The HTTP/2.0 frames have a variable length. The <cite>Length</cite> field of the header contains the length of the frame payload in bytes. As this field is encoded as a 24 bits field, an HTTP/2.0 frame cannot be longer than <span class="math notranslate nohighlight">\(2^{24} -1\)</span> bytes. It should be noted that <span class="target" id="index-74"/><a class="rfc reference external" href="https://datatracker.ietf.org/doc/html/rfc7540.html"><strong>RFC 7540</strong></a> assumes a maximum size of <span class="math notranslate nohighlight">\(2^{14}\)</span> bytes, i.e. 16,384 bytes for the HTTP/2.0 frame payload unless a longer maximum frame length has been negotiated at the beginning of the session using the HTTP/2.0 <cite>Settings</cite> frame that will be described later. The next field of the frames header indicates the frame type. The first frame types are <cite>Data</cite> which contains data from web objects and <cite>Headers</cite> containing HTTP/2.0 headers. When a client retrieves a web object from a server, it always receives an HTTP/2.0 <cite>Headers</cite> frame followed by an HTTP/2.0 <cite>Data</cite> frame. The <cite>Headers</cite> frame information contains essentially the same HTTP headers as the ones supported by HTTP/1.1, but those are encoded by leveraging a data compression technique that minimizes the number of bytes required to transmit them.</p>
<p>Other frame types are described later. The <cite>Flags</cite> are used for some frame types and the <cite>R</cite> bit must be set to zero. The last important field of the <cite>HTTP/2.0 Frame</cite> header is the <cite>Stream Identifier</cite>. With HTTP/2.0, the bytestream of the underlying transport connection is divided in independent streams that are identified by an integer. The odd (resp. even) stream identifiers are managed by the client (resp. server). This enables the server (or the client) to multiplex data corresponding to different frames over a single bytestream.</p>
<p id="index-75">This multiplexing capability is probably the most important feature of HTTP/2.0 from a performance viewpoint. To understand its benefits, let us consider a client that retrieves two web objects over a 1 Mbps connection. The two requests are sent together by the client. The first object is 125 bytes long, while the second is 12500 bytes long. In this case, the server will first return the first object as a single frame and the second will be sent in the subsequent frame.</p>
<p>Consider now that the first object is 12500 bytes long and the second 125 bytes long as shown in <a class="reference internal" href="#fig-http-hol"><span class="std std-numref">Fig. 41</span></a>. With a 1 Mbps connection, this object will use the underlying connection during 100 milliseconds. The client will thus need to wait 100 milliseconds to retrieve the second object. This is the <cite>Head of Line</cite> (HoL) blocking problem that affects the performance of many web services. If the short web object is a javascript code that requests other web objects, its retrieval may be critical to display the retrieved web page.</p>
<div class="figure" id="id70" style="text-align: center">
<span id="fig-http-hol"/><p><img src="../Images/7fc784e24d2a3dd0171363ba394ef8ba.png" alt="Figure made with TikZ" data-original-src="https://4ed.computer-networking.info/syllabus/default/_images/tikz-7185aba6e91e748e3c4daf068076253fb73a87c6.png"/></p>
<p><span class="caption-number">Fig. 41 </span><span class="caption-text">Head-of-line blocking, a large response may deal a small one</span></p>
</div><p>With HTTP/2.0 frames, the server could send the first 1250 bytes of the long object during 10 milliseconds, then send a second frame that contains the short object during one millisecond and later send a longer frame that contains the remaining 11250 bytes of the long object. This is illustrated in <a class="reference internal" href="#fig-http2-no-hol"><span class="std std-numref">Fig. 42</span></a>. In this case, the client has received the short object after 10 milliseconds. Given the HTTP/2.0 streams, the transmission of long web objects does not anymore blocks the transmission of shorter ones.</p>
<p>The length of the HTTP/2.0 frames obviously affects how different web objects can be multiplexed over the underlying transport connection. If HTTP/2.0 frames are long, the overhead of the frame header is minimal, but long frames can block short web objects. On the other hand, if the frame length is small, then the overhead due to the HTTP/2.0 frame header could become significant.</p>
<div class="figure" id="id71" style="text-align: center">
<span id="fig-http2-no-hol"/><p><img src="../Images/8873fd6b2b8e1c27c72e08f4926f28fb.png" alt="Figure made with TikZ" data-original-src="https://4ed.computer-networking.info/syllabus/default/_images/tikz-3fc9d3e76128d78fbcabea984f4061d76c9729f1.png"/></p>
<p><span class="caption-number">Fig. 42 </span><span class="caption-text">The data from HTTP/2 frames can be interleaved to prevent head-of-line blocking</span></p>
</div><p>The HTTP/2.0 streams can provide performance benefits, but they also increase the complexity of the implementations since an HTTP/2.0 receiver must be able to simultaneously process frames that correspond to different web objects. This complexity mainly resides on the client side. The HTTP/2.0 protocol includes several techniques that enable clients to manage the utilization of the HTTP/2.0 session.</p>
<p>The first frame that a client sends over an HTTP/2.0 session is the <cite>Settings</cite> frame. This is a control frame that indicates some parameters that the client proposes for this session. Several of these parameters are defined in <span class="target" id="index-76"/><a class="rfc reference external" href="https://datatracker.ietf.org/doc/html/rfc7540.html"><strong>RFC 7540</strong></a>. The most important ones are probably the <cite>SETTINGS_MAX_FRAME_SIZE</cite> that specifies the maximum length of the HTTP/2.0 frames that this implementation supports and the <cite>SETTINGS_MAX_CONCURRENT_STREAMS</cite> that specifies the maximum number of parallel streams that this implementation can manage. The <cite>SETTINGS_MAX_FRAME_SIZE</cite> must be at least <span class="math notranslate nohighlight">\(2^{14}\)</span> bytes but can go up to <span class="math notranslate nohighlight">\(2^{24} -1\)</span> bytes. There is no minimum value for <cite>SETTINGS_MAX_CONCURRENT_STREAMS</cite>, but <span class="target" id="index-77"/><a class="rfc reference external" href="https://datatracker.ietf.org/doc/html/rfc7540.html"><strong>RFC 7540</strong></a> recommends to support at least 100 different stream identifiers.</p>
<p>By using multiple streams, the server can multiplex different web objects over the same underlying transport connection. However, these objects are only sent in response to requests from clients. There are some situations where the server might know in advance that the client will request a given object. It could speedup the transfer by sending it before having received a client request. This is the <cite>push</cite> feature of HTTP/2.0. A server can independently push web objects to a client without having received any request. This feature can only be used by the server if the client has enabled it by sending <cite>SETTINGS_ENABLE_PUSH</cite> in its <cite>Settings</cite> frame. A classical use case for this <cite>push</cite> feature is to enable a server to automatically send an object which cannot be cached by the client, such as a dynamic javascript code, when another web object that references it is requested. However, measurement studies indicate that very few web servers seem to have adopted this feature <a class="reference internal" href="../bibliography.html#zwh2018" id="id41"><span>[ZWH2018]</span></a>.</p>
<p>Another feature of HTTP/2.0 is that it is possible to assign different priorities to different streams. A high priority stream should carry more <cite>Data</cite> frames than a lower priority ones. The HTTP/2.0 specification defines <cite>Priority</cite> frames which can be used for this purpose.</p>
<p>As the server can send multiple objects at the same time, there is a risk of overloading the client buffers. To cope with this potential problem, HTTP/2.0 includes its own flow control mechanism. When an HTTP/2.0 session starts, a receiver agrees to receive up to 65,535 bytes over this connection (unless it has indicated a different initial window in its <cite>Settings</cite> frame). This limits the amount of data that a sender can transmit over the HTTP/2.0 session. The receiver can advertise a large receive window by sending a <cite>Window_Update</cite> frame at any time. This flow control mechanism can be applied to the entire connection or to a specific stream. In practice, using a small <cite>HTTP/2.0 window</cite> could severely limit the throughput over an HTTP/2.0 session.</p>
<p>HTTP/2.0 includes much more than what we have covered in this short introduction. There is for example a <cite>Ping</cite> frame that allows measuring the round-trip-time between a client and a server or the <cite>GoAway</cite> frame that indicates the termination of an HTTP/2.0 session. This frame contains an error code that indicates why the session has been terminated. Several error codes are defined in <span class="target" id="index-78"/><a class="rfc reference external" href="https://datatracker.ietf.org/doc/html/rfc7540.html"><strong>RFC 7540</strong></a>, including <cite>ENHANCE_YOUR_CALM</cite> that is used to indicate that the other endpoint exhibits an behavior that could cause excessive load.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Detecting whether a server supports HTTP/2.0</p>
<p>HTTP/2.0 is a new version of the HTTP protocol that still uses port 80. When a client contacts an HTTP server, it must be able to determine whether it supports HTTP/1.x or HTTP/2.0. If the client sends a binary encoded HTTP/2.0 request to a server that only supports the ASCII encoded HTTP/1.x, it could cause problems on the server and even crash it. To minimize the risk of crashing HTTP/1.x servers, an HTTP/2.0 session starts like an HTTP/1.1 session and the first request contains the <cite>Connection</cite>, <cite>Upgrade</cite> and <cite>HTTP2-Settings</cite> headers. An example of such a request to upgrade the version of HTTP is shown below.</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span/><span class="go">GET /robots.txt HTTP/1.1</span>
<span class="go">Host: nghttp2.org</span>
<span class="go">User-Agent: curl/7.52.1</span>
<span class="go">Connection: Upgrade, HTTP2-Settings</span>
<span class="go">Upgrade: h2c</span>
<span class="go">HTTP2-Settings: AAMAAABkAARAAAAA</span>
</pre></div>
</div>
<p>The <cite>HTTP2-Settings</cite> line contains the HTTP/2.0 settings frame that the client would server over an HTTP/2.0 session encoded in Base64. The server replies with a response that indicates that it has accepted to upgrade the connection to HTTP/2.0. A sample response is shown below.</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span/><span class="go">HTTP/1.1 101 Switching Protocols</span>
<span class="go">Connection: Upgrade</span>
<span class="go">Upgrade: h2c</span>
</pre></div>
</div>
<p>Finally, the client and the server need to confirm the utilization of HTTP/2.0. A client confirms this by sending the following Magic string <cite>PRI * HTTP/2.0rnrnSMrnrn</cite> or <cite>0x505249202a20485454502f322e300d0a0d0a534d0d0a0d0a</cite> in hex. This string is followed by a SETTINGS frame. The server must send a possibly empty SETTINGS frame.</p>
</div>
</section>
</section>
<section id="remote-procedure-calls">
<h2>Remote Procedure Calls<a class="headerlink" href="#remote-procedure-calls" title="Link to this heading">#</a></h2>
<p>In the previous sections, we have described several protocols that enable humans to exchange messages and access to remote documents. This is not the only usage of computer networks and in many situations applications use the network to exchange information with other applications. When an application needs to perform a large computation on a host, it can sometimes be useful to request computations from other hosts. Many distributed systems have been built by distributing applications on different hosts and using <cite>Remote Procedure Calls</cite> as a basic building block.</p>
<p>In traditional programming languages, <cite>procedure calls</cite> allow programmers to better structure their code. Each procedure is identified by a name, a return type and a set of parameters. When a procedure is called, the current flow of program execution is diverted to execute the procedure. This procedure uses the provided parameters to perform its computation and returns one or more values. This programming model was designed with a single host in mind. In a nutshell, most programming languages support it as follows :</p>
<blockquote>
<div><ol class="arabic simple">
<li><p>The caller places the values of the parameters at a location (register, stack, …) where the callee can access them</p></li>
<li><p>The caller transfers the control of execution to the callee’s procedure</p></li>
<li><p>The callee accesses the parameters and performs the requested computation</p></li>
<li><p>The callee places the return value(s) at a location (register, stack, …) where the caller can access them</p></li>
<li><p>The callee returns the control of execution to the caller’s</p></li>
</ol>
</div></blockquote>
<p>This model was developed with a single host in mind. How should it be modified if the caller and the callee are different hosts connected through a network ? Since the two hosts can be different, the two main problems are the fact they do not share the same memory and that they do not necessarily use the same representation for numbers, characters, … Let us examine how the five steps identified above can be supported through a network.</p>
<p>The first problem to be solved is how to transfer the information from the caller to the callee. This problem is not simple and includes two sub-problems. The first sub-problem is the encoding of the information. How to encode the values of the parameters so that they can be transferred correctly through the network ? The second problem is how to reach the callee through the network ? The callee is identified by a procedure name, but to use the transport service, we need to convert this name into an address and a port number.</p>
<section id="encoding-data">
<span id="index-79"/><h3>Encoding data<a class="headerlink" href="#encoding-data" title="Link to this heading">#</a></h3>
<p>The encoding problem exists in a wide range of applications. In the previous sections, we have described how character-based encodings are used by email and HTTP. Although standard encoding techniques such as ASN.1 <a class="reference internal" href="../bibliography.html#dubuisson2000" id="id42"><span>[Dubuisson2000]</span></a> have been defined to cover most application needs, many applications have defined their specific encoding. <cite>Remote Procedure Call</cite> are no exception to this rule. The three most popular encoding methods are probably XDR <span class="target" id="index-80"/><a class="rfc reference external" href="https://datatracker.ietf.org/doc/html/rfc1832.html"><strong>RFC 1832</strong></a> used by ONC-RPC <span class="target" id="index-81"/><a class="rfc reference external" href="https://datatracker.ietf.org/doc/html/rfc1831.html"><strong>RFC 1831</strong></a>, XML, used by XML-RPC and JSON <span class="target" id="index-82"/><a class="rfc reference external" href="https://datatracker.ietf.org/doc/html/rfc4627.html"><strong>RFC 4627</strong></a>.</p>
<p>The eXternal Data Representation (XDR) Standard, defined in <span class="target" id="index-83"/><a class="rfc reference external" href="https://datatracker.ietf.org/doc/html/rfc1832.html"><strong>RFC 1832</strong></a> is an early specification that describes how information exchanged during Remote Procedure Calls should be encoded before being transmitted through a network. Since the transport service enables transferring a block of bytes (with the connectionless service) or a stream of bytes (by using the connection-oriented service), XDR maps each datatype onto a sequence of bytes. The caller encodes each data in the appropriate sequence and the callee decodes the received information. Here are a few examples extracted from <span class="target" id="index-84"/><a class="rfc reference external" href="https://datatracker.ietf.org/doc/html/rfc1832.html"><strong>RFC 1832</strong></a> to illustrate how this encoding/decoding can be performed.</p>
<p>For basic data types, <span class="target" id="index-85"/><a class="rfc reference external" href="https://datatracker.ietf.org/doc/html/rfc1832.html"><strong>RFC 1832</strong></a> simply maps their representation into a sequence of bytes. For example a 32 bits integer is transmitted as shown in <a class="reference internal" href="#fig-xdr-int32"><span class="std std-numref">Fig. 43</span></a> (with the most significant byte first, which corresponds to big-endian encoding).</p>
<figure class="align-center" id="id72">
<span id="fig-xdr-int32"/><img alt="../_images/xdr-integer.svg" src="../Images/d52e7c6b6281eb132d460857ec233eff.png" data-original-src="https://4ed.computer-networking.info/syllabus/default/_images/xdr-integer.svg"/>
<figcaption>
<p><span class="caption-number">Fig. 43 </span><span class="caption-text">XDR representation of a 32 bits integer</span><a class="headerlink" href="#id72" title="Link to this image">#</a></p>
</figcaption>
</figure>
<p>XDR also supports 64 bits integers and booleans. The booleans are mapped onto integers (<cite>0</cite> for <cite>false</cite> and <cite>1</cite> for <cite>true</cite>). For the floating point numbers, the encoding defined in the IEEE standard is used. In the representation, the first bit (<cite>S</cite>) is the sign (<cite>0</cite> represents positive). The next 11 bits represent the exponent of the number (<cite>E</cite>), in base 2, and the remaining 52 bits are the fractional part of the number (<cite>F</cite>). The floating point number that corresponds to this representation is <span class="math notranslate nohighlight">\((-1)^{S} \times 2^{E-1023} \times 1.F\)</span>. XDR also allows encoding complex data types. A first example is the string of bytes. A string of bytes is composed of two parts : a length (encoded as an integer) and a sequence of bytes. For performance reasons, the encoding of a string is aligned to 32 bits boundaries. This implies that some padding bytes may be inserted during the encoding operation is the length of the string is not a multiple of 4. The structure of the string is shown below (source <span class="target" id="index-86"/><a class="rfc reference external" href="https://datatracker.ietf.org/doc/html/rfc1832.html"><strong>RFC 1832</strong></a>).</p>
<figure class="align-center" id="id73">
<span id="fig-xdr-float"/><a class="reference internal image-reference" href="../_images/xdr-float.svg"><img alt="../_images/xdr-float.svg" src="../Images/b3e916ca81c68d2a4b58075d4bf0bb7c.png" style="width: 664.8px; height: 115.19999999999999px;" data-original-src="https://4ed.computer-networking.info/syllabus/default/_images/xdr-float.svg"/>
</a>
<figcaption>
<p><span class="caption-number">Fig. 44 </span><span class="caption-text">XDR representation of a floating point number</span><a class="headerlink" href="#id73" title="Link to this image">#</a></p>
</figcaption>
</figure>
<p>In some situations, it is necessary to encode fixed or variable length arrays. XDR <span class="target" id="index-87"/><a class="rfc reference external" href="https://datatracker.ietf.org/doc/html/rfc1832.html"><strong>RFC 1832</strong></a> supports such arrays. For example, the encoding in <a class="reference internal" href="#fig-xdr-narray"><span class="std std-numref">Fig. 45</span></a> corresponds to an array containing n elements. The encoded representation starts with an integer that contains the number of elements and follows with all elements in sequence.</p>
<figure class="align-center" id="id74">
<span id="fig-xdr-narray"/><a class="reference internal image-reference" href="../_images/xdr-array.svg"><img alt="../_images/xdr-array.svg" src="../Images/e1244da31b6e5cd69f0f51dd6cf774b8.png" style="width: 634.8px; height: 96.0px;" data-original-src="https://4ed.computer-networking.info/syllabus/default/_images/xdr-array.svg"/>
</a>
<figcaption>
<p><span class="caption-number">Fig. 45 </span><span class="caption-text">XDR representation of an array</span><a class="headerlink" href="#id74" title="Link to this image">#</a></p>
</figcaption>
</figure>
<p>XDR also supports the definition of unions, structures, … Additional details are provided in <span class="target" id="index-88"/><a class="rfc reference external" href="https://datatracker.ietf.org/doc/html/rfc1832.html"><strong>RFC 1832</strong></a>.</p>
<p>A second popular method to encode data is the JavaScript Object Notation (JSON). This syntax was initially defined to allow applications written in JavaScript to exchange data, but it has now wider usages. JSON <span class="target" id="index-89"/><a class="rfc reference external" href="https://datatracker.ietf.org/doc/html/rfc4627.html"><strong>RFC 4627</strong></a> is a text-based representation. The simplest data type is the integer. It is represented as a sequence of digits in ASCII. Strings can also be encoding by using JSON. A JSON string always starts and ends with a quote character (<cite>”</cite>) as in the C language. As in the C language, some characters (like <cite>“</cite> or <cite>\</cite>) must be escaped if they appear in a string. <span class="target" id="index-90"/><a class="rfc reference external" href="https://datatracker.ietf.org/doc/html/rfc4627.html"><strong>RFC 4627</strong></a> describes this in details. Booleans are also supported by using the strings <cite>false</cite> and <cite>true</cite>. Like XDR, JSON supports more complex data types. A structure or object is defined as a comma separated list of elements enclosed in curly brackets. <span class="target" id="index-91"/><a class="rfc reference external" href="https://datatracker.ietf.org/doc/html/rfc4627.html"><strong>RFC 4627</strong></a> provides the following example as an illustration.</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span/><span class="p">{</span>
<span class="w">   </span><span class="s2">"Image"</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">       </span><span class="s2">"Width"</span><span class="o">:</span><span class="w">  </span><span class="mf">800</span><span class="p">,</span>
<span class="w">       </span><span class="s2">"Height"</span><span class="o">:</span><span class="w"> </span><span class="mf">600</span><span class="p">,</span>
<span class="w">       </span><span class="s2">"Title"</span><span class="o">:</span><span class="w">  </span><span class="s2">"View from 15th Floor"</span><span class="p">,</span>
<span class="w">       </span><span class="s2">"Thumbnail"</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">           </span><span class="s2">"Url"</span><span class="o">:</span><span class="w">    </span><span class="s2">"http://www.example.com/image/481989943"</span><span class="p">,</span>
<span class="w">           </span><span class="s2">"Height"</span><span class="o">:</span><span class="w"> </span><span class="mf">125</span><span class="p">,</span>
<span class="w">           </span><span class="s2">"Width"</span><span class="o">:</span><span class="w">  </span><span class="mf">100</span>
<span class="w">       </span><span class="p">},</span>
<span class="w">       </span><span class="s2">"ID"</span><span class="o">:</span><span class="w"> </span><span class="mf">1234</span>
<span class="w">     </span><span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>This object has one field named <cite>Image</cite>. It has five attributes. The first one, <cite>Width</cite>, is an integer set to 800. The third one is a string. The fourth attribute, <cite>Thumbnail</cite> is also an object composed of three different attributes, one string and two integers. JSON can also be used to encode arrays or lists. In this case, square brackets are used as delimiters. The snippet below shows an array which contains the prime integers that are smaller than ten.</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span/><span class="p">{</span>
<span class="w">  </span><span class="s2">"Primes"</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="p">[</span><span class="w"> </span><span class="mf">2</span><span class="p">,</span><span class="w"> </span><span class="mf">3</span><span class="p">,</span><span class="w"> </span><span class="mf">5</span><span class="p">,</span><span class="w"> </span><span class="mf">7</span><span class="w"> </span><span class="p">]</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Compared with XDR, the main advantage of JSON is that the transfer syntax is easily readable by a human. However, this comes at the expense of a less compact encoding. Some data encoded in JSON will usually take more space than when it is encoded with XDR. More compact encoding schemes have been defined, see e.g. <a class="reference internal" href="../bibliography.html#bh2013" id="id43"><span>[BH2013]</span></a> and the references therein.</p>
</section>
<section id="reaching-the-callee">
<h3>Reaching the callee<a class="headerlink" href="#reaching-the-callee" title="Link to this heading">#</a></h3>
<p>The second sub-problem is how to reach the callee. A simple solution to this problem is to make sure that the callee listens on a specific port on the remote machine and then exchange information with this server process. This is the solution chosen for JSON-RPC <a class="reference internal" href="../bibliography.html#json-rpc2" id="id44"><span>[JSON-RPC2]</span></a>. JSON-RPC can be used over the connectionless or the connection-oriented transport service. A JSON-RPC request contains the following fields:</p>
<blockquote>
<div><ul class="simple">
<li><p><cite>jsonrpc</cite>: a string indicating the version of the protocol used. This is important to allow the protocol to evolve in the future.</p></li>
<li><p><cite>method</cite>: a string that contains the name of the procedure which is invoked</p></li>
<li><p><cite>params</cite>: a structure that contains the values of the parameters that are passed to the method</p></li>
<li><p><cite>id</cite>: an identifier chosen by the caller</p></li>
</ul>
</div></blockquote>
<p>The JSON-RPC is encoded as a JSON object. For example, the example below shows an invocation of a method called <cite>sum</cite> with <cite>1</cite> and <cite>3</cite> as parameters.</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span/><span class="p">{</span><span class="w"> </span><span class="s2">"jsonrpc"</span><span class="o">:</span><span class="w"> </span><span class="s2">"2.0"</span><span class="p">,</span><span class="w"> </span><span class="s2">"method"</span><span class="o">:</span><span class="w"> </span><span class="s2">"sum"</span><span class="p">,</span><span class="w"> </span><span class="s2">"params"</span><span class="o">:</span><span class="w"> </span><span class="p">[</span><span class="mf">1</span><span class="p">,</span><span class="w"> </span><span class="mf">3</span><span class="p">],</span><span class="w"> </span><span class="s2">"id"</span><span class="o">:</span><span class="w"> </span><span class="mf">1</span><span class="w"> </span><span class="p">}</span>
</pre></div>
</div>
<p>Upon reception of this JSON structure, the callee parses the object, locates the corresponding method and passes the parameters. This method returns a response which is also encoded as a JSON structure. This response contains the following fields:</p>
<blockquote>
<div><ul>
<li><p><cite>jsonrpc</cite>: a string indicating the version of the protocol used to encode the response</p></li>
<li><p><cite>id</cite>: the same identifier as the identifier chosen by the caller</p></li>
<li><p><cite>result</cite>: if the request succeeded, this member contains the result of the request (in our example, value <cite>4</cite>).</p></li>
<li><p><cite>error</cite>: if the method called does not exist or its execution causes an error, the <cite>result</cite> element will be replaced by an <cite>error</cite> element which contains the following members :</p>
<blockquote>
<div><ul class="simple">
<li><p><cite>code</cite>: a number that indicates the type of error. Several error codes are defined in <a class="reference internal" href="../bibliography.html#json-rpc2" id="id45"><span>[JSON-RPC2]</span></a>. For example, <cite>-32700</cite> indicates an error in parsing the request, <cite>-32602</cite> indicates invalid parameters and <cite>-32601</cite> indicates that the method could not be found on the server. Other error codes are listed in <a class="reference internal" href="../bibliography.html#json-rpc2" id="id46"><span>[JSON-RPC2]</span></a>.</p></li>
<li><p><cite>message</cite>: a string (limited to one sentence) that provides a short description of the error.</p></li>
<li><p><cite>data</cite>: an optional field that provides additional information about the error.</p></li>
</ul>
</div></blockquote>
</li>
</ul>
</div></blockquote>
<p>Coming back to our example with the call for the <cite>sum</cite> procedure, it would return the following JSON structure.</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span/><span class="p">{</span><span class="w"> </span><span class="s2">"jsonrpc"</span><span class="o">:</span><span class="w"> </span><span class="s2">"2.0"</span><span class="p">,</span><span class="w"> </span><span class="s2">"result"</span><span class="o">:</span><span class="w"> </span><span class="mf">4</span><span class="p">,</span><span class="w"> </span><span class="s2">"id"</span><span class="o">:</span><span class="w"> </span><span class="mf">1</span><span class="w"> </span><span class="p">}</span>
</pre></div>
</div>
<p>If the <cite>sum</cite> method is not implemented on the server, it would reply with the following response.</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span/><span class="p">{</span><span class="w"> </span><span class="s2">"jsonrpc"</span><span class="o">:</span><span class="w"> </span><span class="s2">"2.0"</span><span class="p">,</span><span class="w"> </span><span class="s2">"error"</span><span class="o">:</span><span class="w"> </span><span class="p">{</span><span class="s2">"code"</span><span class="o">:</span><span class="w"> </span><span class="o">-</span><span class="mf">32601</span><span class="p">,</span><span class="w"> </span><span class="s2">"message"</span><span class="o">:</span><span class="w"> </span><span class="s2">"Method not found"</span><span class="p">},</span><span class="w"> </span><span class="s2">"id"</span><span class="o">:</span><span class="w"> </span><span class="s2">"1"</span><span class="w"> </span><span class="p">}</span>
</pre></div>
</div>
<p>The <cite>id</cite> field, which is present in the request and the response plays the same role as the identifier field in the DNS message. It allows the caller to match the response with the request that it sent. This <cite>id</cite> is very important when JSON-RPC is used over the connectionless transport service which is unreliable. If a request is sent, it may need to be retransmitted and it is possible that a callee will receive twice the same request (e.g. if the response for the first request was lost). In the DNS, when a request is lost, it can be retransmitted without causing any difficulty. However with remote procedure calls in general, losses can cause some problems. Consider a method which is used to deposit money on a bank account. If the request is lost, it will be retransmitted and the deposit will be eventually performed. However, if the response is lost, the caller will also retransmit its request. This request will be received by the callee that will deposit the money again. To prevent this problem from affecting the application, either the programmer must ensure that the remote procedures that it calls can be safely called multiple times or the application must verify whether the request has been transmitted earlier. In most deployments, the programmers use remote methods that can be safely called multiple times without breaking the application logic.</p>
<p id="index-92">ONC-RPC uses a more complex method to allow a caller to reach the callee. On a host, server processes can run on different ports and given the limited number of port values (<span class="math notranslate nohighlight">\(2^{16}\)</span> per host on the Internet), it is impossible to reserve one port number for each method. The solution used in ONC-RPC <span class="target" id="index-93"/><a class="rfc reference external" href="https://datatracker.ietf.org/doc/html/rfc1831.html"><strong>RFC 1831</strong></a> is to use a special method which is called the <cite>portmapper</cite> <span class="target" id="index-94"/><a class="rfc reference external" href="https://datatracker.ietf.org/doc/html/rfc1833.html"><strong>RFC 1833</strong></a>. The <cite>portmapper</cite> is a kind of directory that runs on a server that hosts methods. The <cite>portmapper</cite> runs on a standard port (<cite>111</cite> for ONC-RPC <span class="target" id="index-95"/><a class="rfc reference external" href="https://datatracker.ietf.org/doc/html/rfc1833.html"><strong>RFC 1833</strong></a>). A server process that implements a method registers its method on the local <cite>portmapper</cite>. When a caller needs to call a method on a remote server, it first contacts the <cite>portmapper</cite> to obtain the port number of the server process which implements the method. The response from the portmapper allows it to directly contact the server process which implements the method.</p>
<p class="rubric">Footnotes</p>
<aside class="footnote-list brackets">
<aside class="footnote brackets" id="fhosts" role="doc-footnote">
<span class="label"><span class="fn-bracket">[</span><a role="doc-backlink" href="#id8">1</a><span class="fn-bracket">]</span></span>
<p>The <a class="reference internal" href="../glossary.html#term-hosts.txt"><span class="xref std std-term">hosts.txt</span></a> file is not maintained anymore. A historical snapshot from April 1984 is available from <a class="reference external" href="https://www.saildart.org/HOSTS.TXT%5BHST,NET%5D15">https://www.saildart.org/HOSTS.TXT%5BHST,NET%5D15</a></p>
</aside>
<aside class="footnote brackets" id="fdnstimeline" role="doc-footnote">
<span class="label"><span class="fn-bracket">[</span><a role="doc-backlink" href="#id9">2</a><span class="fn-bracket">]</span></span>
<p>See <a class="reference external" href="http://www.donelan.com/dnstimeline.html">http://www.donelan.com/dnstimeline.html</a> for a timeline of DNS-related developments.</p>
</aside>
<aside class="footnote brackets" id="fidn" role="doc-footnote">
<span class="label"><span class="fn-bracket">[</span><a role="doc-backlink" href="#id10">3</a><span class="fn-bracket">]</span></span>
<p>This specification evolved later to support domain names written by using other character sets than us-ASCII <span class="target" id="index-96"/><a class="rfc reference external" href="https://datatracker.ietf.org/doc/html/rfc5890.html"><strong>RFC 5890</strong></a>. This extension is important to support languages other than English, but a detailed discussion is outside the scope of this document.</p>
</aside>
<aside class="footnote brackets" id="ftld" role="doc-footnote">
<span class="label"><span class="fn-bracket">[</span><a role="doc-backlink" href="#id11">4</a><span class="fn-bracket">]</span></span>
<p>The official list of top-level domain names is maintained by <a class="reference internal" href="../glossary.html#term-IANA"><span class="xref std std-term">IANA</span></a> at <a class="reference external" href="http://data.iana.org/TLD/tlds-alpha-by-domain.txt">http://data.iana.org/TLD/tlds-alpha-by-domain.txt</a>. Additional information about these domains may be found at <a class="reference external" href="http://en.wikipedia.org/wiki/List_of_Internet_top-level_domains">http://en.wikipedia.org/wiki/List_of_Internet_top-level_domains</a>.</p>
</aside>
<aside class="footnote brackets" id="fg00gle" role="doc-footnote">
<span class="label"><span class="fn-bracket">[</span><a role="doc-backlink" href="#id12">5</a><span class="fn-bracket">]</span></span>
<p>It is interesting to note that to prevent any homograph attack, Google Inc. registered the <cite>g00gle.com</cite> domain name but does not apparently use it.</p>
</aside>
<aside class="footnote brackets" id="froot" role="doc-footnote">
<span class="label"><span class="fn-bracket">[</span><a role="doc-backlink" href="#id14">6</a><span class="fn-bracket">]</span></span>
<p>A copy of the information maintained by each root nameserver is available at <a class="reference external" href="http://www.internic.net/zones/root.zone">http://www.internic.net/zones/root.zone</a>.</p>
</aside>
<aside class="footnote brackets" id="frootv6" role="doc-footnote">
<span class="label"><span class="fn-bracket">[</span><a role="doc-backlink" href="#id15">7</a><span class="fn-bracket">]</span></span>
<p>Until February 2008, the root DNS servers only had IPv4 addresses. IPv6 addresses were slowly added to the root DNS servers to avoid creating problems as discussed in <a class="reference external" href="http://www.icann.org/en/committees/security/sac018.pdf">http://www.icann.org/en/committees/security/sac018.pdf</a>. As of February 2021, there remain a few DNS root servers that are still not reachable using IPv6. The full list is available at <a class="reference external" href="http://www.root-servers.org/">http://www.root-servers.org/</a>.</p>
</aside>
<aside class="footnote brackets" id="f8888" role="doc-footnote">
<span class="label"><span class="fn-bracket">[</span><a role="doc-backlink" href="#id17">8</a><span class="fn-bracket">]</span></span>
<p>Some DNS resolvers allow any host to send queries. Google operates a <a class="reference external" href="https://developers.google.com/speed/public-dns/docs/using">public DNS resolver</a> at addresses <cite>2001:4860:4860::8888</cite> and <cite>2001:4860:4860::8844</cite>. Other companies provide similar services.</p>
</aside>
<aside class="footnote brackets" id="fhtonl" role="doc-footnote">
<span class="label"><span class="fn-bracket">[</span><a role="doc-backlink" href="#id3">9</a><span class="fn-bracket">]</span></span>
<p>For example, the <em class="manpage">htonl(3)</em> (resp. <em class="manpage">ntohl(3)</em>) function the standard C library converts a 32-bits unsigned integer from the byte order used by the CPU to the network byte order (resp. from the network byte order to the CPU byte order). Similar functions exist in other programming languages.</p>
</aside>
<aside class="footnote brackets" id="fto" role="doc-footnote">
<span class="label"><span class="fn-bracket">[</span><a role="doc-backlink" href="#id21">10</a><span class="fn-bracket">]</span></span>
<p>It could be surprising that the <cite>To:</cite> is not mandatory inside an email message. While most email messages will contain this header line an email that does not contain a <cite>To:</cite> header line and that relies on the <cite>bcc:</cite> to specify the recipient is valid as well.</p>
</aside>
<aside class="footnote brackets" id="femailheaders" role="doc-footnote">
<span class="label"><span class="fn-bracket">[</span><a role="doc-backlink" href="#id22">11</a><span class="fn-bracket">]</span></span>
<p>The list of all standard email header lines may be found at <a class="reference external" href="http://www.iana.org/assignments/message-headers/message-header-index.html">http://www.iana.org/assignments/message-headers/message-header-index.html</a></p>
</aside>
<aside class="footnote brackets" id="fsmtpauth" role="doc-footnote">
<span class="label"><span class="fn-bracket">[</span><a role="doc-backlink" href="#id24">12</a><span class="fn-bracket">]</span></span>
<p>During the last years, many Internet Service Providers, campus and enterprise networks have deployed SMTP extensions <span class="target" id="index-97"/><a class="rfc reference external" href="https://datatracker.ietf.org/doc/html/rfc4954.html"><strong>RFC 4954</strong></a> on their MSAs. These extensions force the MUAs to be authenticated before the MSA accepts an email message from the MUA.</p>
</aside>
<aside class="footnote brackets" id="fehlo" role="doc-footnote">
<span class="label"><span class="fn-bracket">[</span><a role="doc-backlink" href="#id25">13</a><span class="fn-bracket">]</span></span>
<p>The first versions of SMTP used <cite>HELO</cite> as the first command sent by a client to a SMTP server. When SMTP was extended to support newer features such as 8 bits characters, it was necessary to allow a server to recognize whether it was interacting with a client that supported the extensions or not. <cite>EHLO</cite> became mandatory with the publication of <span class="target" id="index-98"/><a class="rfc reference external" href="https://datatracker.ietf.org/doc/html/rfc2821.html"><strong>RFC 2821</strong></a>.</p>
</aside>
<aside class="footnote brackets" id="fdot" role="doc-footnote">
<span class="label"><span class="fn-bracket">[</span><a role="doc-backlink" href="#id26">14</a><span class="fn-bracket">]</span></span>
<p>This implies that a valid email message cannot contain a line with one dot followed by <cite>CR</cite> and <cite>LF</cite>. If a user types such a line in an email, his email client will automatically add a space character before or after the dot when sending the message over SMTP.</p>
</aside>
<aside class="footnote brackets" id="fapop" role="doc-footnote">
<span class="label"><span class="fn-bracket">[</span><a role="doc-backlink" href="#id27">15</a><span class="fn-bracket">]</span></span>
<p><span class="target" id="index-99"/><a class="rfc reference external" href="https://datatracker.ietf.org/doc/html/rfc1939.html"><strong>RFC 1939</strong></a> defines the APOP authentication scheme that is not vulnerable to such attacks.</p>
</aside>
<aside class="footnote brackets" id="furiretrieve" role="doc-footnote">
<span class="label"><span class="fn-bracket">[</span><a role="doc-backlink" href="#id32">16</a><span class="fn-bracket">]</span></span>
<p>An example of a non-retrievable URI is <cite>urn:isbn:0-380-81593-1</cite> which is an unique identifier for a book, through the urn scheme (see <span class="target" id="index-100"/><a class="rfc reference external" href="https://datatracker.ietf.org/doc/html/rfc3187.html"><strong>RFC 3187</strong></a>). Of course, any URI can be made retrievable via a dedicated server or a new protocol but this one has no explicit protocol. Same thing for the scheme tag (see <span class="target" id="index-101"/><a class="rfc reference external" href="https://datatracker.ietf.org/doc/html/rfc4151.html"><strong>RFC 4151</strong></a>), often used in Web syndication (see <span class="target" id="index-102"/><a class="rfc reference external" href="https://datatracker.ietf.org/doc/html/rfc4287.html"><strong>RFC 4287</strong></a> about the Atom syndication format). Even when the scheme is retrievable (for instance with <cite>http</cite>), it is often used only as an identifier, not as a way to get a resource. See <a class="reference external" href="http://norman.walsh.name/2006/07/25/namesAndAddresses">http://norman.walsh.name/2006/07/25/namesAndAddresses</a> for a good explanation.</p>
</aside>
<aside class="footnote brackets" id="furilist" role="doc-footnote">
<span class="label"><span class="fn-bracket">[</span><a role="doc-backlink" href="#id33">17</a><span class="fn-bracket">]</span></span>
<p>The list of standard URI schemes is maintained by <a class="reference external" href="https://www.iana.org">IANA</a> at <a class="reference external" href="http://www.iana.org/assignments/uri-schemes.html">http://www.iana.org/assignments/uri-schemes.html</a></p>
</aside>
<aside class="footnote brackets" id="ffavicon" role="doc-footnote">
<span class="label"><span class="fn-bracket">[</span><a role="doc-backlink" href="#id35">18</a><span class="fn-bracket">]</span></span>
<p>Favorite icons are small icons that are used to represent web servers in the toolbar of Internet browsers. Microsoft added this feature in their browsers without taking into account the W3C standards. See <a class="reference external" href="http://www.w3.org/2005/10/howto-favicon">http://www.w3.org/2005/10/howto-favicon</a> for a discussion on how to cleanly support such favorite icons.</p>
</aside>
<aside class="footnote brackets" id="fpipelining" role="doc-footnote">
<span class="label"><span class="fn-bracket">[</span><a role="doc-backlink" href="#id39">19</a><span class="fn-bracket">]</span></span>
<p>See <a class="reference external" href="https://en.wikipedia.org/wiki/HTTP_pipelining">https://en.wikipedia.org/wiki/HTTP_pipelining</a> for additional information.</p>
</aside>
</aside>
</section>
</section>
&#13;

<span id="naming"/><span id="index-4"/><h2>Naming and addressing<a class="headerlink" href="#naming-and-addressing" title="Link to this heading">#</a></h2>
<p>The network and the transport layers rely on addresses that are encoded as fixed-size bit strings. A network layer address uniquely identifies a host. Several transport layer entities can use the service of the same network layer. For example, a reliable transport protocol and a connectionless transport protocol can coexist on the same host. In this case, the network layer multiplexes the segments produced by these two protocols. This multiplexing is usually achieved by placing in the network packet header a field that indicates which transport protocol should process the segment. Given that there are few different transport protocols, this field does not need to be long. The port numbers play a similar role in the transport layer since they enable it to multiplex data from several application processes.</p>
<p>While addresses are natural for the network and transport layer entities, humans prefer to use names when interacting with network services. Names can be encoded as a character string, and a mapping service allows applications to map a name into the corresponding address. Using names is friendlier for humans, but it also provides a level of indirection which is very useful in many situations.</p>
<p>In the early days of the Internet, only a few hosts (mainly minicomputers) were connected to the network. The most popular applications were <a class="reference internal" href="../glossary.html#term-remote-login"><span class="xref std std-term">remote login</span></a> and file transfer. By 1983, there were already five hundred hosts attached to the Internet <a class="reference internal" href="../bibliography.html#zakon" id="id7"><span>[Zakon]</span></a>. Each of these hosts was identified by a unique address. Forcing human users to remember the addresses of the hosts that they wanted to use was not user-friendly. Humans prefer to remember names and use them when needed. Using names as aliases for addresses is a common technique in Computer Science. It simplifies the development of applications and allows the developer to ignore the low-level details. For example, by using a programming language instead of writing machine code, a developer can write software without knowing whether the variables that it uses are stored in memory or inside registers.</p>
<p>Because names are at a higher level than addresses, they allow (both in the example of programming above and on the Internet) to treat addresses as mere technical identifiers, which can change at will. Only the names are stable.</p>
<p id="index-5">The first solution that allowed applications to use names was the <a class="reference internal" href="../glossary.html#term-hosts.txt"><span class="xref std std-term">hosts.txt</span></a> file. This file is similar to the symbol table found in compiled code. It contains the mapping between the name of each Internet host and its associated address <a class="footnote-reference brackets" href="#fhosts" id="id8" role="doc-noteref"><span class="fn-bracket">[</span>1<span class="fn-bracket">]</span></a>. It was maintained by the SRI International Network Information Center (NIC). When a new host was connected to the network, the system administrator had to register its name and address at the NIC. The NIC updated the <a class="reference internal" href="../glossary.html#term-hosts.txt"><span class="xref std std-term">hosts.txt</span></a> file on its server. All Internet hosts regularly retrieved the updated <a class="reference internal" href="../glossary.html#term-hosts.txt"><span class="xref std std-term">hosts.txt</span></a> file from the <a class="reference external" href="https://www.sri.com">SRI</a> server. This file was stored at a well-known location on each Internet host (see <span class="target" id="index-6"/><a class="rfc reference external" href="https://datatracker.ietf.org/doc/html/rfc952.html"><strong>RFC 952</strong></a>) and networked applications could use it to find the address corresponding to a name.</p>
<p>A <a class="reference internal" href="../glossary.html#term-hosts.txt"><span class="xref std std-term">hosts.txt</span></a> file can be used when there are up to a few hundred hosts on the network. However, it is clearly not suitable for a network containing thousands or millions of hosts. A key issue in a large network is to define a suitable naming scheme. The ARPANet initially used a flat naming space, i.e. each host was assigned a unique name. To limit collisions between names, these names usually contained the name of the institution and a suffix to identify the host inside the institution (a kind of poor man’s hierarchical naming scheme). On the ARPANet, few institutions had several hosts connected to the network.</p>
<p>However, the limitations of a flat naming scheme became clear before the end of the ARPANet, and <span class="target" id="index-7"/><a class="rfc reference external" href="https://datatracker.ietf.org/doc/html/rfc819.html"><strong>RFC 819</strong></a> proposed a hierarchical naming scheme. While <span class="target" id="index-8"/><a class="rfc reference external" href="https://datatracker.ietf.org/doc/html/rfc819.html"><strong>RFC 819</strong></a> discussed the possibility of organizing the names as a directed graph, the Internet opted for a tree structure capable of containing all names. In this tree, the top-level domains are those that are directly attached to the root. The first top-level domain was <cite>.arpa</cite> <a class="footnote-reference brackets" href="#fdnstimeline" id="id9" role="doc-noteref"><span class="fn-bracket">[</span>2<span class="fn-bracket">]</span></a>. This top-level name was initially added as a suffix to the names of the hosts attached to the ARPANet and listed in the <cite>hosts.txt</cite> file. In 1984, the <cite>.gov</cite>, <cite>.edu</cite>, <cite>.com</cite>, <cite>.mil</cite>, and <cite>.org</cite> generic top-level domain names were added. <span class="target" id="index-9"/><a class="rfc reference external" href="https://datatracker.ietf.org/doc/html/rfc1032.html"><strong>RFC 1032</strong></a> proposed the utilization of the two-letter <a class="reference internal" href="../glossary.html#term-ISO-3166"><span class="xref std std-term">ISO-3166</span></a> country codes as top-level domain names. Since <a class="reference internal" href="../glossary.html#term-ISO-3166"><span class="xref std std-term">ISO-3166</span></a> defines a two-letter code for each country recognized by the United Nations, this allowed all countries to automatically have a top-level domain. These domains include <cite>.be</cite> for Belgium, <cite>.fr</cite> for France, <cite>.us</cite> for the USA, <cite>.ie</cite> for Ireland, or <cite>.tv</cite> for Tuvalu, a group of small islands in the Pacific, or <cite>.tm</cite> for Turkmenistan. The set of top-level domain names is managed by the Internet Corporation for Assigned Names and Numbers (<a class="reference internal" href="../glossary.html#term-ICANN"><span class="xref std std-term">ICANN</span></a>). <a class="reference internal" href="../glossary.html#term-ICANN"><span class="xref std std-term">ICANN</span></a> adds generic top-level domains that are not related to a country, and the <cite>.cat</cite> top-level domain has been registered for the Catalan language. There are ongoing discussions within <a class="reference internal" href="../glossary.html#term-ICANN"><span class="xref std std-term">ICANN</span></a> to increase the number of top-level domains.</p>
<p>Each top-level domain is managed by an organization that decides how subdomain names can be registered. Most top-level domain names use a first-come, first-served system and allow anyone to register domain names, but there are some exceptions. For example, <cite>.gov</cite> is reserved for the US government, <cite>.int</cite> is reserved for international organizations, and names in the <cite>.ca</cite> are mainly <a class="reference external" href="http://en.wikipedia.org/wiki/.ca">reserved</a> for companies or users that are present in Canada.</p>
<div class="figure" id="id51" style="text-align: center"><p><img src="../Images/28e49f48398377711717aaa96d6ec501.png" alt="Figure made with TikZ" data-original-src="https://4ed.computer-networking.info/syllabus/default/_images/tikz-265d61a849902ef0108e787463bece1439793242.png"/></p>
<p><span class="caption-number">Fig. 23 </span><span class="caption-text">The tree of domain names</span></p>
</div><p>The syntax of the domain names has been defined more precisely in
<span class="target" id="index-10"/><a class="rfc reference external" href="https://datatracker.ietf.org/doc/html/rfc1035.html"><strong>RFC 1035</strong></a>. This document recommends
the following <a class="reference internal" href="../glossary.html#term-BNF"><span class="xref std std-term">BNF</span></a> for fully qualified
domain names (the domain names themselves have a much richer syntax).</p>
<div class="literal-block-wrapper docutils container" id="id52">
<div class="code-block-caption"><span class="caption-number">Listing 1 </span><span class="caption-text">BNF of the fully qualified host names</span><a class="headerlink" href="#id52" title="Link to this code">#</a></div>
<div class="highlight-abnf notranslate"><div class="highlight"><pre><span/><span class="nc">domain</span><span class="w"> </span>::<span class="o">=</span><span class="w"> </span><span class="nc">subdomain</span><span class="w"> </span>|<span class="w"> </span><span class="l">" "</span>
<span class="nc">subdomain</span><span class="w"> </span>::<span class="o">=</span><span class="w"> </span><span class="nc">label</span><span class="w"> </span>|<span class="w"> </span><span class="nc">subdomain</span><span class="w"> </span><span class="l">"."</span><span class="w"> </span><span class="nc">label</span>
<span class="nc">label</span><span class="w"> </span>::<span class="o">=</span><span class="w"> </span><span class="nc">letter</span><span class="w"> </span><span class="p">[</span><span class="w"> </span><span class="p">[</span><span class="w"> </span><span class="nc">ldh-str</span><span class="w"> </span><span class="p">]</span><span class="w"> </span><span class="nc">let-dig</span><span class="w"> </span><span class="p">]</span>
<span class="nc">ldh-str</span><span class="w"> </span>::<span class="o">=</span><span class="w"> </span><span class="nc">let-dig-hyp</span><span class="w"> </span>|<span class="w"> </span><span class="nc">let-dig-hyp</span><span class="w"> </span><span class="nc">ldh-str</span>
<span class="nc">let-dig-hyp</span><span class="w"> </span>::<span class="o">=</span><span class="w"> </span><span class="nc">let-dig</span><span class="w"> </span>|<span class="w"> </span><span class="l">"-"</span>
<span class="nc">let-dig</span><span class="w"> </span>::<span class="o">=</span><span class="w"> </span><span class="nc">letter</span><span class="w"> </span>|<span class="w"> </span><span class="nc">digit</span>
<span class="nc">letter</span><span class="w"> </span>::<span class="o">=</span><span class="w"> </span><span class="nc">any</span><span class="w"> </span><span class="nc">one</span><span class="w"> </span><span class="nc">of</span><span class="w"> </span><span class="nc">the</span><span class="w"> </span><span class="o">52</span><span class="w"> </span><span class="nc">alphabetic</span><span class="w"> </span><span class="nc">characters</span><span class="w"> </span><span class="nc">A</span><span class="w"> </span><span class="nc">through</span><span class="w"> </span><span class="nc">Z</span><span class="w"> </span><span class="nc">in</span><span class="w"> </span><span class="nc">upper</span><span class="w"> </span><span class="nc">case</span><span class="w"> </span><span class="nc">and</span><span class="w"> </span><span class="nc">a</span><span class="w"> </span><span class="nc">through</span><span class="w"> </span><span class="nc">z</span><span class="w"> </span><span class="nc">in</span><span class="w"> </span><span class="nc">lower</span><span class="w"> </span><span class="nc">case</span>
<span class="nc">digit</span><span class="w"> </span>::<span class="o">=</span><span class="w"> </span><span class="nc">any</span><span class="w"> </span><span class="nc">one</span><span class="w"> </span><span class="nc">of</span><span class="w"> </span><span class="nc">the</span><span class="w"> </span><span class="nc">ten</span><span class="w"> </span><span class="nc">digits</span><span class="w"> </span><span class="o">0</span><span class="w"> </span><span class="nc">through</span><span class="w"> </span><span class="o">9</span>
</pre></div>
</div>
</div>
<p>This grammar specifies that a host name is an ordered list of labels separated by the dot (<cite>.</cite>) character. Each label can contain letters, numbers, and the hyphen character (<cite>-</cite>) <a class="footnote-reference brackets" href="#fidn" id="id10" role="doc-noteref"><span class="fn-bracket">[</span>3<span class="fn-bracket">]</span></a>. Fully qualified domain names are read from left to right. The first label is a hostname or a domain name followed by the hierarchy of domains and ending with the root implicitly at the right. The top-level domain name must be one of the registered TLDs <a class="footnote-reference brackets" href="#ftld" id="id11" role="doc-noteref"><span class="fn-bracket">[</span>4<span class="fn-bracket">]</span></a>. For example, in the above figure, <cite>www.computer-networking.info</cite> corresponds to a host named <cite>www</cite> inside the <cite>computer-networking</cite> domain that belongs to the <cite>info</cite> top-level domain.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Some visually similar characters have different character codes</p>
<p>The Domain Name System was created at a time when the Internet was mainly used in North America. The initial design assumed that all domain names would be composed of letters and digits <span class="target" id="index-11"/><a class="rfc reference external" href="https://datatracker.ietf.org/doc/html/rfc1035.html"><strong>RFC 1035</strong></a>. As Internet usage grew in other parts of the world, it became important to support non-ASCII characters. For this, extensions have been proposed to the Domain Name System <span class="target" id="index-12"/><a class="rfc reference external" href="https://datatracker.ietf.org/doc/html/rfc3490.html"><strong>RFC 3490</strong></a>. In a nutshell, the solution that is used to support Internationalized Domain Names works as follows. First, it is possible to use most of the Unicode characters to encode domain names and hostnames, with a few exceptions (for example, the dot character cannot be part of a name since it is used as a separator). Once a domain name has been encoded as a series of Unicode characters, it is then converted into a string that contains the <code class="docutils literal notranslate"><span class="pre">xn--</span></code> prefix and a sequence of ASCII characters. More details on these algorithms can be found in <span class="target" id="index-13"/><a class="rfc reference external" href="https://datatracker.ietf.org/doc/html/rfc3490.html"><strong>RFC 3490</strong></a> and <span class="target" id="index-14"/><a class="rfc reference external" href="https://datatracker.ietf.org/doc/html/rfc3492.html"><strong>RFC 3492</strong></a>.</p>
<p>The possibility of using all Unicode characters to create domain names opened a new form of attack called the <a class="reference external" href="https://en.wikipedia.org/wiki/IDN_homograph_attack">homograph attack</a>. This attack occurs when two character strings or domain names are visually similar but do not correspond to the same server. A simple example is <a class="reference external" href="https://G00GLE.COM">https://G00GLE.COM</a> and <a class="reference external" href="https://GOOGLE.COM">https://GOOGLE.COM</a>. These two URLs are visually close but they correspond to different names (the first one does not point to a valid server <a class="footnote-reference brackets" href="#fg00gle" id="id12" role="doc-noteref"><span class="fn-bracket">[</span>5<span class="fn-bracket">]</span></a>). With other Unicode characters, it is possible to construct domain names that are visually equivalent to existing ones. See <a class="reference internal" href="../bibliography.html#zhe2017" id="id13"><span>[Zhe2017]</span></a> for additional details on this attack.</p>
</div>
<p>This hierarchical naming scheme is a key component of the Domain Name System (DNS). The DNS is a distributed database that contains mappings between fully qualified domain names and addresses. The DNS uses the client-server model. The clients are hosts or applications that need to retrieve the mapping for a given name. Each <a class="reference internal" href="../glossary.html#term-nameserver"><span class="xref std std-term">nameserver</span></a> stores part of the distributed database and answers the queries sent by clients. There is at least one <a class="reference internal" href="../glossary.html#term-nameserver"><span class="xref std std-term">nameserver</span></a> that is responsible for each domain. In the figure below, domains are represented by circles and there are three hosts inside domain <cite>dom</cite> (<cite>h1</cite>, <cite>h2</cite>, and <cite>h3</cite>) and three hosts inside domain <cite>a.sdom1.dom</cite>. As shown in the figure below, a sub-domain may contain both host names and sub-domains.</p>
<div class="figure" id="id53" style="text-align: center"><p><img src="../Images/7989bbb8be7d75c8e85246fc80c86c13.png" alt="Figure made with TikZ" data-original-src="https://4ed.computer-networking.info/syllabus/default/_images/tikz-d7ddf201364b12c4f9f6121e1c3a4ee07870ed7f.png"/></p>
<p><span class="caption-number">Fig. 24 </span><span class="caption-text">A simple tree of domain names</span></p>
</div><p>A <a class="reference internal" href="../glossary.html#term-nameserver"><span class="xref std std-term">nameserver</span></a> that is responsible for domain <cite>dom</cite> can directly answer the following queries :</p>
<blockquote>
<div><ul class="simple">
<li><p>the address of any host residing directly inside domain <cite>dom</cite> (e.g. <cite>h2.dom</cite> in the figure above)</p></li>
<li><p>the nameserver(s) that are responsible for any direct sub-domain of domain <cite>dom</cite> (i.e. <cite>sdom1.dom</cite> and <cite>sdom2.dom</cite> in the figure above, but not <cite>z.sdom1.dom</cite>)</p></li>
</ul>
</div></blockquote>
<p>To retrieve the mapping for host <cite>h2.dom</cite>, a client sends its query to the name server that is responsible for the domain <cite>.dom</cite>. The name server directly answers the query. To retrieve a mapping for <cite>h3.a.sdom1.dom</cite>, a DNS client first sends a query to the name server that is responsible for the <cite>.dom</cite> domain. This nameserver returns the nameserver that is responsible for the <cite>sdom1.dom</cite> domain. This nameserver can now be contacted to obtain the nameserver that is responsible for the <cite>a.sdom1.dom</cite> domain. This nameserver can be contacted to retrieve the mapping for the <cite>h3.a.sdom1.dom</cite> name. Thanks to this structure, it is possible for a DNS client to obtain the mapping of any host inside the <cite>.dom</cite> domain or any of its subdomains. To ensure that any DNS client will be able to resolve any fully qualified domain name, there are special nameservers that are responsible for the root of the domain name hierarchy. These nameservers are called <a class="reference internal" href="../glossary.html#term-root-nameserver"><span class="xref std std-term">root nameserver</span></a>.</p>
<p>Each root nameserver maintains the list <a class="footnote-reference brackets" href="#froot" id="id14" role="doc-noteref"><span class="fn-bracket">[</span>6<span class="fn-bracket">]</span></a> of all the nameservers that are responsible for each of the top-level domain names and their addresses <a class="footnote-reference brackets" href="#frootv6" id="id15" role="doc-noteref"><span class="fn-bracket">[</span>7<span class="fn-bracket">]</span></a>. All root nameservers cooperate and provide the same answers. By querying any of the root nameservers, a DNS client can obtain the nameserver that is responsible for any top-level-domain name. From this nameserver, it is possible to resolve any domain name.</p>
<p>To be able to contact the root nameservers, each DNS client must know their addresses. This implies that DNS clients must maintain an up-to-date list of the addresses of the root nameservers. Without this list, it is impossible to contact the root nameservers. Forcing all Internet hosts to maintain the most recent version of this list would be difficult from an operational point of view. To solve this problem, the designers of the DNS introduced a special type of DNS server : the DNS resolvers. A <a class="reference internal" href="../glossary.html#term-resolver"><span class="xref std std-term">resolver</span></a> is a server that provides the name resolution service for a set of clients. A network usually contains a few resolvers. Each host in these networks is configured to send all its DNS queries via one of its local resolvers. These queries are called <cite>recursive queries</cite> as the <a class="reference internal" href="../glossary.html#term-resolver"><span class="xref std std-term">resolver</span></a> must recursively send requests through the hierarchy of nameservers to obtain the <cite>answer</cite>.</p>
<p>DNS resolvers have several advantages over letting each Internet host query directly nameservers. Firstly, regular Internet hosts do not need to maintain the up-to-date list of the addresses of the root servers. Secondly, regular Internet hosts do not need to send queries to nameservers all over the Internet. Furthermore, as a DNS resolver serves a large number of hosts, it can cache the received answers. This allows the resolver to quickly return answers for popular DNS queries and reduces the load on all DNS servers <a class="reference internal" href="../bibliography.html#jsbm2002" id="id16"><span>[JSBM2002]</span></a>.</p>
<section id="benefits-of-names">
<h3>Benefits of names<a class="headerlink" href="#benefits-of-names" title="Link to this heading">#</a></h3>
<p>In addition to being more human-friendly, using names instead of addresses inside applications has several important benefits. To understand them, let us consider a popular application that provides information stored on servers. This application involves clients and servers. The server provides information upon requests from client processes. A first deployment of this application would be to rely only on addresses. In this case, the server process would be installed on one host, and the clients would connect to this server to retrieve information. Such a deployment has several drawbacks :</p>
<blockquote>
<div><ul class="simple">
<li><p>if the server process moves to another physical server, all clients must be informed about the new server address.</p></li>
<li><p>if there are many concurrent clients, the load of the server will increase without any possibility of adding another server without changing the server addresses used by the clients.</p></li>
</ul>
</div></blockquote>
<p>Using names solves these problems and provides additional benefits. If the clients are configured with the name of the server, they will query the name service before contacting the server. The name service will resolve the name into the corresponding address. If a server process needs to move from one physical server to another, it suffices to update the name-to-address mapping on the name service to allow all clients to connect to the new server. The name service also enables the servers to better sustain the load. Assume a very popular server which is accessed by millions of users. This service cannot be provided by a single physical server due to performance limitations. Thanks to the utilization of names, it is possible to scale this service by mapping a given name to a set of addresses. When a client queries the name service for the server’s name, the name service returns one of the addresses in the set. Various strategies can be used to select one particular address inside the set of addresses. A first strategy is to select a random address in the set. A second strategy is to maintain information about the load on the servers and return the address of the less loaded server. Note that the list of server addresses does not need to remain fixed. It is possible to add and remove addresses from the list to cope with load fluctuations. Another strategy is to infer the location of the client from the name request and return the address of the closest server.</p>
<p>Mapping a single name onto a set of addresses allows popular servers to dynamically scale. There are also benefits in mapping multiple names, possibly a large number of them, onto a single address. Consider the case of information servers run by individuals or SMEs. Some of these servers attract only a few clients per day. Using a single physical server for each of these services would be a waste of resources. A better approach is to use a single server for a set of services that are all identified by different names. This enables service providers to support a large number of server processes, identified by different names, onto a single physical server. If one of these server processes becomes very popular, it will be possible to map its name onto a set of addresses to be able to sustain the load. There are some deployments where this mapping is done dynamically in function of the load.</p>
<p>Names provide a lot of flexibility compared to addresses. For the network, they play a similar role as variables in programming languages. No programmer using a high-level programming language would consider using hardcoded values instead of variables. For the same reasons, all networked applications should depend on names and avoid dealing with addresses as much as possible.</p>
</section>
<section id="the-domain-name-system">
<span id="dns"/><h3>The Domain Name System<a class="headerlink" href="#the-domain-name-system" title="Link to this heading">#</a></h3>
<p>The last component of the Domain Name System is the DNS protocol. The original DNS protocol runs above both the datagram and the bytestream services. In practice, the datagram service is used when short queries and responses are exchanged, and the bytestream service is used when longer responses are expected. In this section, we first focus on the utilization of the DNS protocol above the datagram service. We will discuss later other recently proposed protocols to carry DNS information.</p>
<p id="index-15">DNS messages are composed of five parts that are named sections in RFC :<cite>1035</cite>. The first three sections are mandatory, and the last two sections are optional. The first section of a DNS message is its <cite>Header</cite>. It contains information about the message type and the content of the other sections. The second section contains the <cite>Question</cite> sent to the nameserver or resolver. The third section contains the <cite>Answer</cite> to the <cite>Question</cite>. When a client sends a DNS query, the <cite>Answer</cite> section is empty. The fourth section, named <cite>Authority</cite>, contains information about the servers that can provide an authoritative answer if required. The last section contains additional information that is supplied by the resolver or nameserver but was not requested in the question.</p>
<p>The header of DNS messages is composed of 12 bytes. The figure below presents its structure.</p>
<figure class="align-center" id="id54">
<a class="reference internal image-reference" href="../_images/dnsheader.svg"><img alt="../_images/dnsheader.svg" src="../Images/21a7bad41190434264bf8afe39a2de6a.png" style="width: 445.0px; height: 256.0px;" data-original-src="https://4ed.computer-networking.info/syllabus/default/_images/dnsheader.svg"/>
</a>
<figcaption>
<p><span class="caption-number">Fig. 25 </span><span class="caption-text">The DNS header</span><a class="headerlink" href="#id54" title="Link to this image">#</a></p>
</figcaption>
</figure>
<p>The <cite>Transaction ID</cite> (transaction identifier) is a 16-bit random value chosen by the client.
When a client sends a question to a DNS server, it remembers the question and its identifier. When a server returns an answer, it returns in the <cite>Transaction ID</cite> field the identifier chosen by the client. Thanks to this identifier, the client can match the received answer with the question that it sent.</p>
<p>The DNS header contains a series of flags. The <cite>QR</cite> flag is used to distinguish between queries and responses. It is set to <cite>0</cite> in DNS queries and <cite>1</cite> in DNS answers. The <cite>Opcode</cite> is used to specify the query type. For instance, a <a class="reference internal" href="../glossary.html#term-standard-query"><span class="xref std std-term">standard query</span></a> is used when a client sends a <cite>name</cite> and the server returns the corresponding <cite>data</cite>. An update request is used when the client sends a <cite>name</cite> and new <cite>data</cite>, and the server then updates its database.</p>
<p>The <cite>AA</cite> bit is set when the server that sent the response has <cite>authority</cite> for the domain name found in the question section. In the original DNS deployments, two types of servers were considered : <cite>authoritative</cite> servers and <cite>non-authoritative</cite> servers. The <cite>authoritative</cite> servers are managed by the system administrators responsible for a given domain. They always store the most recent information about a domain. <cite>Non-authoritative</cite> servers are servers or resolvers that store DNS information about external domains without being managed by the owners of a domain. They may thus provide answers that are out of date. From a security point of view, the <cite>authoritative</cite> bit is not an absolute indication about the validity of an answer. Securing the Domain Name System is a complex problem that was only addressed satisfactorily recently by the utilization of cryptographic signatures in the DNSSEC extensions to DNS described in : RFC:<cite>4033</cite>.</p>
<p>The <cite>RD</cite> (recursion desired) bit is set by a client when it sends a query to a resolver. Such a query is said to be <cite>recursive</cite> because the resolver will recursively traverse the DNS hierarchy to retrieve the answer on behalf of the client. In the past, all resolvers were configured to perform recursive queries on behalf of any Internet host. However, this exposes the resolvers to several security risks. The simplest one is that the resolver could become overloaded by having too many recursive queries to process. Most resolvers <a class="footnote-reference brackets" href="#f8888" id="id17" role="doc-noteref"><span class="fn-bracket">[</span>8<span class="fn-bracket">]</span></a> only allow recursive queries from clients belonging to their company or network and discard all other recursive queries. The <cite>RA</cite> bit indicates whether the server supports recursion. The <cite>RCODE</cite> is used to distinguish between different types of errors. See : RFC:<cite>1035</cite> for additional details. The last four fields indicate the size of the <cite>Question</cite>, <cite>Answer</cite>, <cite>Authority</cite>, and <cite>Additional</cite> sections of the DNS message.</p>
<p>The last four sections of the DNS message contain <cite>Resource Records</cite> (RR).  All RRs have the same top-level format shown in the figure below.</p>
<figure class="align-center" id="id55">
<a class="reference internal image-reference" href="../_images/dnsrr.svg"><img alt="../_images/dnsrr.svg" src="../Images/a838af70f19f03e6cc3645b1c9e8591e.png" style="width: 445.0px; height: 320.0px;" data-original-src="https://4ed.computer-networking.info/syllabus/default/_images/dnsrr.svg"/>
</a>
<figcaption>
<p><span class="caption-number">Fig. 26 </span><span class="caption-text">DNS Resource Records</span><a class="headerlink" href="#id55" title="Link to this image">#</a></p>
</figcaption>
</figure>
<p>In a <cite>Resource Record</cite> (<cite>RR</cite>), the <cite>Name</cite> indicates the name of the node to which this resource record pertains. The two-byte <cite>Type</cite> field indicates the type of resource record. The <cite>Class</cite> field was used to support the utilization of the DNS in other environments than the Internet. The <cite>IN</cite> <cite>Class</cite> refers to Internet names.</p>
<p>The <cite>TTL</cite> field indicates the lifetime of the <cite>Resource Record</cite> in seconds. This field is set by the server that returns an answer and indicates for how long a client or a resolver can store the <cite>Resource Record</cite> inside its cache. A long <cite>TTL</cite> indicates a stable <cite>RR</cite>. Some companies use short <cite>TTL</cite> values for mobile hosts and also for popular servers. For example, a web hosting company that wants to spread the load over a pool of hundred servers can configure its nameservers to return different answers to different clients. If each answer has a small <cite>TTL</cite>, the clients will be forced to send DNS queries regularly. The nameserver will reply to these queries by supplying the address of the less loaded server.</p>
<p>The <cite>RDLength</cite> field is the length of the <cite>RData</cite> field that contains the information of the type specified in the <cite>Type</cite> field.</p>
<p>Several types of DNS RR are used in practice. The <cite>A</cite> type encodes the IPv4 address that corresponds to the specified name. The <cite>AAAA</cite> type encodes the IPv6 address that corresponds to the specified name. A <cite>NS</cite> record contains the name of the DNS server that is responsible for a given domain. For example, a query for the <cite>AAAA</cite> record associated with the <cite>www.ietf.org</cite> name returned the following answer:</p>
<figure class="align-center" id="id56">
<img alt="../_images/dns6-www-ietf-org.svg" src="../Images/2a132b4acb2d03e996f683289606e16b.png" data-original-src="https://4ed.computer-networking.info/syllabus/default/_images/dns6-www-ietf-org.svg"/>
<figcaption>
<p><span class="caption-number">Fig. 27 </span><span class="caption-text">Query for the <cite>AAAA</cite> record of <cite>www.ietf.org</cite></span><a class="headerlink" href="#id56" title="Link to this image">#</a></p>
</figcaption>
</figure>
<p>This answer contains several pieces of information. First, the name <cite>www.ietf.org</cite> is associated with the IP address <cite>2001:1890:123a::1:1e</cite>. Second, the <cite>ietf.org</cite> domain is managed by six different nameservers. Five of these nameservers are reachable via IPv4 and IPv6.</p>
<p><cite>CNAME</cite> (or canonical names) are used to define aliases. For example, <cite>www.example.com</cite> could be a <cite>CNAME</cite> for <cite>pc12.example.com</cite>, which is the actual name of the server on which the web server for <cite>www.example.com</cite> runs.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Reverse DNS</p>
<p>The DNS is mainly used to find the address that corresponds to a given name. However, it is sometimes useful to obtain the name that corresponds to an IP address. This is done by using the <cite>PTR</cite> (<cite>pointer</cite>) <cite>RR</cite>. The <cite>RData</cite> part of a <cite>PTR</cite> <cite>RR</cite> contains the name while the <cite>Name</cite> part of the <cite>RR</cite> contains the IP address encoded in the <cite>in-addr.arpa</cite> domain. IPv4 addresses are encoded in the <cite>in-addr.arpa</cite> by reversing the four digits that compose the dotted decimal representation of the address. For example, consider IPv4 address <cite>192.0.2.11</cite>. The hostname associated to this address can be found by requesting the <cite>PTR</cite> <cite>RR</cite> that corresponds to <cite>11.2.0.192.in-addr.arpa</cite>.
A similar solution is used to support IPv6 addresses : RFC:<cite>3596</cite>, but slightly more complex given the length of the IPv6 addresses. For example, consider IPv6 address <cite>2001:1890:123a::1:1e</cite>. To obtain the name that corresponds to this address, we need first to convert it in a reverse dotted decimal notation : <cite>e.1.0.0.1.0.0.0.0.0.0.0.0.0.0.0.0.0.0.a.3.2.1.0.9.8.1.1.0.0.2</cite>. In this notation, each character between dots corresponds to one nibble, i.e. four bits. The low-order byte (<cite>e</cite>) appears first and the high order (<cite>2</cite>) last. To obtain the name that corresponds to this address, one needs to append the <cite>ip6.arpa</cite> domain name and query for <cite>e.1.0.0.1.0.0.0.0.0.0.0.0.0.0.0.0.0.0.0.a.3.2.1.0.9.8.1.1.0.0.2.ip6.arpa</cite>. In practice, tools and libraries do the conversion automatically and the user does not need to worry about it.</p>
</div>
<p>An important point to note regarding the Domain Name System is that it is extensible. Thanks to the <cite>Type</cite> and <cite>RDLength</cite> fields, the format of the Resource Records can easily be extended. Furthermore, a DNS implementation that receives a new Resource Record that it does not understand can ignore the record while still being able to process the other parts of the message. This allows, for example, a DNS server that only supports IPv6 to
safely ignore the IPv4 addresses listed in the DNS reply for <cite>www.ietf.org</cite> while still being able to correctly parse the Resource Records that it understands. This allowed the Domain Name System to evolve over the years while still preserving the backward compatibility with already deployed DNS implementations.</p>
</section>
&#13;

<h3>Benefits of names<a class="headerlink" href="#benefits-of-names" title="Link to this heading">#</a></h3>
<p>In addition to being more human-friendly, using names instead of addresses inside applications has several important benefits. To understand them, let us consider a popular application that provides information stored on servers. This application involves clients and servers. The server provides information upon requests from client processes. A first deployment of this application would be to rely only on addresses. In this case, the server process would be installed on one host, and the clients would connect to this server to retrieve information. Such a deployment has several drawbacks :</p>
<blockquote>
<div><ul class="simple">
<li><p>if the server process moves to another physical server, all clients must be informed about the new server address.</p></li>
<li><p>if there are many concurrent clients, the load of the server will increase without any possibility of adding another server without changing the server addresses used by the clients.</p></li>
</ul>
</div></blockquote>
<p>Using names solves these problems and provides additional benefits. If the clients are configured with the name of the server, they will query the name service before contacting the server. The name service will resolve the name into the corresponding address. If a server process needs to move from one physical server to another, it suffices to update the name-to-address mapping on the name service to allow all clients to connect to the new server. The name service also enables the servers to better sustain the load. Assume a very popular server which is accessed by millions of users. This service cannot be provided by a single physical server due to performance limitations. Thanks to the utilization of names, it is possible to scale this service by mapping a given name to a set of addresses. When a client queries the name service for the server’s name, the name service returns one of the addresses in the set. Various strategies can be used to select one particular address inside the set of addresses. A first strategy is to select a random address in the set. A second strategy is to maintain information about the load on the servers and return the address of the less loaded server. Note that the list of server addresses does not need to remain fixed. It is possible to add and remove addresses from the list to cope with load fluctuations. Another strategy is to infer the location of the client from the name request and return the address of the closest server.</p>
<p>Mapping a single name onto a set of addresses allows popular servers to dynamically scale. There are also benefits in mapping multiple names, possibly a large number of them, onto a single address. Consider the case of information servers run by individuals or SMEs. Some of these servers attract only a few clients per day. Using a single physical server for each of these services would be a waste of resources. A better approach is to use a single server for a set of services that are all identified by different names. This enables service providers to support a large number of server processes, identified by different names, onto a single physical server. If one of these server processes becomes very popular, it will be possible to map its name onto a set of addresses to be able to sustain the load. There are some deployments where this mapping is done dynamically in function of the load.</p>
<p>Names provide a lot of flexibility compared to addresses. For the network, they play a similar role as variables in programming languages. No programmer using a high-level programming language would consider using hardcoded values instead of variables. For the same reasons, all networked applications should depend on names and avoid dealing with addresses as much as possible.</p>
&#13;

<span id="dns"/><h3>The Domain Name System<a class="headerlink" href="#the-domain-name-system" title="Link to this heading">#</a></h3>
<p>The last component of the Domain Name System is the DNS protocol. The original DNS protocol runs above both the datagram and the bytestream services. In practice, the datagram service is used when short queries and responses are exchanged, and the bytestream service is used when longer responses are expected. In this section, we first focus on the utilization of the DNS protocol above the datagram service. We will discuss later other recently proposed protocols to carry DNS information.</p>
<p id="index-15">DNS messages are composed of five parts that are named sections in RFC :<cite>1035</cite>. The first three sections are mandatory, and the last two sections are optional. The first section of a DNS message is its <cite>Header</cite>. It contains information about the message type and the content of the other sections. The second section contains the <cite>Question</cite> sent to the nameserver or resolver. The third section contains the <cite>Answer</cite> to the <cite>Question</cite>. When a client sends a DNS query, the <cite>Answer</cite> section is empty. The fourth section, named <cite>Authority</cite>, contains information about the servers that can provide an authoritative answer if required. The last section contains additional information that is supplied by the resolver or nameserver but was not requested in the question.</p>
<p>The header of DNS messages is composed of 12 bytes. The figure below presents its structure.</p>
<figure class="align-center" id="id54">
<a class="reference internal image-reference" href="../_images/dnsheader.svg"><img alt="../_images/dnsheader.svg" src="../Images/21a7bad41190434264bf8afe39a2de6a.png" style="width: 445.0px; height: 256.0px;" data-original-src="https://4ed.computer-networking.info/syllabus/default/_images/dnsheader.svg"/>
</a>
<figcaption>
<p><span class="caption-number">Fig. 25 </span><span class="caption-text">The DNS header</span><a class="headerlink" href="#id54" title="Link to this image">#</a></p>
</figcaption>
</figure>
<p>The <cite>Transaction ID</cite> (transaction identifier) is a 16-bit random value chosen by the client.
When a client sends a question to a DNS server, it remembers the question and its identifier. When a server returns an answer, it returns in the <cite>Transaction ID</cite> field the identifier chosen by the client. Thanks to this identifier, the client can match the received answer with the question that it sent.</p>
<p>The DNS header contains a series of flags. The <cite>QR</cite> flag is used to distinguish between queries and responses. It is set to <cite>0</cite> in DNS queries and <cite>1</cite> in DNS answers. The <cite>Opcode</cite> is used to specify the query type. For instance, a <a class="reference internal" href="../glossary.html#term-standard-query"><span class="xref std std-term">standard query</span></a> is used when a client sends a <cite>name</cite> and the server returns the corresponding <cite>data</cite>. An update request is used when the client sends a <cite>name</cite> and new <cite>data</cite>, and the server then updates its database.</p>
<p>The <cite>AA</cite> bit is set when the server that sent the response has <cite>authority</cite> for the domain name found in the question section. In the original DNS deployments, two types of servers were considered : <cite>authoritative</cite> servers and <cite>non-authoritative</cite> servers. The <cite>authoritative</cite> servers are managed by the system administrators responsible for a given domain. They always store the most recent information about a domain. <cite>Non-authoritative</cite> servers are servers or resolvers that store DNS information about external domains without being managed by the owners of a domain. They may thus provide answers that are out of date. From a security point of view, the <cite>authoritative</cite> bit is not an absolute indication about the validity of an answer. Securing the Domain Name System is a complex problem that was only addressed satisfactorily recently by the utilization of cryptographic signatures in the DNSSEC extensions to DNS described in : RFC:<cite>4033</cite>.</p>
<p>The <cite>RD</cite> (recursion desired) bit is set by a client when it sends a query to a resolver. Such a query is said to be <cite>recursive</cite> because the resolver will recursively traverse the DNS hierarchy to retrieve the answer on behalf of the client. In the past, all resolvers were configured to perform recursive queries on behalf of any Internet host. However, this exposes the resolvers to several security risks. The simplest one is that the resolver could become overloaded by having too many recursive queries to process. Most resolvers <a class="footnote-reference brackets" href="#f8888" id="id17" role="doc-noteref"><span class="fn-bracket">[</span>8<span class="fn-bracket">]</span></a> only allow recursive queries from clients belonging to their company or network and discard all other recursive queries. The <cite>RA</cite> bit indicates whether the server supports recursion. The <cite>RCODE</cite> is used to distinguish between different types of errors. See : RFC:<cite>1035</cite> for additional details. The last four fields indicate the size of the <cite>Question</cite>, <cite>Answer</cite>, <cite>Authority</cite>, and <cite>Additional</cite> sections of the DNS message.</p>
<p>The last four sections of the DNS message contain <cite>Resource Records</cite> (RR).  All RRs have the same top-level format shown in the figure below.</p>
<figure class="align-center" id="id55">
<a class="reference internal image-reference" href="../_images/dnsrr.svg"><img alt="../_images/dnsrr.svg" src="../Images/a838af70f19f03e6cc3645b1c9e8591e.png" style="width: 445.0px; height: 320.0px;" data-original-src="https://4ed.computer-networking.info/syllabus/default/_images/dnsrr.svg"/>
</a>
<figcaption>
<p><span class="caption-number">Fig. 26 </span><span class="caption-text">DNS Resource Records</span><a class="headerlink" href="#id55" title="Link to this image">#</a></p>
</figcaption>
</figure>
<p>In a <cite>Resource Record</cite> (<cite>RR</cite>), the <cite>Name</cite> indicates the name of the node to which this resource record pertains. The two-byte <cite>Type</cite> field indicates the type of resource record. The <cite>Class</cite> field was used to support the utilization of the DNS in other environments than the Internet. The <cite>IN</cite> <cite>Class</cite> refers to Internet names.</p>
<p>The <cite>TTL</cite> field indicates the lifetime of the <cite>Resource Record</cite> in seconds. This field is set by the server that returns an answer and indicates for how long a client or a resolver can store the <cite>Resource Record</cite> inside its cache. A long <cite>TTL</cite> indicates a stable <cite>RR</cite>. Some companies use short <cite>TTL</cite> values for mobile hosts and also for popular servers. For example, a web hosting company that wants to spread the load over a pool of hundred servers can configure its nameservers to return different answers to different clients. If each answer has a small <cite>TTL</cite>, the clients will be forced to send DNS queries regularly. The nameserver will reply to these queries by supplying the address of the less loaded server.</p>
<p>The <cite>RDLength</cite> field is the length of the <cite>RData</cite> field that contains the information of the type specified in the <cite>Type</cite> field.</p>
<p>Several types of DNS RR are used in practice. The <cite>A</cite> type encodes the IPv4 address that corresponds to the specified name. The <cite>AAAA</cite> type encodes the IPv6 address that corresponds to the specified name. A <cite>NS</cite> record contains the name of the DNS server that is responsible for a given domain. For example, a query for the <cite>AAAA</cite> record associated with the <cite>www.ietf.org</cite> name returned the following answer:</p>
<figure class="align-center" id="id56">
<img alt="../_images/dns6-www-ietf-org.svg" src="../Images/2a132b4acb2d03e996f683289606e16b.png" data-original-src="https://4ed.computer-networking.info/syllabus/default/_images/dns6-www-ietf-org.svg"/>
<figcaption>
<p><span class="caption-number">Fig. 27 </span><span class="caption-text">Query for the <cite>AAAA</cite> record of <cite>www.ietf.org</cite></span><a class="headerlink" href="#id56" title="Link to this image">#</a></p>
</figcaption>
</figure>
<p>This answer contains several pieces of information. First, the name <cite>www.ietf.org</cite> is associated with the IP address <cite>2001:1890:123a::1:1e</cite>. Second, the <cite>ietf.org</cite> domain is managed by six different nameservers. Five of these nameservers are reachable via IPv4 and IPv6.</p>
<p><cite>CNAME</cite> (or canonical names) are used to define aliases. For example, <cite>www.example.com</cite> could be a <cite>CNAME</cite> for <cite>pc12.example.com</cite>, which is the actual name of the server on which the web server for <cite>www.example.com</cite> runs.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Reverse DNS</p>
<p>The DNS is mainly used to find the address that corresponds to a given name. However, it is sometimes useful to obtain the name that corresponds to an IP address. This is done by using the <cite>PTR</cite> (<cite>pointer</cite>) <cite>RR</cite>. The <cite>RData</cite> part of a <cite>PTR</cite> <cite>RR</cite> contains the name while the <cite>Name</cite> part of the <cite>RR</cite> contains the IP address encoded in the <cite>in-addr.arpa</cite> domain. IPv4 addresses are encoded in the <cite>in-addr.arpa</cite> by reversing the four digits that compose the dotted decimal representation of the address. For example, consider IPv4 address <cite>192.0.2.11</cite>. The hostname associated to this address can be found by requesting the <cite>PTR</cite> <cite>RR</cite> that corresponds to <cite>11.2.0.192.in-addr.arpa</cite>.
A similar solution is used to support IPv6 addresses : RFC:<cite>3596</cite>, but slightly more complex given the length of the IPv6 addresses. For example, consider IPv6 address <cite>2001:1890:123a::1:1e</cite>. To obtain the name that corresponds to this address, we need first to convert it in a reverse dotted decimal notation : <cite>e.1.0.0.1.0.0.0.0.0.0.0.0.0.0.0.0.0.0.a.3.2.1.0.9.8.1.1.0.0.2</cite>. In this notation, each character between dots corresponds to one nibble, i.e. four bits. The low-order byte (<cite>e</cite>) appears first and the high order (<cite>2</cite>) last. To obtain the name that corresponds to this address, one needs to append the <cite>ip6.arpa</cite> domain name and query for <cite>e.1.0.0.1.0.0.0.0.0.0.0.0.0.0.0.0.0.0.0.a.3.2.1.0.9.8.1.1.0.0.2.ip6.arpa</cite>. In practice, tools and libraries do the conversion automatically and the user does not need to worry about it.</p>
</div>
<p>An important point to note regarding the Domain Name System is that it is extensible. Thanks to the <cite>Type</cite> and <cite>RDLength</cite> fields, the format of the Resource Records can easily be extended. Furthermore, a DNS implementation that receives a new Resource Record that it does not understand can ignore the record while still being able to process the other parts of the message. This allows, for example, a DNS server that only supports IPv6 to
safely ignore the IPv4 addresses listed in the DNS reply for <cite>www.ietf.org</cite> while still being able to correctly parse the Resource Records that it understands. This allowed the Domain Name System to evolve over the years while still preserving the backward compatibility with already deployed DNS implementations.</p>
&#13;

<span id="email"/><h2>Electronic mail<a class="headerlink" href="#electronic-mail" title="Link to this heading">#</a></h2>
<p>Electronic mail, or email, is a very popular application in computer networks such as the Internet. Email <a class="reference external" href="http://openmap.bbn.com/~tomlinso/ray/firstemailframe.html">appeared</a> in the early 1970s and allows users to exchange text based messages. Initially, it was mainly used to exchange short messages, but over the years its usage has grown. It is now not only used to exchange small, but also long messages that can be composed of several parts as we will see later.</p>
<p>Before looking at the details of Internet email, let us consider a simple scenario illustrated in <a class="reference internal" href="#fig-email-arch"><span class="std std-numref">Fig. 28</span></a>, where Alice sends an email to Bob. Alice prepares her email by using an <a class="reference external" href="https://en.wikipedia.org/wiki/Comparison_of_email_clients">email clients</a> and sends it to her email server. Alice’s <a class="reference external" href="http://en.wikipedia.org/wiki/Comparison_of_mail_servers">email server</a> extracts Bob’s address from the email and delivers the message to Bob’s server. Bob retrieves Alice’s message on his server and reads it by using his favorite email client or through his webmail interface.</p>
<blockquote>
<div><div class="figure" id="id57" style="text-align: center">
<span id="fig-email-arch"/><p><img src="../Images/1de029c587cbf6cfd571cb993682463a.png" alt="Figure made with TikZ" data-original-src="https://4ed.computer-networking.info/syllabus/default/_images/tikz-d532eeba6ea7ce06137fa6534176a8b85b2baf8e.png"/></p>
<p><span class="caption-number">Fig. 28 </span><span class="caption-text">Simplified architecture of the Internet email</span></p>
</div></div></blockquote>
<p>The email system that we consider in this book is composed of four components :</p>
<blockquote>
<div><ul class="simple">
<li><p>a message format, that defines how valid email messages are encoded</p></li>
<li><p>protocols, that allow hosts and servers to exchange email messages</p></li>
<li><p>client software, that allows users to easily create and read email messages</p></li>
<li><p>software, that allows servers to efficiently exchange email messages</p></li>
</ul>
</div></blockquote>
<p>We first discuss the format of email messages followed by the protocols that are used on today’s Internet to exchange and retrieve emails. Other email systems have been developed in the past <a class="reference internal" href="../bibliography.html#bush1993" id="id18"><span>[Bush1993]</span></a> <a class="reference internal" href="../bibliography.html#genilloud1990" id="id19"><span>[Genilloud1990]</span></a> <a class="reference internal" href="../bibliography.html#gc2000" id="id20"><span>[GC2000]</span></a>, but today most email solutions have migrated to the Internet email. Information about the software that is used to compose and deliver emails may be found on <a class="reference external" href="https://en.wikipedia.org">wikipedia</a> among others, for both <a class="reference external" href="https://en.wikipedia.org/wiki/Comparison_of_email_clients">email clients</a> and <a class="reference external" href="http://en.wikipedia.org/wiki/Comparison_of_mail_servers">email servers</a>. More detailed information about the full Internet Mail Architecture may be found in <span class="target" id="index-16"/><a class="rfc reference external" href="https://datatracker.ietf.org/doc/html/rfc5598.html"><strong>RFC 5598</strong></a>.</p>
<p id="index-17">Email messages, like postal mail, are composed of two parts :</p>
<blockquote>
<div><ul class="simple">
<li><p>a <cite>header</cite> that plays the same role as the letterhead in regular mail. It contains metadata about the message.</p></li>
<li><p>the <cite>body</cite> that contains the message itself.</p></li>
</ul>
</div></blockquote>
<p>Email messages are entirely composed of lines of ASCII characters. Each line can contain up to 998 characters and is terminated by the <cite>CR</cite> and <cite>LF</cite> control characters <span class="target" id="index-18"/><a class="rfc reference external" href="https://datatracker.ietf.org/doc/html/rfc5322.html"><strong>RFC 5322</strong></a>. The lines that compose the <cite>header</cite> appear before the message <cite>body</cite>. An empty line, containing only the <cite>CR</cite> and <cite>LF</cite> characters, marks the end of the <cite>header</cite>. This is illustrated in <a class="reference internal" href="#fig-email-msg"><span class="std std-numref">Fig. 29</span></a>.</p>
<blockquote>
<div><div class="figure" id="id58" style="text-align: center">
<span id="fig-email-msg"/><p><img src="../Images/8a178944414537a08bc98dae0cf87286.png" alt="Figure made with TikZ" data-original-src="https://4ed.computer-networking.info/syllabus/default/_images/tikz-414a73216cd7c532e0153815e9553d0dd93a9cdc.png"/></p>
<p><span class="caption-number">Fig. 29 </span><span class="caption-text">The structure of email messages</span></p>
</div></div></blockquote>
<p>The email header contains several lines that all begin with a keyword followed by a colon and additional information. The format of email messages and the different types of header lines are defined in <span class="target" id="index-19"/><a class="rfc reference external" href="https://datatracker.ietf.org/doc/html/rfc5322.html"><strong>RFC 5322</strong></a>. Two of these header lines are mandatory and must appear in all email messages :</p>
<blockquote>
<div><ul class="simple">
<li><p>The sender address. This header line starts with <cite>From:</cite>. This contains the (optional) name of the sender followed by its email address between <cite>&lt;</cite> and <cite>&gt;</cite>. Email addresses are always composed of a username followed by the <cite>@</cite> sign and a domain name.</p></li>
<li><p>The date. This header line starts with <cite>Date:</cite>. <span class="target" id="index-20"/><a class="rfc reference external" href="https://datatracker.ietf.org/doc/html/rfc5322.html"><strong>RFC 5322</strong></a> precisely defines the format used to encode a date.</p></li>
</ul>
</div></blockquote>
<p>Other header lines appear in most email messages. The <cite>Subject:</cite> header line allows the sender to indicate the topic discussed in the email. Three types of header lines can be used to specify the recipients of a message :</p>
<blockquote>
<div><ul class="simple">
<li><p>the <cite>To:</cite> header line contains the email addresses of the primary recipients of the message <a class="footnote-reference brackets" href="#fto" id="id21" role="doc-noteref"><span class="fn-bracket">[</span>10<span class="fn-bracket">]</span></a>. Several addresses can be separated by using commas.</p></li>
<li><p>the <cite>cc:</cite> header line is used by the sender to provide a list of email addresses that must receive a carbon copy of the message. Several addresses can be listed in this header line, separated by commas. All recipients of the email message receive the <cite>To:</cite> and <cite>cc:</cite> header lines.</p></li>
<li><p>the <cite>bcc:</cite> header line is used by the sender to provide a list of comma separated email addresses that must receive a blind carbon copy of the message. The <cite>bcc:</cite> header line is not delivered to the recipients of the email message.</p></li>
</ul>
</div></blockquote>
<p>A simple email message containing the <cite>From:</cite>, <cite>To:</cite>, <cite>Subject:</cite> and <cite>Date:</cite> header lines and two lines of body is shown below.</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span/>From: Bob Smith &lt;Bob@machine.example&gt;
To: Alice Doe &lt;alice@example.net&gt;, Alice Smith &lt;Alice@machine.example&gt;
Subject: Hello
Date: Mon, 8 Mar 2010 19:55:06 -0600

This is the "Hello world" of email messages.
This is the second line of the body
</pre></div>
</div>
<p>Note the empty line after the <cite>Date:</cite> header line; this empty line contains only the <cite>CR</cite> and <cite>LF</cite> characters, and marks the boundary between the header and the body of the message.</p>
<p>Several other optional header lines are defined in <span class="target" id="index-21"/><a class="rfc reference external" href="https://datatracker.ietf.org/doc/html/rfc5322.html"><strong>RFC 5322</strong></a> and elsewhere <a class="footnote-reference brackets" href="#femailheaders" id="id22" role="doc-noteref"><span class="fn-bracket">[</span>11<span class="fn-bracket">]</span></a>. Furthermore, many email clients and servers define their own header lines starting from <cite>X-</cite>. Several of the optional header lines defined in <span class="target" id="index-22"/><a class="rfc reference external" href="https://datatracker.ietf.org/doc/html/rfc5322.html"><strong>RFC 5322</strong></a> are worth being discussed here :</p>
<blockquote>
<div><ul class="simple">
<li><p>the <cite>Message-Id:</cite> header line is used to associate a “unique” identifier to each email. Email identifiers are usually structured like <cite>string@domain</cite> where <cite>string</cite> is a unique character string or sequence number chosen by the sender of the email and <cite>domain</cite> the domain name of the sender. Since domain names are unique, a host can generate globally unique message identifiers concatenating a locally unique identifier with its domain name.</p></li>
<li><p>the <cite>In-reply-to:</cite> header line is used when a message was created in reply to a previous message. In this case, the end of the <cite>In-reply-to:</cite> line contains the identifier of the original message.</p></li>
<li><p>the <cite>Received:</cite> header line is used when an email message is processed by several servers before reaching its destination. Each intermediate email server adds a <cite>Received:</cite> header line. These header lines are useful to debug problems in delivering email messages.</p></li>
</ul>
</div></blockquote>
<p>The figure below shows the header lines of one email message. The message originated at a host named <cite>wira.firstpr.com.au</cite> and was received by <cite>smtp3.sgsi.ucl.ac.be</cite>. The <cite>Received:</cite> lines have been wrapped for readability.</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span/>Received: from smtp3.sgsi.ucl.ac.be (Unknown [10.1.5.3])
    by mmp.sipr-dc.ucl.ac.be
    (Sun Java(tm) System Messaging Server 7u3-15.01 64bit (built Feb 12 2010))
    with ESMTP id &lt;0KYY00L85LI5JLE0@mmp.sipr-dc.ucl.ac.be&gt;; Mon,
    08 Mar 2010 11:37:17 +0100 (CET)
Received: from mail.ietf.org (mail.ietf.org [64.170.98.32])
    by smtp3.sgsi.ucl.ac.be (Postfix) with ESMTP id B92351C60D7; Mon,
    08 Mar 2010 11:36:51 +0100 (CET)
Received: from [127.0.0.1] (localhost [127.0.0.1])     by core3.amsl.com (Postfix)
    with ESMTP id F066A3A68B9; Mon, 08 Mar 2010 02:36:38 -0800 (PST)
Received: from localhost (localhost [127.0.0.1])       by core3.amsl.com (Postfix)
    with ESMTP id A1E6C3A681B  for &lt;rrg@core3.amsl.com&gt;; Mon,
    08 Mar 2010 02:36:37 -0800 (PST)
Received: from mail.ietf.org ([64.170.98.32])
    by localhost (core3.amsl.com [127.0.0.1]) (amavisd-new, port 10024)
    with ESMTP id erw8ih2v8VQa for &lt;rrg@core3.amsl.com&gt;; Mon,
    08 Mar 2010 02:36:36 -0800 (PST)
Received: from gair.firstpr.com.au (gair.firstpr.com.au [150.101.162.123])
    by core3.amsl.com (Postfix) with ESMTP id 03E893A67ED      for &lt;rrg@irtf.org&gt;; Mon,
    08 Mar 2010 02:36:35 -0800 (PST)
Received: from [10.0.0.6] (wira.firstpr.com.au [10.0.0.6])
    by gair.firstpr.com.au (Postfix) with ESMTP id D0A49175B63; Mon,
    08 Mar 2010 21:36:37 +1100 (EST)
Date: Mon, 08 Mar 2010 21:36:38 +1100
From: Robin Whittle &lt;rw@firstpr.com.au&gt;
Subject: Re: [rrg] Recommendation and what happens next
In-reply-to: &lt;C7B9C21A.4FAB%tony.li@tony.li&gt;
To: RRG &lt;rrg@irtf.org&gt;
Message-id: &lt;4B94D336.7030504@firstpr.com.au&gt;

Message content removed
</pre></div>
</div>
<p>Initially, email was used to exchange small messages of ASCII text between computer scientists. However, with the growth of the Internet, supporting only ASCII text became a severe limitation for two reasons. First of all, non-English speakers wanted to write emails in their native language that often required more characters than those of the ASCII character table. Second, many users wanted to send other content than just ASCII text by email such as binary files, images or sound.</p>
<p>To solve this problem, the <a class="reference external" href="https://www.ietf.org">IETF</a> developed the Multipurpose Internet Mail Extensions (<a class="reference internal" href="../glossary.html#term-MIME"><span class="xref std std-term">MIME</span></a>). These extensions were carefully designed to allow Internet email to carry non-ASCII characters and binary files without breaking the email servers that were deployed at that time. This requirement for backward compatibility forced the MIME designers to develop extensions to the existing email message format <span class="target" id="index-23"/><a class="rfc reference external" href="https://datatracker.ietf.org/doc/html/rfc822.html"><strong>RFC 822</strong></a> instead of defining a completely new format that would have been better suited to support the new types of emails.</p>
<p><span class="target" id="index-24"/><a class="rfc reference external" href="https://datatracker.ietf.org/doc/html/rfc2045.html"><strong>RFC 2045</strong></a> defines three new types of header lines to support MIME :</p>
<blockquote>
<div><ul class="simple">
<li><p>The <cite>MIME-Version:</cite> header line indicates the version of the MIME specification that was used to encode the email message. The current version of MIME is 1.0. Other versions of MIME may be defined in the future. Thanks to this header line, the software that processes email messages will be able to adapt to the MIME version used to encode the message. Messages that do not contain this header are supposed to be formatted according to the original <span class="target" id="index-25"/><a class="rfc reference external" href="https://datatracker.ietf.org/doc/html/rfc822.html"><strong>RFC 822</strong></a> specification.</p></li>
<li><p>The <cite>Content-Type:</cite> header line indicates the type of data that is carried inside the message (see below).</p></li>
<li><p>The <cite>Content-Transfer-Encoding:</cite> header line is used to specify how the message has been encoded. When MIME was designed, some email servers were only able to process messages containing characters encoded using the 7 bits ASCII character set. MIME allows the utilization of other character encodings.</p></li>
</ul>
</div></blockquote>
<p>Inside the email header, the <cite>Content-Type:</cite> header line indicates how the MIME email message is structured. <span class="target" id="index-26"/><a class="rfc reference external" href="https://datatracker.ietf.org/doc/html/rfc2046.html"><strong>RFC 2046</strong></a> defines the utilization of this header line. The two most common structures for MIME messages are :</p>
<blockquote>
<div><ul class="simple">
<li><p><cite>Content-Type: multipart/mixed</cite>. This header line indicates that the MIME message contains several independent parts. For example, such a message may contain a part in plain text and a binary file.</p></li>
<li><p><cite>Content-Type: multipart/alternative</cite>. This header line indicates that the MIME message contains several representations of the same information. For example, a <cite>multipart/alternative</cite> message may contain both a plain text and an HTML version of the same text.</p></li>
</ul>
</div></blockquote>
<p>To support these two types of MIME messages, the recipient of a message must be able to extract the different parts from the message. In <span class="target" id="index-27"/><a class="rfc reference external" href="https://datatracker.ietf.org/doc/html/rfc822.html"><strong>RFC 822</strong></a>, an empty line was used to separate the header lines from the body. Using an empty line to separate the different parts of an email body would be difficult as the body of email messages often contains one or more empty lines. Another possible option would be to define a special line, e.g. <cite>*-LAST_LINE-*</cite> to mark the boundary between two parts of a MIME message. Unfortunately, this is not possible as some emails may contain this string in their body (e.g. emails sent to students to explain the format of MIME messages). To solve this problem, the <cite>Content-Type:</cite> header line contains a second parameter that specifies the string that has been used by the sender of the MIME message to delineate the different parts. In practice, this string is often chosen randomly by the mail client.</p>
<p>The email message below, copied from <span class="target" id="index-28"/><a class="rfc reference external" href="https://datatracker.ietf.org/doc/html/rfc2046.html"><strong>RFC 2046</strong></a> shows a MIME message containing two parts that are both in plain text and encoded using the ASCII character set. The string <cite>simple boundary</cite> is defined in the <cite>Content-Type:</cite> header as the marker for the boundary between two successive parts. Another example of MIME messages may be found in <span class="target" id="index-29"/><a class="rfc reference external" href="https://datatracker.ietf.org/doc/html/rfc2046.html"><strong>RFC 2046</strong></a>.</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span/>Date: Mon, 20 Sep 1999 16:33:16 +0200
From: Nathaniel Borenstein &lt;nsb@bellcore.com&gt;
To: Ned Freed &lt;ned@innosoft.com&gt;
Subject: Test
MIME-Version: 1.0
Content-Type: multipart/mixed; boundary="simple boundary"

preamble, to be ignored

--simple boundary
Content-Type: text/plain; charset=us-ascii

First part

--simple boundary
Content-Type: text/plain; charset=us-ascii

Second part
--simple boundary
</pre></div>
</div>
<p>The <cite>Content-Type:</cite> header can also be used inside a MIME part. In this case, it indicates the type of data placed in this part. Each data type is specified as a type followed by a subtype. A detailed description may be found in <span class="target" id="index-30"/><a class="rfc reference external" href="https://datatracker.ietf.org/doc/html/rfc2046.html"><strong>RFC 2046</strong></a>. Some of the most popular <cite>Content-Type:</cite> header lines are :</p>
<blockquote>
<div><ul class="simple">
<li><p><cite>text</cite>. The message part contains information in textual format. There are several subtypes : <cite>text/plain</cite> for regular ASCII text, <cite>text/html</cite> defined in <span class="target" id="index-31"/><a class="rfc reference external" href="https://datatracker.ietf.org/doc/html/rfc2854.html"><strong>RFC 2854</strong></a> for documents in <a class="reference internal" href="../glossary.html#term-HTML"><span class="xref std std-term">HTML</span></a> format or the <cite>text/enriched</cite> format defined in <span class="target" id="index-32"/><a class="rfc reference external" href="https://datatracker.ietf.org/doc/html/rfc1896.html"><strong>RFC 1896</strong></a>. The <cite>Content-Type:</cite> header line may contain a second parameter that specifies the character set used to encode the text. <cite>charset=us-ascii</cite> is the standard ASCII character table.  Other frequent character sets include <cite>charset=UTF8</cite> or <cite>charset=iso-8859-1</cite>. The <a class="reference external" href="http://www.iana.org/assignments/character-sets">list of standard character sets</a> is maintained by <a class="reference internal" href="../glossary.html#term-IANA"><span class="xref std std-term">IANA</span></a>.</p></li>
<li><p><cite>image</cite>. The message part contains a binary representation of an image. The subtype indicates the format of the image such as <a class="reference external" href="http://en.wikipedia.org/wiki/Graphics_Interchange_Format">gif</a>, <a class="reference external" href="http://en.wikipedia.org/wiki/Jpeg">jpg</a> or <a class="reference external" href="http://en.wikipedia.org/wiki/Portable_Network_Graphics">png</a>.</p></li>
<li><p><cite>audio</cite>. The message part contains an audio clip. The subtype indicates the format of the audio clip like <a class="reference external" href="http://en.wikipedia.org/wiki/Wav">wav</a> or <a class="reference external" href="http://en.wikipedia.org/wiki/Mp3">mp3</a>.</p></li>
<li><p><cite>video</cite>. The message part contains a video clip. The subtype indicates the format of the video clip like <a class="reference external" href="http://en.wikipedia.org/wiki/Audio_Video_Interleave">avi</a> or <a class="reference external" href="http://en.wikipedia.org/wiki/Mp4">mp4</a>.</p></li>
<li><p><cite>application</cite>. The message part contains binary information that was produced by the particular application listed as the subtype. Email clients use the subtype to launch the application that is able to decode the received binary information.</p></li>
</ul>
</div></blockquote>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>From ASCII to Unicode</p>
<p>The first computers used different techniques to represent characters in memory and on disk. During the 1960s, computers began to exchange information via tape or telephone lines. Unfortunately, each vendor had its own proprietary character set and exchanging data between computers from different vendors was often difficult. The 7 bits ASCII character table <span class="target" id="index-33"/><a class="rfc reference external" href="https://datatracker.ietf.org/doc/html/rfc20.html"><strong>RFC 20</strong></a> was adopted by several vendors and by many Internet protocols. However, ASCII became a problem with the internationalization of the Internet and the desire of more and more users to use character sets that support their own written language. A first attempt at solving this problem was the definition of the <a class="reference external" href="https://en.wikipedia.org/wiki/ISO_8859">ISO-8859</a> character sets by <a class="reference internal" href="../glossary.html#term-ISO"><span class="xref std std-term">ISO</span></a>. This family of standards specified various character sets that allowed the representation of many European written languages by using 8 bits characters. Unfortunately, an 8-bits character set is not sufficient to support some widely used languages, such as those used in Asian countries. Fortunately, at the end of the 1980s, several computer scientists proposed to develop a standard that supports all written languages used on Earth today. The Unicode standard <a class="reference internal" href="../bibliography.html#unicode" id="id23"><span>[Unicode]</span></a> has now been adopted by most computer and software vendors. For example, Java always uses Unicode to manipulate characters, Python can handle both ASCII and Unicode characters. Internet applications are slowly moving towards complete support for the Unicode character sets, but moving from ASCII to Unicode is an important change that can have a huge impact on current deployed implementations. See, for example, the work to completely internationalize email <span class="target" id="index-34"/><a class="rfc reference external" href="https://datatracker.ietf.org/doc/html/rfc4952.html"><strong>RFC 4952</strong></a> and domain names <span class="target" id="index-35"/><a class="rfc reference external" href="https://datatracker.ietf.org/doc/html/rfc5890.html"><strong>RFC 5890</strong></a>.</p>
</div>
<p>The last MIME header line is <cite>Content-Transfer-Encoding:</cite>. This header line is used after the <cite>Content-Type:</cite> header line, within a message part, and specifies how the message part has been encoded. The default encoding is to use 7 bits ASCII. The most frequent encodings are <cite>quoted-printable</cite> and <cite>Base64</cite>. Both support encoding a sequence of bytes into a set of ASCII lines that can be safely transmitted by email servers. <cite>quoted-printable</cite> is defined in <span class="target" id="index-36"/><a class="rfc reference external" href="https://datatracker.ietf.org/doc/html/rfc2045.html"><strong>RFC 2045</strong></a>. We briefly describe <cite>base64</cite> which is defined in <span class="target" id="index-37"/><a class="rfc reference external" href="https://datatracker.ietf.org/doc/html/rfc2045.html"><strong>RFC 2045</strong></a> and <span class="target" id="index-38"/><a class="rfc reference external" href="https://datatracker.ietf.org/doc/html/rfc4648.html"><strong>RFC 4648</strong></a>.</p>
<p id="index-39"><cite>Base64</cite> divides the sequence of bytes to be encoded into groups of three bytes (with the last group possibly being partially filled). Each group of three bytes is then divided into four six-bit fields and each six bit field is encoded as a character from the table below.</p>
<div class="pst-scrollable-table-container"><table class="table">
<tbody>
<tr class="row-odd"><td><p>Value</p></td>
<td><p>Encoding</p></td>
<td><p>Value</p></td>
<td><p>Encoding</p></td>
<td><p>Value</p></td>
<td><p>Encoding</p></td>
<td><p>Value</p></td>
<td><p>Encoding</p></td>
</tr>
<tr class="row-even"><td><p>0</p></td>
<td><p>A</p></td>
<td><p>17</p></td>
<td><p>R</p></td>
<td><p>34</p></td>
<td><p>i</p></td>
<td><p>51</p></td>
<td><p>z</p></td>
</tr>
<tr class="row-odd"><td><p>1</p></td>
<td><p>B</p></td>
<td><p>18</p></td>
<td><p>S</p></td>
<td><p>35</p></td>
<td><p>j</p></td>
<td><p>52</p></td>
<td><p>0</p></td>
</tr>
<tr class="row-even"><td><p>2</p></td>
<td><p>C</p></td>
<td><p>19</p></td>
<td><p>T</p></td>
<td><p>36</p></td>
<td><p>k</p></td>
<td><p>53</p></td>
<td><p>1</p></td>
</tr>
<tr class="row-odd"><td><p>3</p></td>
<td><p>D</p></td>
<td><p>20</p></td>
<td><p>U</p></td>
<td><p>37</p></td>
<td><p>l</p></td>
<td><p>54</p></td>
<td><p>2</p></td>
</tr>
<tr class="row-even"><td><p>4</p></td>
<td><p>E</p></td>
<td><p>21</p></td>
<td><p>V</p></td>
<td><p>38</p></td>
<td><p>m</p></td>
<td><p>55</p></td>
<td><p>3</p></td>
</tr>
<tr class="row-odd"><td><p>5</p></td>
<td><p>F</p></td>
<td><p>22</p></td>
<td><p>W</p></td>
<td><p>39</p></td>
<td><p>n</p></td>
<td><p>56</p></td>
<td><p>4</p></td>
</tr>
<tr class="row-even"><td><p>6</p></td>
<td><p>G</p></td>
<td><p>23</p></td>
<td><p>X</p></td>
<td><p>40</p></td>
<td><p>o</p></td>
<td><p>57</p></td>
<td><p>5</p></td>
</tr>
<tr class="row-odd"><td><p>7</p></td>
<td><p>H</p></td>
<td><p>24</p></td>
<td><p>Y</p></td>
<td><p>41</p></td>
<td><p>p</p></td>
<td><p>58</p></td>
<td><p>6</p></td>
</tr>
<tr class="row-even"><td><p>8</p></td>
<td><p>I</p></td>
<td><p>25</p></td>
<td><p>Z</p></td>
<td><p>42</p></td>
<td><p>q</p></td>
<td><p>59</p></td>
<td><p>7</p></td>
</tr>
<tr class="row-odd"><td><p>9</p></td>
<td><p>J</p></td>
<td><p>26</p></td>
<td><p>a</p></td>
<td><p>43</p></td>
<td><p>r</p></td>
<td><p>60</p></td>
<td><p>8</p></td>
</tr>
<tr class="row-even"><td><p>10</p></td>
<td><p>K</p></td>
<td><p>27</p></td>
<td><p>b</p></td>
<td><p>44</p></td>
<td><p>s</p></td>
<td><p>61</p></td>
<td><p>9</p></td>
</tr>
<tr class="row-odd"><td><p>11</p></td>
<td><p>L</p></td>
<td><p>28</p></td>
<td><p>c</p></td>
<td><p>45</p></td>
<td><p>t</p></td>
<td><p>62</p></td>
<td><p>+</p></td>
</tr>
<tr class="row-even"><td><p>12</p></td>
<td><p>M</p></td>
<td><p>29</p></td>
<td><p>d</p></td>
<td><p>46</p></td>
<td><p>u</p></td>
<td><p>63</p></td>
<td><p>/</p></td>
</tr>
<tr class="row-odd"><td><p>13</p></td>
<td><p>N</p></td>
<td><p>30</p></td>
<td><p>e</p></td>
<td><p>47</p></td>
<td><p>v</p></td>
<td/>
<td/>
</tr>
<tr class="row-even"><td><p>14</p></td>
<td><p>O</p></td>
<td><p>31</p></td>
<td><p>f</p></td>
<td><p>48</p></td>
<td><p>w</p></td>
<td/>
<td/>
</tr>
<tr class="row-odd"><td><p>15</p></td>
<td><p>P</p></td>
<td><p>32</p></td>
<td><p>g</p></td>
<td><p>49</p></td>
<td><p>x</p></td>
<td/>
<td/>
</tr>
<tr class="row-even"><td><p>16</p></td>
<td><p>Q</p></td>
<td><p>33</p></td>
<td><p>h</p></td>
<td><p>50</p></td>
<td><p>y</p></td>
<td/>
<td/>
</tr>
</tbody>
</table>
</div>
<p>The example below, from <span class="target" id="index-40"/><a class="rfc reference external" href="https://datatracker.ietf.org/doc/html/rfc4648.html"><strong>RFC 4648</strong></a>, illustrates the <cite>Base64</cite> encoding.</p>
<blockquote>
<div><div class="pst-scrollable-table-container"><table class="table">
<tbody>
<tr class="row-odd"><td><p>Input data</p></td>
<td><p><cite>0x14fb9c03d97e</cite></p></td>
</tr>
<tr class="row-even"><td><p>8-bit</p></td>
<td><p>00010100 11111011 10011100   00000011 11011001 01111110</p></td>
</tr>
<tr class="row-odd"><td><p>6-bit</p></td>
<td><p>000101 001111 101110 011100  000000 111101 100101 111110</p></td>
</tr>
<tr class="row-even"><td><p>Decimal</p></td>
<td><p>5      15     46     28      0     61     37     62</p></td>
</tr>
<tr class="row-odd"><td><p>Encoding</p></td>
<td><p>F      P      u      c       A      9      l      +</p></td>
</tr>
</tbody>
</table>
</div>
</div></blockquote>
<p>The last point to be discussed about <cite>base64</cite> is what happens when the length of the sequence of bytes to be encoded is not a multiple of three. In this case, the last group of bytes may contain one or two bytes instead of three. <cite>Base64</cite> reserves the <cite>=</cite> character as a padding character. This character is used once when the last group contains two bytes and twice when it contains one byte as illustrated by the two examples below.</p>
<blockquote>
<div><div class="pst-scrollable-table-container"><table class="table">
<tbody>
<tr class="row-odd"><td><p>Input data</p></td>
<td><p>0x14</p></td>
</tr>
<tr class="row-even"><td><p>8-bit</p></td>
<td><p>00010100</p></td>
</tr>
<tr class="row-odd"><td><p>6-bit</p></td>
<td><p>000101 000000</p></td>
</tr>
<tr class="row-even"><td><p>Decimal</p></td>
<td><p>5     0</p></td>
</tr>
<tr class="row-odd"><td><p>Encoding</p></td>
<td><p>F     A    =  =</p></td>
</tr>
</tbody>
</table>
</div>
<div class="pst-scrollable-table-container"><table class="table">
<tbody>
<tr class="row-odd"><td><p>Input data</p></td>
<td><p>0x14b9</p></td>
</tr>
<tr class="row-even"><td><p>8-bit</p></td>
<td><p>00010100  11111011</p></td>
</tr>
<tr class="row-odd"><td><p>6-bit</p></td>
<td><p>000101 001111 101100</p></td>
</tr>
<tr class="row-even"><td><p>Decimal</p></td>
<td><p>5    15      44</p></td>
</tr>
<tr class="row-odd"><td><p>Encoding</p></td>
<td><p>F     P       s     =</p></td>
</tr>
</tbody>
</table>
</div>
</div></blockquote>
<p>Now that we have explained the format of the email messages, we can discuss how these messages can be exchanged through the Internet. <a class="reference internal" href="#fig-email-protocols"><span class="std std-numref">Fig. 30</span></a> illustrates the protocols that are used when <cite>Alice</cite> sends an email message to <cite>Bob</cite>. <cite>Alice</cite> prepares her email with an email client or on a webmail interface. To send her email to <cite>Bob</cite>, <cite>Alice</cite>’s client will use the Simple Mail Transfer Protocol (<a class="reference internal" href="../glossary.html#term-SMTP"><span class="xref std std-term">SMTP</span></a>) to deliver her message to her SMTP server. <cite>Alice</cite>’s email client is configured with the name of the default SMTP server for her domain. There is usually at least one SMTP server per domain. To deliver the message, <cite>Alice</cite>’s SMTP server must find the SMTP server that contains <cite>Bob</cite>’s mailbox. This can be done by using the Mail eXchange (MX) records of the DNS. A set of MX records can be associated to each domain. Each MX record contains a numerical preference and the fully qualified domain name of a SMTP server that is able to deliver email messages destined to all valid email addresses of this domain. The DNS can return several MX records for a given domain. In this case, the server with the lowest numerical preference is used first <span class="target" id="index-41"/><a class="rfc reference external" href="https://datatracker.ietf.org/doc/html/rfc2821.html"><strong>RFC 2821</strong></a>. If this server is not reachable, the second most preferred server is used etc. <cite>Bob</cite>’s SMTP server will store the message sent by <cite>Alice</cite> until <cite>Bob</cite> retrieves it using a webmail interface or protocols such as the Post Office Protocol (<a class="reference internal" href="../glossary.html#term-POP"><span class="xref std std-term">POP</span></a>) or the Internet Message Access Protocol (<a class="reference internal" href="../glossary.html#term-IMAP"><span class="xref std std-term">IMAP</span></a>).</p>
<blockquote>
<div><div class="figure" id="id59" style="text-align: center">
<span id="fig-email-protocols"/><p><img src="../Images/1016e46afc46c3c3a2098ab7047067a3.png" alt="Figure made with TikZ" data-original-src="https://4ed.computer-networking.info/syllabus/default/_images/tikz-6b8b294c11dc4ed409ed6c4e2c92703b4c094393.png"/></p>
<p><span class="caption-number">Fig. 30 </span><span class="caption-text">Email delivery protocols</span></p>
</div></div></blockquote>
<section id="the-simple-mail-transfer-protocol">
<span id="smtp"/><h3>The Simple Mail Transfer Protocol<a class="headerlink" href="#the-simple-mail-transfer-protocol" title="Link to this heading">#</a></h3>
<p>The Simple Mail Transfer Protocol (<a class="reference internal" href="../glossary.html#term-SMTP"><span class="xref std std-term">SMTP</span></a>) defined in <span class="target" id="index-42"/><a class="rfc reference external" href="https://datatracker.ietf.org/doc/html/rfc5321.html"><strong>RFC 5321</strong></a> is a client-server protocol. The SMTP specification distinguishes between five types of processes involved in the delivery of email messages. Email messages are composed on a Mail User Agent (MUA). The MUA is usually either an email client or a webmail. The MUA sends the email message to a Mail Submission Agent (MSA). The MSA processes the received email and forwards it to the Mail Transmission Agent (MTA). The MTA is responsible for the transmission of the email, directly or via intermediate MTAs to the MTA of the destination domain. This destination MTA will then forward the message to the Mail Delivery Agent (MDA) where it will be accessed by the recipient’s MUA. SMTP is used for the interactions between MUA and MSA <a class="footnote-reference brackets" href="#fsmtpauth" id="id24" role="doc-noteref"><span class="fn-bracket">[</span>12<span class="fn-bracket">]</span></a>, MSA-MTA and MTA-MTA.</p>
<p>SMTP is a text-based protocol like many other application-layer protocols on the Internet. It relies on the byte-stream service. Servers listen on port <cite>25</cite>. Clients send commands that are each composed of one line of ASCII text terminated by <cite>CR+LF</cite>. Servers reply by sending ASCII lines that contain a three digit numerical error/success code and optional comments.</p>
<p>The SMTP protocol, like most text-based protocols, is specified as a <a class="reference internal" href="../glossary.html#term-BNF"><span class="xref std std-term">BNF</span></a>. The full BNF is defined in <span class="target" id="index-43"/><a class="rfc reference external" href="https://datatracker.ietf.org/doc/html/rfc5321.html"><strong>RFC 5321</strong></a>. The main SMTP commands are defined by the BNF rules shown in <a class="reference internal" href="#fig-smtp-bnf"><span class="std std-numref">Fig. 31</span></a>.</p>
<figure class="align-center" id="id60">
<span id="fig-smtp-bnf"/><a class="reference internal image-reference" href="../_images/smtp-bnf.svg"><img alt="../_images/smtp-bnf.svg" src="../Images/c14bdccb9a063300e7e5dc0d244b52c9.png" style="width: 839.8000000000001px; height: 291.2px;" data-original-src="https://4ed.computer-networking.info/syllabus/default/_images/smtp-bnf.svg"/>
</a>
<figcaption>
<p><span class="caption-number">Fig. 31 </span><span class="caption-text">BNF specification of the SMTP commands</span><a class="headerlink" href="#id60" title="Link to this image">#</a></p>
</figcaption>
</figure>
<p>In this BNF, <cite>atext</cite> corresponds to printable ASCII characters. This BNF rule is defined in <span class="target" id="index-44"/><a class="rfc reference external" href="https://datatracker.ietf.org/doc/html/rfc5322.html"><strong>RFC 5322</strong></a>. The five main commands are <cite>EHLO</cite> <a class="footnote-reference brackets" href="#fehlo" id="id25" role="doc-noteref"><span class="fn-bracket">[</span>13<span class="fn-bracket">]</span></a>, <cite>MAIL FROM:</cite>, <cite>RCPT TO:</cite>, <cite>DATA</cite> and <cite>QUIT</cite>. <cite>Postmaster</cite> is the alias of the system administrator who is responsible for a given domain or SMTP server. All domains must have a <cite>Postmaster</cite> alias. The SMTP responses are defined by the BNF shown in <a class="reference internal" href="#fig-smtp-responses"><span class="std std-numref">Fig. 32</span></a>.</p>
<figure class="align-center" id="id61">
<span id="fig-smtp-responses"/><img alt="../_images/smtp-response.svg" src="../Images/699468c24e349ef194f6c3fcb1101a01.png" data-original-src="https://4ed.computer-networking.info/syllabus/default/_images/smtp-response.svg"/>
<figcaption>
<p><span class="caption-number">Fig. 32 </span><span class="caption-text">BNF specification of the SMTP responses</span><a class="headerlink" href="#id61" title="Link to this image">#</a></p>
</figcaption>
</figure>
<p>SMTP servers use structured reply codes containing three digits and an optional comment. The first digit of the reply code indicates whether the command was successful or not. A reply code of <cite>2xy</cite> indicates that the command has been accepted. A reply code of <cite>3xy</cite> indicates that the command has been accepted, but additional information from the client is expected. A reply code of <cite>4xy</cite> indicates a transient negative reply. This means that for some reason, which is indicated by either the other digits or the comment, the command cannot be processed immediately, but there is some hope that the problem will only be transient. This is basically telling the client to try the same command again later. In contrast, a reply code of <cite>5xy</cite> indicates a permanent failure or error. In this case, it is useless for the client to retry the same command later. Other application layer protocols such as FTP <span class="target" id="index-45"/><a class="rfc reference external" href="https://datatracker.ietf.org/doc/html/rfc959.html"><strong>RFC 959</strong></a>  or HTTP <span class="target" id="index-46"/><a class="rfc reference external" href="https://datatracker.ietf.org/doc/html/rfc2616.html"><strong>RFC 2616</strong></a> use a similar structure for their reply codes. Additional details about the other reply codes may be found in <span class="target" id="index-47"/><a class="rfc reference external" href="https://datatracker.ietf.org/doc/html/rfc5321.html"><strong>RFC 5321</strong></a>.</p>
<p>Examples of SMTP reply codes include the following :</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span/>220  &lt;domain&gt; Service ready
221  &lt;domain&gt; Service closing transmission channel
250  Requested mail action okay, completed
354  Start mail input; end with &lt;CRLF&gt;.&lt;CRLF&gt;
421  &lt;domain&gt; Service not available, closing transmission channel
450  Requested mail action not taken: mailbox unavailable
452  Requested action not taken: insufficient system storage
500  Syntax error, command unrecognized
501  Syntax error in parameters or arguments
502  Command not implemented
503  Bad sequence of commands
550  Requested action not taken: mailbox unavailable
</pre></div>
</div>
<p>Reply code <cite>220</cite> is used by the server as the first message when it agrees to interact with the client. Reply code <cite>221</cite> is sent by the server before closing the underlying transport connection. Reply code <cite>250</cite> is the standard positive reply that indicates the success of the previous command. Reply code <cite>354</cite> indicates that the client can start transmitting its email message. Reply code <cite>421</cite> is returned when there is a problem (e.g. lack of memory/disk resources) that prevents the server from accepting the transport connection.  Reply codes <cite>450</cite> and <cite>452</cite> indicate that the destination mailbox is temporarily unavailable, for various reasons, while reply code <cite>550</cite> indicates that the mailbox does not exist or cannot be used for policy reasons.  The <cite>500</cite> to <cite>503</cite> reply codes correspond to errors in the commands sent by the client. The <cite>503</cite> reply code would be sent by the server when the client sends commands in an incorrect order (e.g. the client tries to send an email before providing the destination address of the message).</p>
<p>The transfer of an email message is performed in three phases. During the first phase, the client opens a transport connection with the server. Once the connection has been established, the client and the server exchange greetings messages (<cite>EHLO</cite> command). Most servers insist on receiving valid greeting messages and some of them drop the underlying transport connection if they do not receive a valid greeting. Once the greetings have been exchanged, the email transfer phase can start. During this phase, the client transfers one or more email messages by indicating the email address of the sender (<cite>MAIL FROM:</cite> command), the email address of the recipient (<cite>RCPT TO:</cite> command) followed by the headers and the body of the email message (<cite>DATA</cite> command). Once the client has finished sending all its queued email messages to the SMTP server, it terminates the SMTP association (<cite>QUIT</cite> command).</p>
<p>A successful transfer of an email message is shown below</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span/>S: 220 smtp.example.com ESMTP MTA information
C: EHLO mta.example.org
S: 250 Hello mta.example.org, glad to meet you
C: MAIL FROM:&lt;alice@example.org&gt;
S: 250 Ok
C: RCPT TO:&lt;bob@example.com&gt;
S: 250 Ok
C: DATA
S: 354 End data with &lt;CR&gt;&lt;LF&gt;.&lt;CR&gt;&lt;LF&gt;
C: From: "Alice Doe" &lt;alice@example.org&gt;
C: To: Bob Smith &lt;bob@example.com&gt;
C: Date: Mon, 9 Mar 2010 18:22:32 +0100
C: Subject: Hello
C:
C: Hello Bob
C: This is a small message containing 4 lines of text.
C: Best regards,
C: Alice
C: .
S: 250 Ok: queued as 12345
C: QUIT
S: 221 Bye
</pre></div>
</div>
<p>In the example above, the MTA running on <cite>mta.example.org</cite> opens a TCP connection to the SMTP server on host <cite>smtp.example.com</cite>. The lines prefixed with <cite>S:</cite> (resp. <cite>C:</cite>) are the responses sent by the server (resp. the commands sent by the client). The server sends its greetings as soon as the TCP connection has been established. The client then sends the <cite>EHLO</cite> command with its fully qualified domain name. The server replies with reply-code <cite>250</cite> and sends its greetings. The SMTP association can now be used to exchange an email.</p>
<p>To send an email, the client must first provide the address of the recipient with <cite>RCPT TO:</cite>. Then it uses the <cite>MAIL FROM:</cite> with the address of the sender. Both the recipient and the sender are accepted by the server. The client can now issue the <cite>DATA</cite> command to start the transfer of the email message. After having received the <cite>354</cite> reply code, the client sends the headers and the body of its email message. The client indicates the end of the message by sending a line containing only the <cite>.</cite> (dot) character <a class="footnote-reference brackets" href="#fdot" id="id26" role="doc-noteref"><span class="fn-bracket">[</span>14<span class="fn-bracket">]</span></a>. The server confirms that the email message has been queued for delivery or transmission with a reply code of <cite>250</cite>. The client issues the <cite>QUIT</cite> command to close the session and the server confirms with reply-code <cite>221</cite>, before closing the TCP connection.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Open SMTP relays and spam</p>
<p>Since its creation in 1971, email has been a very useful tool that is used by many users to exchange lots of information. In the early days, all SMTP servers were open and anyone could use them to forward emails towards their final destination. Unfortunately, over the years, some unscrupulous users have found ways to use email for marketing purposes or to send malware. The first documented abuse of email for marketing purposes occurred in 1978 when a marketer who worked for a computer vendor sent a <a class="reference external" href="http://www.templetons.com/brad/spamreact.html#msg">marketing email</a> to many ARPANET users. At that time, the ARPANET could only be used for research purposes and this was an abuse of the acceptable use policy. Unfortunately, given the extremely low cost of sending emails, the problem of unsolicited emails has not stopped. Unsolicited emails are now called spam and a <a class="reference external" href="http://www.enisa.europa.eu/act/res/other-areas/anti-spam-measures">study</a> carried out by <a class="reference external" href="https://www.enisa.europa.eu/">ENISA</a> in 2009 reveals that 95% of email was spam and this number seems to continue to grow. This places a burden on the email infrastructure of Internet Service Providers and large companies that need to process many useless messages.</p>
<p>Given the amount of spam messages, SMTP servers are no longer open <span class="target" id="index-48"/><a class="rfc reference external" href="https://datatracker.ietf.org/doc/html/rfc5068.html"><strong>RFC 5068</strong></a>. Several extensions to SMTP have been developed in recent years to deal with this problem. For example, the SMTP authentication scheme defined in <span class="target" id="index-49"/><a class="rfc reference external" href="https://datatracker.ietf.org/doc/html/rfc4954.html"><strong>RFC 4954</strong></a> can be used by an SMTP server to authenticate a client. Several techniques have also been proposed to allow SMTP servers to <cite>authenticate</cite> the messages sent by their users <span class="target" id="index-50"/><a class="rfc reference external" href="https://datatracker.ietf.org/doc/html/rfc4870.html"><strong>RFC 4870</strong></a> <span class="target" id="index-51"/><a class="rfc reference external" href="https://datatracker.ietf.org/doc/html/rfc4871.html"><strong>RFC 4871</strong></a> .</p>
</div>
</section>
<section id="the-post-office-protocol">
<span id="index-52"/><span id="popprotocol"/><h3>The Post Office Protocol<a class="headerlink" href="#the-post-office-protocol" title="Link to this heading">#</a></h3>
<p>When the first versions of SMTP were designed, the Internet was composed of minicomputers that were used by an entire university department or research lab. These minicomputers were used by many users at the same time. Email was mainly used to send messages from a user on a given host to another user on a remote host. At that time, SMTP was the only protocol involved in the delivery of the emails as all hosts attached to the network were running an SMTP server. On such hosts, an email destined to local users was delivered by placing the email in a special directory or file owned by the user. However, the introduction of personal computers in the 1980s changed this environment. Initially, users of these personal computers used applications such as <a class="reference internal" href="../glossary.html#term-telnet"><span class="xref std std-term">telnet</span></a> to open a remote session on the local <a class="reference internal" href="../glossary.html#term-minicomputer"><span class="xref std std-term">minicomputer</span></a> to read their email. This was not user-friendly. A better solution appeared with the development of user friendly email client applications on personal computers. Several protocols were designed to allow these client applications to retrieve the email messages destined to a user from his/her server. Two of these protocols became popular and are still used today. The Post Office Protocol (POP), defined in <span class="target" id="index-53"/><a class="rfc reference external" href="https://datatracker.ietf.org/doc/html/rfc1939.html"><strong>RFC 1939</strong></a>, is the simplest one. It allows a client to download all the messages destined to a given user from his/her email server. We describe POP briefly in this section. The second protocol is the Internet Message Access Protocol (IMAP), defined in <span class="target" id="index-54"/><a class="rfc reference external" href="https://datatracker.ietf.org/doc/html/rfc3501.html"><strong>RFC 3501</strong></a>. IMAP is more powerful, but also more complex than POP. IMAP was designed to allow client applications to efficiently access, in real-time, to messages stored in various folders on servers. IMAP assumes that all the messages of a given user are stored on a server and provides the functions that are necessary to search, download, delete or filter messages.</p>
<p>POP is another example of a simple line-based protocol. POP runs above the bytestream service. A POP server usually listens to port 110. A POP session is composed of three parts : an <cite>authorisation</cite> phase during which the server verifies the client’s credential, a <cite>transaction</cite> phase during which the client downloads messages and an <cite>update</cite> phase that concludes the session. The client sends commands and the server replies are prefixed by <cite>+OK</cite> to indicate a successful command or by <cite>-ERR</cite> to indicate errors.</p>
<p>When a client opens a transport connection with the POP server, the latter sends as banner an ASCII-line starting with <cite>+OK</cite>. The POP session is at that time in the <cite>authorisation</cite> phase. In this phase, the client can send its username (resp. password) with the <cite>USER</cite> (resp. <cite>PASS</cite>) command. The server replies with <cite>+OK</cite> if the username (resp. password) is valid and <cite>-ERR</cite> otherwise.</p>
<p>Once the username and password have been validated, the POP session enters in the <cite>transaction</cite> phase. In this phase, the client can issue several commands. The <cite>STAT</cite> command is used to retrieve the status of the server. Upon reception of this command, the server replies with a line that contains <cite>+OK</cite> followed by the number of messages in the mailbox and the total size of the mailbox in bytes. The <cite>RETR</cite> command, followed by a space and an integer, is used to retrieve the nth message of the mailbox. The <cite>DELE</cite> command is used to mark for deletion the nth message of the mailbox.</p>
<p>Once the client has retrieved and possibly deleted the emails contained in the mailbox, it must issue the <cite>QUIT</cite> command. This command terminates the POP session and allows the server to delete all the messages that have been marked for deletion by using the <cite>DELE</cite> command.</p>
<p>The figure below provides a simple POP session. All lines prefixed with <cite>C:</cite> (resp. <cite>S:</cite>) are sent by the client (resp. server).</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span/>S:    +OK POP3 server ready
C:    USER alice
S:    +OK
C     PASS 12345pass
S:    +OK alice's maildrop has 2 messages (620 octets)
C:    STAT
S:    +OK 2 620
C:    LIST
S:    +OK 2 messages (620 octets)
S:    1 120
S:    2 500
S:    .
C:    RETR 1
S:    +OK 120 octets
S:    &lt;the POP3 server sends message 1&gt;
S:    .
C:    DELE 1
S:    +OK message 1 deleted
C:    QUIT
S:    +OK POP3 server signing off (1 message left)
</pre></div>
</div>
<p>In this example, a POP client contacts a POP server on behalf of the user named <cite>alice</cite>. Note that in this example, Alice’s password is sent in clear by the client. This implies that if someone is able to capture the packets sent by Alice, he will know Alice’s password <a class="footnote-reference brackets" href="#fapop" id="id27" role="doc-noteref"><span class="fn-bracket">[</span>15<span class="fn-bracket">]</span></a>. Then Alice’s client issues the <cite>STAT</cite> command to know the number of messages that are stored in her mailbox. It then retrieves and deletes the first message of the mailbox.</p>
</section>
&#13;

<span id="smtp"/><h3>The Simple Mail Transfer Protocol<a class="headerlink" href="#the-simple-mail-transfer-protocol" title="Link to this heading">#</a></h3>
<p>The Simple Mail Transfer Protocol (<a class="reference internal" href="../glossary.html#term-SMTP"><span class="xref std std-term">SMTP</span></a>) defined in <span class="target" id="index-42"/><a class="rfc reference external" href="https://datatracker.ietf.org/doc/html/rfc5321.html"><strong>RFC 5321</strong></a> is a client-server protocol. The SMTP specification distinguishes between five types of processes involved in the delivery of email messages. Email messages are composed on a Mail User Agent (MUA). The MUA is usually either an email client or a webmail. The MUA sends the email message to a Mail Submission Agent (MSA). The MSA processes the received email and forwards it to the Mail Transmission Agent (MTA). The MTA is responsible for the transmission of the email, directly or via intermediate MTAs to the MTA of the destination domain. This destination MTA will then forward the message to the Mail Delivery Agent (MDA) where it will be accessed by the recipient’s MUA. SMTP is used for the interactions between MUA and MSA <a class="footnote-reference brackets" href="#fsmtpauth" id="id24" role="doc-noteref"><span class="fn-bracket">[</span>12<span class="fn-bracket">]</span></a>, MSA-MTA and MTA-MTA.</p>
<p>SMTP is a text-based protocol like many other application-layer protocols on the Internet. It relies on the byte-stream service. Servers listen on port <cite>25</cite>. Clients send commands that are each composed of one line of ASCII text terminated by <cite>CR+LF</cite>. Servers reply by sending ASCII lines that contain a three digit numerical error/success code and optional comments.</p>
<p>The SMTP protocol, like most text-based protocols, is specified as a <a class="reference internal" href="../glossary.html#term-BNF"><span class="xref std std-term">BNF</span></a>. The full BNF is defined in <span class="target" id="index-43"/><a class="rfc reference external" href="https://datatracker.ietf.org/doc/html/rfc5321.html"><strong>RFC 5321</strong></a>. The main SMTP commands are defined by the BNF rules shown in <a class="reference internal" href="#fig-smtp-bnf"><span class="std std-numref">Fig. 31</span></a>.</p>
<figure class="align-center" id="id60">
<span id="fig-smtp-bnf"/><a class="reference internal image-reference" href="../_images/smtp-bnf.svg"><img alt="../_images/smtp-bnf.svg" src="../Images/c14bdccb9a063300e7e5dc0d244b52c9.png" style="width: 839.8000000000001px; height: 291.2px;" data-original-src="https://4ed.computer-networking.info/syllabus/default/_images/smtp-bnf.svg"/>
</a>
<figcaption>
<p><span class="caption-number">Fig. 31 </span><span class="caption-text">BNF specification of the SMTP commands</span><a class="headerlink" href="#id60" title="Link to this image">#</a></p>
</figcaption>
</figure>
<p>In this BNF, <cite>atext</cite> corresponds to printable ASCII characters. This BNF rule is defined in <span class="target" id="index-44"/><a class="rfc reference external" href="https://datatracker.ietf.org/doc/html/rfc5322.html"><strong>RFC 5322</strong></a>. The five main commands are <cite>EHLO</cite> <a class="footnote-reference brackets" href="#fehlo" id="id25" role="doc-noteref"><span class="fn-bracket">[</span>13<span class="fn-bracket">]</span></a>, <cite>MAIL FROM:</cite>, <cite>RCPT TO:</cite>, <cite>DATA</cite> and <cite>QUIT</cite>. <cite>Postmaster</cite> is the alias of the system administrator who is responsible for a given domain or SMTP server. All domains must have a <cite>Postmaster</cite> alias. The SMTP responses are defined by the BNF shown in <a class="reference internal" href="#fig-smtp-responses"><span class="std std-numref">Fig. 32</span></a>.</p>
<figure class="align-center" id="id61">
<span id="fig-smtp-responses"/><img alt="../_images/smtp-response.svg" src="../Images/699468c24e349ef194f6c3fcb1101a01.png" data-original-src="https://4ed.computer-networking.info/syllabus/default/_images/smtp-response.svg"/>
<figcaption>
<p><span class="caption-number">Fig. 32 </span><span class="caption-text">BNF specification of the SMTP responses</span><a class="headerlink" href="#id61" title="Link to this image">#</a></p>
</figcaption>
</figure>
<p>SMTP servers use structured reply codes containing three digits and an optional comment. The first digit of the reply code indicates whether the command was successful or not. A reply code of <cite>2xy</cite> indicates that the command has been accepted. A reply code of <cite>3xy</cite> indicates that the command has been accepted, but additional information from the client is expected. A reply code of <cite>4xy</cite> indicates a transient negative reply. This means that for some reason, which is indicated by either the other digits or the comment, the command cannot be processed immediately, but there is some hope that the problem will only be transient. This is basically telling the client to try the same command again later. In contrast, a reply code of <cite>5xy</cite> indicates a permanent failure or error. In this case, it is useless for the client to retry the same command later. Other application layer protocols such as FTP <span class="target" id="index-45"/><a class="rfc reference external" href="https://datatracker.ietf.org/doc/html/rfc959.html"><strong>RFC 959</strong></a>  or HTTP <span class="target" id="index-46"/><a class="rfc reference external" href="https://datatracker.ietf.org/doc/html/rfc2616.html"><strong>RFC 2616</strong></a> use a similar structure for their reply codes. Additional details about the other reply codes may be found in <span class="target" id="index-47"/><a class="rfc reference external" href="https://datatracker.ietf.org/doc/html/rfc5321.html"><strong>RFC 5321</strong></a>.</p>
<p>Examples of SMTP reply codes include the following :</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span/>220  &lt;domain&gt; Service ready
221  &lt;domain&gt; Service closing transmission channel
250  Requested mail action okay, completed
354  Start mail input; end with &lt;CRLF&gt;.&lt;CRLF&gt;
421  &lt;domain&gt; Service not available, closing transmission channel
450  Requested mail action not taken: mailbox unavailable
452  Requested action not taken: insufficient system storage
500  Syntax error, command unrecognized
501  Syntax error in parameters or arguments
502  Command not implemented
503  Bad sequence of commands
550  Requested action not taken: mailbox unavailable
</pre></div>
</div>
<p>Reply code <cite>220</cite> is used by the server as the first message when it agrees to interact with the client. Reply code <cite>221</cite> is sent by the server before closing the underlying transport connection. Reply code <cite>250</cite> is the standard positive reply that indicates the success of the previous command. Reply code <cite>354</cite> indicates that the client can start transmitting its email message. Reply code <cite>421</cite> is returned when there is a problem (e.g. lack of memory/disk resources) that prevents the server from accepting the transport connection.  Reply codes <cite>450</cite> and <cite>452</cite> indicate that the destination mailbox is temporarily unavailable, for various reasons, while reply code <cite>550</cite> indicates that the mailbox does not exist or cannot be used for policy reasons.  The <cite>500</cite> to <cite>503</cite> reply codes correspond to errors in the commands sent by the client. The <cite>503</cite> reply code would be sent by the server when the client sends commands in an incorrect order (e.g. the client tries to send an email before providing the destination address of the message).</p>
<p>The transfer of an email message is performed in three phases. During the first phase, the client opens a transport connection with the server. Once the connection has been established, the client and the server exchange greetings messages (<cite>EHLO</cite> command). Most servers insist on receiving valid greeting messages and some of them drop the underlying transport connection if they do not receive a valid greeting. Once the greetings have been exchanged, the email transfer phase can start. During this phase, the client transfers one or more email messages by indicating the email address of the sender (<cite>MAIL FROM:</cite> command), the email address of the recipient (<cite>RCPT TO:</cite> command) followed by the headers and the body of the email message (<cite>DATA</cite> command). Once the client has finished sending all its queued email messages to the SMTP server, it terminates the SMTP association (<cite>QUIT</cite> command).</p>
<p>A successful transfer of an email message is shown below</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span/>S: 220 smtp.example.com ESMTP MTA information
C: EHLO mta.example.org
S: 250 Hello mta.example.org, glad to meet you
C: MAIL FROM:&lt;alice@example.org&gt;
S: 250 Ok
C: RCPT TO:&lt;bob@example.com&gt;
S: 250 Ok
C: DATA
S: 354 End data with &lt;CR&gt;&lt;LF&gt;.&lt;CR&gt;&lt;LF&gt;
C: From: "Alice Doe" &lt;alice@example.org&gt;
C: To: Bob Smith &lt;bob@example.com&gt;
C: Date: Mon, 9 Mar 2010 18:22:32 +0100
C: Subject: Hello
C:
C: Hello Bob
C: This is a small message containing 4 lines of text.
C: Best regards,
C: Alice
C: .
S: 250 Ok: queued as 12345
C: QUIT
S: 221 Bye
</pre></div>
</div>
<p>In the example above, the MTA running on <cite>mta.example.org</cite> opens a TCP connection to the SMTP server on host <cite>smtp.example.com</cite>. The lines prefixed with <cite>S:</cite> (resp. <cite>C:</cite>) are the responses sent by the server (resp. the commands sent by the client). The server sends its greetings as soon as the TCP connection has been established. The client then sends the <cite>EHLO</cite> command with its fully qualified domain name. The server replies with reply-code <cite>250</cite> and sends its greetings. The SMTP association can now be used to exchange an email.</p>
<p>To send an email, the client must first provide the address of the recipient with <cite>RCPT TO:</cite>. Then it uses the <cite>MAIL FROM:</cite> with the address of the sender. Both the recipient and the sender are accepted by the server. The client can now issue the <cite>DATA</cite> command to start the transfer of the email message. After having received the <cite>354</cite> reply code, the client sends the headers and the body of its email message. The client indicates the end of the message by sending a line containing only the <cite>.</cite> (dot) character <a class="footnote-reference brackets" href="#fdot" id="id26" role="doc-noteref"><span class="fn-bracket">[</span>14<span class="fn-bracket">]</span></a>. The server confirms that the email message has been queued for delivery or transmission with a reply code of <cite>250</cite>. The client issues the <cite>QUIT</cite> command to close the session and the server confirms with reply-code <cite>221</cite>, before closing the TCP connection.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Open SMTP relays and spam</p>
<p>Since its creation in 1971, email has been a very useful tool that is used by many users to exchange lots of information. In the early days, all SMTP servers were open and anyone could use them to forward emails towards their final destination. Unfortunately, over the years, some unscrupulous users have found ways to use email for marketing purposes or to send malware. The first documented abuse of email for marketing purposes occurred in 1978 when a marketer who worked for a computer vendor sent a <a class="reference external" href="http://www.templetons.com/brad/spamreact.html#msg">marketing email</a> to many ARPANET users. At that time, the ARPANET could only be used for research purposes and this was an abuse of the acceptable use policy. Unfortunately, given the extremely low cost of sending emails, the problem of unsolicited emails has not stopped. Unsolicited emails are now called spam and a <a class="reference external" href="http://www.enisa.europa.eu/act/res/other-areas/anti-spam-measures">study</a> carried out by <a class="reference external" href="https://www.enisa.europa.eu/">ENISA</a> in 2009 reveals that 95% of email was spam and this number seems to continue to grow. This places a burden on the email infrastructure of Internet Service Providers and large companies that need to process many useless messages.</p>
<p>Given the amount of spam messages, SMTP servers are no longer open <span class="target" id="index-48"/><a class="rfc reference external" href="https://datatracker.ietf.org/doc/html/rfc5068.html"><strong>RFC 5068</strong></a>. Several extensions to SMTP have been developed in recent years to deal with this problem. For example, the SMTP authentication scheme defined in <span class="target" id="index-49"/><a class="rfc reference external" href="https://datatracker.ietf.org/doc/html/rfc4954.html"><strong>RFC 4954</strong></a> can be used by an SMTP server to authenticate a client. Several techniques have also been proposed to allow SMTP servers to <cite>authenticate</cite> the messages sent by their users <span class="target" id="index-50"/><a class="rfc reference external" href="https://datatracker.ietf.org/doc/html/rfc4870.html"><strong>RFC 4870</strong></a> <span class="target" id="index-51"/><a class="rfc reference external" href="https://datatracker.ietf.org/doc/html/rfc4871.html"><strong>RFC 4871</strong></a> .</p>
</div>
&#13;

<span id="index-52"/><span id="popprotocol"/><h3>The Post Office Protocol<a class="headerlink" href="#the-post-office-protocol" title="Link to this heading">#</a></h3>
<p>When the first versions of SMTP were designed, the Internet was composed of minicomputers that were used by an entire university department or research lab. These minicomputers were used by many users at the same time. Email was mainly used to send messages from a user on a given host to another user on a remote host. At that time, SMTP was the only protocol involved in the delivery of the emails as all hosts attached to the network were running an SMTP server. On such hosts, an email destined to local users was delivered by placing the email in a special directory or file owned by the user. However, the introduction of personal computers in the 1980s changed this environment. Initially, users of these personal computers used applications such as <a class="reference internal" href="../glossary.html#term-telnet"><span class="xref std std-term">telnet</span></a> to open a remote session on the local <a class="reference internal" href="../glossary.html#term-minicomputer"><span class="xref std std-term">minicomputer</span></a> to read their email. This was not user-friendly. A better solution appeared with the development of user friendly email client applications on personal computers. Several protocols were designed to allow these client applications to retrieve the email messages destined to a user from his/her server. Two of these protocols became popular and are still used today. The Post Office Protocol (POP), defined in <span class="target" id="index-53"/><a class="rfc reference external" href="https://datatracker.ietf.org/doc/html/rfc1939.html"><strong>RFC 1939</strong></a>, is the simplest one. It allows a client to download all the messages destined to a given user from his/her email server. We describe POP briefly in this section. The second protocol is the Internet Message Access Protocol (IMAP), defined in <span class="target" id="index-54"/><a class="rfc reference external" href="https://datatracker.ietf.org/doc/html/rfc3501.html"><strong>RFC 3501</strong></a>. IMAP is more powerful, but also more complex than POP. IMAP was designed to allow client applications to efficiently access, in real-time, to messages stored in various folders on servers. IMAP assumes that all the messages of a given user are stored on a server and provides the functions that are necessary to search, download, delete or filter messages.</p>
<p>POP is another example of a simple line-based protocol. POP runs above the bytestream service. A POP server usually listens to port 110. A POP session is composed of three parts : an <cite>authorisation</cite> phase during which the server verifies the client’s credential, a <cite>transaction</cite> phase during which the client downloads messages and an <cite>update</cite> phase that concludes the session. The client sends commands and the server replies are prefixed by <cite>+OK</cite> to indicate a successful command or by <cite>-ERR</cite> to indicate errors.</p>
<p>When a client opens a transport connection with the POP server, the latter sends as banner an ASCII-line starting with <cite>+OK</cite>. The POP session is at that time in the <cite>authorisation</cite> phase. In this phase, the client can send its username (resp. password) with the <cite>USER</cite> (resp. <cite>PASS</cite>) command. The server replies with <cite>+OK</cite> if the username (resp. password) is valid and <cite>-ERR</cite> otherwise.</p>
<p>Once the username and password have been validated, the POP session enters in the <cite>transaction</cite> phase. In this phase, the client can issue several commands. The <cite>STAT</cite> command is used to retrieve the status of the server. Upon reception of this command, the server replies with a line that contains <cite>+OK</cite> followed by the number of messages in the mailbox and the total size of the mailbox in bytes. The <cite>RETR</cite> command, followed by a space and an integer, is used to retrieve the nth message of the mailbox. The <cite>DELE</cite> command is used to mark for deletion the nth message of the mailbox.</p>
<p>Once the client has retrieved and possibly deleted the emails contained in the mailbox, it must issue the <cite>QUIT</cite> command. This command terminates the POP session and allows the server to delete all the messages that have been marked for deletion by using the <cite>DELE</cite> command.</p>
<p>The figure below provides a simple POP session. All lines prefixed with <cite>C:</cite> (resp. <cite>S:</cite>) are sent by the client (resp. server).</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span/>S:    +OK POP3 server ready
C:    USER alice
S:    +OK
C     PASS 12345pass
S:    +OK alice's maildrop has 2 messages (620 octets)
C:    STAT
S:    +OK 2 620
C:    LIST
S:    +OK 2 messages (620 octets)
S:    1 120
S:    2 500
S:    .
C:    RETR 1
S:    +OK 120 octets
S:    &lt;the POP3 server sends message 1&gt;
S:    .
C:    DELE 1
S:    +OK message 1 deleted
C:    QUIT
S:    +OK POP3 server signing off (1 message left)
</pre></div>
</div>
<p>In this example, a POP client contacts a POP server on behalf of the user named <cite>alice</cite>. Note that in this example, Alice’s password is sent in clear by the client. This implies that if someone is able to capture the packets sent by Alice, he will know Alice’s password <a class="footnote-reference brackets" href="#fapop" id="id27" role="doc-noteref"><span class="fn-bracket">[</span>15<span class="fn-bracket">]</span></a>. Then Alice’s client issues the <cite>STAT</cite> command to know the number of messages that are stored in her mailbox. It then retrieves and deletes the first message of the mailbox.</p>
&#13;

<span id="http"/><h2>The world wide web<a class="headerlink" href="#the-world-wide-web" title="Link to this heading">#</a></h2>
<p>In the early days, the Internet was mainly used for remote terminal access with <a class="reference external" href="https://en.wikipedia.org/wiki/Telnet">telnet</a>, email and file transfer. The default file transfer protocol, <cite>FTP</cite>, defined in <span class="target" id="index-55"/><a class="rfc reference external" href="https://datatracker.ietf.org/doc/html/rfc959.html"><strong>RFC 959</strong></a> was widely used. <cite>FTP</cite> clients and servers are still included in some operating systems.</p>
<p>Many <cite>FTP</cite> clients offered a user interface similar to a Unix shell and allowed clients to browse the file system on the server and to send and retrieve files. <cite>FTP</cite> servers can be configured in two modes :</p>
<blockquote>
<div><ul class="simple">
<li><p><cite>authenticated</cite> : in this mode, the ftp server only accepts users with a valid user name and password. Once authenticated, they can access the files and directories according to their permissions</p></li>
<li><p><cite>anonymous</cite> : in this mode, clients supply the <cite>anonymous</cite> user identifier and their email address as password. These clients are granted access to a special zone of the file system that only contains public files.</p></li>
</ul>
</div></blockquote>
<p><cite>FTP</cite> was very popular in the 1990s and early 2000s, but today it has mostly been superseded by more recent protocols. Authenticated access to files is mainly done by using the Secure Shell (<a class="reference external" href="https://en.wikipedia.org/wiki/Secure_Shell">ssh</a>) protocol defined in <span class="target" id="index-56"/><a class="rfc reference external" href="https://datatracker.ietf.org/doc/html/rfc4251.html"><strong>RFC 4251</strong></a> and supported by clients such as <a class="reference external" href="https://www.openssh.org">scp</a> or <a class="reference external" href="https://www.openssh.org">sftp</a>. Nowadays, anonymous access is mainly provided by web protocols.</p>
<p>In the late 1980s, high energy physicists working at <a class="reference external" href="https://www.cern.ch">CERN</a> had to efficiently exchange documents about their ongoing and planned experiments. <a class="reference external" href="https://www.w3.org/People/Berners-Lee/">Tim Berners-Lee</a> evaluated several of the documents sharing techniques that were available at that time <a class="reference internal" href="../bibliography.html#b1989" id="id28"><span>[B1989]</span></a>. As none of the existing solutions met CERN’s requirements, they chose to develop a completely new document sharing system. This system was initially called the <cite>mesh</cite>. It was quickly renamed the <cite>world wide web</cite>. The starting point for the <cite>world wide web</cite> are hypertext documents. An hypertext document is a document that contains references (hyperlinks) to other documents that the reader can immediately access. Hypertext was not invented for the world wide web. The idea of hypertext documents was proposed in 1945 <a class="reference internal" href="../bibliography.html#bush1945" id="id29"><span>[Bush1945]</span></a> and the first experiments were done during the 1960s <a class="reference internal" href="../bibliography.html#nelson1965" id="id30"><span>[Nelson1965]</span></a> <a class="reference internal" href="../bibliography.html#myers1998" id="id31"><span>[Myers1998]</span></a> . Compared to the hypertext documents that were used in the late 1980s, the main innovation introduced by the <cite>world wide web</cite> was to allow hyperlinks to reference documents stored on different remote machines. This is illustrated in <a class="reference internal" href="#fig-web"><span class="std std-numref">Fig. 33</span></a>.</p>
<blockquote>
<div><div class="figure" id="id62" style="text-align: center">
<span id="fig-web"/><p><img src="../Images/203e09d617f034ce3c963e378c622093.png" alt="Figure made with TikZ" data-original-src="https://4ed.computer-networking.info/syllabus/default/_images/tikz-0785f7e38adaa09624fe0499a6f30185abeb9a19.png"/></p>
<p><span class="caption-number">Fig. 33 </span><span class="caption-text">World-wide web clients and servers</span></p>
</div></div></blockquote>
<p>A document sharing system such as the <cite>world wide web</cite> is composed of three important parts.</p>
<blockquote>
<div><ol class="arabic simple">
<li><p>A standardized addressing scheme that unambiguously identifies documents</p></li>
<li><p>A standard document format : the <a class="reference external" href="http://www.w3.org/MarkUp">HyperText Markup Language</a></p></li>
<li><p>A standardized protocol to efficiently retrieve the documents stored on a server</p></li>
</ol>
</div></blockquote>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Open standards and open implementations</p>
<p>Open standards play a key role in the success of the <cite>world wide web</cite> as we know it today. Without open standards, the world wide web would have never reached its current size. In addition to open standards, another important factor for the success of the web was the availability of open and efficient implementations of these standards. When CERN started to work on the <cite>web</cite>, their objective was to build a running system that could be used by physicists. They developed open-source implementations of the <a class="reference external" href="http://www.w3.org/Daemon/">first web servers</a> and <a class="reference external" href="http://www.w3.org/Library/Activity.html">web clients</a>. These open-source implementations were powerful and could be used as is, by institutions willing to share information. They were also extended by other developers who contributed to new features. For example, the <a class="reference external" href="https://www.ncsa.illinois.edu">NCSA</a> added support for images in their <a class="reference external" href="http://en.wikipedia.org/wiki/Mosaic_(web_browser)">Mosaic browser</a> that was eventually used to create <a class="reference external" href="http://en.wikipedia.org/wiki/Netscape">Netscape Communications</a> and the first commercial browsers and servers.</p>
</div>
<p>The first components of the <cite>world wide web</cite> are the Uniform Resource Identifiers (URI), defined in <span class="target" id="index-57"/><a class="rfc reference external" href="https://datatracker.ietf.org/doc/html/rfc3986.html"><strong>RFC 3986</strong></a>. A URI is a character string that unambiguously identifies a resource on the world wide web. Here is a subset of the BNF for URIs</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span/><span class="n">URI</span>           <span class="o">=</span> <span class="n">scheme</span> <span class="s2">":"</span> <span class="s2">"//"</span> <span class="n">authority</span> <span class="n">path</span> <span class="p">[</span> <span class="s2">"?"</span> <span class="n">query</span> <span class="p">]</span> <span class="p">[</span> <span class="s2">"#"</span> <span class="n">fragment</span> <span class="p">]</span>
<span class="n">scheme</span>        <span class="o">=</span> <span class="n">ALPHA</span> <span class="o">*</span><span class="p">(</span> <span class="n">ALPHA</span> <span class="o">/</span> <span class="n">DIGIT</span> <span class="o">/</span> <span class="s2">"+"</span> <span class="o">/</span> <span class="s2">"-"</span> <span class="o">/</span> <span class="s2">"."</span> <span class="p">)</span>
<span class="n">authority</span>     <span class="o">=</span> <span class="p">[</span> <span class="n">userinfo</span> <span class="s2">"@"</span> <span class="p">]</span> <span class="n">host</span> <span class="p">[</span> <span class="s2">":"</span> <span class="n">port</span> <span class="p">]</span>
<span class="n">query</span>         <span class="o">=</span> <span class="o">*</span><span class="p">(</span> <span class="n">pchar</span> <span class="o">/</span> <span class="s2">"/"</span> <span class="o">/</span> <span class="s2">"?"</span> <span class="p">)</span>
<span class="n">fragment</span>      <span class="o">=</span> <span class="o">*</span><span class="p">(</span> <span class="n">pchar</span> <span class="o">/</span> <span class="s2">"/"</span> <span class="o">/</span> <span class="s2">"?"</span> <span class="p">)</span>
<span class="n">pchar</span>         <span class="o">=</span> <span class="n">unreserved</span> <span class="o">/</span> <span class="n">pct</span><span class="o">-</span><span class="n">encoded</span> <span class="o">/</span> <span class="n">sub</span><span class="o">-</span><span class="n">delims</span> <span class="o">/</span> <span class="s2">":"</span> <span class="o">/</span> <span class="s2">"@"</span>
<span class="n">query</span>         <span class="o">=</span> <span class="o">*</span><span class="p">(</span> <span class="n">pchar</span> <span class="o">/</span> <span class="s2">"/"</span> <span class="o">/</span> <span class="s2">"?"</span> <span class="p">)</span>
<span class="n">fragment</span>      <span class="o">=</span> <span class="o">*</span><span class="p">(</span> <span class="n">pchar</span> <span class="o">/</span> <span class="s2">"/"</span> <span class="o">/</span> <span class="s2">"?"</span> <span class="p">)</span>
<span class="n">pct</span><span class="o">-</span><span class="n">encoded</span>   <span class="o">=</span> <span class="s2">"%"</span> <span class="n">HEXDIG</span> <span class="n">HEXDIG</span>
<span class="n">unreserved</span>    <span class="o">=</span> <span class="n">ALPHA</span> <span class="o">/</span> <span class="n">DIGIT</span> <span class="o">/</span> <span class="s2">"-"</span> <span class="o">/</span> <span class="s2">"."</span> <span class="o">/</span> <span class="s2">"_"</span> <span class="o">/</span> <span class="s2">"~"</span>
<span class="n">reserved</span>      <span class="o">=</span> <span class="n">gen</span><span class="o">-</span><span class="n">delims</span> <span class="o">/</span> <span class="n">sub</span><span class="o">-</span><span class="n">delims</span>
<span class="n">gen</span><span class="o">-</span><span class="n">delims</span>    <span class="o">=</span> <span class="s2">":"</span> <span class="o">/</span> <span class="s2">"/"</span> <span class="o">/</span> <span class="s2">"?"</span> <span class="o">/</span> <span class="s2">"#"</span> <span class="o">/</span> <span class="s2">"["</span> <span class="o">/</span> <span class="s2">"]"</span> <span class="o">/</span> <span class="s2">"@"</span>
<span class="n">sub</span><span class="o">-</span><span class="n">delims</span>    <span class="o">=</span> <span class="s2">"!"</span> <span class="o">/</span> <span class="s2">"$"</span> <span class="o">/</span> <span class="s2">"&amp;"</span> <span class="o">/</span> <span class="s2">"'"</span> <span class="o">/</span> <span class="s2">"("</span> <span class="o">/</span> <span class="s2">")"</span> <span class="o">/</span> <span class="s2">"*"</span> <span class="o">/</span> <span class="s2">"+"</span> <span class="o">/</span> <span class="s2">","</span> <span class="o">/</span> <span class="s2">";"</span> <span class="o">/</span> <span class="s2">"="</span>
</pre></div>
</div>
<p>The first component of a URI is its <cite>scheme</cite>. A <cite>scheme</cite> can be seen as a selector, indicating the meaning of the fields after it. In practice, the scheme often identifies the application-layer protocol that must be used by the client to retrieve the document, but it is not always the case. Some schemes do not imply a protocol at all and some do not indicate a retrievable document <a class="footnote-reference brackets" href="#furiretrieve" id="id32" role="doc-noteref"><span class="fn-bracket">[</span>16<span class="fn-bracket">]</span></a>. The most frequent schemes are <cite>http</cite> and <cite>https</cite>. We focus on <cite>http</cite> in this section. A URI scheme can be defined for almost any application layer protocol <a class="footnote-reference brackets" href="#furilist" id="id33" role="doc-noteref"><span class="fn-bracket">[</span>17<span class="fn-bracket">]</span></a>. The characters <cite>:</cite> and <cite>//</cite> follow the <cite>scheme</cite> of any URI.</p>
<p>The second part of the URI is the <cite>authority</cite>. With retrievable URIs, this includes the DNS name or the IP address of the server where the document can be retrieved using the protocol specified via the <cite>scheme</cite>. This name can be preceded by some information about the user (e.g. a user name) who is requesting the information. Earlier definitions of the URI allowed the specification of a user name and a password before the <cite>@</cite> character (<span class="target" id="index-58"/><a class="rfc reference external" href="https://datatracker.ietf.org/doc/html/rfc1738.html"><strong>RFC 1738</strong></a>), but this is now deprecated as placing a password inside a URI is insecure. The host name can be followed by the semicolon character and a port number. A default port number is defined for some protocols and the port number should only be included in the URI if a non-default port number is used (for other protocols, techniques like service DNS records can used).</p>
<p>The third part of the URI is the path to the document. This path is structured as filenames on a Unix host (but it does not imply that the files are indeed stored this way on the server). If the path is not specified, the server will return a default document. The last two optional parts of the URI are used to provide a query parameter and indicate a specific part (e.g. a section in an article) of the requested document. Sample URIs are shown below.</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span/>http://tools.ietf.org/html/rfc3986.html
mailto:infobot@example.com?subject=current-issue
http://docs.python.org/library/basehttpserver.html?highlight=http#BaseHTTPServer.BaseHTTPRequestHandler
telnet://[2001:db8:3080:3::2]:2323/
ftp://cnn.example.com&amp;story=breaking_news@10.0.0.1/top_story.htm
</pre></div>
</div>
<p>The first URI corresponds to a document named <cite>rfc3986.html</cite> that is stored on the server named <cite>tools.ietf.org</cite> and can be accessed by using the <cite>http</cite> protocol on its default port. The second URI corresponds to an email message, with subject <cite>current-issue</cite>, that will be sent to user <cite>infobot</cite> in domain <cite>example.com</cite>. The <cite>mailto:</cite> URI scheme is defined in <span class="target" id="index-59"/><a class="rfc reference external" href="https://datatracker.ietf.org/doc/html/rfc2368.html"><strong>RFC 2368</strong></a>. The third URI references the portion <cite>BaseHTTPServer.BaseHTTPRequestHandler</cite> of the document <cite>basehttpserver.html</cite> that is stored in the <cite>library</cite> directory on the <cite>docs.python.org</cite> server. This document can be retrieved by using the <cite>http</cite> protocol. The query parameter <cite>highlight=http</cite> is associated to this URI. The fourth example is a server that operates the <a class="reference external" href="https://en.wikipedia.org/wiki/Telnet">telnet</a> protocol, uses IPv6 address <cite>2001:db8:3080:3::2</cite> and is reachable on port 2323. The last URI is somewhat special. Most users will assume that it corresponds to a document stored on the <cite>cnn.example.com</cite> server. However, to parse this URI, it is important to remember that the <cite>@</cite> character is used to separate the user name from the host name in the authorization part of a URI. This implies that the URI points to a document named <cite>top_story.htm</cite> on the host having IPv4 address <cite>10.0.0.1</cite>. The document will be retrieved by using the <cite>ftp</cite> protocol with the user name set to <cite>cnn.example.com&amp;story=breaking_news</cite>.</p>
<p>The second component of the <cite>word wide web</cite> is the HyperText Markup Language (HTML). HTML defines the format of the documents that are exchanged on the <cite>web</cite>. The <a class="reference external" href="http://www.w3.org/History/19921103-hypertext/hypertext/WWW/MarkUp/Tags.html">first version of HTML</a> was derived from the Standard Generalized Markup Language (SGML) that was standardized in 1986 by <a class="reference internal" href="../glossary.html#term-ISO"><span class="xref std std-term">ISO</span></a>. <a class="reference external" href="https://en.wikipedia.org/wiki/Standard_Generalized_Markup_Language">SGML</a> was designed to support large documents maintained by government, law firms or aerospace companies that must be shared efficiently in a machine-readable manner. These industries require documents to remain readable and editable for tens of years and insisted on a standardized format supported by multiple vendors. Today, <a class="reference external" href="https://en.wikipedia.org/wiki/Standard_Generalized_Markup_Language">SGML</a> is no longer widely used beyond specific applications, but its descendants including <a class="reference internal" href="../glossary.html#term-HTML"><span class="xref std std-term">HTML</span></a> and <a class="reference internal" href="../glossary.html#term-XML"><span class="xref std std-term">XML</span></a> are now widespread.</p>
<p>A markup language is a structured way of adding annotations about the formatting of the document within the document itself. Example markup languages include <a class="reference external" href="https://en.wikipedia.org/wiki/Troff">troff</a>, which is used to write the Unix man pages or <a class="reference external" href="https://en.wikipedia.org/wiki/Latex">Latex</a>. HTML uses markers to annotate text and a document is composed of <cite>HTML elements</cite>. Each element is usually composed of three parts: a start tag that potentially includes some specific attributes, some text (often including other elements), and an end tag. A HTML tag is a keyword enclosed in angle brackets. The generic form of an HTML element is</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span/><span class="o">&lt;</span><span class="n">tag</span><span class="o">&gt;</span><span class="n">Some</span> <span class="n">text</span> <span class="n">to</span> <span class="n">be</span> <span class="n">displayed</span><span class="o">&lt;/</span><span class="n">tag</span><span class="o">&gt;</span>
</pre></div>
</div>
<p>More complex HTML elements can also include optional attributes in the start tag</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span/><span class="o">&lt;</span><span class="n">tag</span> <span class="n">attribute1</span><span class="o">=</span><span class="s2">"value1"</span> <span class="n">attribute2</span><span class="o">=</span><span class="s2">"value2"</span><span class="o">&gt;</span><span class="n">some</span> <span class="n">text</span> <span class="n">to</span> <span class="n">be</span> <span class="n">displayed</span><span class="o">&lt;/</span><span class="n">tag</span><span class="o">&gt;</span>
</pre></div>
</div>
<p>The HTML document shown in <a class="reference internal" href="#fig-html-page"><span class="std std-numref">Fig. 34</span></a> is composed of two parts: a header, delineated by the <cite>&lt;head&gt;</cite> and <cite>&lt;/head&gt;</cite> markers, and a body (between the <cite>&lt;body&gt;</cite> and <cite>&lt;/body&gt;</cite> markers). In the example below, the header only contains a title, but other types of information can be included in the header. The body contains an image, some text and a list with three hyperlinks. The image is included in the web page by indicating its URI between brackets inside the <cite>&lt;img src=”…”&gt;</cite> marker. It is important to note that the image can reside on any server. The client will automatically download it when rendering the web page. The <cite>&lt;h1&gt;…&lt;/h1&gt;</cite> marker is used to specify the first level of headings. The <cite>&lt;ul&gt;</cite> marker indicates an unnumbered list while the <cite>&lt;li&gt;</cite> marker indicates a list item. The <cite>&lt;a href=”URI”&gt;text&lt;/a&gt;</cite> indicates a hyperlink. The <cite>text</cite> will be underlined in the rendered web page and the client will fetch the specified URI when the user clicks on the link.</p>
<figure class="align-center" id="id63">
<span id="fig-html-page"/><a class="reference internal image-reference" href="../_images/html-page.png"><img alt="../_images/html-page.png" src="../Images/44780516838bc54a13c36a8fe2321d96.png" style="width: 525.6999999999999px; height: 201.6px;" data-original-src="https://4ed.computer-networking.info/syllabus/default/_images/html-page.png"/>
</a>
<figcaption>
<p><span class="caption-number">Fig. 34 </span><span class="caption-text">A simple HTML page</span><a class="headerlink" href="#id63" title="Link to this image">#</a></p>
</figcaption>
</figure>
<p>Over the years, various extensions to HTML have been proposed and implemented. These include the specification of style sheets that adjust the layout of the document and the possibility of adding or referencing javascript code. Additional details about the various extensions to HTML may be found in the <a class="reference external" href="http://www.w3.org/MarkUp/">official specifications</a> maintained by <a class="reference external" href="https://www.w3.org">W3C</a>.</p>
<section id="the-hypertext-transfer-protocol">
<h3>The HyperText Transfer Protocol<a class="headerlink" href="#the-hypertext-transfer-protocol" title="Link to this heading">#</a></h3>
<p>The third component of the <cite>world wide web</cite> is the HyperText Transfer Protocol (HTTP). HTTP is a text-based protocol like SMTP. The client sends a request and the server returns a response. HTTP runs above the bytestream service and HTTP servers listen by default on port <cite>80</cite>. The design of HTTP has largely been inspired by the Internet email protocols. Each HTTP request contains three parts :</p>
<blockquote>
<div><ul class="simple">
<li><p>a <cite>method</cite>, that indicates the type of request, a URI, and the version of the HTTP protocol used by the client</p></li>
<li><p>a <cite>header</cite>, that is used by the client to specify optional parameters for the request. An empty line is used to mark the end of the header</p></li>
<li><p>an optional MIME document attached to the request</p></li>
</ul>
</div></blockquote>
<p>The response sent by the server also contains three parts :</p>
<blockquote>
<div><ul class="simple">
<li><p>a <cite>status line</cite> , that indicates whether the request was successful or not</p></li>
<li><p>a <cite>header</cite>, that contains additional information about the response. The response header ends with an empty line.</p></li>
<li><p>a MIME document</p></li>
</ul>
</div></blockquote>
<p>Figure <a class="reference internal" href="#fig-http-req-resp"><span class="std std-numref">Fig. 35</span></a> provides sample HTTP request and response.</p>
<blockquote>
<div><div class="figure" id="id64" style="text-align: center">
<span id="fig-http-req-resp"/><p><img src="../Images/64fd856539fab465e6b2fadde6a8bd15.png" alt="Figure made with TikZ" data-original-src="https://4ed.computer-networking.info/syllabus/default/_images/tikz-75f726be37c1860fd3d926a2afa1f9ab3d360f4d.png"/></p>
<p><span class="caption-number">Fig. 35 </span><span class="caption-text">HTTP requests and responses</span></p>
</div></div></blockquote>
<p>Several types of method can be used in HTTP requests. The three most important ones are :</p>
<blockquote>
<div><ul class="simple">
<li><p>the <cite>GET</cite> method is the most popular one. It is used to retrieve a document from a server. The <cite>GET</cite> method is encoded as <cite>GET</cite> followed by the path of the URI of the requested document and the version of HTTP used by the client. For example, to retrieve the <a class="reference external" href="http://www.w3.org/MarkUp/">http://www.w3.org/MarkUp/</a> URI, a client must open a TCP connection on port <cite>80</cite> with host <cite>www.w3.org</cite> and send a HTTP request containing the following line:</p></li>
</ul>
<div class="highlight-console notranslate"><div class="highlight"><pre><span/><span class="go">GET /MarkUp/ HTTP/1.0</span>
</pre></div>
</div>
<ul class="simple">
<li><p>the <cite>HEAD</cite> method is a variant of the <cite>GET</cite> method that allows the retrieval of the header lines for a given URI without retrieving the entire document. It can be used by a client to verify if a document exists, for instance.</p></li>
<li><p>the <cite>POST</cite> method can be used by a client to send a document to a server. The document is attached to the HTTP request as a MIME document.</p></li>
</ul>
</div></blockquote>
<p>HTTP clients and servers can include different HTTP headers in HTTP requests and responses. Each HTTP header is encoded as a single ASCII-line terminated by <cite>CR</cite> and <cite>LF</cite>. Several of these headers are briefly described below. A detailed discussion of the standard headers may be found in <span class="target" id="index-60"/><a class="rfc reference external" href="https://datatracker.ietf.org/doc/html/rfc1945.html"><strong>RFC 1945</strong></a>. The MIME headers can appear in both HTTP requests and HTTP responses.</p>
<blockquote>
<div><ul class="simple">
<li><p>the <cite>Content-Length:</cite> header is the <a class="reference internal" href="../glossary.html#term-MIME"><span class="xref std std-term">MIME</span></a> header that indicates the length of the MIME document in bytes.</p></li>
<li><p>the <cite>Content-Type:</cite> header is the <a class="reference internal" href="../glossary.html#term-MIME"><span class="xref std std-term">MIME</span></a> header that indicates the type of the attached MIME document. HTML pages use the <cite>text/html</cite> type.</p></li>
<li><p>the <cite>Content-Encoding:</cite> header indicates how the <a class="reference internal" href="../glossary.html#term-MIME-document"><span class="xref std std-term">MIME document</span></a> has been encoded. For example, this header would be set to <cite>x-gzip</cite> for a document compressed using the <a class="reference external" href="https://www.gzip.org">gzip</a> software.</p></li>
</ul>
</div></blockquote>
<p><span class="target" id="index-61"/><a class="rfc reference external" href="https://datatracker.ietf.org/doc/html/rfc1945.html"><strong>RFC 1945</strong></a> and <span class="target" id="index-62"/><a class="rfc reference external" href="https://datatracker.ietf.org/doc/html/rfc2616.html"><strong>RFC 2616</strong></a> define headers that are specific to HTTP responses. These server headers include:</p>
<blockquote>
<div><ul class="simple">
<li><p>the <cite>Server:</cite> header indicates the version of the web server that has generated the HTTP response. Some servers provide information about their software release and optional modules that they use. For security reasons, some system administrators disable these headers to avoid revealing too much information about their server to potential attackers.</p></li>
<li><p>the <cite>Date:</cite> header indicates when the HTTP response has been produced by the server.</p></li>
<li><p>the <cite>Last-Modified:</cite> header indicates the date and time of the last modification of the document attached to the HTTP response.</p></li>
</ul>
</div></blockquote>
<p>Similarly, the following header lines can only appear inside HTTP requests sent by a client:</p>
<blockquote>
<div><ul class="simple">
<li><p>the <cite>User-Agent:</cite> header provides information about the client that has generated the HTTP request. Some servers analyze this header line and return different headers and sometimes different documents for different user agents.</p></li>
<li><p>the <cite>If-Modified-Since:</cite> header is followed by a date. It enables clients to cache in memory or on disk recent or most frequently used documents. When a client needs to request a URI from a server, it first checks whether the document is already in its cache. If it is, the client sends an HTTP request with the <cite>If-Modified-Since:</cite> header indicating the date of the cached document. The server will only return the document attached to the HTTP response if it is newer than the version stored in the client’s cache.</p></li>
<li><p>the <cite>Referrer:</cite> header is followed by a URI. It indicates the URI of the document that the client visited before sending this HTTP request. Thanks to this header, the server can know the URI of the document containing the hyperlink followed by the client, if any. This information is very useful to measure the impact of advertisements containing hyperlinks placed on websites.</p></li>
<li><p>the <cite>Host:</cite> header contains the fully qualified domain name of the URI being requested.</p></li>
</ul>
</div></blockquote>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The importance of the <cite>Host:</cite> header line</p>
<p>The first version of HTTP did not include the <cite>Host:</cite> header line. This was a severe limitation for web hosting companies. For example consider a web hosting company that wants to serve both <cite>web.example.com</cite> and <cite>www.example.net</cite> on the same physical server. Both web sites contain a <cite>/index.html</cite> document. When a client sends a request for either <cite>http://web.example.com/index.html</cite> or <cite>http://www.example.net/index.html</cite>, the HTTP 1.0 request contains the following line :</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span/>GET /index.html HTTP/1.0
</pre></div>
</div>
<p>By parsing this line, a server cannot determine which <cite>index.html</cite> file is requested. Thanks to the <cite>Host:</cite> header line, the server knows whether the request is for <cite>http://web.example.com/index.html</cite> or <cite>http://www.dummy.net/index.html</cite>. Without the <cite>Host:</cite> header, this is impossible. The <cite>Host:</cite> header line allowed web hosting companies to develop their business by supporting a large number of independent web servers on the same physical server.</p>
</div>
<p>The status line of the HTTP response begins with the version of HTTP used by the server (usually <cite>HTTP/1.0</cite> defined in <span class="target" id="index-63"/><a class="rfc reference external" href="https://datatracker.ietf.org/doc/html/rfc1945.html"><strong>RFC 1945</strong></a> or <cite>HTTP/1.1</cite> defined in <span class="target" id="index-64"/><a class="rfc reference external" href="https://datatracker.ietf.org/doc/html/rfc2616.html"><strong>RFC 2616</strong></a>) followed by a three digit status code and additional information in English. HTTP status codes have a similar structure as the reply codes used by SMTP:</p>
<blockquote>
<div><ul class="simple">
<li><p>All status codes starting with digit <cite>2</cite> indicate a valid response. <cite>200 Ok</cite> indicates that the HTTP request was successfully processed by the server and that the response is valid.</p></li>
<li><p>All status codes starting with digit <cite>3</cite> indicate that the requested document is no longer available on the server. <cite>301 Moved Permanently</cite> indicates that the requested document is no longer available on this server. A <cite>Location:</cite> header containing the new URI of the requested document is inserted in the HTTP response. <cite>304 Not Modified</cite> is used in response to an HTTP request containing the <cite>If-Modified-Since:</cite> header. This status line is used by the server if the document stored on the server is not more recent than the date indicated in the <cite>If-Modified-Since:</cite> header.</p></li>
<li><p>All status codes starting with digit <cite>4</cite> indicate that the server has detected an error in the HTTP request sent by the client. <cite>400 Bad Request</cite> indicates a syntax error in the HTTP request. <cite>404 Not Found</cite> indicates that the requested document does not exist on the server.</p></li>
<li><p>All status codes starting with digit <cite>5</cite> indicate an error on the server. <cite>500 Internal Server Error</cite> indicates that the server could not process the request due to an error on the server itself.</p></li>
</ul>
</div></blockquote>
<p>In both HTTP requests and responses, the MIME document refers to a representation of the document with the MIME headers indicating the type of document and its size.</p>
<p>As an illustration of HTTP/1.0, the transcript below shows a HTTP request for <a class="reference external" href="http://www.ietf.org">http://www.ietf.org</a> and the corresponding HTTP response. The HTTP request was sent using the <a class="reference external" href="https://curl.haxx.se/">curl</a> command line tool. The <cite>User-Agent:</cite> header line contains more information about this client software. There is no MIME document attached to this HTTP request, and it ends with a blank line.</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span/>GET / HTTP/1.0
User-Agent: curl/7.19.4 (universal-apple-darwin10.0) libcurl/7.19.4 OpenSSL/0.9.8l zlib/1.2.3
Host: www.ietf.org
</pre></div>
</div>
<p>The HTTP response indicates the version of the server software used with the modules included. The <cite>Last-Modified:</cite> header indicates that the requested document was modified about one week before the request. A HTML document (not shown) is attached to the response. Note the blank line between the header of the HTTP response and the attached MIME document. The <cite>Server:</cite> header line has been truncated in this output.</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span/>HTTP/1.1 200 OK
Date: Mon, 15 Mar 2010 13:40:38 GMT
Server: Apache/2.2.4 (Linux/SUSE) mod_ssl/2.2.4 OpenSSL/0.9.8e (truncated)
Last-Modified: Tue, 09 Mar 2010 21:26:53 GMT
Content-Length: 17019
Content-Type: text/html

&lt;!DOCTYPE HTML PUBLIC .../HTML&gt;
</pre></div>
</div>
<p>HTTP was initially designed to share text documents. For this reason, and to ease the implementation of clients and servers, the designers of HTTP chose to open a TCP connection for each HTTP request. This implies that a client must open one TCP connection for each URI that it wants to retrieve from a server as illustrated on the figure below, showing HTTP 1.0 and the underlying TCP connection. For a web page containing only text documents this was a reasonable design choice as the client usually remains idle while the (human) user is reading the retrieved document.</p>
<p class="mscgen">
<img src="../Images/15f6359ba4c5a3cfe439a837a247edb5.png" alt="msc {&#10;a1 [label=&quot;&quot;, linecolour=white],&#10;a [label=&quot;&quot;, linecolour=white],&#10;b [label=&quot;Client&quot;, linecolour=black],&#10;z [label=&quot;&quot;, linecolour=white],&#10;c [label=&quot;Server&quot;, linecolour=black],&#10;d [label=&quot;&quot;, linecolour=white],&#10;d1 [label=&quot;&quot;, linecolour=white];&#10;&#10;a1=&gt;b [ label = &quot;CONNECT.request&quot; ] ,&#10;b&gt;&gt;c [ label = &quot;&quot;, arcskip=&quot;1&quot;];&#10;c=&gt;d1 [ label = &quot;CONNECT.indication&quot; ];&#10;&#10;d1=&gt;c [ label = &quot;CONNECT.response&quot; ] ,&#10;c&gt;&gt;b [ label = &quot;&quot;, arcskip=&quot;1&quot;];&#10;b=&gt;a1 [ label = &quot;CONNECT.confirm&quot; ];&#10;&#10;a1=&gt;b [ label = &quot;DATA.request(Request)&quot;, linecolour=red, textcolour=red],&#10;b&gt;&gt;c [ linecolour=red, arcskip=&quot;1&quot;];&#10;c==d1 [ label = &quot;DATA.indication(Request)&quot;, linecolour=red, textcolour=red];&#10;&#10;d1=&gt;c [ label = &quot;DATA.request(Response)&quot;, linecolour=blue, textcolour=blue] ,&#10;c&gt;&gt;b [ linecolour=blue, arcskip=&quot;1&quot;];&#10;b=&gt;a1 [ label = &quot;DATA.indication(Response)&quot;, linecolour=blue, textcolour=blue],&#10;d1=&gt;c [ label = &quot;DISCONNECT.request&quot;],&#10;c&gt;&gt;b [ arcskip=&quot;1&quot;];&#10;b=&gt;a1 [ label = &quot;DISCONNECT.indication&quot; ];&#10;&#10;a1=&gt;b [ label = &quot;DISCONNECT.request&quot; ] ,&#10;b&gt;&gt;c [ label = &quot;&quot;, arcskip=&quot;1&quot;];&#10;c=&gt;d1 [ label = &quot;DISCONNECT.indication&quot; ];&#10;}" usemap="#d49bedba389123d38d35a1fef746a30e5445ef03" data-original-src="https://4ed.computer-networking.info/syllabus/default/_images/mscgen-d49bedba389123d38d35a1fef746a30e5445ef03.png"/>
<map id="d49bedba389123d38d35a1fef746a30e5445ef03" name="d49bedba389123d38d35a1fef746a30e5445ef03"/></p>
<p>However, as the web evolved to support richer documents containing images, opening a TCP connection for each URI became a performance problem <a class="reference internal" href="../bibliography.html#mogul1995" id="id34"><span>[Mogul1995]</span></a>. Indeed, besides its HTML part, a web page may include dozens of images or more. Forcing the client to open a TCP connection for each component of a web page has two important drawbacks. First, the client and the server must exchange packets to open and close a TCP connection as we will see later. This increases the network overhead and the total delay of completely retrieving all the components of a web page. Second, a large number of established TCP connections may be a performance bottleneck on servers.</p>
<p>This problem was solved by extending HTTP to support persistent TCP connections <span class="target" id="index-65"/><a class="rfc reference external" href="https://datatracker.ietf.org/doc/html/rfc2616.html"><strong>RFC 2616</strong></a>. A persistent connection is a TCP connection over which a client may send several HTTP requests. This is illustrated in the figure below showing the persistent connection of HTTP 1.1.</p>
<p class="mscgen">
<img src="../Images/1dd234f6259caa842e7721e4f7b6857e.png" alt="msc {&#10;a1 [label=&quot;&quot;, linecolour=white],&#10;a [label=&quot;&quot;, linecolour=white],&#10;b [label=&quot;Client&quot;, linecolour=black],&#10;z [label=&quot;&quot;, linecolour=white],&#10;c [label=&quot;Server&quot;, linecolour=black],&#10;d [label=&quot;&quot;, linecolour=white],&#10;d1 [label=&quot;&quot;, linecolour=white];&#10;&#10;a1=&gt;b [ label = &quot;CONNECT.request&quot; ] ,&#10;b&gt;&gt;c [ label = &quot;&quot;, arcskip=&quot;1&quot;];&#10;c=&gt;d1 [ label = &quot;CONNECT.indication&quot; ];&#10;&#10;d1=&gt;c [ label = &quot;CONNECT.response&quot; ] ,&#10;c&gt;&gt;b [ label = &quot;&quot;, arcskip=&quot;1&quot;];&#10;b=&gt;a1 [ label = &quot;CONNECT.confirm&quot; ];&#10;&#10;a1=&gt;b [ label = &quot;&quot;, linecolour=red, textcolour=red],&#10;b&gt;&gt;c [ linecolour=red, arcskip=&quot;1&quot;];&#10;a1=&gt;b [ label = &quot;GET / HTTP1.1\nConnection: Keep-Alive\n...&quot;, linecolour=white, textcolour=red],&#10;c=&gt;d1 [ label = &quot;&quot;, linecolour=red, textcolour=red];&#10;&#10;d1=&gt;c [ label = &quot;&quot;, linecolour=blue, textcolour=blue] ,&#10;c&gt;&gt;b [ linecolour=blue, arcskip=&quot;1&quot;];&#10;d1=&gt;c [ label = &quot;HTTP/1.1 200 OK\nKeep-Alive: timeout=15, max=100\nConnection: Keep-Alive\n...&quot;, linecolour=white, textcolour=blue],&#10;b=&gt;a1 [ label = &quot;&quot;, linecolour=blue, textcolour=blue];&#10;&#10;a1=&gt;b [ label = &quot;&quot;, linecolour=red, textcolour=red],&#10;b&gt;&gt;c [ linecolour=red, arcskip=&quot;1&quot;];&#10;a1=&gt;b [ label = &quot;GET /images/logo.gif HTTP1.1\nConnection: Keep-Alive\n...&quot;, linecolour=white, textcolour=red],&#10;c=&gt;d1 [ label = &quot;&quot;, linecolour=red, textcolour=red];&#10;&#10;d1=&gt;c [ label = &quot;&quot;, linecolour=blue, textcolour=blue] ,&#10;c&gt;&gt;b [ linecolour=blue, arcskip=&quot;1&quot;];&#10;d1=&gt;c [ label = &quot;HTTP/1.1 200 OK\nKeep-Alive: timeout=15, max=99\nConnection: Keep-Alive\n...&quot;, linecolour=white, textcolour=blue],&#10;b=&gt;a1 [ label = &quot;&quot;, linecolour=blue, textcolour=blue];&#10;&#10;|||;&#10;d1=&gt;c [ label = &quot;DISCONNECT.request&quot;],&#10;c&gt;&gt;b [ arcskip=&quot;1&quot;];&#10;b=&gt;a1 [ label = &quot;DISCONNECT.indication&quot; ];&#10;&#10;&#10;a1=&gt;b [ label = &quot;DISCONNECT.request&quot; ] ,&#10;b&gt;&gt;c [ label = &quot;&quot;, arcskip=&quot;1&quot;];&#10;c=&gt;d1 [ label = &quot;DISCONNECT.indication&quot; ];&#10;}" usemap="#e3a7f46f483e3da6d68605217fa3410d14c6e31b" data-original-src="https://4ed.computer-networking.info/syllabus/default/_images/mscgen-e3a7f46f483e3da6d68605217fa3410d14c6e31b.png"/>
<map id="e3a7f46f483e3da6d68605217fa3410d14c6e31b" name="e3a7f46f483e3da6d68605217fa3410d14c6e31b"/></p>
<p>To allow the clients and servers to control the utilization of these persistent TCP connections, HTTP 1.1 <span class="target" id="index-66"/><a class="rfc reference external" href="https://datatracker.ietf.org/doc/html/rfc2616.html"><strong>RFC 2616</strong></a> defines several new HTTP headers:</p>
<blockquote>
<div><ul class="simple">
<li><p>The <cite>Connection:</cite> header is used with the <cite>Keep-Alive</cite> argument by the client to indicate that it expects the underlying TCP connection to be persistent. When this header is used with the <cite>Close</cite> argument, it indicates that the entity that sent it will close the underlying TCP connection at the end of the HTTP response.</p></li>
<li><p>The <cite>Keep-Alive:</cite> header is used by the server to inform the client about how it agrees to use the persistent connection. A typical <cite>Keep-Alive:</cite> contains two parameters: the maximum number of requests that the server agrees to serve on the underlying TCP connection and the timeout (in seconds) after which the server will close an idle connection</p></li>
</ul>
</div></blockquote>
<p>The example below shows the operation of HTTP/1.1 over a persistent TCP connection to retrieve three URIs stored on the same server. Once the connection has been established, the client sends its first request with the <cite>Connection: Keep-Alive</cite> header to request a persistent connection.</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span/>GET / HTTP/1.1
Host: www.kame.net
User-Agent: Mozilla/5.0 (Macintosh; U; Intel Mac OS X 10_6_2; en-us)
Connection: Keep-Alive
</pre></div>
</div>
<p>The server replies with the <cite>Connection: Keep-Alive</cite> header and indicates that it accepts a maximum of 100 HTTP requests over this connection and that it will close the connection if it remains idle for 15 seconds.</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span/>HTTP/1.1 200 OK
Date: Fri, 19 Mar 2010 09:23:37 GMT
Server: Apache/2.0.63 (FreeBSD) PHP/5.2.12 with Suhosin-Patch
Keep-Alive: timeout=15, max=100
Connection: Keep-Alive
Content-Length: 3462
Content-Type: text/html

&lt;html&gt;...   &lt;/html&gt;
</pre></div>
</div>
<p>The client sends a second request for the style sheet of the retrieved web page.</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span/>GET /style.css HTTP/1.1
Host: www.kame.net
Referer: http://www.kame.net/
User-Agent: Mozilla/5.0 (Macintosh; U; Intel Mac OS X 10_6_2; en-us)
Connection: keep-alive
</pre></div>
</div>
<p>The server replies with the requested style sheet and maintains the persistent connection. Note that the server only accepts 99 remaining HTTP requests over this persistent connection.</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span/>HTTP/1.1 200 OK
Date: Fri, 19 Mar 2010 09:23:37 GMT
Server: Apache/2.0.63 (FreeBSD) PHP/5.2.12 with Suhosin-Patch
Last-Modified: Mon, 10 Apr 2006 05:06:39 GMT
Content-Length: 2235
Keep-Alive: timeout=15, max=99
Connection: Keep-Alive
Content-Type: text/css

...
</pre></div>
</div>
<p>Then the client requested the web server’s icon <a class="footnote-reference brackets" href="#ffavicon" id="id35" role="doc-noteref"><span class="fn-bracket">[</span>18<span class="fn-bracket">]</span></a>. This server does not contain such an icon and thus replies with a <cite>404</cite> HTTP status. However, the underlying TCP connection is not closed immediately.</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span/>GET /favicon.ico HTTP/1.1
Host: www.kame.net
Referer: http://www.kame.net/
User-Agent: Mozilla/5.0 (Macintosh; U; Intel Mac OS X 10_6_2; en-us)
Connection: keep-alive

HTTP/1.1 404 Not Found
Date: Fri, 19 Mar 2010 09:23:40 GMT
Server: Apache/2.0.63 (FreeBSD) PHP/5.2.12 with Suhosin-Patch
Content-Length: 318
Keep-Alive: timeout=15, max=98
Connection: Keep-Alive
Content-Type: text/html; charset=iso-8859-1

&lt;!DOCTYPE HTML PUBLIC "-//IETF//DTD HTML 2.0//EN"&gt; ...
</pre></div>
</div>
<p>As illustrated above, a client can send several HTTP requests over the same persistent TCP connection. However, it is important to note that all of these HTTP requests are considered to be independent by the server. Each HTTP request must be self-contained. This implies that each request must include all the header lines that are required by the server to understand the request. The independence of these requests is one of the key design choices of HTTP. As a consequence of this design choice, when a server processes a HTTP request, it does not use any other information than what is contained in the request itself. This explains why the client adds its <cite>User-Agent:</cite> header in all of the HTTP requests that it sends over the persistent TCP connection.</p>
<p>However, in practice, some servers want to provide content tuned for each user. For example, some servers can provide information in several languages. Other servers want to provide advertisements that are targeted to different types of users. To do this, servers need to maintain some information about the preferences of each user and use this information to produce content matching the user’s preferences. HTTP contains several mechanisms to solve this problem. We discuss three of them below.</p>
<p>A first solution is to force the users to be authenticated. This was the solution used by <cite>FTP</cite> to control the files that each user could access. Initially, user names and passwords could be included inside URIs <span class="target" id="index-67"/><a class="rfc reference external" href="https://datatracker.ietf.org/doc/html/rfc1738.html"><strong>RFC 1738</strong></a>. However, placing passwords in the clear in a potentially publicly visible URI is completely insecure and this usage has now been deprecated <span class="target" id="index-68"/><a class="rfc reference external" href="https://datatracker.ietf.org/doc/html/rfc3986.html"><strong>RFC 3986</strong></a>. HTTP supports several extension headers <span class="target" id="index-69"/><a class="rfc reference external" href="https://datatracker.ietf.org/doc/html/rfc2617.html"><strong>RFC 2617</strong></a> that can be used by a server to request the authentication of the client by providing his/her credentials. However, user names and passwords have not been popular on web servers as they force human users to remember one user name and one password per server. Remembering a password is acceptable when a user needs to access protected content, but users will not accept to remember a unique user name and password for each web sites that they visit.</p>
<p>A second solution to allow servers to tune that content to the needs and capabilities of the user is to rely on the different types of <cite>Accept-*</cite> HTTP headers. For example, the <cite>Accept-Language:</cite> header can be used by the client to indicate its preferred languages. Unfortunately, in practice this header is usually set based on the default language of the browser and it is difficult for a user to indicate the language it prefers by selecting options for each visited web server.</p>
<p>The third and widely adopted solution are HTTP cookies. HTTP cookies were initially developed as a private extension by <a class="reference external" href="https://en.wikipedia.org/wiki/Netscape">Netscape</a>. They are now part of the standard <span class="target" id="index-70"/><a class="rfc reference external" href="https://datatracker.ietf.org/doc/html/rfc6265.html"><strong>RFC 6265</strong></a>. In a nutshell, a cookie is a short string that is chosen by a server to represent a given client. Two HTTP headers are used : <cite>Cookie:</cite> and <cite>Set-Cookie:</cite>. When a server receives an HTTP request from a new client (i.e. an HTTP request that does not contain the <cite>Cookie:</cite> header), it generates a cookie for the client and includes it in the <cite>Set-Cookie:</cite> header of the returned HTTP response. The <cite>Set-Cookie:</cite> header contains several additional parameters including the domain names for which the cookie is valid. The client stores all received cookies on disk and every time it sends an HTTP request, it verifies whether it already knows a cookie for this domain. If so, it attaches the <cite>Cookie:</cite> header to the HTTP request. This is illustrated in the figure below with HTTP 1.1, but cookies also work with HTTP 1.0.</p>
<p class="mscgen">
<img src="../Images/46342147d4ef4a386569e9a3c497ba69.png" alt="msc {&#10;a1 [label=&quot;&quot;, linecolour=white],&#10;a [label=&quot;&quot;, linecolour=white],&#10;b [label=&quot;Client&quot;, linecolour=black],&#10;z [label=&quot;&quot;, linecolour=white],&#10;c [label=&quot;Server&quot;, linecolour=black],&#10;d [label=&quot;&quot;, linecolour=white],&#10;d1 [label=&quot;&quot;, linecolour=white];&#10;&#10;a1=&gt;b [ label = &quot;&quot;, linecolour=red, textcolour=red],&#10;b&gt;&gt;c [ linecolour=red, arcskip=&quot;1&quot;];&#10;a1=&gt;b [ label = &quot;GET / HTTP1.1\n...&quot;, linecolour=white, textcolour=red],&#10;c=&gt;d1 [ label = &quot;&quot;, linecolour=red, textcolour=red];&#10;&#10;d1=&gt;c [ label = &quot;&quot;, linecolour=blue, textcolour=blue] ,&#10;c&gt;&gt;b [ linecolour=blue, arcskip=&quot;1&quot;];&#10;d1=&gt;c [ label = &quot;HTTP/1.1 200 OK\nSet-Cookie: machin\n...&quot;, linecolour=white, textcolour=blue],&#10;b=&gt;a1 [ label = &quot;&quot;, linecolour=blue, textcolour=blue];&#10;a1=&gt;b [ label = &quot;Browser saves cookie&quot;, linecolour=white],&#10;c=&gt;d1 [ label = &quot;Normal response&quot;, linecolour=white];&#10;&#10;a1=&gt;b [ label = &quot;&quot;, linecolour=red, textcolour=red],&#10;b&gt;&gt;c [ linecolour=red, arcskip=&quot;1&quot;];&#10;a1=&gt;b [ label = &quot;GET /doc HTTP1.1\nCookie: machin\n...&quot;, linecolour=white, textcolour=red],&#10;c=&gt;d1 [ label = &quot;&quot;, linecolour=red, textcolour=red];&#10;&#10;d1=&gt;c [ label = &quot;&quot;, linecolour=blue, textcolour=blue] ,&#10;c&gt;&gt;b [ linecolour=blue, arcskip=&quot;1&quot;];&#10;d1=&gt;c [ label = &quot;HTTP/1.1 200 OK\n...&quot;, linecolour=white, textcolour=blue],&#10;b=&gt;a1 [ label = &quot;&quot;, linecolour=blue, textcolour=blue];&#10;c=&gt;d1 [ label = &quot;Response is function\nof URL and cookie&quot;, linecolour=white];&#10;&#10;a1=&gt;b [ label = &quot;&quot;, linecolour=red, textcolour=red],&#10;b&gt;&gt;c [ linecolour=red, arcskip=&quot;1&quot;];&#10;a1=&gt;b [ label = &quot;GET /images/t.gif HTTP1.1\nCookie: machin\n...&quot;, linecolour=white, textcolour=red],&#10;c=&gt;d1 [ label = &quot;&quot;, linecolour=red, textcolour=red];&#10;&#10;d1=&gt;c [ label = &quot;&quot;, linecolour=blue, textcolour=blue] ,&#10;c&gt;&gt;b [ linecolour=blue, arcskip=&quot;1&quot;];&#10;d1=&gt;c [ label = &quot;HTTP/1.1 200 OK\n...&quot;, linecolour=white, textcolour=blue],&#10;b=&gt;a1 [ label = &quot;&quot;, linecolour=blue, textcolour=blue];&#10;a1=&gt;b [ label = &quot;Browser sends cookie in\nall requests sent to server&quot;, linecolour=white];&#10;}" usemap="#577adf721a7a6a7a5af9beec3659eccef6881630" data-original-src="https://4ed.computer-networking.info/syllabus/default/_images/mscgen-577adf721a7a6a7a5af9beec3659eccef6881630.png"/>
<map id="577adf721a7a6a7a5af9beec3659eccef6881630" name="577adf721a7a6a7a5af9beec3659eccef6881630"/></p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Privacy issues with HTTP cookies</p>
<p>The HTTP cookies introduced by <a class="reference external" href="https://en.wikipedia.org/wiki/Netscape">Netscape</a> are key for large e-commerce websites. However, they have also raised many discussions concerning their <a class="reference external" href="http://www.nytimes.com/2001/09/04/technology/04COOK.html">potential misuses</a>. Consider <cite>ad.com</cite>, a company that delivers lots of advertisements on web sites. A web site that wishes to include <cite>ad.com</cite>’s advertisements next to its content will add links to <cite>ad.com</cite> inside its HTML pages. If <cite>ad.com</cite> is used by many web sites, <cite>ad.com</cite> could be able to track the interests of all the users that visit its client websites and use this information to provide targeted advertisements. Privacy advocates have even <a class="reference external" href="http://epic.org/privacy/internet/cookies/">sued</a> online advertisement companies to force them to comply with the privacy regulations. More recent related technologies also raise <a class="reference external" href="http://www.eff.org/deeplinks/2009/09/new-cookie-technologies-harder-see-and-remove-wide">privacy concerns</a>.</p>
</div>
</section>
<section id="http-version-2-0">
<span id="http2"/><h3>HTTP version 2.0<a class="headerlink" href="#http-version-2-0" title="Link to this heading">#</a></h3>
<p>During the last decade, a growing number of services have been supported by world wide web servers. The web protocols are not only used to deliver static documents, they are also used to deliver streaming music or video. They also enable clients to use interactive applications including games or productivity applications. These services and applications have more stringent performance requirements than the delivery of static documents. Many researchers and companies have proposed solutions to improve the performance of web services and protocols during the last decade <a class="reference internal" href="../bibliography.html#kr2001" id="id36"><span>[KR2001]</span></a> <a class="reference internal" href="../bibliography.html#wbk2014" id="id37"><span>[WBK2014]</span></a>. We discuss a subset of them in this section.</p>
<p>A first way to improve the performance of the web protocols is to tune the servers that provide content. In the early days, documents were stored on a single server. Clients established TCP connections to this server to retrieve each document. This architecture evolved in several directions. A first way to speedup web services is to avoid unnecessary transmissions. Thanks to the <cite>HEAD</cite> method and the <cite>If-Modified-Since:</cite> header, web browsers can verify that they have the most recent version of a document in their cache.</p>
<blockquote>
<div><div class="figure" id="id65" style="text-align: center">
<span id="fig-web-proxy"/><p><img src="../Images/e9483f4f858b0589cf3d76890882a4d6.png" alt="Figure made with TikZ" data-original-src="https://4ed.computer-networking.info/syllabus/default/_images/tikz-05c525754f05b235f3df09dac26b1026a2609c06.png"/></p>
<p><span class="caption-number">Fig. 36 </span><span class="caption-text">Proxies relay client requests to servers and return the received responses</span></p>
</div></div></blockquote>
<p>Caches can also be used inside the network. To understand their benefits, let us consider an SME with a dozen of employees that are connected to the Internet through a low-speed link. These employees often access similar web sites. Consider that Alice and Bob want to browse today’s local newspaper. Their browsers will both retrieve the newspaper’s website through the low bandwidth link and store the main documents in their cache. Unfortunately, the same information passes twice over the low-speed link. Some companies have deployed web proxies to cope with this problem. A web proxy is a server that resides in the enterprise network. All the employee’s browsers are configured to send their HTTP requests to this proxy. When such a proxy receives a request, it checks whether the content is already stored inside its own cache. If so, it returns it directly. Otherwise, the request is sent to the remote server and the information is stored in the proxy cache. By reducing the number of web objects that are exchanged over low-speed links, such proxies can significantly improve performance. Some companies also use them to control the websites that are contacted by their employees and sometimes block illegitimate accesses.</p>
<p>Proxies can also be located in front of servers. In this case, they are called reverse-proxies. Consider a dynamic web server that produces web pages by assembling information stored in different databases. When this server receives a request, it must send multiple queries to its databases and then create the HTML document. These queries and the creation of the HTML document take time and this limits the number of requests that our server can sustain. Many content providers would place a reverse proxy in front of such a server. The DNS servers are configured to point to the reverse proxy. Upon reception of a request, the reverse proxy first checks whether the response is already stored in its cache. If so, it can return it to the client without interacting with the official server. Otherwise, the reverse proxy contacts the server and then returns the response to the client.</p>
<p>These reverse proxies can also be used to spread the load among different servers. In the above example, consider that a server needs 10 milliseconds to process each request and that it must handle them sequentially. Such a server cannot support more than 100 requests per second. If the service becomes popular, then the content provider will need to deploy several servers. These servers could serve the same reverse proxy.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Serving content from multiple servers</p>
<p>When a web user interacts with <cite>www.service.net</cite>, she expects that all the information comes from the <cite>www.service.net</cite> server. If the service is popular, there are probably tens, hundreds, thousands or more physical servers that support this service. Still, the user has the illusion that she is interacting with a single server. Several techniques have been deployed by content providers to scale web services. Consider a simple service that serves text documents from <cite>N</cite> different servers. There are different ways to architect such a service.</p>
<p>A first approach is to store all files on each physical server and rely on the DNS to distribute the load among them. Each physical server has its own IP address and when the DNS server receives a query for <cite>www.service.net</cite>, it returns the IP address of one of them. Some DNS servers use Round-Robin to return one of these IP addresses. Others measure the load of the physical servers and return the address of the less loaded one. Another possibility is to locate the physical servers in different regions and configure the DNS server to return the IP address of the server that is geographically closer to the client’s IP address.</p>
<p>A second approach is to rely on <cite>k</cite> reverse proxies and <cite>N-k</cite> servers. The servers store the content and the proxies cache the most frequently used files. The proxies can be geographically close to the clients while the servers can reside in the datacenters of the content provider. The DNS server can also distribute the load among the different proxies or return the geographically closest proxy. An important point to note about reverse proxies is that they receive HTTP requests from clients and send HTTP requests to the original servers that host the content. Several companies, usually called Content Distribution Networks, have deployed such reverse proxies throughout the world to cache web content next to the end-users. A good description of such a CDN may be found in <a class="reference internal" href="../bibliography.html#nss2010" id="id38"><span>[NSS2010]</span></a>.</p>
</div>
<p>A second way to improve the web performance is to reduce the time required to retrieve web objects. While the first web servers returned an HTML documents with possibly a few images, today’s rich web servers return one HTML document with associated style sheets, javascript code, images, fonts, … Some of these web objects come from the original server while others are hosted on different servers. Today, a typical web page contains almost 2 MBytes of data on average. The size of the web pages continues to grow according to statistics collected by <cite>httparchive.org</cite> as shown in <a class="reference internal" href="#fig-httparchive"><span class="std std-numref">Fig. 37</span></a>. Web pages targeted to mobile devices are slightly smaller.</p>
<figure class="align-center" id="id66">
<span id="fig-httparchive"/><a class="reference internal image-reference" href="../_images/httparchive-bytes.png"><img alt="../_images/httparchive-bytes.png" src="../Images/e512429b911bc1ff17df73d156e86ce1.png" style="width: 720.0px; height: 480.0px;" data-original-src="https://4ed.computer-networking.info/syllabus/default/_images/httparchive-bytes.png"/>
</a>
<figcaption>
<p><span class="caption-number">Fig. 37 </span><span class="caption-text">Evolution of the size of the web pages (source: <a class="reference external" href="https://httparchive.org/reports/page-weight">https://httparchive.org/reports/page-weight</a>)</span><a class="headerlink" href="#id66" title="Link to this image">#</a></p>
</figcaption>
</figure>
<p>A closer look at the average web page shows that it contains, on average, 27 KBytes of HTML, 120 KBytes of fonts, 60 KBytes of CSS information, almost 1 MBytes of images and more than 400 KBytes of javascript.  Each of these web page requires about 70 different HTTP requests. In other words, a browser needs to send on average 70 requests to retrieve a complete web page.</p>
<p>Two directions have been explored to improve the delivery of these web pages. The first direction is to tune the HTTP protocol. The second approach is to change the entire network stack. This approach is discussed in the QUIC chapter.</p>
<p>One of the limitations of HTTP from a performance viewpoint is that the requests that are sent by a browser must be sequential. Typically, a browser requests the HTML page. Once the page has been retrieved, the browser parses it to identify all the objects that it references and requests them one after each other. The web page can only be displayed to the user once all the required web objects have been retrieved. This implies that the browser must wait until the reception of each response before sending the next request. Another possibility is to allow the browser to send multiple requests without waiting for their corresponding responses. This approach is called <cite>pipelining</cite> in <span class="target" id="index-71"/><a class="rfc reference external" href="https://datatracker.ietf.org/doc/html/rfc7230.html"><strong>RFC 7230</strong></a>.</p>
<p>To understand the benefits of pipelining, let us consider a simple but illustrative example. A client needs to retrieve 5 web objects that are each 100 bytes. The underlying transport connection has a 1 Gbps bandwidth but a one-way delay of 100 msec. A normal HTTP/1.x client would send the first request, wait 200 msec to receive the answer, then send another request… It would need one entire second to retrieve the five web objects. This is illustrated in <a class="reference internal" href="#fig-http-nopipelining"><span class="std std-numref">Fig. 38</span></a>.</p>
<div class="figure" id="id67" style="text-align: center">
<span id="fig-http-nopipelining"/><p><img src="../Images/902ce8ac285bbf69a2f6e825e8e51419.png" alt="Figure made with TikZ" data-original-src="https://4ed.computer-networking.info/syllabus/default/_images/tikz-ca125cad3bdce90b39b9ded24ca279bf4ba28bf6.png"/></p>
<p><span class="caption-number">Fig. 38 </span><span class="caption-text">A sequence of HTTP requests to a given server</span></p>
</div><p>With <cite>pipelining</cite>, the client sends the five requests immediately and receives the five responses after 200 msec. <a class="reference internal" href="#fig-http-pipelining"><span class="std std-numref">Fig. 39</span></a> illustrates the benefits of <cite>pipelining</cite>.</p>
<div class="figure" id="id68" style="text-align: center">
<span id="fig-http-pipelining"/><p><img src="../Images/d0394b043492534d50c59a67578ea778.png" alt="Figure made with TikZ" data-original-src="https://4ed.computer-networking.info/syllabus/default/_images/tikz-b3813db3df8e3cc996d74f94fe7f87616d863710.png"/></p>
<p><span class="caption-number">Fig. 39 </span><span class="caption-text">A sequence of HTTP requests to a server with pipelining</span></p>
</div><p>However, as explained in <span class="target" id="index-72"/><a class="rfc reference external" href="https://datatracker.ietf.org/doc/html/rfc7230.html"><strong>RFC 7230</strong></a>, there is one important limitation to <cite>pipelining</cite>. It can only be used to serve HTTP requests that are idempotent, i.e. none of the requests must depend on any of the previous requests in the pipeline. It turned out that it was difficult for web browsers to correctly support this requirement and very few of them have implemented <cite>pipelining</cite> <a class="footnote-reference brackets" href="#fpipelining" id="id39" role="doc-noteref"><span class="fn-bracket">[</span>19<span class="fn-bracket">]</span></a>.</p>
<p>Another limitation of HTTP/1.1 is that all commands and parameters are encoded as ASCII strings. Using ASCII strings makes it easy to write simple clients or debug problems by observing packets. Unfortunately, the burden is placed on servers that need to include complex parsers that accept a wide range of partially compliant implementations. Furthermore, the flexibility of the ASCII encoding has enabled some classes of security attacks on servers <a class="reference internal" href="../bibliography.html#cwe444" id="id40"><span>[CWE444]</span></a>.</p>
<p>To cope with these two problems, the IETF HTTP working group developed version 2.0 of HTTP. HTTP/2.0 diverges from HTTP/1.1 in two important ways. First, HTTP/2.0 relies on binary encoding which is both more compact and easier to parse. Second, HTTP/2.0 supports multiple streams, which makes it possible to simultaneously transfer different web objects over a single transport connection. Furthermore, HTTP/2.0 also compresses the HTTP headers to reduce the amount of data transferred. This technique is described in <span class="target" id="index-73"/><a class="rfc reference external" href="https://datatracker.ietf.org/doc/html/rfc7541.html"><strong>RFC 7541</strong></a> but is not discussed in this chapter.</p>
<p>Let us first examine how HTTP/2.0 structures the bytestream of the underlying connection.</p>
<figure class="align-center" id="id69">
<span id="fig-http2-frame"/><a class="reference internal image-reference" href="../_images/http2-frame.svg"><img alt="../_images/http2-frame.svg" src="../Images/70ec7c103b170dfdecf10fd670dc9b85.png" style="width: 579.0px; height: 144.0px;" data-original-src="https://4ed.computer-networking.info/syllabus/default/_images/http2-frame.svg"/>
</a>
<figcaption>
<p><span class="caption-number">Fig. 40 </span><span class="caption-text">The HTTP/2.0 Frame header</span><a class="headerlink" href="#id69" title="Link to this image">#</a></p>
</figcaption>
</figure>
<p>The information exchanged over an HTTP/2.0 session is composed of frames. A frame starts with a 9 bytes-long header that carries several types of information as shown in <a class="reference internal" href="#fig-http2-frame"><span class="std std-numref">Fig. 40</span></a>. The HTTP/2.0 frames have a variable length. The <cite>Length</cite> field of the header contains the length of the frame payload in bytes. As this field is encoded as a 24 bits field, an HTTP/2.0 frame cannot be longer than <span class="math notranslate nohighlight">\(2^{24} -1\)</span> bytes. It should be noted that <span class="target" id="index-74"/><a class="rfc reference external" href="https://datatracker.ietf.org/doc/html/rfc7540.html"><strong>RFC 7540</strong></a> assumes a maximum size of <span class="math notranslate nohighlight">\(2^{14}\)</span> bytes, i.e. 16,384 bytes for the HTTP/2.0 frame payload unless a longer maximum frame length has been negotiated at the beginning of the session using the HTTP/2.0 <cite>Settings</cite> frame that will be described later. The next field of the frames header indicates the frame type. The first frame types are <cite>Data</cite> which contains data from web objects and <cite>Headers</cite> containing HTTP/2.0 headers. When a client retrieves a web object from a server, it always receives an HTTP/2.0 <cite>Headers</cite> frame followed by an HTTP/2.0 <cite>Data</cite> frame. The <cite>Headers</cite> frame information contains essentially the same HTTP headers as the ones supported by HTTP/1.1, but those are encoded by leveraging a data compression technique that minimizes the number of bytes required to transmit them.</p>
<p>Other frame types are described later. The <cite>Flags</cite> are used for some frame types and the <cite>R</cite> bit must be set to zero. The last important field of the <cite>HTTP/2.0 Frame</cite> header is the <cite>Stream Identifier</cite>. With HTTP/2.0, the bytestream of the underlying transport connection is divided in independent streams that are identified by an integer. The odd (resp. even) stream identifiers are managed by the client (resp. server). This enables the server (or the client) to multiplex data corresponding to different frames over a single bytestream.</p>
<p id="index-75">This multiplexing capability is probably the most important feature of HTTP/2.0 from a performance viewpoint. To understand its benefits, let us consider a client that retrieves two web objects over a 1 Mbps connection. The two requests are sent together by the client. The first object is 125 bytes long, while the second is 12500 bytes long. In this case, the server will first return the first object as a single frame and the second will be sent in the subsequent frame.</p>
<p>Consider now that the first object is 12500 bytes long and the second 125 bytes long as shown in <a class="reference internal" href="#fig-http-hol"><span class="std std-numref">Fig. 41</span></a>. With a 1 Mbps connection, this object will use the underlying connection during 100 milliseconds. The client will thus need to wait 100 milliseconds to retrieve the second object. This is the <cite>Head of Line</cite> (HoL) blocking problem that affects the performance of many web services. If the short web object is a javascript code that requests other web objects, its retrieval may be critical to display the retrieved web page.</p>
<div class="figure" id="id70" style="text-align: center">
<span id="fig-http-hol"/><p><img src="../Images/7fc784e24d2a3dd0171363ba394ef8ba.png" alt="Figure made with TikZ" data-original-src="https://4ed.computer-networking.info/syllabus/default/_images/tikz-7185aba6e91e748e3c4daf068076253fb73a87c6.png"/></p>
<p><span class="caption-number">Fig. 41 </span><span class="caption-text">Head-of-line blocking, a large response may deal a small one</span></p>
</div><p>With HTTP/2.0 frames, the server could send the first 1250 bytes of the long object during 10 milliseconds, then send a second frame that contains the short object during one millisecond and later send a longer frame that contains the remaining 11250 bytes of the long object. This is illustrated in <a class="reference internal" href="#fig-http2-no-hol"><span class="std std-numref">Fig. 42</span></a>. In this case, the client has received the short object after 10 milliseconds. Given the HTTP/2.0 streams, the transmission of long web objects does not anymore blocks the transmission of shorter ones.</p>
<p>The length of the HTTP/2.0 frames obviously affects how different web objects can be multiplexed over the underlying transport connection. If HTTP/2.0 frames are long, the overhead of the frame header is minimal, but long frames can block short web objects. On the other hand, if the frame length is small, then the overhead due to the HTTP/2.0 frame header could become significant.</p>
<div class="figure" id="id71" style="text-align: center">
<span id="fig-http2-no-hol"/><p><img src="../Images/8873fd6b2b8e1c27c72e08f4926f28fb.png" alt="Figure made with TikZ" data-original-src="https://4ed.computer-networking.info/syllabus/default/_images/tikz-3fc9d3e76128d78fbcabea984f4061d76c9729f1.png"/></p>
<p><span class="caption-number">Fig. 42 </span><span class="caption-text">The data from HTTP/2 frames can be interleaved to prevent head-of-line blocking</span></p>
</div><p>The HTTP/2.0 streams can provide performance benefits, but they also increase the complexity of the implementations since an HTTP/2.0 receiver must be able to simultaneously process frames that correspond to different web objects. This complexity mainly resides on the client side. The HTTP/2.0 protocol includes several techniques that enable clients to manage the utilization of the HTTP/2.0 session.</p>
<p>The first frame that a client sends over an HTTP/2.0 session is the <cite>Settings</cite> frame. This is a control frame that indicates some parameters that the client proposes for this session. Several of these parameters are defined in <span class="target" id="index-76"/><a class="rfc reference external" href="https://datatracker.ietf.org/doc/html/rfc7540.html"><strong>RFC 7540</strong></a>. The most important ones are probably the <cite>SETTINGS_MAX_FRAME_SIZE</cite> that specifies the maximum length of the HTTP/2.0 frames that this implementation supports and the <cite>SETTINGS_MAX_CONCURRENT_STREAMS</cite> that specifies the maximum number of parallel streams that this implementation can manage. The <cite>SETTINGS_MAX_FRAME_SIZE</cite> must be at least <span class="math notranslate nohighlight">\(2^{14}\)</span> bytes but can go up to <span class="math notranslate nohighlight">\(2^{24} -1\)</span> bytes. There is no minimum value for <cite>SETTINGS_MAX_CONCURRENT_STREAMS</cite>, but <span class="target" id="index-77"/><a class="rfc reference external" href="https://datatracker.ietf.org/doc/html/rfc7540.html"><strong>RFC 7540</strong></a> recommends to support at least 100 different stream identifiers.</p>
<p>By using multiple streams, the server can multiplex different web objects over the same underlying transport connection. However, these objects are only sent in response to requests from clients. There are some situations where the server might know in advance that the client will request a given object. It could speedup the transfer by sending it before having received a client request. This is the <cite>push</cite> feature of HTTP/2.0. A server can independently push web objects to a client without having received any request. This feature can only be used by the server if the client has enabled it by sending <cite>SETTINGS_ENABLE_PUSH</cite> in its <cite>Settings</cite> frame. A classical use case for this <cite>push</cite> feature is to enable a server to automatically send an object which cannot be cached by the client, such as a dynamic javascript code, when another web object that references it is requested. However, measurement studies indicate that very few web servers seem to have adopted this feature <a class="reference internal" href="../bibliography.html#zwh2018" id="id41"><span>[ZWH2018]</span></a>.</p>
<p>Another feature of HTTP/2.0 is that it is possible to assign different priorities to different streams. A high priority stream should carry more <cite>Data</cite> frames than a lower priority ones. The HTTP/2.0 specification defines <cite>Priority</cite> frames which can be used for this purpose.</p>
<p>As the server can send multiple objects at the same time, there is a risk of overloading the client buffers. To cope with this potential problem, HTTP/2.0 includes its own flow control mechanism. When an HTTP/2.0 session starts, a receiver agrees to receive up to 65,535 bytes over this connection (unless it has indicated a different initial window in its <cite>Settings</cite> frame). This limits the amount of data that a sender can transmit over the HTTP/2.0 session. The receiver can advertise a large receive window by sending a <cite>Window_Update</cite> frame at any time. This flow control mechanism can be applied to the entire connection or to a specific stream. In practice, using a small <cite>HTTP/2.0 window</cite> could severely limit the throughput over an HTTP/2.0 session.</p>
<p>HTTP/2.0 includes much more than what we have covered in this short introduction. There is for example a <cite>Ping</cite> frame that allows measuring the round-trip-time between a client and a server or the <cite>GoAway</cite> frame that indicates the termination of an HTTP/2.0 session. This frame contains an error code that indicates why the session has been terminated. Several error codes are defined in <span class="target" id="index-78"/><a class="rfc reference external" href="https://datatracker.ietf.org/doc/html/rfc7540.html"><strong>RFC 7540</strong></a>, including <cite>ENHANCE_YOUR_CALM</cite> that is used to indicate that the other endpoint exhibits an behavior that could cause excessive load.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Detecting whether a server supports HTTP/2.0</p>
<p>HTTP/2.0 is a new version of the HTTP protocol that still uses port 80. When a client contacts an HTTP server, it must be able to determine whether it supports HTTP/1.x or HTTP/2.0. If the client sends a binary encoded HTTP/2.0 request to a server that only supports the ASCII encoded HTTP/1.x, it could cause problems on the server and even crash it. To minimize the risk of crashing HTTP/1.x servers, an HTTP/2.0 session starts like an HTTP/1.1 session and the first request contains the <cite>Connection</cite>, <cite>Upgrade</cite> and <cite>HTTP2-Settings</cite> headers. An example of such a request to upgrade the version of HTTP is shown below.</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span/><span class="go">GET /robots.txt HTTP/1.1</span>
<span class="go">Host: nghttp2.org</span>
<span class="go">User-Agent: curl/7.52.1</span>
<span class="go">Connection: Upgrade, HTTP2-Settings</span>
<span class="go">Upgrade: h2c</span>
<span class="go">HTTP2-Settings: AAMAAABkAARAAAAA</span>
</pre></div>
</div>
<p>The <cite>HTTP2-Settings</cite> line contains the HTTP/2.0 settings frame that the client would server over an HTTP/2.0 session encoded in Base64. The server replies with a response that indicates that it has accepted to upgrade the connection to HTTP/2.0. A sample response is shown below.</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span/><span class="go">HTTP/1.1 101 Switching Protocols</span>
<span class="go">Connection: Upgrade</span>
<span class="go">Upgrade: h2c</span>
</pre></div>
</div>
<p>Finally, the client and the server need to confirm the utilization of HTTP/2.0. A client confirms this by sending the following Magic string <cite>PRI * HTTP/2.0rnrnSMrnrn</cite> or <cite>0x505249202a20485454502f322e300d0a0d0a534d0d0a0d0a</cite> in hex. This string is followed by a SETTINGS frame. The server must send a possibly empty SETTINGS frame.</p>
</div>
</section>
&#13;

<h3>The HyperText Transfer Protocol<a class="headerlink" href="#the-hypertext-transfer-protocol" title="Link to this heading">#</a></h3>
<p>The third component of the <cite>world wide web</cite> is the HyperText Transfer Protocol (HTTP). HTTP is a text-based protocol like SMTP. The client sends a request and the server returns a response. HTTP runs above the bytestream service and HTTP servers listen by default on port <cite>80</cite>. The design of HTTP has largely been inspired by the Internet email protocols. Each HTTP request contains three parts :</p>
<blockquote>
<div><ul class="simple">
<li><p>a <cite>method</cite>, that indicates the type of request, a URI, and the version of the HTTP protocol used by the client</p></li>
<li><p>a <cite>header</cite>, that is used by the client to specify optional parameters for the request. An empty line is used to mark the end of the header</p></li>
<li><p>an optional MIME document attached to the request</p></li>
</ul>
</div></blockquote>
<p>The response sent by the server also contains three parts :</p>
<blockquote>
<div><ul class="simple">
<li><p>a <cite>status line</cite> , that indicates whether the request was successful or not</p></li>
<li><p>a <cite>header</cite>, that contains additional information about the response. The response header ends with an empty line.</p></li>
<li><p>a MIME document</p></li>
</ul>
</div></blockquote>
<p>Figure <a class="reference internal" href="#fig-http-req-resp"><span class="std std-numref">Fig. 35</span></a> provides sample HTTP request and response.</p>
<blockquote>
<div><div class="figure" id="id64" style="text-align: center">
<span id="fig-http-req-resp"/><p><img src="../Images/64fd856539fab465e6b2fadde6a8bd15.png" alt="Figure made with TikZ" data-original-src="https://4ed.computer-networking.info/syllabus/default/_images/tikz-75f726be37c1860fd3d926a2afa1f9ab3d360f4d.png"/></p>
<p><span class="caption-number">Fig. 35 </span><span class="caption-text">HTTP requests and responses</span></p>
</div></div></blockquote>
<p>Several types of method can be used in HTTP requests. The three most important ones are :</p>
<blockquote>
<div><ul class="simple">
<li><p>the <cite>GET</cite> method is the most popular one. It is used to retrieve a document from a server. The <cite>GET</cite> method is encoded as <cite>GET</cite> followed by the path of the URI of the requested document and the version of HTTP used by the client. For example, to retrieve the <a class="reference external" href="http://www.w3.org/MarkUp/">http://www.w3.org/MarkUp/</a> URI, a client must open a TCP connection on port <cite>80</cite> with host <cite>www.w3.org</cite> and send a HTTP request containing the following line:</p></li>
</ul>
<div class="highlight-console notranslate"><div class="highlight"><pre><span/><span class="go">GET /MarkUp/ HTTP/1.0</span>
</pre></div>
</div>
<ul class="simple">
<li><p>the <cite>HEAD</cite> method is a variant of the <cite>GET</cite> method that allows the retrieval of the header lines for a given URI without retrieving the entire document. It can be used by a client to verify if a document exists, for instance.</p></li>
<li><p>the <cite>POST</cite> method can be used by a client to send a document to a server. The document is attached to the HTTP request as a MIME document.</p></li>
</ul>
</div></blockquote>
<p>HTTP clients and servers can include different HTTP headers in HTTP requests and responses. Each HTTP header is encoded as a single ASCII-line terminated by <cite>CR</cite> and <cite>LF</cite>. Several of these headers are briefly described below. A detailed discussion of the standard headers may be found in <span class="target" id="index-60"/><a class="rfc reference external" href="https://datatracker.ietf.org/doc/html/rfc1945.html"><strong>RFC 1945</strong></a>. The MIME headers can appear in both HTTP requests and HTTP responses.</p>
<blockquote>
<div><ul class="simple">
<li><p>the <cite>Content-Length:</cite> header is the <a class="reference internal" href="../glossary.html#term-MIME"><span class="xref std std-term">MIME</span></a> header that indicates the length of the MIME document in bytes.</p></li>
<li><p>the <cite>Content-Type:</cite> header is the <a class="reference internal" href="../glossary.html#term-MIME"><span class="xref std std-term">MIME</span></a> header that indicates the type of the attached MIME document. HTML pages use the <cite>text/html</cite> type.</p></li>
<li><p>the <cite>Content-Encoding:</cite> header indicates how the <a class="reference internal" href="../glossary.html#term-MIME-document"><span class="xref std std-term">MIME document</span></a> has been encoded. For example, this header would be set to <cite>x-gzip</cite> for a document compressed using the <a class="reference external" href="https://www.gzip.org">gzip</a> software.</p></li>
</ul>
</div></blockquote>
<p><span class="target" id="index-61"/><a class="rfc reference external" href="https://datatracker.ietf.org/doc/html/rfc1945.html"><strong>RFC 1945</strong></a> and <span class="target" id="index-62"/><a class="rfc reference external" href="https://datatracker.ietf.org/doc/html/rfc2616.html"><strong>RFC 2616</strong></a> define headers that are specific to HTTP responses. These server headers include:</p>
<blockquote>
<div><ul class="simple">
<li><p>the <cite>Server:</cite> header indicates the version of the web server that has generated the HTTP response. Some servers provide information about their software release and optional modules that they use. For security reasons, some system administrators disable these headers to avoid revealing too much information about their server to potential attackers.</p></li>
<li><p>the <cite>Date:</cite> header indicates when the HTTP response has been produced by the server.</p></li>
<li><p>the <cite>Last-Modified:</cite> header indicates the date and time of the last modification of the document attached to the HTTP response.</p></li>
</ul>
</div></blockquote>
<p>Similarly, the following header lines can only appear inside HTTP requests sent by a client:</p>
<blockquote>
<div><ul class="simple">
<li><p>the <cite>User-Agent:</cite> header provides information about the client that has generated the HTTP request. Some servers analyze this header line and return different headers and sometimes different documents for different user agents.</p></li>
<li><p>the <cite>If-Modified-Since:</cite> header is followed by a date. It enables clients to cache in memory or on disk recent or most frequently used documents. When a client needs to request a URI from a server, it first checks whether the document is already in its cache. If it is, the client sends an HTTP request with the <cite>If-Modified-Since:</cite> header indicating the date of the cached document. The server will only return the document attached to the HTTP response if it is newer than the version stored in the client’s cache.</p></li>
<li><p>the <cite>Referrer:</cite> header is followed by a URI. It indicates the URI of the document that the client visited before sending this HTTP request. Thanks to this header, the server can know the URI of the document containing the hyperlink followed by the client, if any. This information is very useful to measure the impact of advertisements containing hyperlinks placed on websites.</p></li>
<li><p>the <cite>Host:</cite> header contains the fully qualified domain name of the URI being requested.</p></li>
</ul>
</div></blockquote>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The importance of the <cite>Host:</cite> header line</p>
<p>The first version of HTTP did not include the <cite>Host:</cite> header line. This was a severe limitation for web hosting companies. For example consider a web hosting company that wants to serve both <cite>web.example.com</cite> and <cite>www.example.net</cite> on the same physical server. Both web sites contain a <cite>/index.html</cite> document. When a client sends a request for either <cite>http://web.example.com/index.html</cite> or <cite>http://www.example.net/index.html</cite>, the HTTP 1.0 request contains the following line :</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span/>GET /index.html HTTP/1.0
</pre></div>
</div>
<p>By parsing this line, a server cannot determine which <cite>index.html</cite> file is requested. Thanks to the <cite>Host:</cite> header line, the server knows whether the request is for <cite>http://web.example.com/index.html</cite> or <cite>http://www.dummy.net/index.html</cite>. Without the <cite>Host:</cite> header, this is impossible. The <cite>Host:</cite> header line allowed web hosting companies to develop their business by supporting a large number of independent web servers on the same physical server.</p>
</div>
<p>The status line of the HTTP response begins with the version of HTTP used by the server (usually <cite>HTTP/1.0</cite> defined in <span class="target" id="index-63"/><a class="rfc reference external" href="https://datatracker.ietf.org/doc/html/rfc1945.html"><strong>RFC 1945</strong></a> or <cite>HTTP/1.1</cite> defined in <span class="target" id="index-64"/><a class="rfc reference external" href="https://datatracker.ietf.org/doc/html/rfc2616.html"><strong>RFC 2616</strong></a>) followed by a three digit status code and additional information in English. HTTP status codes have a similar structure as the reply codes used by SMTP:</p>
<blockquote>
<div><ul class="simple">
<li><p>All status codes starting with digit <cite>2</cite> indicate a valid response. <cite>200 Ok</cite> indicates that the HTTP request was successfully processed by the server and that the response is valid.</p></li>
<li><p>All status codes starting with digit <cite>3</cite> indicate that the requested document is no longer available on the server. <cite>301 Moved Permanently</cite> indicates that the requested document is no longer available on this server. A <cite>Location:</cite> header containing the new URI of the requested document is inserted in the HTTP response. <cite>304 Not Modified</cite> is used in response to an HTTP request containing the <cite>If-Modified-Since:</cite> header. This status line is used by the server if the document stored on the server is not more recent than the date indicated in the <cite>If-Modified-Since:</cite> header.</p></li>
<li><p>All status codes starting with digit <cite>4</cite> indicate that the server has detected an error in the HTTP request sent by the client. <cite>400 Bad Request</cite> indicates a syntax error in the HTTP request. <cite>404 Not Found</cite> indicates that the requested document does not exist on the server.</p></li>
<li><p>All status codes starting with digit <cite>5</cite> indicate an error on the server. <cite>500 Internal Server Error</cite> indicates that the server could not process the request due to an error on the server itself.</p></li>
</ul>
</div></blockquote>
<p>In both HTTP requests and responses, the MIME document refers to a representation of the document with the MIME headers indicating the type of document and its size.</p>
<p>As an illustration of HTTP/1.0, the transcript below shows a HTTP request for <a class="reference external" href="http://www.ietf.org">http://www.ietf.org</a> and the corresponding HTTP response. The HTTP request was sent using the <a class="reference external" href="https://curl.haxx.se/">curl</a> command line tool. The <cite>User-Agent:</cite> header line contains more information about this client software. There is no MIME document attached to this HTTP request, and it ends with a blank line.</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span/>GET / HTTP/1.0
User-Agent: curl/7.19.4 (universal-apple-darwin10.0) libcurl/7.19.4 OpenSSL/0.9.8l zlib/1.2.3
Host: www.ietf.org
</pre></div>
</div>
<p>The HTTP response indicates the version of the server software used with the modules included. The <cite>Last-Modified:</cite> header indicates that the requested document was modified about one week before the request. A HTML document (not shown) is attached to the response. Note the blank line between the header of the HTTP response and the attached MIME document. The <cite>Server:</cite> header line has been truncated in this output.</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span/>HTTP/1.1 200 OK
Date: Mon, 15 Mar 2010 13:40:38 GMT
Server: Apache/2.2.4 (Linux/SUSE) mod_ssl/2.2.4 OpenSSL/0.9.8e (truncated)
Last-Modified: Tue, 09 Mar 2010 21:26:53 GMT
Content-Length: 17019
Content-Type: text/html

&lt;!DOCTYPE HTML PUBLIC .../HTML&gt;
</pre></div>
</div>
<p>HTTP was initially designed to share text documents. For this reason, and to ease the implementation of clients and servers, the designers of HTTP chose to open a TCP connection for each HTTP request. This implies that a client must open one TCP connection for each URI that it wants to retrieve from a server as illustrated on the figure below, showing HTTP 1.0 and the underlying TCP connection. For a web page containing only text documents this was a reasonable design choice as the client usually remains idle while the (human) user is reading the retrieved document.</p>
<p class="mscgen">
<img src="../Images/15f6359ba4c5a3cfe439a837a247edb5.png" alt="msc {&#10;a1 [label=&quot;&quot;, linecolour=white],&#10;a [label=&quot;&quot;, linecolour=white],&#10;b [label=&quot;Client&quot;, linecolour=black],&#10;z [label=&quot;&quot;, linecolour=white],&#10;c [label=&quot;Server&quot;, linecolour=black],&#10;d [label=&quot;&quot;, linecolour=white],&#10;d1 [label=&quot;&quot;, linecolour=white];&#10;&#10;a1=&gt;b [ label = &quot;CONNECT.request&quot; ] ,&#10;b&gt;&gt;c [ label = &quot;&quot;, arcskip=&quot;1&quot;];&#10;c=&gt;d1 [ label = &quot;CONNECT.indication&quot; ];&#10;&#10;d1=&gt;c [ label = &quot;CONNECT.response&quot; ] ,&#10;c&gt;&gt;b [ label = &quot;&quot;, arcskip=&quot;1&quot;];&#10;b=&gt;a1 [ label = &quot;CONNECT.confirm&quot; ];&#10;&#10;a1=&gt;b [ label = &quot;DATA.request(Request)&quot;, linecolour=red, textcolour=red],&#10;b&gt;&gt;c [ linecolour=red, arcskip=&quot;1&quot;];&#10;c==d1 [ label = &quot;DATA.indication(Request)&quot;, linecolour=red, textcolour=red];&#10;&#10;d1=&gt;c [ label = &quot;DATA.request(Response)&quot;, linecolour=blue, textcolour=blue] ,&#10;c&gt;&gt;b [ linecolour=blue, arcskip=&quot;1&quot;];&#10;b=&gt;a1 [ label = &quot;DATA.indication(Response)&quot;, linecolour=blue, textcolour=blue],&#10;d1=&gt;c [ label = &quot;DISCONNECT.request&quot;],&#10;c&gt;&gt;b [ arcskip=&quot;1&quot;];&#10;b=&gt;a1 [ label = &quot;DISCONNECT.indication&quot; ];&#10;&#10;a1=&gt;b [ label = &quot;DISCONNECT.request&quot; ] ,&#10;b&gt;&gt;c [ label = &quot;&quot;, arcskip=&quot;1&quot;];&#10;c=&gt;d1 [ label = &quot;DISCONNECT.indication&quot; ];&#10;}" usemap="#d49bedba389123d38d35a1fef746a30e5445ef03" data-original-src="https://4ed.computer-networking.info/syllabus/default/_images/mscgen-d49bedba389123d38d35a1fef746a30e5445ef03.png"/>
<map id="d49bedba389123d38d35a1fef746a30e5445ef03" name="d49bedba389123d38d35a1fef746a30e5445ef03"/></p>
<p>However, as the web evolved to support richer documents containing images, opening a TCP connection for each URI became a performance problem <a class="reference internal" href="../bibliography.html#mogul1995" id="id34"><span>[Mogul1995]</span></a>. Indeed, besides its HTML part, a web page may include dozens of images or more. Forcing the client to open a TCP connection for each component of a web page has two important drawbacks. First, the client and the server must exchange packets to open and close a TCP connection as we will see later. This increases the network overhead and the total delay of completely retrieving all the components of a web page. Second, a large number of established TCP connections may be a performance bottleneck on servers.</p>
<p>This problem was solved by extending HTTP to support persistent TCP connections <span class="target" id="index-65"/><a class="rfc reference external" href="https://datatracker.ietf.org/doc/html/rfc2616.html"><strong>RFC 2616</strong></a>. A persistent connection is a TCP connection over which a client may send several HTTP requests. This is illustrated in the figure below showing the persistent connection of HTTP 1.1.</p>
<p class="mscgen">
<img src="../Images/1dd234f6259caa842e7721e4f7b6857e.png" alt="msc {&#10;a1 [label=&quot;&quot;, linecolour=white],&#10;a [label=&quot;&quot;, linecolour=white],&#10;b [label=&quot;Client&quot;, linecolour=black],&#10;z [label=&quot;&quot;, linecolour=white],&#10;c [label=&quot;Server&quot;, linecolour=black],&#10;d [label=&quot;&quot;, linecolour=white],&#10;d1 [label=&quot;&quot;, linecolour=white];&#10;&#10;a1=&gt;b [ label = &quot;CONNECT.request&quot; ] ,&#10;b&gt;&gt;c [ label = &quot;&quot;, arcskip=&quot;1&quot;];&#10;c=&gt;d1 [ label = &quot;CONNECT.indication&quot; ];&#10;&#10;d1=&gt;c [ label = &quot;CONNECT.response&quot; ] ,&#10;c&gt;&gt;b [ label = &quot;&quot;, arcskip=&quot;1&quot;];&#10;b=&gt;a1 [ label = &quot;CONNECT.confirm&quot; ];&#10;&#10;a1=&gt;b [ label = &quot;&quot;, linecolour=red, textcolour=red],&#10;b&gt;&gt;c [ linecolour=red, arcskip=&quot;1&quot;];&#10;a1=&gt;b [ label = &quot;GET / HTTP1.1\nConnection: Keep-Alive\n...&quot;, linecolour=white, textcolour=red],&#10;c=&gt;d1 [ label = &quot;&quot;, linecolour=red, textcolour=red];&#10;&#10;d1=&gt;c [ label = &quot;&quot;, linecolour=blue, textcolour=blue] ,&#10;c&gt;&gt;b [ linecolour=blue, arcskip=&quot;1&quot;];&#10;d1=&gt;c [ label = &quot;HTTP/1.1 200 OK\nKeep-Alive: timeout=15, max=100\nConnection: Keep-Alive\n...&quot;, linecolour=white, textcolour=blue],&#10;b=&gt;a1 [ label = &quot;&quot;, linecolour=blue, textcolour=blue];&#10;&#10;a1=&gt;b [ label = &quot;&quot;, linecolour=red, textcolour=red],&#10;b&gt;&gt;c [ linecolour=red, arcskip=&quot;1&quot;];&#10;a1=&gt;b [ label = &quot;GET /images/logo.gif HTTP1.1\nConnection: Keep-Alive\n...&quot;, linecolour=white, textcolour=red],&#10;c=&gt;d1 [ label = &quot;&quot;, linecolour=red, textcolour=red];&#10;&#10;d1=&gt;c [ label = &quot;&quot;, linecolour=blue, textcolour=blue] ,&#10;c&gt;&gt;b [ linecolour=blue, arcskip=&quot;1&quot;];&#10;d1=&gt;c [ label = &quot;HTTP/1.1 200 OK\nKeep-Alive: timeout=15, max=99\nConnection: Keep-Alive\n...&quot;, linecolour=white, textcolour=blue],&#10;b=&gt;a1 [ label = &quot;&quot;, linecolour=blue, textcolour=blue];&#10;&#10;|||;&#10;d1=&gt;c [ label = &quot;DISCONNECT.request&quot;],&#10;c&gt;&gt;b [ arcskip=&quot;1&quot;];&#10;b=&gt;a1 [ label = &quot;DISCONNECT.indication&quot; ];&#10;&#10;&#10;a1=&gt;b [ label = &quot;DISCONNECT.request&quot; ] ,&#10;b&gt;&gt;c [ label = &quot;&quot;, arcskip=&quot;1&quot;];&#10;c=&gt;d1 [ label = &quot;DISCONNECT.indication&quot; ];&#10;}" usemap="#e3a7f46f483e3da6d68605217fa3410d14c6e31b" data-original-src="https://4ed.computer-networking.info/syllabus/default/_images/mscgen-e3a7f46f483e3da6d68605217fa3410d14c6e31b.png"/>
<map id="e3a7f46f483e3da6d68605217fa3410d14c6e31b" name="e3a7f46f483e3da6d68605217fa3410d14c6e31b"/></p>
<p>To allow the clients and servers to control the utilization of these persistent TCP connections, HTTP 1.1 <span class="target" id="index-66"/><a class="rfc reference external" href="https://datatracker.ietf.org/doc/html/rfc2616.html"><strong>RFC 2616</strong></a> defines several new HTTP headers:</p>
<blockquote>
<div><ul class="simple">
<li><p>The <cite>Connection:</cite> header is used with the <cite>Keep-Alive</cite> argument by the client to indicate that it expects the underlying TCP connection to be persistent. When this header is used with the <cite>Close</cite> argument, it indicates that the entity that sent it will close the underlying TCP connection at the end of the HTTP response.</p></li>
<li><p>The <cite>Keep-Alive:</cite> header is used by the server to inform the client about how it agrees to use the persistent connection. A typical <cite>Keep-Alive:</cite> contains two parameters: the maximum number of requests that the server agrees to serve on the underlying TCP connection and the timeout (in seconds) after which the server will close an idle connection</p></li>
</ul>
</div></blockquote>
<p>The example below shows the operation of HTTP/1.1 over a persistent TCP connection to retrieve three URIs stored on the same server. Once the connection has been established, the client sends its first request with the <cite>Connection: Keep-Alive</cite> header to request a persistent connection.</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span/>GET / HTTP/1.1
Host: www.kame.net
User-Agent: Mozilla/5.0 (Macintosh; U; Intel Mac OS X 10_6_2; en-us)
Connection: Keep-Alive
</pre></div>
</div>
<p>The server replies with the <cite>Connection: Keep-Alive</cite> header and indicates that it accepts a maximum of 100 HTTP requests over this connection and that it will close the connection if it remains idle for 15 seconds.</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span/>HTTP/1.1 200 OK
Date: Fri, 19 Mar 2010 09:23:37 GMT
Server: Apache/2.0.63 (FreeBSD) PHP/5.2.12 with Suhosin-Patch
Keep-Alive: timeout=15, max=100
Connection: Keep-Alive
Content-Length: 3462
Content-Type: text/html

&lt;html&gt;...   &lt;/html&gt;
</pre></div>
</div>
<p>The client sends a second request for the style sheet of the retrieved web page.</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span/>GET /style.css HTTP/1.1
Host: www.kame.net
Referer: http://www.kame.net/
User-Agent: Mozilla/5.0 (Macintosh; U; Intel Mac OS X 10_6_2; en-us)
Connection: keep-alive
</pre></div>
</div>
<p>The server replies with the requested style sheet and maintains the persistent connection. Note that the server only accepts 99 remaining HTTP requests over this persistent connection.</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span/>HTTP/1.1 200 OK
Date: Fri, 19 Mar 2010 09:23:37 GMT
Server: Apache/2.0.63 (FreeBSD) PHP/5.2.12 with Suhosin-Patch
Last-Modified: Mon, 10 Apr 2006 05:06:39 GMT
Content-Length: 2235
Keep-Alive: timeout=15, max=99
Connection: Keep-Alive
Content-Type: text/css

...
</pre></div>
</div>
<p>Then the client requested the web server’s icon <a class="footnote-reference brackets" href="#ffavicon" id="id35" role="doc-noteref"><span class="fn-bracket">[</span>18<span class="fn-bracket">]</span></a>. This server does not contain such an icon and thus replies with a <cite>404</cite> HTTP status. However, the underlying TCP connection is not closed immediately.</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span/>GET /favicon.ico HTTP/1.1
Host: www.kame.net
Referer: http://www.kame.net/
User-Agent: Mozilla/5.0 (Macintosh; U; Intel Mac OS X 10_6_2; en-us)
Connection: keep-alive

HTTP/1.1 404 Not Found
Date: Fri, 19 Mar 2010 09:23:40 GMT
Server: Apache/2.0.63 (FreeBSD) PHP/5.2.12 with Suhosin-Patch
Content-Length: 318
Keep-Alive: timeout=15, max=98
Connection: Keep-Alive
Content-Type: text/html; charset=iso-8859-1

&lt;!DOCTYPE HTML PUBLIC "-//IETF//DTD HTML 2.0//EN"&gt; ...
</pre></div>
</div>
<p>As illustrated above, a client can send several HTTP requests over the same persistent TCP connection. However, it is important to note that all of these HTTP requests are considered to be independent by the server. Each HTTP request must be self-contained. This implies that each request must include all the header lines that are required by the server to understand the request. The independence of these requests is one of the key design choices of HTTP. As a consequence of this design choice, when a server processes a HTTP request, it does not use any other information than what is contained in the request itself. This explains why the client adds its <cite>User-Agent:</cite> header in all of the HTTP requests that it sends over the persistent TCP connection.</p>
<p>However, in practice, some servers want to provide content tuned for each user. For example, some servers can provide information in several languages. Other servers want to provide advertisements that are targeted to different types of users. To do this, servers need to maintain some information about the preferences of each user and use this information to produce content matching the user’s preferences. HTTP contains several mechanisms to solve this problem. We discuss three of them below.</p>
<p>A first solution is to force the users to be authenticated. This was the solution used by <cite>FTP</cite> to control the files that each user could access. Initially, user names and passwords could be included inside URIs <span class="target" id="index-67"/><a class="rfc reference external" href="https://datatracker.ietf.org/doc/html/rfc1738.html"><strong>RFC 1738</strong></a>. However, placing passwords in the clear in a potentially publicly visible URI is completely insecure and this usage has now been deprecated <span class="target" id="index-68"/><a class="rfc reference external" href="https://datatracker.ietf.org/doc/html/rfc3986.html"><strong>RFC 3986</strong></a>. HTTP supports several extension headers <span class="target" id="index-69"/><a class="rfc reference external" href="https://datatracker.ietf.org/doc/html/rfc2617.html"><strong>RFC 2617</strong></a> that can be used by a server to request the authentication of the client by providing his/her credentials. However, user names and passwords have not been popular on web servers as they force human users to remember one user name and one password per server. Remembering a password is acceptable when a user needs to access protected content, but users will not accept to remember a unique user name and password for each web sites that they visit.</p>
<p>A second solution to allow servers to tune that content to the needs and capabilities of the user is to rely on the different types of <cite>Accept-*</cite> HTTP headers. For example, the <cite>Accept-Language:</cite> header can be used by the client to indicate its preferred languages. Unfortunately, in practice this header is usually set based on the default language of the browser and it is difficult for a user to indicate the language it prefers by selecting options for each visited web server.</p>
<p>The third and widely adopted solution are HTTP cookies. HTTP cookies were initially developed as a private extension by <a class="reference external" href="https://en.wikipedia.org/wiki/Netscape">Netscape</a>. They are now part of the standard <span class="target" id="index-70"/><a class="rfc reference external" href="https://datatracker.ietf.org/doc/html/rfc6265.html"><strong>RFC 6265</strong></a>. In a nutshell, a cookie is a short string that is chosen by a server to represent a given client. Two HTTP headers are used : <cite>Cookie:</cite> and <cite>Set-Cookie:</cite>. When a server receives an HTTP request from a new client (i.e. an HTTP request that does not contain the <cite>Cookie:</cite> header), it generates a cookie for the client and includes it in the <cite>Set-Cookie:</cite> header of the returned HTTP response. The <cite>Set-Cookie:</cite> header contains several additional parameters including the domain names for which the cookie is valid. The client stores all received cookies on disk and every time it sends an HTTP request, it verifies whether it already knows a cookie for this domain. If so, it attaches the <cite>Cookie:</cite> header to the HTTP request. This is illustrated in the figure below with HTTP 1.1, but cookies also work with HTTP 1.0.</p>
<p class="mscgen">
<img src="../Images/46342147d4ef4a386569e9a3c497ba69.png" alt="msc {&#10;a1 [label=&quot;&quot;, linecolour=white],&#10;a [label=&quot;&quot;, linecolour=white],&#10;b [label=&quot;Client&quot;, linecolour=black],&#10;z [label=&quot;&quot;, linecolour=white],&#10;c [label=&quot;Server&quot;, linecolour=black],&#10;d [label=&quot;&quot;, linecolour=white],&#10;d1 [label=&quot;&quot;, linecolour=white];&#10;&#10;a1=&gt;b [ label = &quot;&quot;, linecolour=red, textcolour=red],&#10;b&gt;&gt;c [ linecolour=red, arcskip=&quot;1&quot;];&#10;a1=&gt;b [ label = &quot;GET / HTTP1.1\n...&quot;, linecolour=white, textcolour=red],&#10;c=&gt;d1 [ label = &quot;&quot;, linecolour=red, textcolour=red];&#10;&#10;d1=&gt;c [ label = &quot;&quot;, linecolour=blue, textcolour=blue] ,&#10;c&gt;&gt;b [ linecolour=blue, arcskip=&quot;1&quot;];&#10;d1=&gt;c [ label = &quot;HTTP/1.1 200 OK\nSet-Cookie: machin\n...&quot;, linecolour=white, textcolour=blue],&#10;b=&gt;a1 [ label = &quot;&quot;, linecolour=blue, textcolour=blue];&#10;a1=&gt;b [ label = &quot;Browser saves cookie&quot;, linecolour=white],&#10;c=&gt;d1 [ label = &quot;Normal response&quot;, linecolour=white];&#10;&#10;a1=&gt;b [ label = &quot;&quot;, linecolour=red, textcolour=red],&#10;b&gt;&gt;c [ linecolour=red, arcskip=&quot;1&quot;];&#10;a1=&gt;b [ label = &quot;GET /doc HTTP1.1\nCookie: machin\n...&quot;, linecolour=white, textcolour=red],&#10;c=&gt;d1 [ label = &quot;&quot;, linecolour=red, textcolour=red];&#10;&#10;d1=&gt;c [ label = &quot;&quot;, linecolour=blue, textcolour=blue] ,&#10;c&gt;&gt;b [ linecolour=blue, arcskip=&quot;1&quot;];&#10;d1=&gt;c [ label = &quot;HTTP/1.1 200 OK\n...&quot;, linecolour=white, textcolour=blue],&#10;b=&gt;a1 [ label = &quot;&quot;, linecolour=blue, textcolour=blue];&#10;c=&gt;d1 [ label = &quot;Response is function\nof URL and cookie&quot;, linecolour=white];&#10;&#10;a1=&gt;b [ label = &quot;&quot;, linecolour=red, textcolour=red],&#10;b&gt;&gt;c [ linecolour=red, arcskip=&quot;1&quot;];&#10;a1=&gt;b [ label = &quot;GET /images/t.gif HTTP1.1\nCookie: machin\n...&quot;, linecolour=white, textcolour=red],&#10;c=&gt;d1 [ label = &quot;&quot;, linecolour=red, textcolour=red];&#10;&#10;d1=&gt;c [ label = &quot;&quot;, linecolour=blue, textcolour=blue] ,&#10;c&gt;&gt;b [ linecolour=blue, arcskip=&quot;1&quot;];&#10;d1=&gt;c [ label = &quot;HTTP/1.1 200 OK\n...&quot;, linecolour=white, textcolour=blue],&#10;b=&gt;a1 [ label = &quot;&quot;, linecolour=blue, textcolour=blue];&#10;a1=&gt;b [ label = &quot;Browser sends cookie in\nall requests sent to server&quot;, linecolour=white];&#10;}" usemap="#577adf721a7a6a7a5af9beec3659eccef6881630" data-original-src="https://4ed.computer-networking.info/syllabus/default/_images/mscgen-577adf721a7a6a7a5af9beec3659eccef6881630.png"/>
<map id="577adf721a7a6a7a5af9beec3659eccef6881630" name="577adf721a7a6a7a5af9beec3659eccef6881630"/></p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Privacy issues with HTTP cookies</p>
<p>The HTTP cookies introduced by <a class="reference external" href="https://en.wikipedia.org/wiki/Netscape">Netscape</a> are key for large e-commerce websites. However, they have also raised many discussions concerning their <a class="reference external" href="http://www.nytimes.com/2001/09/04/technology/04COOK.html">potential misuses</a>. Consider <cite>ad.com</cite>, a company that delivers lots of advertisements on web sites. A web site that wishes to include <cite>ad.com</cite>’s advertisements next to its content will add links to <cite>ad.com</cite> inside its HTML pages. If <cite>ad.com</cite> is used by many web sites, <cite>ad.com</cite> could be able to track the interests of all the users that visit its client websites and use this information to provide targeted advertisements. Privacy advocates have even <a class="reference external" href="http://epic.org/privacy/internet/cookies/">sued</a> online advertisement companies to force them to comply with the privacy regulations. More recent related technologies also raise <a class="reference external" href="http://www.eff.org/deeplinks/2009/09/new-cookie-technologies-harder-see-and-remove-wide">privacy concerns</a>.</p>
</div>
&#13;

<span id="http2"/><h3>HTTP version 2.0<a class="headerlink" href="#http-version-2-0" title="Link to this heading">#</a></h3>
<p>During the last decade, a growing number of services have been supported by world wide web servers. The web protocols are not only used to deliver static documents, they are also used to deliver streaming music or video. They also enable clients to use interactive applications including games or productivity applications. These services and applications have more stringent performance requirements than the delivery of static documents. Many researchers and companies have proposed solutions to improve the performance of web services and protocols during the last decade <a class="reference internal" href="../bibliography.html#kr2001" id="id36"><span>[KR2001]</span></a> <a class="reference internal" href="../bibliography.html#wbk2014" id="id37"><span>[WBK2014]</span></a>. We discuss a subset of them in this section.</p>
<p>A first way to improve the performance of the web protocols is to tune the servers that provide content. In the early days, documents were stored on a single server. Clients established TCP connections to this server to retrieve each document. This architecture evolved in several directions. A first way to speedup web services is to avoid unnecessary transmissions. Thanks to the <cite>HEAD</cite> method and the <cite>If-Modified-Since:</cite> header, web browsers can verify that they have the most recent version of a document in their cache.</p>
<blockquote>
<div><div class="figure" id="id65" style="text-align: center">
<span id="fig-web-proxy"/><p><img src="../Images/e9483f4f858b0589cf3d76890882a4d6.png" alt="Figure made with TikZ" data-original-src="https://4ed.computer-networking.info/syllabus/default/_images/tikz-05c525754f05b235f3df09dac26b1026a2609c06.png"/></p>
<p><span class="caption-number">Fig. 36 </span><span class="caption-text">Proxies relay client requests to servers and return the received responses</span></p>
</div></div></blockquote>
<p>Caches can also be used inside the network. To understand their benefits, let us consider an SME with a dozen of employees that are connected to the Internet through a low-speed link. These employees often access similar web sites. Consider that Alice and Bob want to browse today’s local newspaper. Their browsers will both retrieve the newspaper’s website through the low bandwidth link and store the main documents in their cache. Unfortunately, the same information passes twice over the low-speed link. Some companies have deployed web proxies to cope with this problem. A web proxy is a server that resides in the enterprise network. All the employee’s browsers are configured to send their HTTP requests to this proxy. When such a proxy receives a request, it checks whether the content is already stored inside its own cache. If so, it returns it directly. Otherwise, the request is sent to the remote server and the information is stored in the proxy cache. By reducing the number of web objects that are exchanged over low-speed links, such proxies can significantly improve performance. Some companies also use them to control the websites that are contacted by their employees and sometimes block illegitimate accesses.</p>
<p>Proxies can also be located in front of servers. In this case, they are called reverse-proxies. Consider a dynamic web server that produces web pages by assembling information stored in different databases. When this server receives a request, it must send multiple queries to its databases and then create the HTML document. These queries and the creation of the HTML document take time and this limits the number of requests that our server can sustain. Many content providers would place a reverse proxy in front of such a server. The DNS servers are configured to point to the reverse proxy. Upon reception of a request, the reverse proxy first checks whether the response is already stored in its cache. If so, it can return it to the client without interacting with the official server. Otherwise, the reverse proxy contacts the server and then returns the response to the client.</p>
<p>These reverse proxies can also be used to spread the load among different servers. In the above example, consider that a server needs 10 milliseconds to process each request and that it must handle them sequentially. Such a server cannot support more than 100 requests per second. If the service becomes popular, then the content provider will need to deploy several servers. These servers could serve the same reverse proxy.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Serving content from multiple servers</p>
<p>When a web user interacts with <cite>www.service.net</cite>, she expects that all the information comes from the <cite>www.service.net</cite> server. If the service is popular, there are probably tens, hundreds, thousands or more physical servers that support this service. Still, the user has the illusion that she is interacting with a single server. Several techniques have been deployed by content providers to scale web services. Consider a simple service that serves text documents from <cite>N</cite> different servers. There are different ways to architect such a service.</p>
<p>A first approach is to store all files on each physical server and rely on the DNS to distribute the load among them. Each physical server has its own IP address and when the DNS server receives a query for <cite>www.service.net</cite>, it returns the IP address of one of them. Some DNS servers use Round-Robin to return one of these IP addresses. Others measure the load of the physical servers and return the address of the less loaded one. Another possibility is to locate the physical servers in different regions and configure the DNS server to return the IP address of the server that is geographically closer to the client’s IP address.</p>
<p>A second approach is to rely on <cite>k</cite> reverse proxies and <cite>N-k</cite> servers. The servers store the content and the proxies cache the most frequently used files. The proxies can be geographically close to the clients while the servers can reside in the datacenters of the content provider. The DNS server can also distribute the load among the different proxies or return the geographically closest proxy. An important point to note about reverse proxies is that they receive HTTP requests from clients and send HTTP requests to the original servers that host the content. Several companies, usually called Content Distribution Networks, have deployed such reverse proxies throughout the world to cache web content next to the end-users. A good description of such a CDN may be found in <a class="reference internal" href="../bibliography.html#nss2010" id="id38"><span>[NSS2010]</span></a>.</p>
</div>
<p>A second way to improve the web performance is to reduce the time required to retrieve web objects. While the first web servers returned an HTML documents with possibly a few images, today’s rich web servers return one HTML document with associated style sheets, javascript code, images, fonts, … Some of these web objects come from the original server while others are hosted on different servers. Today, a typical web page contains almost 2 MBytes of data on average. The size of the web pages continues to grow according to statistics collected by <cite>httparchive.org</cite> as shown in <a class="reference internal" href="#fig-httparchive"><span class="std std-numref">Fig. 37</span></a>. Web pages targeted to mobile devices are slightly smaller.</p>
<figure class="align-center" id="id66">
<span id="fig-httparchive"/><a class="reference internal image-reference" href="../_images/httparchive-bytes.png"><img alt="../_images/httparchive-bytes.png" src="../Images/e512429b911bc1ff17df73d156e86ce1.png" style="width: 720.0px; height: 480.0px;" data-original-src="https://4ed.computer-networking.info/syllabus/default/_images/httparchive-bytes.png"/>
</a>
<figcaption>
<p><span class="caption-number">Fig. 37 </span><span class="caption-text">Evolution of the size of the web pages (source: <a class="reference external" href="https://httparchive.org/reports/page-weight">https://httparchive.org/reports/page-weight</a>)</span><a class="headerlink" href="#id66" title="Link to this image">#</a></p>
</figcaption>
</figure>
<p>A closer look at the average web page shows that it contains, on average, 27 KBytes of HTML, 120 KBytes of fonts, 60 KBytes of CSS information, almost 1 MBytes of images and more than 400 KBytes of javascript.  Each of these web page requires about 70 different HTTP requests. In other words, a browser needs to send on average 70 requests to retrieve a complete web page.</p>
<p>Two directions have been explored to improve the delivery of these web pages. The first direction is to tune the HTTP protocol. The second approach is to change the entire network stack. This approach is discussed in the QUIC chapter.</p>
<p>One of the limitations of HTTP from a performance viewpoint is that the requests that are sent by a browser must be sequential. Typically, a browser requests the HTML page. Once the page has been retrieved, the browser parses it to identify all the objects that it references and requests them one after each other. The web page can only be displayed to the user once all the required web objects have been retrieved. This implies that the browser must wait until the reception of each response before sending the next request. Another possibility is to allow the browser to send multiple requests without waiting for their corresponding responses. This approach is called <cite>pipelining</cite> in <span class="target" id="index-71"/><a class="rfc reference external" href="https://datatracker.ietf.org/doc/html/rfc7230.html"><strong>RFC 7230</strong></a>.</p>
<p>To understand the benefits of pipelining, let us consider a simple but illustrative example. A client needs to retrieve 5 web objects that are each 100 bytes. The underlying transport connection has a 1 Gbps bandwidth but a one-way delay of 100 msec. A normal HTTP/1.x client would send the first request, wait 200 msec to receive the answer, then send another request… It would need one entire second to retrieve the five web objects. This is illustrated in <a class="reference internal" href="#fig-http-nopipelining"><span class="std std-numref">Fig. 38</span></a>.</p>
<div class="figure" id="id67" style="text-align: center">
<span id="fig-http-nopipelining"/><p><img src="../Images/902ce8ac285bbf69a2f6e825e8e51419.png" alt="Figure made with TikZ" data-original-src="https://4ed.computer-networking.info/syllabus/default/_images/tikz-ca125cad3bdce90b39b9ded24ca279bf4ba28bf6.png"/></p>
<p><span class="caption-number">Fig. 38 </span><span class="caption-text">A sequence of HTTP requests to a given server</span></p>
</div><p>With <cite>pipelining</cite>, the client sends the five requests immediately and receives the five responses after 200 msec. <a class="reference internal" href="#fig-http-pipelining"><span class="std std-numref">Fig. 39</span></a> illustrates the benefits of <cite>pipelining</cite>.</p>
<div class="figure" id="id68" style="text-align: center">
<span id="fig-http-pipelining"/><p><img src="../Images/d0394b043492534d50c59a67578ea778.png" alt="Figure made with TikZ" data-original-src="https://4ed.computer-networking.info/syllabus/default/_images/tikz-b3813db3df8e3cc996d74f94fe7f87616d863710.png"/></p>
<p><span class="caption-number">Fig. 39 </span><span class="caption-text">A sequence of HTTP requests to a server with pipelining</span></p>
</div><p>However, as explained in <span class="target" id="index-72"/><a class="rfc reference external" href="https://datatracker.ietf.org/doc/html/rfc7230.html"><strong>RFC 7230</strong></a>, there is one important limitation to <cite>pipelining</cite>. It can only be used to serve HTTP requests that are idempotent, i.e. none of the requests must depend on any of the previous requests in the pipeline. It turned out that it was difficult for web browsers to correctly support this requirement and very few of them have implemented <cite>pipelining</cite> <a class="footnote-reference brackets" href="#fpipelining" id="id39" role="doc-noteref"><span class="fn-bracket">[</span>19<span class="fn-bracket">]</span></a>.</p>
<p>Another limitation of HTTP/1.1 is that all commands and parameters are encoded as ASCII strings. Using ASCII strings makes it easy to write simple clients or debug problems by observing packets. Unfortunately, the burden is placed on servers that need to include complex parsers that accept a wide range of partially compliant implementations. Furthermore, the flexibility of the ASCII encoding has enabled some classes of security attacks on servers <a class="reference internal" href="../bibliography.html#cwe444" id="id40"><span>[CWE444]</span></a>.</p>
<p>To cope with these two problems, the IETF HTTP working group developed version 2.0 of HTTP. HTTP/2.0 diverges from HTTP/1.1 in two important ways. First, HTTP/2.0 relies on binary encoding which is both more compact and easier to parse. Second, HTTP/2.0 supports multiple streams, which makes it possible to simultaneously transfer different web objects over a single transport connection. Furthermore, HTTP/2.0 also compresses the HTTP headers to reduce the amount of data transferred. This technique is described in <span class="target" id="index-73"/><a class="rfc reference external" href="https://datatracker.ietf.org/doc/html/rfc7541.html"><strong>RFC 7541</strong></a> but is not discussed in this chapter.</p>
<p>Let us first examine how HTTP/2.0 structures the bytestream of the underlying connection.</p>
<figure class="align-center" id="id69">
<span id="fig-http2-frame"/><a class="reference internal image-reference" href="../_images/http2-frame.svg"><img alt="../_images/http2-frame.svg" src="../Images/70ec7c103b170dfdecf10fd670dc9b85.png" style="width: 579.0px; height: 144.0px;" data-original-src="https://4ed.computer-networking.info/syllabus/default/_images/http2-frame.svg"/>
</a>
<figcaption>
<p><span class="caption-number">Fig. 40 </span><span class="caption-text">The HTTP/2.0 Frame header</span><a class="headerlink" href="#id69" title="Link to this image">#</a></p>
</figcaption>
</figure>
<p>The information exchanged over an HTTP/2.0 session is composed of frames. A frame starts with a 9 bytes-long header that carries several types of information as shown in <a class="reference internal" href="#fig-http2-frame"><span class="std std-numref">Fig. 40</span></a>. The HTTP/2.0 frames have a variable length. The <cite>Length</cite> field of the header contains the length of the frame payload in bytes. As this field is encoded as a 24 bits field, an HTTP/2.0 frame cannot be longer than <span class="math notranslate nohighlight">\(2^{24} -1\)</span> bytes. It should be noted that <span class="target" id="index-74"/><a class="rfc reference external" href="https://datatracker.ietf.org/doc/html/rfc7540.html"><strong>RFC 7540</strong></a> assumes a maximum size of <span class="math notranslate nohighlight">\(2^{14}\)</span> bytes, i.e. 16,384 bytes for the HTTP/2.0 frame payload unless a longer maximum frame length has been negotiated at the beginning of the session using the HTTP/2.0 <cite>Settings</cite> frame that will be described later. The next field of the frames header indicates the frame type. The first frame types are <cite>Data</cite> which contains data from web objects and <cite>Headers</cite> containing HTTP/2.0 headers. When a client retrieves a web object from a server, it always receives an HTTP/2.0 <cite>Headers</cite> frame followed by an HTTP/2.0 <cite>Data</cite> frame. The <cite>Headers</cite> frame information contains essentially the same HTTP headers as the ones supported by HTTP/1.1, but those are encoded by leveraging a data compression technique that minimizes the number of bytes required to transmit them.</p>
<p>Other frame types are described later. The <cite>Flags</cite> are used for some frame types and the <cite>R</cite> bit must be set to zero. The last important field of the <cite>HTTP/2.0 Frame</cite> header is the <cite>Stream Identifier</cite>. With HTTP/2.0, the bytestream of the underlying transport connection is divided in independent streams that are identified by an integer. The odd (resp. even) stream identifiers are managed by the client (resp. server). This enables the server (or the client) to multiplex data corresponding to different frames over a single bytestream.</p>
<p id="index-75">This multiplexing capability is probably the most important feature of HTTP/2.0 from a performance viewpoint. To understand its benefits, let us consider a client that retrieves two web objects over a 1 Mbps connection. The two requests are sent together by the client. The first object is 125 bytes long, while the second is 12500 bytes long. In this case, the server will first return the first object as a single frame and the second will be sent in the subsequent frame.</p>
<p>Consider now that the first object is 12500 bytes long and the second 125 bytes long as shown in <a class="reference internal" href="#fig-http-hol"><span class="std std-numref">Fig. 41</span></a>. With a 1 Mbps connection, this object will use the underlying connection during 100 milliseconds. The client will thus need to wait 100 milliseconds to retrieve the second object. This is the <cite>Head of Line</cite> (HoL) blocking problem that affects the performance of many web services. If the short web object is a javascript code that requests other web objects, its retrieval may be critical to display the retrieved web page.</p>
<div class="figure" id="id70" style="text-align: center">
<span id="fig-http-hol"/><p><img src="../Images/7fc784e24d2a3dd0171363ba394ef8ba.png" alt="Figure made with TikZ" data-original-src="https://4ed.computer-networking.info/syllabus/default/_images/tikz-7185aba6e91e748e3c4daf068076253fb73a87c6.png"/></p>
<p><span class="caption-number">Fig. 41 </span><span class="caption-text">Head-of-line blocking, a large response may deal a small one</span></p>
</div><p>With HTTP/2.0 frames, the server could send the first 1250 bytes of the long object during 10 milliseconds, then send a second frame that contains the short object during one millisecond and later send a longer frame that contains the remaining 11250 bytes of the long object. This is illustrated in <a class="reference internal" href="#fig-http2-no-hol"><span class="std std-numref">Fig. 42</span></a>. In this case, the client has received the short object after 10 milliseconds. Given the HTTP/2.0 streams, the transmission of long web objects does not anymore blocks the transmission of shorter ones.</p>
<p>The length of the HTTP/2.0 frames obviously affects how different web objects can be multiplexed over the underlying transport connection. If HTTP/2.0 frames are long, the overhead of the frame header is minimal, but long frames can block short web objects. On the other hand, if the frame length is small, then the overhead due to the HTTP/2.0 frame header could become significant.</p>
<div class="figure" id="id71" style="text-align: center">
<span id="fig-http2-no-hol"/><p><img src="../Images/8873fd6b2b8e1c27c72e08f4926f28fb.png" alt="Figure made with TikZ" data-original-src="https://4ed.computer-networking.info/syllabus/default/_images/tikz-3fc9d3e76128d78fbcabea984f4061d76c9729f1.png"/></p>
<p><span class="caption-number">Fig. 42 </span><span class="caption-text">The data from HTTP/2 frames can be interleaved to prevent head-of-line blocking</span></p>
</div><p>The HTTP/2.0 streams can provide performance benefits, but they also increase the complexity of the implementations since an HTTP/2.0 receiver must be able to simultaneously process frames that correspond to different web objects. This complexity mainly resides on the client side. The HTTP/2.0 protocol includes several techniques that enable clients to manage the utilization of the HTTP/2.0 session.</p>
<p>The first frame that a client sends over an HTTP/2.0 session is the <cite>Settings</cite> frame. This is a control frame that indicates some parameters that the client proposes for this session. Several of these parameters are defined in <span class="target" id="index-76"/><a class="rfc reference external" href="https://datatracker.ietf.org/doc/html/rfc7540.html"><strong>RFC 7540</strong></a>. The most important ones are probably the <cite>SETTINGS_MAX_FRAME_SIZE</cite> that specifies the maximum length of the HTTP/2.0 frames that this implementation supports and the <cite>SETTINGS_MAX_CONCURRENT_STREAMS</cite> that specifies the maximum number of parallel streams that this implementation can manage. The <cite>SETTINGS_MAX_FRAME_SIZE</cite> must be at least <span class="math notranslate nohighlight">\(2^{14}\)</span> bytes but can go up to <span class="math notranslate nohighlight">\(2^{24} -1\)</span> bytes. There is no minimum value for <cite>SETTINGS_MAX_CONCURRENT_STREAMS</cite>, but <span class="target" id="index-77"/><a class="rfc reference external" href="https://datatracker.ietf.org/doc/html/rfc7540.html"><strong>RFC 7540</strong></a> recommends to support at least 100 different stream identifiers.</p>
<p>By using multiple streams, the server can multiplex different web objects over the same underlying transport connection. However, these objects are only sent in response to requests from clients. There are some situations where the server might know in advance that the client will request a given object. It could speedup the transfer by sending it before having received a client request. This is the <cite>push</cite> feature of HTTP/2.0. A server can independently push web objects to a client without having received any request. This feature can only be used by the server if the client has enabled it by sending <cite>SETTINGS_ENABLE_PUSH</cite> in its <cite>Settings</cite> frame. A classical use case for this <cite>push</cite> feature is to enable a server to automatically send an object which cannot be cached by the client, such as a dynamic javascript code, when another web object that references it is requested. However, measurement studies indicate that very few web servers seem to have adopted this feature <a class="reference internal" href="../bibliography.html#zwh2018" id="id41"><span>[ZWH2018]</span></a>.</p>
<p>Another feature of HTTP/2.0 is that it is possible to assign different priorities to different streams. A high priority stream should carry more <cite>Data</cite> frames than a lower priority ones. The HTTP/2.0 specification defines <cite>Priority</cite> frames which can be used for this purpose.</p>
<p>As the server can send multiple objects at the same time, there is a risk of overloading the client buffers. To cope with this potential problem, HTTP/2.0 includes its own flow control mechanism. When an HTTP/2.0 session starts, a receiver agrees to receive up to 65,535 bytes over this connection (unless it has indicated a different initial window in its <cite>Settings</cite> frame). This limits the amount of data that a sender can transmit over the HTTP/2.0 session. The receiver can advertise a large receive window by sending a <cite>Window_Update</cite> frame at any time. This flow control mechanism can be applied to the entire connection or to a specific stream. In practice, using a small <cite>HTTP/2.0 window</cite> could severely limit the throughput over an HTTP/2.0 session.</p>
<p>HTTP/2.0 includes much more than what we have covered in this short introduction. There is for example a <cite>Ping</cite> frame that allows measuring the round-trip-time between a client and a server or the <cite>GoAway</cite> frame that indicates the termination of an HTTP/2.0 session. This frame contains an error code that indicates why the session has been terminated. Several error codes are defined in <span class="target" id="index-78"/><a class="rfc reference external" href="https://datatracker.ietf.org/doc/html/rfc7540.html"><strong>RFC 7540</strong></a>, including <cite>ENHANCE_YOUR_CALM</cite> that is used to indicate that the other endpoint exhibits an behavior that could cause excessive load.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Detecting whether a server supports HTTP/2.0</p>
<p>HTTP/2.0 is a new version of the HTTP protocol that still uses port 80. When a client contacts an HTTP server, it must be able to determine whether it supports HTTP/1.x or HTTP/2.0. If the client sends a binary encoded HTTP/2.0 request to a server that only supports the ASCII encoded HTTP/1.x, it could cause problems on the server and even crash it. To minimize the risk of crashing HTTP/1.x servers, an HTTP/2.0 session starts like an HTTP/1.1 session and the first request contains the <cite>Connection</cite>, <cite>Upgrade</cite> and <cite>HTTP2-Settings</cite> headers. An example of such a request to upgrade the version of HTTP is shown below.</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span/><span class="go">GET /robots.txt HTTP/1.1</span>
<span class="go">Host: nghttp2.org</span>
<span class="go">User-Agent: curl/7.52.1</span>
<span class="go">Connection: Upgrade, HTTP2-Settings</span>
<span class="go">Upgrade: h2c</span>
<span class="go">HTTP2-Settings: AAMAAABkAARAAAAA</span>
</pre></div>
</div>
<p>The <cite>HTTP2-Settings</cite> line contains the HTTP/2.0 settings frame that the client would server over an HTTP/2.0 session encoded in Base64. The server replies with a response that indicates that it has accepted to upgrade the connection to HTTP/2.0. A sample response is shown below.</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span/><span class="go">HTTP/1.1 101 Switching Protocols</span>
<span class="go">Connection: Upgrade</span>
<span class="go">Upgrade: h2c</span>
</pre></div>
</div>
<p>Finally, the client and the server need to confirm the utilization of HTTP/2.0. A client confirms this by sending the following Magic string <cite>PRI * HTTP/2.0rnrnSMrnrn</cite> or <cite>0x505249202a20485454502f322e300d0a0d0a534d0d0a0d0a</cite> in hex. This string is followed by a SETTINGS frame. The server must send a possibly empty SETTINGS frame.</p>
</div>
&#13;

<h2>Remote Procedure Calls<a class="headerlink" href="#remote-procedure-calls" title="Link to this heading">#</a></h2>
<p>In the previous sections, we have described several protocols that enable humans to exchange messages and access to remote documents. This is not the only usage of computer networks and in many situations applications use the network to exchange information with other applications. When an application needs to perform a large computation on a host, it can sometimes be useful to request computations from other hosts. Many distributed systems have been built by distributing applications on different hosts and using <cite>Remote Procedure Calls</cite> as a basic building block.</p>
<p>In traditional programming languages, <cite>procedure calls</cite> allow programmers to better structure their code. Each procedure is identified by a name, a return type and a set of parameters. When a procedure is called, the current flow of program execution is diverted to execute the procedure. This procedure uses the provided parameters to perform its computation and returns one or more values. This programming model was designed with a single host in mind. In a nutshell, most programming languages support it as follows :</p>
<blockquote>
<div><ol class="arabic simple">
<li><p>The caller places the values of the parameters at a location (register, stack, …) where the callee can access them</p></li>
<li><p>The caller transfers the control of execution to the callee’s procedure</p></li>
<li><p>The callee accesses the parameters and performs the requested computation</p></li>
<li><p>The callee places the return value(s) at a location (register, stack, …) where the caller can access them</p></li>
<li><p>The callee returns the control of execution to the caller’s</p></li>
</ol>
</div></blockquote>
<p>This model was developed with a single host in mind. How should it be modified if the caller and the callee are different hosts connected through a network ? Since the two hosts can be different, the two main problems are the fact they do not share the same memory and that they do not necessarily use the same representation for numbers, characters, … Let us examine how the five steps identified above can be supported through a network.</p>
<p>The first problem to be solved is how to transfer the information from the caller to the callee. This problem is not simple and includes two sub-problems. The first sub-problem is the encoding of the information. How to encode the values of the parameters so that they can be transferred correctly through the network ? The second problem is how to reach the callee through the network ? The callee is identified by a procedure name, but to use the transport service, we need to convert this name into an address and a port number.</p>
<section id="encoding-data">
<span id="index-79"/><h3>Encoding data<a class="headerlink" href="#encoding-data" title="Link to this heading">#</a></h3>
<p>The encoding problem exists in a wide range of applications. In the previous sections, we have described how character-based encodings are used by email and HTTP. Although standard encoding techniques such as ASN.1 <a class="reference internal" href="../bibliography.html#dubuisson2000" id="id42"><span>[Dubuisson2000]</span></a> have been defined to cover most application needs, many applications have defined their specific encoding. <cite>Remote Procedure Call</cite> are no exception to this rule. The three most popular encoding methods are probably XDR <span class="target" id="index-80"/><a class="rfc reference external" href="https://datatracker.ietf.org/doc/html/rfc1832.html"><strong>RFC 1832</strong></a> used by ONC-RPC <span class="target" id="index-81"/><a class="rfc reference external" href="https://datatracker.ietf.org/doc/html/rfc1831.html"><strong>RFC 1831</strong></a>, XML, used by XML-RPC and JSON <span class="target" id="index-82"/><a class="rfc reference external" href="https://datatracker.ietf.org/doc/html/rfc4627.html"><strong>RFC 4627</strong></a>.</p>
<p>The eXternal Data Representation (XDR) Standard, defined in <span class="target" id="index-83"/><a class="rfc reference external" href="https://datatracker.ietf.org/doc/html/rfc1832.html"><strong>RFC 1832</strong></a> is an early specification that describes how information exchanged during Remote Procedure Calls should be encoded before being transmitted through a network. Since the transport service enables transferring a block of bytes (with the connectionless service) or a stream of bytes (by using the connection-oriented service), XDR maps each datatype onto a sequence of bytes. The caller encodes each data in the appropriate sequence and the callee decodes the received information. Here are a few examples extracted from <span class="target" id="index-84"/><a class="rfc reference external" href="https://datatracker.ietf.org/doc/html/rfc1832.html"><strong>RFC 1832</strong></a> to illustrate how this encoding/decoding can be performed.</p>
<p>For basic data types, <span class="target" id="index-85"/><a class="rfc reference external" href="https://datatracker.ietf.org/doc/html/rfc1832.html"><strong>RFC 1832</strong></a> simply maps their representation into a sequence of bytes. For example a 32 bits integer is transmitted as shown in <a class="reference internal" href="#fig-xdr-int32"><span class="std std-numref">Fig. 43</span></a> (with the most significant byte first, which corresponds to big-endian encoding).</p>
<figure class="align-center" id="id72">
<span id="fig-xdr-int32"/><img alt="../_images/xdr-integer.svg" src="../Images/d52e7c6b6281eb132d460857ec233eff.png" data-original-src="https://4ed.computer-networking.info/syllabus/default/_images/xdr-integer.svg"/>
<figcaption>
<p><span class="caption-number">Fig. 43 </span><span class="caption-text">XDR representation of a 32 bits integer</span><a class="headerlink" href="#id72" title="Link to this image">#</a></p>
</figcaption>
</figure>
<p>XDR also supports 64 bits integers and booleans. The booleans are mapped onto integers (<cite>0</cite> for <cite>false</cite> and <cite>1</cite> for <cite>true</cite>). For the floating point numbers, the encoding defined in the IEEE standard is used. In the representation, the first bit (<cite>S</cite>) is the sign (<cite>0</cite> represents positive). The next 11 bits represent the exponent of the number (<cite>E</cite>), in base 2, and the remaining 52 bits are the fractional part of the number (<cite>F</cite>). The floating point number that corresponds to this representation is <span class="math notranslate nohighlight">\((-1)^{S} \times 2^{E-1023} \times 1.F\)</span>. XDR also allows encoding complex data types. A first example is the string of bytes. A string of bytes is composed of two parts : a length (encoded as an integer) and a sequence of bytes. For performance reasons, the encoding of a string is aligned to 32 bits boundaries. This implies that some padding bytes may be inserted during the encoding operation is the length of the string is not a multiple of 4. The structure of the string is shown below (source <span class="target" id="index-86"/><a class="rfc reference external" href="https://datatracker.ietf.org/doc/html/rfc1832.html"><strong>RFC 1832</strong></a>).</p>
<figure class="align-center" id="id73">
<span id="fig-xdr-float"/><a class="reference internal image-reference" href="../_images/xdr-float.svg"><img alt="../_images/xdr-float.svg" src="../Images/b3e916ca81c68d2a4b58075d4bf0bb7c.png" style="width: 664.8px; height: 115.19999999999999px;" data-original-src="https://4ed.computer-networking.info/syllabus/default/_images/xdr-float.svg"/>
</a>
<figcaption>
<p><span class="caption-number">Fig. 44 </span><span class="caption-text">XDR representation of a floating point number</span><a class="headerlink" href="#id73" title="Link to this image">#</a></p>
</figcaption>
</figure>
<p>In some situations, it is necessary to encode fixed or variable length arrays. XDR <span class="target" id="index-87"/><a class="rfc reference external" href="https://datatracker.ietf.org/doc/html/rfc1832.html"><strong>RFC 1832</strong></a> supports such arrays. For example, the encoding in <a class="reference internal" href="#fig-xdr-narray"><span class="std std-numref">Fig. 45</span></a> corresponds to an array containing n elements. The encoded representation starts with an integer that contains the number of elements and follows with all elements in sequence.</p>
<figure class="align-center" id="id74">
<span id="fig-xdr-narray"/><a class="reference internal image-reference" href="../_images/xdr-array.svg"><img alt="../_images/xdr-array.svg" src="../Images/e1244da31b6e5cd69f0f51dd6cf774b8.png" style="width: 634.8px; height: 96.0px;" data-original-src="https://4ed.computer-networking.info/syllabus/default/_images/xdr-array.svg"/>
</a>
<figcaption>
<p><span class="caption-number">Fig. 45 </span><span class="caption-text">XDR representation of an array</span><a class="headerlink" href="#id74" title="Link to this image">#</a></p>
</figcaption>
</figure>
<p>XDR also supports the definition of unions, structures, … Additional details are provided in <span class="target" id="index-88"/><a class="rfc reference external" href="https://datatracker.ietf.org/doc/html/rfc1832.html"><strong>RFC 1832</strong></a>.</p>
<p>A second popular method to encode data is the JavaScript Object Notation (JSON). This syntax was initially defined to allow applications written in JavaScript to exchange data, but it has now wider usages. JSON <span class="target" id="index-89"/><a class="rfc reference external" href="https://datatracker.ietf.org/doc/html/rfc4627.html"><strong>RFC 4627</strong></a> is a text-based representation. The simplest data type is the integer. It is represented as a sequence of digits in ASCII. Strings can also be encoding by using JSON. A JSON string always starts and ends with a quote character (<cite>”</cite>) as in the C language. As in the C language, some characters (like <cite>“</cite> or <cite>\</cite>) must be escaped if they appear in a string. <span class="target" id="index-90"/><a class="rfc reference external" href="https://datatracker.ietf.org/doc/html/rfc4627.html"><strong>RFC 4627</strong></a> describes this in details. Booleans are also supported by using the strings <cite>false</cite> and <cite>true</cite>. Like XDR, JSON supports more complex data types. A structure or object is defined as a comma separated list of elements enclosed in curly brackets. <span class="target" id="index-91"/><a class="rfc reference external" href="https://datatracker.ietf.org/doc/html/rfc4627.html"><strong>RFC 4627</strong></a> provides the following example as an illustration.</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span/><span class="p">{</span>
<span class="w">   </span><span class="s2">"Image"</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">       </span><span class="s2">"Width"</span><span class="o">:</span><span class="w">  </span><span class="mf">800</span><span class="p">,</span>
<span class="w">       </span><span class="s2">"Height"</span><span class="o">:</span><span class="w"> </span><span class="mf">600</span><span class="p">,</span>
<span class="w">       </span><span class="s2">"Title"</span><span class="o">:</span><span class="w">  </span><span class="s2">"View from 15th Floor"</span><span class="p">,</span>
<span class="w">       </span><span class="s2">"Thumbnail"</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">           </span><span class="s2">"Url"</span><span class="o">:</span><span class="w">    </span><span class="s2">"http://www.example.com/image/481989943"</span><span class="p">,</span>
<span class="w">           </span><span class="s2">"Height"</span><span class="o">:</span><span class="w"> </span><span class="mf">125</span><span class="p">,</span>
<span class="w">           </span><span class="s2">"Width"</span><span class="o">:</span><span class="w">  </span><span class="mf">100</span>
<span class="w">       </span><span class="p">},</span>
<span class="w">       </span><span class="s2">"ID"</span><span class="o">:</span><span class="w"> </span><span class="mf">1234</span>
<span class="w">     </span><span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>This object has one field named <cite>Image</cite>. It has five attributes. The first one, <cite>Width</cite>, is an integer set to 800. The third one is a string. The fourth attribute, <cite>Thumbnail</cite> is also an object composed of three different attributes, one string and two integers. JSON can also be used to encode arrays or lists. In this case, square brackets are used as delimiters. The snippet below shows an array which contains the prime integers that are smaller than ten.</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span/><span class="p">{</span>
<span class="w">  </span><span class="s2">"Primes"</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="p">[</span><span class="w"> </span><span class="mf">2</span><span class="p">,</span><span class="w"> </span><span class="mf">3</span><span class="p">,</span><span class="w"> </span><span class="mf">5</span><span class="p">,</span><span class="w"> </span><span class="mf">7</span><span class="w"> </span><span class="p">]</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Compared with XDR, the main advantage of JSON is that the transfer syntax is easily readable by a human. However, this comes at the expense of a less compact encoding. Some data encoded in JSON will usually take more space than when it is encoded with XDR. More compact encoding schemes have been defined, see e.g. <a class="reference internal" href="../bibliography.html#bh2013" id="id43"><span>[BH2013]</span></a> and the references therein.</p>
</section>
<section id="reaching-the-callee">
<h3>Reaching the callee<a class="headerlink" href="#reaching-the-callee" title="Link to this heading">#</a></h3>
<p>The second sub-problem is how to reach the callee. A simple solution to this problem is to make sure that the callee listens on a specific port on the remote machine and then exchange information with this server process. This is the solution chosen for JSON-RPC <a class="reference internal" href="../bibliography.html#json-rpc2" id="id44"><span>[JSON-RPC2]</span></a>. JSON-RPC can be used over the connectionless or the connection-oriented transport service. A JSON-RPC request contains the following fields:</p>
<blockquote>
<div><ul class="simple">
<li><p><cite>jsonrpc</cite>: a string indicating the version of the protocol used. This is important to allow the protocol to evolve in the future.</p></li>
<li><p><cite>method</cite>: a string that contains the name of the procedure which is invoked</p></li>
<li><p><cite>params</cite>: a structure that contains the values of the parameters that are passed to the method</p></li>
<li><p><cite>id</cite>: an identifier chosen by the caller</p></li>
</ul>
</div></blockquote>
<p>The JSON-RPC is encoded as a JSON object. For example, the example below shows an invocation of a method called <cite>sum</cite> with <cite>1</cite> and <cite>3</cite> as parameters.</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span/><span class="p">{</span><span class="w"> </span><span class="s2">"jsonrpc"</span><span class="o">:</span><span class="w"> </span><span class="s2">"2.0"</span><span class="p">,</span><span class="w"> </span><span class="s2">"method"</span><span class="o">:</span><span class="w"> </span><span class="s2">"sum"</span><span class="p">,</span><span class="w"> </span><span class="s2">"params"</span><span class="o">:</span><span class="w"> </span><span class="p">[</span><span class="mf">1</span><span class="p">,</span><span class="w"> </span><span class="mf">3</span><span class="p">],</span><span class="w"> </span><span class="s2">"id"</span><span class="o">:</span><span class="w"> </span><span class="mf">1</span><span class="w"> </span><span class="p">}</span>
</pre></div>
</div>
<p>Upon reception of this JSON structure, the callee parses the object, locates the corresponding method and passes the parameters. This method returns a response which is also encoded as a JSON structure. This response contains the following fields:</p>
<blockquote>
<div><ul>
<li><p><cite>jsonrpc</cite>: a string indicating the version of the protocol used to encode the response</p></li>
<li><p><cite>id</cite>: the same identifier as the identifier chosen by the caller</p></li>
<li><p><cite>result</cite>: if the request succeeded, this member contains the result of the request (in our example, value <cite>4</cite>).</p></li>
<li><p><cite>error</cite>: if the method called does not exist or its execution causes an error, the <cite>result</cite> element will be replaced by an <cite>error</cite> element which contains the following members :</p>
<blockquote>
<div><ul class="simple">
<li><p><cite>code</cite>: a number that indicates the type of error. Several error codes are defined in <a class="reference internal" href="../bibliography.html#json-rpc2" id="id45"><span>[JSON-RPC2]</span></a>. For example, <cite>-32700</cite> indicates an error in parsing the request, <cite>-32602</cite> indicates invalid parameters and <cite>-32601</cite> indicates that the method could not be found on the server. Other error codes are listed in <a class="reference internal" href="../bibliography.html#json-rpc2" id="id46"><span>[JSON-RPC2]</span></a>.</p></li>
<li><p><cite>message</cite>: a string (limited to one sentence) that provides a short description of the error.</p></li>
<li><p><cite>data</cite>: an optional field that provides additional information about the error.</p></li>
</ul>
</div></blockquote>
</li>
</ul>
</div></blockquote>
<p>Coming back to our example with the call for the <cite>sum</cite> procedure, it would return the following JSON structure.</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span/><span class="p">{</span><span class="w"> </span><span class="s2">"jsonrpc"</span><span class="o">:</span><span class="w"> </span><span class="s2">"2.0"</span><span class="p">,</span><span class="w"> </span><span class="s2">"result"</span><span class="o">:</span><span class="w"> </span><span class="mf">4</span><span class="p">,</span><span class="w"> </span><span class="s2">"id"</span><span class="o">:</span><span class="w"> </span><span class="mf">1</span><span class="w"> </span><span class="p">}</span>
</pre></div>
</div>
<p>If the <cite>sum</cite> method is not implemented on the server, it would reply with the following response.</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span/><span class="p">{</span><span class="w"> </span><span class="s2">"jsonrpc"</span><span class="o">:</span><span class="w"> </span><span class="s2">"2.0"</span><span class="p">,</span><span class="w"> </span><span class="s2">"error"</span><span class="o">:</span><span class="w"> </span><span class="p">{</span><span class="s2">"code"</span><span class="o">:</span><span class="w"> </span><span class="o">-</span><span class="mf">32601</span><span class="p">,</span><span class="w"> </span><span class="s2">"message"</span><span class="o">:</span><span class="w"> </span><span class="s2">"Method not found"</span><span class="p">},</span><span class="w"> </span><span class="s2">"id"</span><span class="o">:</span><span class="w"> </span><span class="s2">"1"</span><span class="w"> </span><span class="p">}</span>
</pre></div>
</div>
<p>The <cite>id</cite> field, which is present in the request and the response plays the same role as the identifier field in the DNS message. It allows the caller to match the response with the request that it sent. This <cite>id</cite> is very important when JSON-RPC is used over the connectionless transport service which is unreliable. If a request is sent, it may need to be retransmitted and it is possible that a callee will receive twice the same request (e.g. if the response for the first request was lost). In the DNS, when a request is lost, it can be retransmitted without causing any difficulty. However with remote procedure calls in general, losses can cause some problems. Consider a method which is used to deposit money on a bank account. If the request is lost, it will be retransmitted and the deposit will be eventually performed. However, if the response is lost, the caller will also retransmit its request. This request will be received by the callee that will deposit the money again. To prevent this problem from affecting the application, either the programmer must ensure that the remote procedures that it calls can be safely called multiple times or the application must verify whether the request has been transmitted earlier. In most deployments, the programmers use remote methods that can be safely called multiple times without breaking the application logic.</p>
<p id="index-92">ONC-RPC uses a more complex method to allow a caller to reach the callee. On a host, server processes can run on different ports and given the limited number of port values (<span class="math notranslate nohighlight">\(2^{16}\)</span> per host on the Internet), it is impossible to reserve one port number for each method. The solution used in ONC-RPC <span class="target" id="index-93"/><a class="rfc reference external" href="https://datatracker.ietf.org/doc/html/rfc1831.html"><strong>RFC 1831</strong></a> is to use a special method which is called the <cite>portmapper</cite> <span class="target" id="index-94"/><a class="rfc reference external" href="https://datatracker.ietf.org/doc/html/rfc1833.html"><strong>RFC 1833</strong></a>. The <cite>portmapper</cite> is a kind of directory that runs on a server that hosts methods. The <cite>portmapper</cite> runs on a standard port (<cite>111</cite> for ONC-RPC <span class="target" id="index-95"/><a class="rfc reference external" href="https://datatracker.ietf.org/doc/html/rfc1833.html"><strong>RFC 1833</strong></a>). A server process that implements a method registers its method on the local <cite>portmapper</cite>. When a caller needs to call a method on a remote server, it first contacts the <cite>portmapper</cite> to obtain the port number of the server process which implements the method. The response from the portmapper allows it to directly contact the server process which implements the method.</p>
<p class="rubric">Footnotes</p>
<aside class="footnote-list brackets">
<aside class="footnote brackets" id="fhosts" role="doc-footnote">
<span class="label"><span class="fn-bracket">[</span><a role="doc-backlink" href="#id8">1</a><span class="fn-bracket">]</span></span>
<p>The <a class="reference internal" href="../glossary.html#term-hosts.txt"><span class="xref std std-term">hosts.txt</span></a> file is not maintained anymore. A historical snapshot from April 1984 is available from <a class="reference external" href="https://www.saildart.org/HOSTS.TXT%5BHST,NET%5D15">https://www.saildart.org/HOSTS.TXT%5BHST,NET%5D15</a></p>
</aside>
<aside class="footnote brackets" id="fdnstimeline" role="doc-footnote">
<span class="label"><span class="fn-bracket">[</span><a role="doc-backlink" href="#id9">2</a><span class="fn-bracket">]</span></span>
<p>See <a class="reference external" href="http://www.donelan.com/dnstimeline.html">http://www.donelan.com/dnstimeline.html</a> for a timeline of DNS-related developments.</p>
</aside>
<aside class="footnote brackets" id="fidn" role="doc-footnote">
<span class="label"><span class="fn-bracket">[</span><a role="doc-backlink" href="#id10">3</a><span class="fn-bracket">]</span></span>
<p>This specification evolved later to support domain names written by using other character sets than us-ASCII <span class="target" id="index-96"/><a class="rfc reference external" href="https://datatracker.ietf.org/doc/html/rfc5890.html"><strong>RFC 5890</strong></a>. This extension is important to support languages other than English, but a detailed discussion is outside the scope of this document.</p>
</aside>
<aside class="footnote brackets" id="ftld" role="doc-footnote">
<span class="label"><span class="fn-bracket">[</span><a role="doc-backlink" href="#id11">4</a><span class="fn-bracket">]</span></span>
<p>The official list of top-level domain names is maintained by <a class="reference internal" href="../glossary.html#term-IANA"><span class="xref std std-term">IANA</span></a> at <a class="reference external" href="http://data.iana.org/TLD/tlds-alpha-by-domain.txt">http://data.iana.org/TLD/tlds-alpha-by-domain.txt</a>. Additional information about these domains may be found at <a class="reference external" href="http://en.wikipedia.org/wiki/List_of_Internet_top-level_domains">http://en.wikipedia.org/wiki/List_of_Internet_top-level_domains</a>.</p>
</aside>
<aside class="footnote brackets" id="fg00gle" role="doc-footnote">
<span class="label"><span class="fn-bracket">[</span><a role="doc-backlink" href="#id12">5</a><span class="fn-bracket">]</span></span>
<p>It is interesting to note that to prevent any homograph attack, Google Inc. registered the <cite>g00gle.com</cite> domain name but does not apparently use it.</p>
</aside>
<aside class="footnote brackets" id="froot" role="doc-footnote">
<span class="label"><span class="fn-bracket">[</span><a role="doc-backlink" href="#id14">6</a><span class="fn-bracket">]</span></span>
<p>A copy of the information maintained by each root nameserver is available at <a class="reference external" href="http://www.internic.net/zones/root.zone">http://www.internic.net/zones/root.zone</a>.</p>
</aside>
<aside class="footnote brackets" id="frootv6" role="doc-footnote">
<span class="label"><span class="fn-bracket">[</span><a role="doc-backlink" href="#id15">7</a><span class="fn-bracket">]</span></span>
<p>Until February 2008, the root DNS servers only had IPv4 addresses. IPv6 addresses were slowly added to the root DNS servers to avoid creating problems as discussed in <a class="reference external" href="http://www.icann.org/en/committees/security/sac018.pdf">http://www.icann.org/en/committees/security/sac018.pdf</a>. As of February 2021, there remain a few DNS root servers that are still not reachable using IPv6. The full list is available at <a class="reference external" href="http://www.root-servers.org/">http://www.root-servers.org/</a>.</p>
</aside>
<aside class="footnote brackets" id="f8888" role="doc-footnote">
<span class="label"><span class="fn-bracket">[</span><a role="doc-backlink" href="#id17">8</a><span class="fn-bracket">]</span></span>
<p>Some DNS resolvers allow any host to send queries. Google operates a <a class="reference external" href="https://developers.google.com/speed/public-dns/docs/using">public DNS resolver</a> at addresses <cite>2001:4860:4860::8888</cite> and <cite>2001:4860:4860::8844</cite>. Other companies provide similar services.</p>
</aside>
<aside class="footnote brackets" id="fhtonl" role="doc-footnote">
<span class="label"><span class="fn-bracket">[</span><a role="doc-backlink" href="#id3">9</a><span class="fn-bracket">]</span></span>
<p>For example, the <em class="manpage">htonl(3)</em> (resp. <em class="manpage">ntohl(3)</em>) function the standard C library converts a 32-bits unsigned integer from the byte order used by the CPU to the network byte order (resp. from the network byte order to the CPU byte order). Similar functions exist in other programming languages.</p>
</aside>
<aside class="footnote brackets" id="fto" role="doc-footnote">
<span class="label"><span class="fn-bracket">[</span><a role="doc-backlink" href="#id21">10</a><span class="fn-bracket">]</span></span>
<p>It could be surprising that the <cite>To:</cite> is not mandatory inside an email message. While most email messages will contain this header line an email that does not contain a <cite>To:</cite> header line and that relies on the <cite>bcc:</cite> to specify the recipient is valid as well.</p>
</aside>
<aside class="footnote brackets" id="femailheaders" role="doc-footnote">
<span class="label"><span class="fn-bracket">[</span><a role="doc-backlink" href="#id22">11</a><span class="fn-bracket">]</span></span>
<p>The list of all standard email header lines may be found at <a class="reference external" href="http://www.iana.org/assignments/message-headers/message-header-index.html">http://www.iana.org/assignments/message-headers/message-header-index.html</a></p>
</aside>
<aside class="footnote brackets" id="fsmtpauth" role="doc-footnote">
<span class="label"><span class="fn-bracket">[</span><a role="doc-backlink" href="#id24">12</a><span class="fn-bracket">]</span></span>
<p>During the last years, many Internet Service Providers, campus and enterprise networks have deployed SMTP extensions <span class="target" id="index-97"/><a class="rfc reference external" href="https://datatracker.ietf.org/doc/html/rfc4954.html"><strong>RFC 4954</strong></a> on their MSAs. These extensions force the MUAs to be authenticated before the MSA accepts an email message from the MUA.</p>
</aside>
<aside class="footnote brackets" id="fehlo" role="doc-footnote">
<span class="label"><span class="fn-bracket">[</span><a role="doc-backlink" href="#id25">13</a><span class="fn-bracket">]</span></span>
<p>The first versions of SMTP used <cite>HELO</cite> as the first command sent by a client to a SMTP server. When SMTP was extended to support newer features such as 8 bits characters, it was necessary to allow a server to recognize whether it was interacting with a client that supported the extensions or not. <cite>EHLO</cite> became mandatory with the publication of <span class="target" id="index-98"/><a class="rfc reference external" href="https://datatracker.ietf.org/doc/html/rfc2821.html"><strong>RFC 2821</strong></a>.</p>
</aside>
<aside class="footnote brackets" id="fdot" role="doc-footnote">
<span class="label"><span class="fn-bracket">[</span><a role="doc-backlink" href="#id26">14</a><span class="fn-bracket">]</span></span>
<p>This implies that a valid email message cannot contain a line with one dot followed by <cite>CR</cite> and <cite>LF</cite>. If a user types such a line in an email, his email client will automatically add a space character before or after the dot when sending the message over SMTP.</p>
</aside>
<aside class="footnote brackets" id="fapop" role="doc-footnote">
<span class="label"><span class="fn-bracket">[</span><a role="doc-backlink" href="#id27">15</a><span class="fn-bracket">]</span></span>
<p><span class="target" id="index-99"/><a class="rfc reference external" href="https://datatracker.ietf.org/doc/html/rfc1939.html"><strong>RFC 1939</strong></a> defines the APOP authentication scheme that is not vulnerable to such attacks.</p>
</aside>
<aside class="footnote brackets" id="furiretrieve" role="doc-footnote">
<span class="label"><span class="fn-bracket">[</span><a role="doc-backlink" href="#id32">16</a><span class="fn-bracket">]</span></span>
<p>An example of a non-retrievable URI is <cite>urn:isbn:0-380-81593-1</cite> which is an unique identifier for a book, through the urn scheme (see <span class="target" id="index-100"/><a class="rfc reference external" href="https://datatracker.ietf.org/doc/html/rfc3187.html"><strong>RFC 3187</strong></a>). Of course, any URI can be made retrievable via a dedicated server or a new protocol but this one has no explicit protocol. Same thing for the scheme tag (see <span class="target" id="index-101"/><a class="rfc reference external" href="https://datatracker.ietf.org/doc/html/rfc4151.html"><strong>RFC 4151</strong></a>), often used in Web syndication (see <span class="target" id="index-102"/><a class="rfc reference external" href="https://datatracker.ietf.org/doc/html/rfc4287.html"><strong>RFC 4287</strong></a> about the Atom syndication format). Even when the scheme is retrievable (for instance with <cite>http</cite>), it is often used only as an identifier, not as a way to get a resource. See <a class="reference external" href="http://norman.walsh.name/2006/07/25/namesAndAddresses">http://norman.walsh.name/2006/07/25/namesAndAddresses</a> for a good explanation.</p>
</aside>
<aside class="footnote brackets" id="furilist" role="doc-footnote">
<span class="label"><span class="fn-bracket">[</span><a role="doc-backlink" href="#id33">17</a><span class="fn-bracket">]</span></span>
<p>The list of standard URI schemes is maintained by <a class="reference external" href="https://www.iana.org">IANA</a> at <a class="reference external" href="http://www.iana.org/assignments/uri-schemes.html">http://www.iana.org/assignments/uri-schemes.html</a></p>
</aside>
<aside class="footnote brackets" id="ffavicon" role="doc-footnote">
<span class="label"><span class="fn-bracket">[</span><a role="doc-backlink" href="#id35">18</a><span class="fn-bracket">]</span></span>
<p>Favorite icons are small icons that are used to represent web servers in the toolbar of Internet browsers. Microsoft added this feature in their browsers without taking into account the W3C standards. See <a class="reference external" href="http://www.w3.org/2005/10/howto-favicon">http://www.w3.org/2005/10/howto-favicon</a> for a discussion on how to cleanly support such favorite icons.</p>
</aside>
<aside class="footnote brackets" id="fpipelining" role="doc-footnote">
<span class="label"><span class="fn-bracket">[</span><a role="doc-backlink" href="#id39">19</a><span class="fn-bracket">]</span></span>
<p>See <a class="reference external" href="https://en.wikipedia.org/wiki/HTTP_pipelining">https://en.wikipedia.org/wiki/HTTP_pipelining</a> for additional information.</p>
</aside>
</aside>
</section>
&#13;

<span id="index-79"/><h3>Encoding data<a class="headerlink" href="#encoding-data" title="Link to this heading">#</a></h3>
<p>The encoding problem exists in a wide range of applications. In the previous sections, we have described how character-based encodings are used by email and HTTP. Although standard encoding techniques such as ASN.1 <a class="reference internal" href="../bibliography.html#dubuisson2000" id="id42"><span>[Dubuisson2000]</span></a> have been defined to cover most application needs, many applications have defined their specific encoding. <cite>Remote Procedure Call</cite> are no exception to this rule. The three most popular encoding methods are probably XDR <span class="target" id="index-80"/><a class="rfc reference external" href="https://datatracker.ietf.org/doc/html/rfc1832.html"><strong>RFC 1832</strong></a> used by ONC-RPC <span class="target" id="index-81"/><a class="rfc reference external" href="https://datatracker.ietf.org/doc/html/rfc1831.html"><strong>RFC 1831</strong></a>, XML, used by XML-RPC and JSON <span class="target" id="index-82"/><a class="rfc reference external" href="https://datatracker.ietf.org/doc/html/rfc4627.html"><strong>RFC 4627</strong></a>.</p>
<p>The eXternal Data Representation (XDR) Standard, defined in <span class="target" id="index-83"/><a class="rfc reference external" href="https://datatracker.ietf.org/doc/html/rfc1832.html"><strong>RFC 1832</strong></a> is an early specification that describes how information exchanged during Remote Procedure Calls should be encoded before being transmitted through a network. Since the transport service enables transferring a block of bytes (with the connectionless service) or a stream of bytes (by using the connection-oriented service), XDR maps each datatype onto a sequence of bytes. The caller encodes each data in the appropriate sequence and the callee decodes the received information. Here are a few examples extracted from <span class="target" id="index-84"/><a class="rfc reference external" href="https://datatracker.ietf.org/doc/html/rfc1832.html"><strong>RFC 1832</strong></a> to illustrate how this encoding/decoding can be performed.</p>
<p>For basic data types, <span class="target" id="index-85"/><a class="rfc reference external" href="https://datatracker.ietf.org/doc/html/rfc1832.html"><strong>RFC 1832</strong></a> simply maps their representation into a sequence of bytes. For example a 32 bits integer is transmitted as shown in <a class="reference internal" href="#fig-xdr-int32"><span class="std std-numref">Fig. 43</span></a> (with the most significant byte first, which corresponds to big-endian encoding).</p>
<figure class="align-center" id="id72">
<span id="fig-xdr-int32"/><img alt="../_images/xdr-integer.svg" src="../Images/d52e7c6b6281eb132d460857ec233eff.png" data-original-src="https://4ed.computer-networking.info/syllabus/default/_images/xdr-integer.svg"/>
<figcaption>
<p><span class="caption-number">Fig. 43 </span><span class="caption-text">XDR representation of a 32 bits integer</span><a class="headerlink" href="#id72" title="Link to this image">#</a></p>
</figcaption>
</figure>
<p>XDR also supports 64 bits integers and booleans. The booleans are mapped onto integers (<cite>0</cite> for <cite>false</cite> and <cite>1</cite> for <cite>true</cite>). For the floating point numbers, the encoding defined in the IEEE standard is used. In the representation, the first bit (<cite>S</cite>) is the sign (<cite>0</cite> represents positive). The next 11 bits represent the exponent of the number (<cite>E</cite>), in base 2, and the remaining 52 bits are the fractional part of the number (<cite>F</cite>). The floating point number that corresponds to this representation is <span class="math notranslate nohighlight">\((-1)^{S} \times 2^{E-1023} \times 1.F\)</span>. XDR also allows encoding complex data types. A first example is the string of bytes. A string of bytes is composed of two parts : a length (encoded as an integer) and a sequence of bytes. For performance reasons, the encoding of a string is aligned to 32 bits boundaries. This implies that some padding bytes may be inserted during the encoding operation is the length of the string is not a multiple of 4. The structure of the string is shown below (source <span class="target" id="index-86"/><a class="rfc reference external" href="https://datatracker.ietf.org/doc/html/rfc1832.html"><strong>RFC 1832</strong></a>).</p>
<figure class="align-center" id="id73">
<span id="fig-xdr-float"/><a class="reference internal image-reference" href="../_images/xdr-float.svg"><img alt="../_images/xdr-float.svg" src="../Images/b3e916ca81c68d2a4b58075d4bf0bb7c.png" style="width: 664.8px; height: 115.19999999999999px;" data-original-src="https://4ed.computer-networking.info/syllabus/default/_images/xdr-float.svg"/>
</a>
<figcaption>
<p><span class="caption-number">Fig. 44 </span><span class="caption-text">XDR representation of a floating point number</span><a class="headerlink" href="#id73" title="Link to this image">#</a></p>
</figcaption>
</figure>
<p>In some situations, it is necessary to encode fixed or variable length arrays. XDR <span class="target" id="index-87"/><a class="rfc reference external" href="https://datatracker.ietf.org/doc/html/rfc1832.html"><strong>RFC 1832</strong></a> supports such arrays. For example, the encoding in <a class="reference internal" href="#fig-xdr-narray"><span class="std std-numref">Fig. 45</span></a> corresponds to an array containing n elements. The encoded representation starts with an integer that contains the number of elements and follows with all elements in sequence.</p>
<figure class="align-center" id="id74">
<span id="fig-xdr-narray"/><a class="reference internal image-reference" href="../_images/xdr-array.svg"><img alt="../_images/xdr-array.svg" src="../Images/e1244da31b6e5cd69f0f51dd6cf774b8.png" style="width: 634.8px; height: 96.0px;" data-original-src="https://4ed.computer-networking.info/syllabus/default/_images/xdr-array.svg"/>
</a>
<figcaption>
<p><span class="caption-number">Fig. 45 </span><span class="caption-text">XDR representation of an array</span><a class="headerlink" href="#id74" title="Link to this image">#</a></p>
</figcaption>
</figure>
<p>XDR also supports the definition of unions, structures, … Additional details are provided in <span class="target" id="index-88"/><a class="rfc reference external" href="https://datatracker.ietf.org/doc/html/rfc1832.html"><strong>RFC 1832</strong></a>.</p>
<p>A second popular method to encode data is the JavaScript Object Notation (JSON). This syntax was initially defined to allow applications written in JavaScript to exchange data, but it has now wider usages. JSON <span class="target" id="index-89"/><a class="rfc reference external" href="https://datatracker.ietf.org/doc/html/rfc4627.html"><strong>RFC 4627</strong></a> is a text-based representation. The simplest data type is the integer. It is represented as a sequence of digits in ASCII. Strings can also be encoding by using JSON. A JSON string always starts and ends with a quote character (<cite>”</cite>) as in the C language. As in the C language, some characters (like <cite>“</cite> or <cite>\</cite>) must be escaped if they appear in a string. <span class="target" id="index-90"/><a class="rfc reference external" href="https://datatracker.ietf.org/doc/html/rfc4627.html"><strong>RFC 4627</strong></a> describes this in details. Booleans are also supported by using the strings <cite>false</cite> and <cite>true</cite>. Like XDR, JSON supports more complex data types. A structure or object is defined as a comma separated list of elements enclosed in curly brackets. <span class="target" id="index-91"/><a class="rfc reference external" href="https://datatracker.ietf.org/doc/html/rfc4627.html"><strong>RFC 4627</strong></a> provides the following example as an illustration.</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span/><span class="p">{</span>
<span class="w">   </span><span class="s2">"Image"</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">       </span><span class="s2">"Width"</span><span class="o">:</span><span class="w">  </span><span class="mf">800</span><span class="p">,</span>
<span class="w">       </span><span class="s2">"Height"</span><span class="o">:</span><span class="w"> </span><span class="mf">600</span><span class="p">,</span>
<span class="w">       </span><span class="s2">"Title"</span><span class="o">:</span><span class="w">  </span><span class="s2">"View from 15th Floor"</span><span class="p">,</span>
<span class="w">       </span><span class="s2">"Thumbnail"</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">           </span><span class="s2">"Url"</span><span class="o">:</span><span class="w">    </span><span class="s2">"http://www.example.com/image/481989943"</span><span class="p">,</span>
<span class="w">           </span><span class="s2">"Height"</span><span class="o">:</span><span class="w"> </span><span class="mf">125</span><span class="p">,</span>
<span class="w">           </span><span class="s2">"Width"</span><span class="o">:</span><span class="w">  </span><span class="mf">100</span>
<span class="w">       </span><span class="p">},</span>
<span class="w">       </span><span class="s2">"ID"</span><span class="o">:</span><span class="w"> </span><span class="mf">1234</span>
<span class="w">     </span><span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>This object has one field named <cite>Image</cite>. It has five attributes. The first one, <cite>Width</cite>, is an integer set to 800. The third one is a string. The fourth attribute, <cite>Thumbnail</cite> is also an object composed of three different attributes, one string and two integers. JSON can also be used to encode arrays or lists. In this case, square brackets are used as delimiters. The snippet below shows an array which contains the prime integers that are smaller than ten.</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span/><span class="p">{</span>
<span class="w">  </span><span class="s2">"Primes"</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="p">[</span><span class="w"> </span><span class="mf">2</span><span class="p">,</span><span class="w"> </span><span class="mf">3</span><span class="p">,</span><span class="w"> </span><span class="mf">5</span><span class="p">,</span><span class="w"> </span><span class="mf">7</span><span class="w"> </span><span class="p">]</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Compared with XDR, the main advantage of JSON is that the transfer syntax is easily readable by a human. However, this comes at the expense of a less compact encoding. Some data encoded in JSON will usually take more space than when it is encoded with XDR. More compact encoding schemes have been defined, see e.g. <a class="reference internal" href="../bibliography.html#bh2013" id="id43"><span>[BH2013]</span></a> and the references therein.</p>
&#13;

<h3>Reaching the callee<a class="headerlink" href="#reaching-the-callee" title="Link to this heading">#</a></h3>
<p>The second sub-problem is how to reach the callee. A simple solution to this problem is to make sure that the callee listens on a specific port on the remote machine and then exchange information with this server process. This is the solution chosen for JSON-RPC <a class="reference internal" href="../bibliography.html#json-rpc2" id="id44"><span>[JSON-RPC2]</span></a>. JSON-RPC can be used over the connectionless or the connection-oriented transport service. A JSON-RPC request contains the following fields:</p>
<blockquote>
<div><ul class="simple">
<li><p><cite>jsonrpc</cite>: a string indicating the version of the protocol used. This is important to allow the protocol to evolve in the future.</p></li>
<li><p><cite>method</cite>: a string that contains the name of the procedure which is invoked</p></li>
<li><p><cite>params</cite>: a structure that contains the values of the parameters that are passed to the method</p></li>
<li><p><cite>id</cite>: an identifier chosen by the caller</p></li>
</ul>
</div></blockquote>
<p>The JSON-RPC is encoded as a JSON object. For example, the example below shows an invocation of a method called <cite>sum</cite> with <cite>1</cite> and <cite>3</cite> as parameters.</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span/><span class="p">{</span><span class="w"> </span><span class="s2">"jsonrpc"</span><span class="o">:</span><span class="w"> </span><span class="s2">"2.0"</span><span class="p">,</span><span class="w"> </span><span class="s2">"method"</span><span class="o">:</span><span class="w"> </span><span class="s2">"sum"</span><span class="p">,</span><span class="w"> </span><span class="s2">"params"</span><span class="o">:</span><span class="w"> </span><span class="p">[</span><span class="mf">1</span><span class="p">,</span><span class="w"> </span><span class="mf">3</span><span class="p">],</span><span class="w"> </span><span class="s2">"id"</span><span class="o">:</span><span class="w"> </span><span class="mf">1</span><span class="w"> </span><span class="p">}</span>
</pre></div>
</div>
<p>Upon reception of this JSON structure, the callee parses the object, locates the corresponding method and passes the parameters. This method returns a response which is also encoded as a JSON structure. This response contains the following fields:</p>
<blockquote>
<div><ul>
<li><p><cite>jsonrpc</cite>: a string indicating the version of the protocol used to encode the response</p></li>
<li><p><cite>id</cite>: the same identifier as the identifier chosen by the caller</p></li>
<li><p><cite>result</cite>: if the request succeeded, this member contains the result of the request (in our example, value <cite>4</cite>).</p></li>
<li><p><cite>error</cite>: if the method called does not exist or its execution causes an error, the <cite>result</cite> element will be replaced by an <cite>error</cite> element which contains the following members :</p>
<blockquote>
<div><ul class="simple">
<li><p><cite>code</cite>: a number that indicates the type of error. Several error codes are defined in <a class="reference internal" href="../bibliography.html#json-rpc2" id="id45"><span>[JSON-RPC2]</span></a>. For example, <cite>-32700</cite> indicates an error in parsing the request, <cite>-32602</cite> indicates invalid parameters and <cite>-32601</cite> indicates that the method could not be found on the server. Other error codes are listed in <a class="reference internal" href="../bibliography.html#json-rpc2" id="id46"><span>[JSON-RPC2]</span></a>.</p></li>
<li><p><cite>message</cite>: a string (limited to one sentence) that provides a short description of the error.</p></li>
<li><p><cite>data</cite>: an optional field that provides additional information about the error.</p></li>
</ul>
</div></blockquote>
</li>
</ul>
</div></blockquote>
<p>Coming back to our example with the call for the <cite>sum</cite> procedure, it would return the following JSON structure.</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span/><span class="p">{</span><span class="w"> </span><span class="s2">"jsonrpc"</span><span class="o">:</span><span class="w"> </span><span class="s2">"2.0"</span><span class="p">,</span><span class="w"> </span><span class="s2">"result"</span><span class="o">:</span><span class="w"> </span><span class="mf">4</span><span class="p">,</span><span class="w"> </span><span class="s2">"id"</span><span class="o">:</span><span class="w"> </span><span class="mf">1</span><span class="w"> </span><span class="p">}</span>
</pre></div>
</div>
<p>If the <cite>sum</cite> method is not implemented on the server, it would reply with the following response.</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span/><span class="p">{</span><span class="w"> </span><span class="s2">"jsonrpc"</span><span class="o">:</span><span class="w"> </span><span class="s2">"2.0"</span><span class="p">,</span><span class="w"> </span><span class="s2">"error"</span><span class="o">:</span><span class="w"> </span><span class="p">{</span><span class="s2">"code"</span><span class="o">:</span><span class="w"> </span><span class="o">-</span><span class="mf">32601</span><span class="p">,</span><span class="w"> </span><span class="s2">"message"</span><span class="o">:</span><span class="w"> </span><span class="s2">"Method not found"</span><span class="p">},</span><span class="w"> </span><span class="s2">"id"</span><span class="o">:</span><span class="w"> </span><span class="s2">"1"</span><span class="w"> </span><span class="p">}</span>
</pre></div>
</div>
<p>The <cite>id</cite> field, which is present in the request and the response plays the same role as the identifier field in the DNS message. It allows the caller to match the response with the request that it sent. This <cite>id</cite> is very important when JSON-RPC is used over the connectionless transport service which is unreliable. If a request is sent, it may need to be retransmitted and it is possible that a callee will receive twice the same request (e.g. if the response for the first request was lost). In the DNS, when a request is lost, it can be retransmitted without causing any difficulty. However with remote procedure calls in general, losses can cause some problems. Consider a method which is used to deposit money on a bank account. If the request is lost, it will be retransmitted and the deposit will be eventually performed. However, if the response is lost, the caller will also retransmit its request. This request will be received by the callee that will deposit the money again. To prevent this problem from affecting the application, either the programmer must ensure that the remote procedures that it calls can be safely called multiple times or the application must verify whether the request has been transmitted earlier. In most deployments, the programmers use remote methods that can be safely called multiple times without breaking the application logic.</p>
<p id="index-92">ONC-RPC uses a more complex method to allow a caller to reach the callee. On a host, server processes can run on different ports and given the limited number of port values (<span class="math notranslate nohighlight">\(2^{16}\)</span> per host on the Internet), it is impossible to reserve one port number for each method. The solution used in ONC-RPC <span class="target" id="index-93"/><a class="rfc reference external" href="https://datatracker.ietf.org/doc/html/rfc1831.html"><strong>RFC 1831</strong></a> is to use a special method which is called the <cite>portmapper</cite> <span class="target" id="index-94"/><a class="rfc reference external" href="https://datatracker.ietf.org/doc/html/rfc1833.html"><strong>RFC 1833</strong></a>. The <cite>portmapper</cite> is a kind of directory that runs on a server that hosts methods. The <cite>portmapper</cite> runs on a standard port (<cite>111</cite> for ONC-RPC <span class="target" id="index-95"/><a class="rfc reference external" href="https://datatracker.ietf.org/doc/html/rfc1833.html"><strong>RFC 1833</strong></a>). A server process that implements a method registers its method on the local <cite>portmapper</cite>. When a caller needs to call a method on a remote server, it first contacts the <cite>portmapper</cite> to obtain the port number of the server process which implements the method. The response from the portmapper allows it to directly contact the server process which implements the method.</p>
<p class="rubric">Footnotes</p>
<aside class="footnote-list brackets">
<aside class="footnote brackets" id="fhosts" role="doc-footnote">
<span class="label"><span class="fn-bracket">[</span><a role="doc-backlink" href="#id8">1</a><span class="fn-bracket">]</span></span>
<p>The <a class="reference internal" href="../glossary.html#term-hosts.txt"><span class="xref std std-term">hosts.txt</span></a> file is not maintained anymore. A historical snapshot from April 1984 is available from <a class="reference external" href="https://www.saildart.org/HOSTS.TXT%5BHST,NET%5D15">https://www.saildart.org/HOSTS.TXT%5BHST,NET%5D15</a></p>
</aside>
<aside class="footnote brackets" id="fdnstimeline" role="doc-footnote">
<span class="label"><span class="fn-bracket">[</span><a role="doc-backlink" href="#id9">2</a><span class="fn-bracket">]</span></span>
<p>See <a class="reference external" href="http://www.donelan.com/dnstimeline.html">http://www.donelan.com/dnstimeline.html</a> for a timeline of DNS-related developments.</p>
</aside>
<aside class="footnote brackets" id="fidn" role="doc-footnote">
<span class="label"><span class="fn-bracket">[</span><a role="doc-backlink" href="#id10">3</a><span class="fn-bracket">]</span></span>
<p>This specification evolved later to support domain names written by using other character sets than us-ASCII <span class="target" id="index-96"/><a class="rfc reference external" href="https://datatracker.ietf.org/doc/html/rfc5890.html"><strong>RFC 5890</strong></a>. This extension is important to support languages other than English, but a detailed discussion is outside the scope of this document.</p>
</aside>
<aside class="footnote brackets" id="ftld" role="doc-footnote">
<span class="label"><span class="fn-bracket">[</span><a role="doc-backlink" href="#id11">4</a><span class="fn-bracket">]</span></span>
<p>The official list of top-level domain names is maintained by <a class="reference internal" href="../glossary.html#term-IANA"><span class="xref std std-term">IANA</span></a> at <a class="reference external" href="http://data.iana.org/TLD/tlds-alpha-by-domain.txt">http://data.iana.org/TLD/tlds-alpha-by-domain.txt</a>. Additional information about these domains may be found at <a class="reference external" href="http://en.wikipedia.org/wiki/List_of_Internet_top-level_domains">http://en.wikipedia.org/wiki/List_of_Internet_top-level_domains</a>.</p>
</aside>
<aside class="footnote brackets" id="fg00gle" role="doc-footnote">
<span class="label"><span class="fn-bracket">[</span><a role="doc-backlink" href="#id12">5</a><span class="fn-bracket">]</span></span>
<p>It is interesting to note that to prevent any homograph attack, Google Inc. registered the <cite>g00gle.com</cite> domain name but does not apparently use it.</p>
</aside>
<aside class="footnote brackets" id="froot" role="doc-footnote">
<span class="label"><span class="fn-bracket">[</span><a role="doc-backlink" href="#id14">6</a><span class="fn-bracket">]</span></span>
<p>A copy of the information maintained by each root nameserver is available at <a class="reference external" href="http://www.internic.net/zones/root.zone">http://www.internic.net/zones/root.zone</a>.</p>
</aside>
<aside class="footnote brackets" id="frootv6" role="doc-footnote">
<span class="label"><span class="fn-bracket">[</span><a role="doc-backlink" href="#id15">7</a><span class="fn-bracket">]</span></span>
<p>Until February 2008, the root DNS servers only had IPv4 addresses. IPv6 addresses were slowly added to the root DNS servers to avoid creating problems as discussed in <a class="reference external" href="http://www.icann.org/en/committees/security/sac018.pdf">http://www.icann.org/en/committees/security/sac018.pdf</a>. As of February 2021, there remain a few DNS root servers that are still not reachable using IPv6. The full list is available at <a class="reference external" href="http://www.root-servers.org/">http://www.root-servers.org/</a>.</p>
</aside>
<aside class="footnote brackets" id="f8888" role="doc-footnote">
<span class="label"><span class="fn-bracket">[</span><a role="doc-backlink" href="#id17">8</a><span class="fn-bracket">]</span></span>
<p>Some DNS resolvers allow any host to send queries. Google operates a <a class="reference external" href="https://developers.google.com/speed/public-dns/docs/using">public DNS resolver</a> at addresses <cite>2001:4860:4860::8888</cite> and <cite>2001:4860:4860::8844</cite>. Other companies provide similar services.</p>
</aside>
<aside class="footnote brackets" id="fhtonl" role="doc-footnote">
<span class="label"><span class="fn-bracket">[</span><a role="doc-backlink" href="#id3">9</a><span class="fn-bracket">]</span></span>
<p>For example, the <em class="manpage">htonl(3)</em> (resp. <em class="manpage">ntohl(3)</em>) function the standard C library converts a 32-bits unsigned integer from the byte order used by the CPU to the network byte order (resp. from the network byte order to the CPU byte order). Similar functions exist in other programming languages.</p>
</aside>
<aside class="footnote brackets" id="fto" role="doc-footnote">
<span class="label"><span class="fn-bracket">[</span><a role="doc-backlink" href="#id21">10</a><span class="fn-bracket">]</span></span>
<p>It could be surprising that the <cite>To:</cite> is not mandatory inside an email message. While most email messages will contain this header line an email that does not contain a <cite>To:</cite> header line and that relies on the <cite>bcc:</cite> to specify the recipient is valid as well.</p>
</aside>
<aside class="footnote brackets" id="femailheaders" role="doc-footnote">
<span class="label"><span class="fn-bracket">[</span><a role="doc-backlink" href="#id22">11</a><span class="fn-bracket">]</span></span>
<p>The list of all standard email header lines may be found at <a class="reference external" href="http://www.iana.org/assignments/message-headers/message-header-index.html">http://www.iana.org/assignments/message-headers/message-header-index.html</a></p>
</aside>
<aside class="footnote brackets" id="fsmtpauth" role="doc-footnote">
<span class="label"><span class="fn-bracket">[</span><a role="doc-backlink" href="#id24">12</a><span class="fn-bracket">]</span></span>
<p>During the last years, many Internet Service Providers, campus and enterprise networks have deployed SMTP extensions <span class="target" id="index-97"/><a class="rfc reference external" href="https://datatracker.ietf.org/doc/html/rfc4954.html"><strong>RFC 4954</strong></a> on their MSAs. These extensions force the MUAs to be authenticated before the MSA accepts an email message from the MUA.</p>
</aside>
<aside class="footnote brackets" id="fehlo" role="doc-footnote">
<span class="label"><span class="fn-bracket">[</span><a role="doc-backlink" href="#id25">13</a><span class="fn-bracket">]</span></span>
<p>The first versions of SMTP used <cite>HELO</cite> as the first command sent by a client to a SMTP server. When SMTP was extended to support newer features such as 8 bits characters, it was necessary to allow a server to recognize whether it was interacting with a client that supported the extensions or not. <cite>EHLO</cite> became mandatory with the publication of <span class="target" id="index-98"/><a class="rfc reference external" href="https://datatracker.ietf.org/doc/html/rfc2821.html"><strong>RFC 2821</strong></a>.</p>
</aside>
<aside class="footnote brackets" id="fdot" role="doc-footnote">
<span class="label"><span class="fn-bracket">[</span><a role="doc-backlink" href="#id26">14</a><span class="fn-bracket">]</span></span>
<p>This implies that a valid email message cannot contain a line with one dot followed by <cite>CR</cite> and <cite>LF</cite>. If a user types such a line in an email, his email client will automatically add a space character before or after the dot when sending the message over SMTP.</p>
</aside>
<aside class="footnote brackets" id="fapop" role="doc-footnote">
<span class="label"><span class="fn-bracket">[</span><a role="doc-backlink" href="#id27">15</a><span class="fn-bracket">]</span></span>
<p><span class="target" id="index-99"/><a class="rfc reference external" href="https://datatracker.ietf.org/doc/html/rfc1939.html"><strong>RFC 1939</strong></a> defines the APOP authentication scheme that is not vulnerable to such attacks.</p>
</aside>
<aside class="footnote brackets" id="furiretrieve" role="doc-footnote">
<span class="label"><span class="fn-bracket">[</span><a role="doc-backlink" href="#id32">16</a><span class="fn-bracket">]</span></span>
<p>An example of a non-retrievable URI is <cite>urn:isbn:0-380-81593-1</cite> which is an unique identifier for a book, through the urn scheme (see <span class="target" id="index-100"/><a class="rfc reference external" href="https://datatracker.ietf.org/doc/html/rfc3187.html"><strong>RFC 3187</strong></a>). Of course, any URI can be made retrievable via a dedicated server or a new protocol but this one has no explicit protocol. Same thing for the scheme tag (see <span class="target" id="index-101"/><a class="rfc reference external" href="https://datatracker.ietf.org/doc/html/rfc4151.html"><strong>RFC 4151</strong></a>), often used in Web syndication (see <span class="target" id="index-102"/><a class="rfc reference external" href="https://datatracker.ietf.org/doc/html/rfc4287.html"><strong>RFC 4287</strong></a> about the Atom syndication format). Even when the scheme is retrievable (for instance with <cite>http</cite>), it is often used only as an identifier, not as a way to get a resource. See <a class="reference external" href="http://norman.walsh.name/2006/07/25/namesAndAddresses">http://norman.walsh.name/2006/07/25/namesAndAddresses</a> for a good explanation.</p>
</aside>
<aside class="footnote brackets" id="furilist" role="doc-footnote">
<span class="label"><span class="fn-bracket">[</span><a role="doc-backlink" href="#id33">17</a><span class="fn-bracket">]</span></span>
<p>The list of standard URI schemes is maintained by <a class="reference external" href="https://www.iana.org">IANA</a> at <a class="reference external" href="http://www.iana.org/assignments/uri-schemes.html">http://www.iana.org/assignments/uri-schemes.html</a></p>
</aside>
<aside class="footnote brackets" id="ffavicon" role="doc-footnote">
<span class="label"><span class="fn-bracket">[</span><a role="doc-backlink" href="#id35">18</a><span class="fn-bracket">]</span></span>
<p>Favorite icons are small icons that are used to represent web servers in the toolbar of Internet browsers. Microsoft added this feature in their browsers without taking into account the W3C standards. See <a class="reference external" href="http://www.w3.org/2005/10/howto-favicon">http://www.w3.org/2005/10/howto-favicon</a> for a discussion on how to cleanly support such favorite icons.</p>
</aside>
<aside class="footnote brackets" id="fpipelining" role="doc-footnote">
<span class="label"><span class="fn-bracket">[</span><a role="doc-backlink" href="#id39">19</a><span class="fn-bracket">]</span></span>
<p>See <a class="reference external" href="https://en.wikipedia.org/wiki/HTTP_pipelining">https://en.wikipedia.org/wiki/HTTP_pipelining</a> for additional information.</p>
</aside>
</aside>
    
</body>
</html>