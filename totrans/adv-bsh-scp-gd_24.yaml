- en: Chapter 19\. Here Documents
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: 原文：[https://tldp.org/LDP/abs/html/here-docs.html](https://tldp.org/LDP/abs/html/here-docs.html)
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: '|   |  **Here and now, boys.*'
  prefs: []
  type: TYPE_NORMAL
- en: '*--Aldous Huxley, *Island***  |'
  prefs: []
  type: TYPE_NORMAL
- en: A *here document* is a special-purpose code block. It uses a form of [I/O redirection](io-redirection.html#IOREDIRREF)
    to feed a command list to an interactive program or a command, such as [ftp](communications.html#FTPREF),
    [cat](basic.html#CATREF), or the *ex* text editor.
  prefs: []
  type: TYPE_NORMAL
- en: '|  [PRE0]  |'
  prefs: []
  type: TYPE_TB
- en: A *limit string* delineates (frames) the command list. The special symbol <<
    precedes the limit string. This has the effect of redirecting the output of a
    command block into the `stdin` of the program or command. It is similar to `**interactive-program
    < command-file**`, where `command-file` contains
  prefs: []
  type: TYPE_NORMAL
- en: '|  [PRE1]  |'
  prefs: []
  type: TYPE_TB
- en: 'The *here document* equivalent looks like this:'
  prefs: []
  type: TYPE_NORMAL
- en: '|  [PRE2]  |'
  prefs: []
  type: TYPE_TB
- en: Choose a *limit string* sufficiently unusual that it will not occur anywhere
    in the command list and confuse matters.
  prefs: []
  type: TYPE_NORMAL
- en: Note that *here documents* may sometimes be used to good effect with non-interactive
    utilities and commands, such as, for example, [wall](system.html#WALLREF).
  prefs: []
  type: TYPE_NORMAL
- en: '**Example 19-1\. *broadcast*: Sends message to everyone logged in**'
  prefs: []
  type: TYPE_NORMAL
- en: '|  [PRE3]  |'
  prefs: []
  type: TYPE_TB
- en: Even such unlikely candidates as the *vi* text editor lend themselves to *here
    documents*.
  prefs: []
  type: TYPE_NORMAL
- en: '**Example 19-2\. *dummyfile*: Creates a 2-line dummy file**'
  prefs: []
  type: TYPE_NORMAL
- en: '|  [PRE4]  |'
  prefs: []
  type: TYPE_TB
- en: The above script could just as effectively have been implemented with **ex**,
    rather than **vi**. *Here documents* containing a list of **ex** commands are
    common enough to form their own category, known as *ex scripts*.
  prefs: []
  type: TYPE_NORMAL
- en: '|  [PRE5]  |'
  prefs: []
  type: TYPE_TB
- en: Analogous to "ex scripts" are *cat scripts*.
  prefs: []
  type: TYPE_NORMAL
- en: '**Example 19-3\. Multi-line message using *cat***'
  prefs: []
  type: TYPE_NORMAL
- en: '|  [PRE6]  |'
  prefs: []
  type: TYPE_TB
- en: The `-` option to mark a here document limit string (`**<<-LimitString**`) suppresses
    leading tabs (but not spaces) in the output. This may be useful in making a script
    more readable.
  prefs: []
  type: TYPE_NORMAL
- en: '**Example 19-4\. Multi-line message, with tabs suppressed**'
  prefs: []
  type: TYPE_NORMAL
- en: '|  [PRE7]  |'
  prefs: []
  type: TYPE_TB
- en: A *here document* supports parameter and command substitution. It is therefore
    possible to pass different parameters to the body of the here document, changing
    its output accordingly.
  prefs: []
  type: TYPE_NORMAL
- en: '**Example 19-5\. Here document with replaceable parameters**'
  prefs: []
  type: TYPE_NORMAL
- en: '|  [PRE8]  |'
  prefs: []
  type: TYPE_TB
- en: This is a useful script containing a *here document* with parameter substitution.
  prefs: []
  type: TYPE_NORMAL
- en: '**Example 19-6\. Upload a file pair to *Sunsite* incoming directory**'
  prefs: []
  type: TYPE_NORMAL
- en: '|  [PRE9]  |'
  prefs: []
  type: TYPE_TB
- en: Quoting or escaping the "limit string" at the head of a here document disables
    parameter substitution within its body. The reason for this is that *quoting/escaping
    the limit string* effectively [escapes](escapingsection.html#ESCP) the $, `, and
    \ [special characters](special-chars.html#SCHARLIST), and causes them to be interpreted
    literally. (Thank you, Allen Halsey, for pointing this out.)
  prefs: []
  type: TYPE_NORMAL
- en: '**Example 19-7\. Parameter substitution turned off**'
  prefs: []
  type: TYPE_NORMAL
- en: '|  [PRE10]  |'
  prefs: []
  type: TYPE_TB
- en: Disabling parameter substitution permits outputting literal text. Generating
    scripts or even program code is one use for this.
  prefs: []
  type: TYPE_NORMAL
- en: '**Example 19-8\. A script that generates another script**'
  prefs: []
  type: TYPE_NORMAL
- en: '|  [PRE11]  |'
  prefs: []
  type: TYPE_TB
- en: It is possible to set a variable from the output of a here document. This is
    actually a devious form of [command substitution](commandsub.html#COMMANDSUBREF).
  prefs: []
  type: TYPE_NORMAL
- en: '|  [PRE12]  |'
  prefs: []
  type: TYPE_TB
- en: A here document can supply input to a function in the same script.
  prefs: []
  type: TYPE_NORMAL
- en: '**Example 19-9\. Here documents and functions**'
  prefs: []
  type: TYPE_NORMAL
- en: '|  [PRE13]  |'
  prefs: []
  type: TYPE_TB
- en: 'It is possible to use : as a dummy command accepting output from a here document.
    This, in effect, creates an "anonymous" here document.'
  prefs: []
  type: TYPE_NORMAL
- en: '**Example 19-10\. "Anonymous" Here Document**'
  prefs: []
  type: TYPE_NORMAL
- en: '|  [PRE14]  |'
  prefs: []
  type: TYPE_TB
- en: '| ![Tip](../Images/753d054f4c48fb039314a9e5947964cd.png) | A variation of the
    above technique permits "commenting out" blocks of code. |'
  prefs: []
  type: TYPE_TB
- en: '**Example 19-11\. Commenting out a block of code**'
  prefs: []
  type: TYPE_NORMAL
- en: '|  [PRE15]  |'
  prefs: []
  type: TYPE_TB
- en: '| ![Tip](../Images/753d054f4c48fb039314a9e5947964cd.png) | Yet another twist
    of this nifty trick makes "self-documenting" scripts possible. |'
  prefs: []
  type: TYPE_TB
- en: '**Example 19-12\. A self-documenting script**'
  prefs: []
  type: TYPE_NORMAL
- en: '|  [PRE16]  |'
  prefs: []
  type: TYPE_TB
- en: Using a [cat script](here-docs.html#CATSCRIPTREF) is an alternate way of accomplishing
    this.
  prefs: []
  type: TYPE_NORMAL
- en: '|  [PRE17]  |'
  prefs: []
  type: TYPE_TB
- en: See also [Example A-28](contributed-scripts.html#ISSPAMMER2), [Example A-40](contributed-scripts.html#PETALS),
    [Example A-41](contributed-scripts.html#QKY), and [Example A-42](contributed-scripts.html#NIM)
    for more examples of self-documenting scripts.
  prefs: []
  type: TYPE_NORMAL
- en: '| ![Note](../Images/068cd6dc5ba56f1437f9ae6e0cb52ede.png) | Here documents
    create temporary files, but these files are deleted after opening and are not
    accessible to any other process.'
  prefs: []
  type: TYPE_NORMAL
- en: '&#124;  [PRE18]  &#124;'
  prefs: []
  type: TYPE_NORMAL
- en: '|'
  prefs: []
  type: TYPE_NORMAL
- en: '| ![Caution](../Images/05aa79b283e0d53b5a94a522ee0b6cfe.png) | Some utilities
    will not work inside a *here document*. |'
  prefs: []
  type: TYPE_TB
- en: '| ![Warning](../Images/9d1b374742c319dd43bb1c5d95d6e008.png) | The closing
    *limit string*, on the final line of a here document, must start in the *first*
    character position. There can be *no leading whitespace*. Trailing whitespace
    after the limit string likewise causes unexpected behavior. The whitespace prevents
    the limit string from being recognized. [[1]](#FTN.AEN17822)'
  prefs: []
  type: TYPE_NORMAL
- en: '&#124;  [PRE19]  &#124;'
  prefs: []
  type: TYPE_NORMAL
- en: '|'
  prefs: []
  type: TYPE_NORMAL
- en: '| ![Caution](../Images/05aa79b283e0d53b5a94a522ee0b6cfe.png) | Some people
    very cleverly use a single ! as a limit string. But, that''s not necessarily a
    good idea.'
  prefs: []
  type: TYPE_NORMAL
- en: '&#124;  [PRE20]  &#124;'
  prefs: []
  type: TYPE_NORMAL
- en: '|'
  prefs: []
  type: TYPE_NORMAL
- en: For those tasks too complex for a *here document*, consider using the `*expect*`
    scripting language, which was specifically designed for feeding input into interactive
    programs.
  prefs: []
  type: TYPE_NORMAL
- en: Notes
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: '| [[1]](here-docs.html#AEN17822) | Except, as Dennis Benzinger points out,
    if [using **<<-** to suppress tabs](here-docs.html#LIMITSTRDASH). |'
  prefs: []
  type: TYPE_TB
