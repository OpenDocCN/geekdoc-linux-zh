- en: Chapter 19\. Here Documents
  id: totrans-0
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 第 19 章。Here 文档
- en: 原文：[https://tldp.org/LDP/abs/html/here-docs.html](https://tldp.org/LDP/abs/html/here-docs.html)
  id: totrans-1
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
  zh: 原文：[https://tldp.org/LDP/abs/html/here-docs.html](https://tldp.org/LDP/abs/html/here-docs.html)
- en: '|   |  **Here and now, boys.*'
  id: totrans-2
  prefs: []
  type: TYPE_NORMAL
  zh: '|    |  **现在就做，孩子们。**'
- en: '*--Aldous Huxley, *Island***  |'
  id: totrans-3
  prefs: []
  type: TYPE_NORMAL
  zh: '*--Aldous Huxley, *Island***  |'
- en: A *here document* is a special-purpose code block. It uses a form of [I/O redirection](io-redirection.html#IOREDIRREF)
    to feed a command list to an interactive program or a command, such as [ftp](communications.html#FTPREF),
    [cat](basic.html#CATREF), or the *ex* text editor.
  id: totrans-4
  prefs: []
  type: TYPE_NORMAL
  zh: '*here document* 是一种特殊用途的代码块。它使用一种 [I/O 重定向](io-redirection.html#IOREDIRREF)
    的形式将命令列表传递给交互式程序或命令，例如 [ftp](communications.html#FTPREF)、[cat](basic.html#CATREF)
    或 *ex* 文本编辑器。'
- en: '|  [PRE0]  |'
  id: totrans-5
  prefs: []
  type: TYPE_TB
  zh: '|  [PRE0]  |'
- en: A *limit string* delineates (frames) the command list. The special symbol <<
    precedes the limit string. This has the effect of redirecting the output of a
    command block into the `stdin` of the program or command. It is similar to `**interactive-program
    < command-file**`, where `command-file` contains
  id: totrans-6
  prefs: []
  type: TYPE_NORMAL
  zh: '*limit string* 界定了（框架）命令列表。特殊符号 << 在限制字符串之前。这具有将命令块输出重定向到程序或命令的 `stdin` 的效果。它类似于
    `**interactive-program < command-file**`，其中 `command-file` 包含'
- en: '|  [PRE1]  |'
  id: totrans-7
  prefs: []
  type: TYPE_TB
  zh: '|  [PRE1]  |'
- en: 'The *here document* equivalent looks like this:'
  id: totrans-8
  prefs: []
  type: TYPE_NORMAL
  zh: '*here document* 的等效形式如下所示：'
- en: '|  [PRE2]  |'
  id: totrans-9
  prefs: []
  type: TYPE_TB
  zh: '|  [PRE2]  |'
- en: Choose a *limit string* sufficiently unusual that it will not occur anywhere
    in the command list and confuse matters.
  id: totrans-10
  prefs: []
  type: TYPE_NORMAL
  zh: 选择一个足够不寻常的 *limit string*，这样它就不会出现在命令列表中并引起混淆。
- en: Note that *here documents* may sometimes be used to good effect with non-interactive
    utilities and commands, such as, for example, [wall](system.html#WALLREF).
  id: totrans-11
  prefs: []
  type: TYPE_NORMAL
  zh: 注意，*here document* 有时与非交互式实用程序和命令一起使用，效果很好，例如，例如 [wall](system.html#WALLREF)。
- en: '**Example 19-1\. *broadcast*: Sends message to everyone logged in**'
  id: totrans-12
  prefs: []
  type: TYPE_NORMAL
  zh: '**示例 19-1\. *广播*: 向所有登录用户发送消息**'
- en: '|  [PRE3]  |'
  id: totrans-13
  prefs: []
  type: TYPE_TB
  zh: '|  [PRE3]  |'
- en: Even such unlikely candidates as the *vi* text editor lend themselves to *here
    documents*.
  id: totrans-14
  prefs: []
  type: TYPE_NORMAL
  zh: 即使像 *vi* 文本编辑器这样的不太可能的候选者也适合使用 *here document*。
- en: '**Example 19-2\. *dummyfile*: Creates a 2-line dummy file**'
  id: totrans-15
  prefs: []
  type: TYPE_NORMAL
  zh: '**示例 19-2\. *dummyfile*: 创建一个两行的虚拟文件**'
- en: '|  [PRE4]  |'
  id: totrans-16
  prefs: []
  type: TYPE_TB
  zh: '|  [PRE4]  |'
- en: The above script could just as effectively have been implemented with **ex**,
    rather than **vi**. *Here documents* containing a list of **ex** commands are
    common enough to form their own category, known as *ex scripts*.
  id: totrans-17
  prefs: []
  type: TYPE_NORMAL
  zh: 上述脚本同样可以用 **ex** 实现，而不是 **vi**。包含 **ex** 命令列表的 *here document* 足够常见，可以形成一个自己的类别，称为
    *ex 脚本*。
- en: '|  [PRE5]  |'
  id: totrans-18
  prefs: []
  type: TYPE_TB
  zh: '|  [PRE5]  |'
- en: Analogous to "ex scripts" are *cat scripts*.
  id: totrans-19
  prefs: []
  type: TYPE_NORMAL
  zh: 与 "ex 脚本" 类似的是 *cat 脚本*。
- en: '**Example 19-3\. Multi-line message using *cat***'
  id: totrans-20
  prefs: []
  type: TYPE_NORMAL
  zh: '**示例 19-3\. 使用 *cat* 的多行消息**'
- en: '|  [PRE6]  |'
  id: totrans-21
  prefs: []
  type: TYPE_TB
  zh: '|  [PRE6]  |'
- en: The `-` option to mark a here document limit string (`**<<-LimitString**`) suppresses
    leading tabs (but not spaces) in the output. This may be useful in making a script
    more readable.
  id: totrans-22
  prefs: []
  type: TYPE_NORMAL
  zh: 用于标记 here 文档限制字符串的 `-` 选项 (`**<<-LimitString**`) 抑制输出中的前导制表符（但不包括空格）。这可能在使脚本更易读时很有用。
- en: '**Example 19-4\. Multi-line message, with tabs suppressed**'
  id: totrans-23
  prefs: []
  type: TYPE_NORMAL
  zh: '**示例 19-4\. 多行消息，抑制了制表符**'
- en: '|  [PRE7]  |'
  id: totrans-24
  prefs: []
  type: TYPE_TB
  zh: '|  [PRE7]  |'
- en: A *here document* supports parameter and command substitution. It is therefore
    possible to pass different parameters to the body of the here document, changing
    its output accordingly.
  id: totrans-25
  prefs: []
  type: TYPE_NORMAL
  zh: '*here document* 支持参数和命令替换。因此，可以将不同的参数传递给 *here document* 的主体，从而相应地改变其输出。'
- en: '**Example 19-5\. Here document with replaceable parameters**'
  id: totrans-26
  prefs: []
  type: TYPE_NORMAL
  zh: '**示例 19-5\. 带有可替换参数的 here 文档**'
- en: '|  [PRE8]  |'
  id: totrans-27
  prefs: []
  type: TYPE_TB
  zh: '|  [PRE8]  |'
- en: This is a useful script containing a *here document* with parameter substitution.
  id: totrans-28
  prefs: []
  type: TYPE_NORMAL
  zh: 这是一个有用的脚本，其中包含带有参数替换的 *here document*。
- en: '**Example 19-6\. Upload a file pair to *Sunsite* incoming directory**'
  id: totrans-29
  prefs: []
  type: TYPE_NORMAL
  zh: '**示例 19-6\. 将文件对上传到 *Sunsite* 入口目录**'
- en: '|  [PRE9]  |'
  id: totrans-30
  prefs: []
  type: TYPE_TB
  zh: '|  [PRE9]  |'
- en: Quoting or escaping the "limit string" at the head of a here document disables
    parameter substitution within its body. The reason for this is that *quoting/escaping
    the limit string* effectively [escapes](escapingsection.html#ESCP) the $, `, and
    \ [special characters](special-chars.html#SCHARLIST), and causes them to be interpreted
    literally. (Thank you, Allen Halsey, for pointing this out.)
  id: totrans-31
  prefs: []
  type: TYPE_NORMAL
  zh: 引用或转义 here 文档头部的 "limit string" 禁止其主体内的参数替换。原因是 *引用/转义 limit string* 有效地 [转义](escapingsection.html#ESCP)
    了 $、`、\ [特殊字符](special-chars.html#SCHARLIST)，并使它们被字面地解释。（感谢 Allen Halsey 指出这一点。）
- en: '**Example 19-7\. Parameter substitution turned off**'
  id: totrans-32
  prefs: []
  type: TYPE_NORMAL
  zh: '**示例 19-7\. 关闭参数替换**'
- en: '|  [PRE10]  |'
  id: totrans-33
  prefs: []
  type: TYPE_TB
  zh: '|  [PRE10]  |'
- en: Disabling parameter substitution permits outputting literal text. Generating
    scripts or even program code is one use for this.
  id: totrans-34
  prefs: []
  type: TYPE_NORMAL
  zh: 关闭参数替换允许输出文本。生成脚本甚至程序代码是这种用途之一。
- en: '**Example 19-8\. A script that generates another script**'
  id: totrans-35
  prefs: []
  type: TYPE_NORMAL
  zh: '**示例 19-8\. 生成另一个脚本的脚本**'
- en: '|  [PRE11]  |'
  id: totrans-36
  prefs: []
  type: TYPE_TB
  zh: '|  [PRE11]  |'
- en: It is possible to set a variable from the output of a here document. This is
    actually a devious form of [command substitution](commandsub.html#COMMANDSUBREF).
  id: totrans-37
  prefs: []
  type: TYPE_NORMAL
  zh: 可以从 *here document* 的输出中设置变量。这实际上是一种[命令替换](commandsub.html#COMMANDSUBREF)的狡猾形式。
- en: '|  [PRE12]  |'
  id: totrans-38
  prefs: []
  type: TYPE_TB
  zh: '|  [PRE12]  |'
- en: A here document can supply input to a function in the same script.
  id: totrans-39
  prefs: []
  type: TYPE_NORMAL
  zh: '*here document* 可以向同一脚本中的函数提供输入。'
- en: '**Example 19-9\. Here documents and functions**'
  id: totrans-40
  prefs: []
  type: TYPE_NORMAL
  zh: '**示例 19-9\. Here documents 和函数**'
- en: '|  [PRE13]  |'
  id: totrans-41
  prefs: []
  type: TYPE_TB
  zh: '|  [PRE13]  |'
- en: 'It is possible to use : as a dummy command accepting output from a here document.
    This, in effect, creates an "anonymous" here document.'
  id: totrans-42
  prefs: []
  type: TYPE_NORMAL
  zh: '可以使用 : 作为接受 *here document* 输出的虚拟命令。这实际上创建了一个 "匿名" *here document*。'
- en: '**Example 19-10\. "Anonymous" Here Document**'
  id: totrans-43
  prefs: []
  type: TYPE_NORMAL
  zh: '**示例 19-10\. "匿名" Here Document**'
- en: '|  [PRE14]  |'
  id: totrans-44
  prefs: []
  type: TYPE_TB
  zh: '|  [PRE14]  |'
- en: '| ![Tip](../Images/753d054f4c48fb039314a9e5947964cd.png) | A variation of the
    above technique permits "commenting out" blocks of code. |'
  id: totrans-45
  prefs: []
  type: TYPE_TB
  zh: '| ![提示](../Images/753d054f4c48fb039314a9e5947964cd.png) | 上述技术的变体允许 "注释" 代码块。|'
- en: '**Example 19-11\. Commenting out a block of code**'
  id: totrans-46
  prefs: []
  type: TYPE_NORMAL
  zh: '**示例 19-11\. 注释代码块**'
- en: '|  [PRE15]  |'
  id: totrans-47
  prefs: []
  type: TYPE_TB
  zh: '|  [PRE15]  |'
- en: '| ![Tip](../Images/753d054f4c48fb039314a9e5947964cd.png) | Yet another twist
    of this nifty trick makes "self-documenting" scripts possible. |'
  id: totrans-48
  prefs: []
  type: TYPE_TB
  zh: '| ![提示](../Images/753d054f4c48fb039314a9e5947964cd.png) | 这个巧妙技巧的另一个变化使得 "自文档"
    脚本成为可能。|'
- en: '**Example 19-12\. A self-documenting script**'
  id: totrans-49
  prefs: []
  type: TYPE_NORMAL
  zh: '**示例 19-12\. 自文档脚本**'
- en: '|  [PRE16]  |'
  id: totrans-50
  prefs: []
  type: TYPE_TB
  zh: '|  [PRE16]  |'
- en: Using a [cat script](here-docs.html#CATSCRIPTREF) is an alternate way of accomplishing
    this.
  id: totrans-51
  prefs: []
  type: TYPE_NORMAL
  zh: 使用 [cat 脚本](here-docs.html#CATSCRIPTREF)是完成此任务的另一种方法。
- en: '|  [PRE17]  |'
  id: totrans-52
  prefs: []
  type: TYPE_TB
  zh: '|  [PRE17]  |'
- en: See also [Example A-28](contributed-scripts.html#ISSPAMMER2), [Example A-40](contributed-scripts.html#PETALS),
    [Example A-41](contributed-scripts.html#QKY), and [Example A-42](contributed-scripts.html#NIM)
    for more examples of self-documenting scripts.
  id: totrans-53
  prefs: []
  type: TYPE_NORMAL
  zh: 参见[示例 A-28](contributed-scripts.html#ISSPAMMER2)、[示例 A-40](contributed-scripts.html#PETALS)、[示例
    A-41](contributed-scripts.html#QKY)和[示例 A-42](contributed-scripts.html#NIM)以获取更多自文档脚本示例。
- en: '| ![Note](../Images/068cd6dc5ba56f1437f9ae6e0cb52ede.png) | Here documents
    create temporary files, but these files are deleted after opening and are not
    accessible to any other process.'
  id: totrans-54
  prefs: []
  type: TYPE_NORMAL
  zh: '| ![注意](../Images/068cd6dc5ba56f1437f9ae6e0cb52ede.png) | 在这里，文档会创建临时文件，但这些文件在打开后会被删除，并且无法被任何其他进程访问。'
- en: '&#124;  [PRE18]  &#124;'
  id: totrans-55
  prefs: []
  type: TYPE_NORMAL
  zh: '&#124;  [PRE18]  &#124;'
- en: '|'
  id: totrans-56
  prefs: []
  type: TYPE_NORMAL
  zh: '|'
- en: '| ![Caution](../Images/05aa79b283e0d53b5a94a522ee0b6cfe.png) | Some utilities
    will not work inside a *here document*. |'
  id: totrans-57
  prefs: []
  type: TYPE_TB
  zh: '| ![警告](../Images/05aa79b283e0d53b5a94a522ee0b6cfe.png) | 一些实用工具在 *here document*
    内部可能无法正常工作。|'
- en: '| ![Warning](../Images/9d1b374742c319dd43bb1c5d95d6e008.png) | The closing
    *limit string*, on the final line of a here document, must start in the *first*
    character position. There can be *no leading whitespace*. Trailing whitespace
    after the limit string likewise causes unexpected behavior. The whitespace prevents
    the limit string from being recognized. [[1]](#FTN.AEN17822)'
  id: totrans-58
  prefs: []
  type: TYPE_NORMAL
  zh: '| ![注意](../Images/9d1b374742c319dd43bb1c5d95d6e008.png) | 在 *here document*
    的最后一行中的 *限制字符串* 必须从 *第一个* 字符位置开始。*不能有前导空格*。限制字符串后面的空格同样会导致意外的行为。空格阻止了限制字符串被识别。[[1]](#FTN.AEN17822)|'
- en: '&#124;  [PRE19]  &#124;'
  id: totrans-59
  prefs: []
  type: TYPE_NORMAL
  zh: '&#124;  [PRE19]  &#124;'
- en: '|'
  id: totrans-60
  prefs: []
  type: TYPE_NORMAL
  zh: '|'
- en: '| ![Caution](../Images/05aa79b283e0d53b5a94a522ee0b6cfe.png) | Some people
    very cleverly use a single ! as a limit string. But, that''s not necessarily a
    good idea.'
  id: totrans-61
  prefs: []
  type: TYPE_NORMAL
  zh: '| ![警告](../Images/05aa79b283e0d53b5a94a522ee0b6cfe.png) | 有些人非常巧妙地使用单个 ! 作为限制字符串。但，这不一定是个好主意。|'
- en: '&#124;  [PRE20]  &#124;'
  id: totrans-62
  prefs: []
  type: TYPE_NORMAL
  zh: '&#124;  [PRE20]  &#124;'
- en: '|'
  id: totrans-63
  prefs: []
  type: TYPE_NORMAL
  zh: '|'
- en: For those tasks too complex for a *here document*, consider using the `*expect*`
    scripting language, which was specifically designed for feeding input into interactive
    programs.
  id: totrans-64
  prefs: []
  type: TYPE_NORMAL
  zh: 对于过于复杂的 *here document* 任务，考虑使用专门为向交互式程序输入输入而设计的 `*expect*` 脚本语言。
- en: Notes
  id: totrans-65
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 注意事项
- en: '| [[1]](here-docs.html#AEN17822) | Except, as Dennis Benzinger points out,
    if [using **<<-** to suppress tabs](here-docs.html#LIMITSTRDASH). |'
  id: totrans-66
  prefs: []
  type: TYPE_TB
  zh: '| [[1]](here-docs.html#AEN17822) | 除了，正如 Dennis Benzinger 指出的，如果[使用 **<<-**
    来抑制制表符](here-docs.html#LIMITSTRDASH)。|'
