<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xmlns:epub="http://www.idpf.org/2007/ops" xml:lang="en-US">
<head>
  <meta charset="utf-8" />
  <meta name="generator" content="pandoc" />
  <title>ch198.xhtml</title>
  <link rel="stylesheet" type="text/css" href="../styles/stylesheet1.css" />
</head>
<body epub:type="bodymatter">
<section id="libcurl__caches__md-_-_-caches" class="level1" data-number="197">
<h1 data-number="197">Caches</h1>
<p>libcurl caches different information in order to help subsequent transfers to perform faster. There are four key caches: DNS, connections, TLS sessions and CA certs.</p>
<p>When the multi interface is used, these caches are by default shared among all the easy handles that are added to that single multi handle, and when the easy interface is used they are kept within that handle.</p>
<p>You can instruct libcurl to share some of the caches with the <a href="ch257.xhtml#helpers__sharing__md">share interface</a>.</p>
<section id="libcurl__caches__md-_-_-dns-cache" class="level2" data-number="197.1">
<h2 data-number="197.1">DNS cache</h2>
<p>When libcurl resolves a hostname to one or more IP addresses, that is stored in the DNS cache so that subsequent transfers in the near term do not have to redo the same resolve again. A name resolve can easily take several hundred milliseconds and sometimes even much longer.</p>
<p>By default, each such hostname is stored in the cache for 60 seconds (changeable with <code>CURLOPT_DNS_CACHE_TIMEOUT</code>).</p>
<p>libcurl does in fact not usually know what the TTL (Time To Live) value is for DNS entries, as that is generally not exposed in the system function calls it uses for this purpose, so increasing this value come with a risk that libcurl keeps using stale addresses longer periods than necessary.</p>
</section>
<section id="libcurl__caches__md-_-_-connection-cache" class="level2" data-number="197.2">
<h2 data-number="197.2">Connection cache</h2>
<p>Also sometimes referred to as the connection pool. This is a collection of previously used connections that instead of being closed after use, are kept around alive so that subsequent transfers that are targeting the same host name and have several other checks also matching, can use them instead of creating a new connection.</p>
<p>A reused connection usually saves having to a DNS lookup, setting up a TCP connection, do a TLS handshake and more.</p>
<p>Connections are only reused if the name is identical. Even if two different hostnames resolve to the same IP addresses, they still always use two separate connections with libcurl.</p>
<p>Since the connection reuse is based on the hostname and the DNS resolve phase is entirely skipped when a connection is reused for a transfer, libcurl does not know the current state of the hostname in DNS as it can in fact change IP over time while the connection might survive and continue to get reused over the original IP address.</p>
<p>The size of the connection cache - the number of live connections to keep there - can be set with <code>CURLOPT_MAXCONNECTS</code> (default is 5) for easy handles and <code>CURLMOPT_MAXCONNECTS</code> for multi handles. The default size for multi handles is 4 times the number of easy handles added.</p>
</section>
<section id="libcurl__caches__md-_-_-tls-session-cache" class="level2" data-number="197.3">
<h2 data-number="197.3">TLS session cache</h2>
<p>TLS session IDs and tickets are special TLS mechanisms that a client can pass to a server to shortcut subsequent TLS handshakes to a server it previously established a connection to.</p>
<p>libcurl caches session IDs and tickets associated with hostnames and port numbers, so if a subsequent connection attempt is made to a host for which libcurl has a cached ID or ticket, using that can greatly decrease the TLS handshake process and therefore the time needed until completion.</p>
</section>
<section id="libcurl__caches__md-_-_-ca-cert-cache" class="level2" data-number="197.4">
<h2 data-number="197.4">CA cert cache</h2>
<p>With some of the TLS backends curl supports (OpenSSL and Schannel), it builds a CA cert store cache in memory and keeps it there for subsequent transfers to use. This lets transfers skip unnecessary loading and parsing time that comes from loading and handling the sometimes rather big CA cert bundles.</p>
<p>Since the CA cert bundle might be updated, the life-time of the cache is by default set to 24 hours so that long-running applications will flush the cache and reload the file at least once every day - to be able to load and use a new version of the store.</p>
<p>Applications can change the CA cert cache timeout with the <code>CURLOPT_CA_CACHE_TIMEOUT</code> option in case this default is not good enough.</p>
<p><span id="libcurl__performance__md"></span></p>
</section>
</section>
</body>
</html>
