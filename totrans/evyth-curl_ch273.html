<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xmlns:epub="http://www.idpf.org/2007/ops" xml:lang="en-US">
<head>
  <meta charset="utf-8" />
  <meta name="generator" content="pandoc" />
  <title>ch273.xhtml</title>
  <link rel="stylesheet" type="text/css" href="../styles/stylesheet1.css" />
</head>
<body epub:type="bodymatter">
<section id="helpers__ws__concept__md-_-_-concept" class="level1" data-number="272">
<h1 data-number="272">Concept</h1>
<p>A libcurl application can do WebSocket using one of these two different approaches below.</p>
<section id="helpers__ws__concept__md-_-_-sect-1-dot--the-callback-approach" class="level2" data-number="272.1">
<h2 data-number="272.1">1. The callback approach</h2>
<p>It can decide to use the regular <a href="ch213.xhtml#transfers__callbacks__write__md">write callback</a> to receive incoming data, and respond to that data in or outside of the callback with <code>curl_ws_send</code>. Thereby treating the entire session as a form of download from the server.</p>
<p>Within the write callback, an application can call <code>curl_ws_meta()</code> to retrieve information about the incoming WebSocket data.</p>
</section>
<section id="helpers__ws__concept__md-_-_-sect-2-dot--the-connect-only-approach" class="level2" data-number="272.2">
<h2 data-number="272.2">2. The connect-only approach</h2>
<p>The other way to do it, if using the write callback is not suitable, is to set <code>CURLOPT_CONNECT_ONLY</code> to the value <code>2L</code> and let libcurl do a transfer that only sets up the connection to the server, does the WebSocket upgrade and then is considered complete. After that <em>connect-only</em> transfer, the application can use <code>curl_ws_recv()</code> and <code>curl_ws_send()</code> to receive and send WebSocket data over the connection.</p>
</section>
<section id="helpers__ws__concept__md-_-_-upgrade-or-die" class="level2" data-number="272.3">
<h2 data-number="272.3">Upgrade or die</h2>
<p>Doing a transfer with a <code>ws://</code> or <code>wss://</code> URL implies that libcurl makes a successful upgrade to the WebSocket protocol or an error is returned. An HTTP 200 response code which for example is considered fine in a normal HTTP transfer is therefor considered an error when asking for a WebSocket transfer.</p>
</section>
<section id="helpers__ws__concept__md-_-_-automatic-pong" class="level2" data-number="272.4">
<h2 data-number="272.4">Automatic <code>PONG</code></h2>
<p>If not using <a href="ch273.xhtml#helpers__ws__options__md">raw mode</a>, libcurl automatically responds with the appropriate <code>PONG</code> response for incoming <code>PING</code> frames and does not expose them in the API.</p>
<p><span id="helpers__ws__options__md"></span></p>
</section>
</section>
</body>
</html>
