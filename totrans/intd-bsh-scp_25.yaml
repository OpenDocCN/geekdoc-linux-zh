- en: Common Bash Errors and Fixes
  id: totrans-0
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 常见Bash错误和修复
- en: Bash scripting is widely used for automation in Linux, but beginners often face
    errors that can be confusing. This chapter explains common Bash errors, why they
    occur, and how to fix them. Each explanation includes examples to make it easy
    to understand and apply in real scenarios.
  id: totrans-1
  prefs: []
  type: TYPE_NORMAL
  zh: Bash脚本在Linux自动化中广泛使用，但初学者经常遇到可能令人困惑的错误。本章解释了常见的Bash错误、它们发生的原因以及如何修复它们。每个说明都包括示例，以便于理解和在实际场景中应用。
- en: By learning these common mistakes, you can debug scripts faster, write cleaner
    code, and avoid repeated errors.
  id: totrans-2
  prefs: []
  type: TYPE_NORMAL
  zh: 通过学习这些常见错误，您可以更快地调试脚本，编写更干净的代码，并避免重复错误。
- en: 1\. Permission Denied
  id: totrans-3
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 1. 权限被拒绝
- en: 'Error:'
  id: totrans-4
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 错误：
- en: '[PRE0]'
  id: totrans-5
  prefs: []
  type: TYPE_PRE
  zh: '[PRE0]'
- en: 'Cause:'
  id: totrans-6
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 原因：
- en: The script file is not executable, which prevents the shell from running it.
  id: totrans-7
  prefs: []
  type: TYPE_NORMAL
  zh: 脚本文件不可执行，这阻止了shell运行它。
- en: 'Fix:'
  id: totrans-8
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 修复：
- en: 'Grant execute permission using:'
  id: totrans-9
  prefs: []
  type: TYPE_NORMAL
  zh: 使用以下方法授予执行权限：
- en: '[PRE1]'
  id: totrans-10
  prefs: []
  type: TYPE_PRE
  zh: '[PRE1]'
- en: 'Then run the script:'
  id: totrans-11
  prefs: []
  type: TYPE_NORMAL
  zh: 然后运行脚本：
- en: '[PRE2]'
  id: totrans-12
  prefs: []
  type: TYPE_PRE
  zh: '[PRE2]'
- en: 'Example:'
  id: totrans-13
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 示例：
- en: '[PRE3]'
  id: totrans-14
  prefs: []
  type: TYPE_PRE
  zh: '[PRE3]'
- en: Without `chmod +x`, running the script results in an error. After granting execute
    permission, the script runs successfully.
  id: totrans-15
  prefs: []
  type: TYPE_NORMAL
  zh: 没有使用`chmod +x`，运行脚本会导致错误。在授予执行权限后，脚本可以成功运行。
- en: '**Explanation:** Linux requires explicit permission to run scripts for security
    reasons. Always set execute permission before running a new script.'
  id: totrans-16
  prefs: []
  type: TYPE_NORMAL
  zh: '**说明：** Linux出于安全原因需要显式权限才能运行脚本。始终在运行新脚本之前设置执行权限。'
- en: 2\. Bad Interpreter or No Such File
  id: totrans-17
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 2. 错误的解释器或文件不存在
- en: 'Error:'
  id: totrans-18
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 错误：
- en: '[PRE4]'
  id: totrans-19
  prefs: []
  type: TYPE_PRE
  zh: '[PRE4]'
- en: 'Cause:'
  id: totrans-20
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 原因：
- en: This occurs when a script is created on Windows. Windows uses carriage return
    characters (`\r\n`) which Linux cannot read.
  id: totrans-21
  prefs: []
  type: TYPE_NORMAL
  zh: 这发生在脚本在Windows上创建时。Windows使用回车换行符（`\r\n`），Linux无法读取。
- en: 'Fix:'
  id: totrans-22
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 修复：
- en: 'Convert the file to Unix format:'
  id: totrans-23
  prefs: []
  type: TYPE_NORMAL
  zh: 将文件转换为Unix格式：
- en: '[PRE5]'
  id: totrans-24
  prefs: []
  type: TYPE_PRE
  zh: '[PRE5]'
- en: Or recreate the file using a Linux text editor such as **nano** or **vim**.
  id: totrans-25
  prefs: []
  type: TYPE_NORMAL
  zh: 或者使用Linux文本编辑器（如**nano**或**vim**）重新创建文件。
- en: '**Explanation:** The first line of a script (`#!/bin/bash`) tells the shell
    which interpreter to use. Extra Windows characters break this line, causing the
    error.'
  id: totrans-26
  prefs: []
  type: TYPE_NORMAL
  zh: '**说明：** 脚本的第一行（`#!/bin/bash`）告诉shell使用哪个解释器。额外的Windows字符会破坏这一行，导致错误。'
- en: 3\. Command Not Found
  id: totrans-27
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 3. 命令未找到
- en: 'Error:'
  id: totrans-28
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 错误：
- en: '[PRE6]'
  id: totrans-29
  prefs: []
  type: TYPE_PRE
  zh: '[PRE6]'
- en: 'Cause:'
  id: totrans-30
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 原因：
- en: The shell cannot locate the command or script. It might not be in the system
    PATH or is executed without specifying the path.
  id: totrans-31
  prefs: []
  type: TYPE_NORMAL
  zh: shell无法定位命令或脚本。它可能不在系统PATH中，或者未指定路径执行。
- en: 'Fix:'
  id: totrans-32
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 修复：
- en: 'Run the script from its current directory:'
  id: totrans-33
  prefs: []
  type: TYPE_NORMAL
  zh: 从其当前目录运行脚本：
- en: '[PRE7]'
  id: totrans-34
  prefs: []
  type: TYPE_PRE
  zh: '[PRE7]'
- en: 'Or add its directory to PATH:'
  id: totrans-35
  prefs: []
  type: TYPE_NORMAL
  zh: 或者将其目录添加到PATH中：
- en: '[PRE8]'
  id: totrans-36
  prefs: []
  type: TYPE_PRE
  zh: '[PRE8]'
- en: '**Explanation:** The shell searches for commands in directories listed in `$PATH`.
    Scripts outside these directories require an explicit path.'
  id: totrans-37
  prefs: []
  type: TYPE_NORMAL
  zh: '**说明：** shell在`$PATH`中列出的目录中搜索命令。这些目录之外的脚本需要显式路径。'
- en: 4\. Syntax Error Near Unexpected Token
  id: totrans-38
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 4. 在意外标记附近出现语法错误
- en: 'Error:'
  id: totrans-39
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 错误：
- en: '[PRE9]'
  id: totrans-40
  prefs: []
  type: TYPE_PRE
  zh: '[PRE9]'
- en: 'Cause:'
  id: totrans-41
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 原因：
- en: A missing `then`, semicolon (`;`) , or incorrect control structure causes Bash
    to fail parsing the script.
  id: totrans-42
  prefs: []
  type: TYPE_NORMAL
  zh: 缺少`then`，分号（`;`）或控制结构不正确会导致Bash无法解析脚本。
- en: 'Fix:'
  id: totrans-43
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 修复：
- en: Ensure correct syntax for conditional statements.
  id: totrans-44
  prefs: []
  type: TYPE_NORMAL
  zh: 确保条件语句的语法正确。
- en: '**Incorrect:**'
  id: totrans-45
  prefs: []
  type: TYPE_NORMAL
  zh: '**不正确：**'
- en: '[PRE10]'
  id: totrans-46
  prefs: []
  type: TYPE_PRE
  zh: '[PRE10]'
- en: '**Correct:**'
  id: totrans-47
  prefs: []
  type: TYPE_NORMAL
  zh: '**正确：**'
- en: '[PRE11]'
  id: totrans-48
  prefs: []
  type: TYPE_PRE
  zh: '[PRE11]'
- en: '**Explanation:** Bash requires a specific structure for `if` statements: `[condition];
    then` followed by commands and closed with `fi`.'
  id: totrans-49
  prefs: []
  type: TYPE_NORMAL
  zh: '**说明：** Bash要求`if`语句具有特定的结构：`[条件]; then`后跟命令，并以`fi`结束。'
- en: 5\. Unexpected End of File (EOF)
  id: totrans-50
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 5. 预期文件结束（EOF）
- en: 'Error:'
  id: totrans-51
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 错误：
- en: '[PRE12]'
  id: totrans-52
  prefs: []
  type: TYPE_PRE
  zh: '[PRE12]'
- en: 'Cause:'
  id: totrans-53
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 原因：
- en: A block (like `if`, `for`, or `while`) or a quote is not properly closed.
  id: totrans-54
  prefs: []
  type: TYPE_NORMAL
  zh: 块（如`if`、`for`或`while`）或引号未正确关闭。
- en: 'Example:'
  id: totrans-55
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 示例：
- en: '**Incorrect:**'
  id: totrans-56
  prefs: []
  type: TYPE_NORMAL
  zh: '**不正确：**'
- en: '[PRE13]'
  id: totrans-57
  prefs: []
  type: TYPE_PRE
  zh: '[PRE13]'
- en: '**Correct:**'
  id: totrans-58
  prefs: []
  type: TYPE_NORMAL
  zh: '**正确：**'
- en: '[PRE14]'
  id: totrans-59
  prefs: []
  type: TYPE_PRE
  zh: '[PRE14]'
- en: '**Explanation:** Every opening keyword like `if` or `for` must have a corresponding
    closing keyword (`fi, done`) for Bash to understand the block.'
  id: totrans-60
  prefs: []
  type: TYPE_NORMAL
  zh: '**说明：** 每个开关键词（如`if`或`for`）都必须有一个相应的关闭关键词（`fi, done`），以便Bash理解代码块。'
- en: 6\. Variable Not Expanding
  id: totrans-61
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 6. 变量未展开
- en: 'Issue:'
  id: totrans-62
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 问题：
- en: A variable prints empty or does not display its value.
  id: totrans-63
  prefs: []
  type: TYPE_NORMAL
  zh: 变量打印空或未显示其值。
- en: 'Cause:'
  id: totrans-64
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 原因：
- en: The variable is not initialized or not exported correctly.
  id: totrans-65
  prefs: []
  type: TYPE_NORMAL
  zh: 变量未初始化或未正确导出。
- en: 'Fix:'
  id: totrans-66
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 修复：
- en: '[PRE15]'
  id: totrans-67
  prefs: []
  type: TYPE_PRE
  zh: '[PRE15]'
- en: '**Explanation:** Variables must be assigned a value before usage. Otherwise,
    Bash prints nothing.'
  id: totrans-68
  prefs: []
  type: TYPE_NORMAL
  zh: '**说明：** 变量在使用之前必须赋值。否则，Bash不会打印任何内容。'
- en: 7\. Integer Expression Expected
  id: totrans-69
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 7. 预期整数表达式
- en: 'Error:'
  id: totrans-70
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 错误：
- en: '[PRE16]'
  id: totrans-71
  prefs: []
  type: TYPE_PRE
  zh: '[PRE16]'
- en: 'Cause:'
  id: totrans-72
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 原因：
- en: A non-numeric value is used in an arithmetic comparison.
  id: totrans-73
  prefs: []
  type: TYPE_NORMAL
  zh: 在算术比较中使用非数值值。
- en: 'Fix:'
  id: totrans-74
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 修复：
- en: '[PRE17]'
  id: totrans-75
  prefs: []
  type: TYPE_PRE
  zh: '[PRE17]'
- en: '**Explanation:** Bash arithmetic comparisons work only with integers. Make
    sure the variable contains a number.'
  id: totrans-76
  prefs: []
  type: TYPE_NORMAL
  zh: '**说明：** Bash的算术比较只适用于整数。请确保变量包含一个数字。'
- en: 8\. Bad Substitution
  id: totrans-77
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 8. 错误替换
- en: 'Error:'
  id: totrans-78
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 错误：
- en: '[PRE18]'
  id: totrans-79
  prefs: []
  type: TYPE_PRE
  zh: '[PRE18]'
- en: 'Cause:'
  id: totrans-80
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 原因：
- en: Bash-specific syntax is used in a shell that does not support it (like `sh`).
  id: totrans-81
  prefs: []
  type: TYPE_NORMAL
  zh: 在不支持Bash特定语法的shell中使用（如`sh`）。
- en: 'Fix:'
  id: totrans-82
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 修复：
- en: 'Run the script with Bash explicitly:'
  id: totrans-83
  prefs: []
  type: TYPE_NORMAL
  zh: 明确使用Bash运行脚本：
- en: '[PRE19]'
  id: totrans-84
  prefs: []
  type: TYPE_PRE
  zh: '[PRE19]'
- en: '**Explanation:** Not all shells support Bash extensions. Always use Bash when
    using advanced syntax.'
  id: totrans-85
  prefs: []
  type: TYPE_NORMAL
  zh: '**解释：** 并非所有shell都支持Bash扩展。在使用高级语法时始终使用Bash。'
- en: 9\. File Redirection Permission Denied
  id: totrans-86
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 9. 文件重定向权限被拒绝
- en: 'Error:'
  id: totrans-87
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 错误：
- en: '[PRE20]'
  id: totrans-88
  prefs: []
  type: TYPE_PRE
  zh: '[PRE20]'
- en: 'Cause:'
  id: totrans-89
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 原因：
- en: The user does not have permission to write to the file or directory.
  id: totrans-90
  prefs: []
  type: TYPE_NORMAL
  zh: 用户没有权限写入文件或目录。
- en: 'Fix:'
  id: totrans-91
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 解决方法：
- en: 'Redirect output to a writable location:'
  id: totrans-92
  prefs: []
  type: TYPE_NORMAL
  zh: 将输出重定向到可写位置：
- en: '[PRE21]'
  id: totrans-93
  prefs: []
  type: TYPE_PRE
  zh: '[PRE21]'
- en: 'Or run with elevated permissions:'
  id: totrans-94
  prefs: []
  type: TYPE_NORMAL
  zh: 或者以提升的权限运行：
- en: '[PRE22]'
  id: totrans-95
  prefs: []
  type: TYPE_PRE
  zh: '[PRE22]'
- en: '**Explanation:** Linux enforces strict file permissions. Writing to protected
    directories requires proper rights.'
  id: totrans-96
  prefs: []
  type: TYPE_NORMAL
  zh: '**解释：** Linux强制执行严格的文件权限。向受保护的目录写入需要适当的权限。'
- en: 10\. Script Not Found
  id: totrans-97
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 10. 脚本未找到
- en: 'Error:'
  id: totrans-98
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 错误：
- en: '[PRE23]'
  id: totrans-99
  prefs: []
  type: TYPE_PRE
  zh: '[PRE23]'
- en: 'Cause:'
  id: totrans-100
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 原因：
- en: The script is executed without specifying the relative or absolute path.
  id: totrans-101
  prefs: []
  type: TYPE_NORMAL
  zh: 脚本在没有指定相对或绝对路径的情况下执行。
- en: 'Fix:'
  id: totrans-102
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 解决方法：
- en: '[PRE24]'
  id: totrans-103
  prefs: []
  type: TYPE_PRE
  zh: '[PRE24]'
- en: 'Or provide full path:'
  id: totrans-104
  prefs: []
  type: TYPE_NORMAL
  zh: 或者提供完整路径：
- en: '[PRE25]'
  id: totrans-105
  prefs: []
  type: TYPE_PRE
  zh: '[PRE25]'
- en: '**Explanation:** Bash will only execute scripts it can locate. Use relative
    or absolute paths when needed.'
  id: totrans-106
  prefs: []
  type: TYPE_NORMAL
  zh: '**解释：** Bash只会执行它能够定位到的脚本。在需要时使用相对或绝对路径。'
- en: 'Practical Example: Loop Over Files'
  id: totrans-107
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 实际示例：遍历文件
- en: Beginners often write loops that process a directory itself instead of the files
    inside it. This is a logical mistake that runs without a syntax error but produces
    unexpected results.
  id: totrans-108
  prefs: []
  type: TYPE_NORMAL
  zh: 初学者经常编写将目录本身而不是目录内的文件作为处理对象的循环。这是一个逻辑错误，虽然不会产生语法错误，但会产生意外的结果。
- en: '**Incorrect:**'
  id: totrans-109
  prefs: []
  type: TYPE_NORMAL
  zh: '**错误：**'
- en: '[PRE26]'
  id: totrans-110
  prefs: []
  type: TYPE_PRE
  zh: '[PRE26]'
- en: 'Output:'
  id: totrans-111
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 输出：
- en: '[PRE27]'
  id: totrans-112
  prefs: []
  type: TYPE_PRE
  zh: '[PRE27]'
- en: '**Correct:**'
  id: totrans-113
  prefs: []
  type: TYPE_NORMAL
  zh: '**正确：**'
- en: '[PRE28]'
  id: totrans-114
  prefs: []
  type: TYPE_PRE
  zh: '[PRE28]'
- en: '**Explanation:** Adding `/*` ensures the loop iterates over each file inside
    the directory, rather than the directory itself.'
  id: totrans-115
  prefs: []
  type: TYPE_NORMAL
  zh: '**解释：** 添加`/*`确保循环遍历目录内的每个文件，而不是目录本身。'
- en: Debugging Tips
  id: totrans-116
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 调试技巧
- en: '`set -x` – Display each command before execution.'
  id: totrans-117
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`set -x` – 在执行前显示每个命令。'
- en: '`$?` – Check the exit status of the last command.'
  id: totrans-118
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`$?` – 检查上一个命令的退出状态。'
- en: '`bash -n script.sh` – Validate syntax without running the script.'
  id: totrans-119
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`bash -n script.sh` – 在不运行脚本的情况下验证语法。'
- en: '`bash -v script.sh` – Display commands as they execute.'
  id: totrans-120
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`bash -v script.sh` – 在执行时显示命令。'
- en: '`2> error.log` – Redirect errors to a file.'
  id: totrans-121
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`2> error.log` – 将错误重定向到文件。'
- en: '`trap ''echo "Error on line $LINENO"'' ERR` – Catch runtime errors with line
    numbers.'
  id: totrans-122
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`trap ''echo "Error on line $LINENO"'' ERR` – 捕获带有行号的运行时错误。'
- en: Key Takeaways
  id: totrans-123
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: '**要点总结**'
- en: 'Most common Bash errors result from:'
  id: totrans-124
  prefs: []
  type: TYPE_NORMAL
  zh: 最常见的Bash错误大多源于：
- en: Missing permissions
  id: totrans-125
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 缺少权限
- en: Syntax mistakes
  id: totrans-126
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 语法错误
- en: Unset variables
  id: totrans-127
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 未设置变量
- en: Running scripts with the wrong shell
  id: totrans-128
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 使用错误的shell运行脚本
- en: Understanding these errors and using debugging techniques will help you write
    reliable and maintainable Bash scripts.
  id: totrans-129
  prefs: []
  type: TYPE_NORMAL
  zh: 理解这些错误并使用调试技术将帮助你编写可靠且可维护的Bash脚本。
