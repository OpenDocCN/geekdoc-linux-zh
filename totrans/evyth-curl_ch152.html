<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xmlns:epub="http://www.idpf.org/2007/ops" xml:lang="en-US">
<head>
  <meta charset="utf-8" />
  <meta name="generator" content="pandoc" />
  <title>ch152.xhtml</title>
  <link rel="stylesheet" type="text/css" href="../styles/stylesheet1.css" />
</head>
<body epub:type="bodymatter">
<section id="http__conditionals__md-_-_-conditionals" class="level1" data-number="151">
<h1 data-number="151">Conditionals</h1>
<p>Sometimes users want to avoid downloading a file again if the same file maybe already has been downloaded the day before. This can be done by making the HTTP transfer conditioned on something. curl supports two different conditions: the file timestamp and etag.</p>
<section id="http__conditionals__md-_-_-check-by-modification-date" class="level2" data-number="151.1">
<h2 data-number="151.1">Check by modification date</h2>
<p>Download the file only if it is newer than a specific date with the use of the <code>-z</code> or <code>--time-cond</code> option:</p>
<pre><code>curl -z &quot;Jan 10, 2017&quot; https://example.com/file -O</code></pre>
<p>Or the reverse, get the file only if it is older than the specific time by prefixing the date with a dash:</p>
<pre><code>curl --time-cond &quot;-Jan 10, 2017&quot; https://example.com/file -O</code></pre>
<p>The date parser is liberal and accepts most formats you can write the date with, and you can also specify it complete with a time:</p>
<pre><code>curl --time-cond &quot;Sun, 12 Sep 2004 15:05:58 -0700&quot; \
  https://www.example.org/file.html</code></pre>
<p>The <code>-z</code> option can also extract and use the timestamp from a local file, which is handy to only download a file if it has been updated remotely:</p>
<pre><code>curl -z file.html https://example.com/file.html -O</code></pre>
<p>It is often useful to combine the use of <code>-z</code> with the <code>--remote-time</code> flag, which sets the time of the locally created file to the same timestamp as the remote file had:</p>
<pre><code>curl -z file.html -o file.html --remote-time https://example.com/file.html</code></pre>
</section>
<section id="http__conditionals__md-_-_-check-by-modification-of-content" class="level2" data-number="151.2">
<h2 data-number="151.2">Check by modification of content</h2>
<p>HTTP servers can return a specific <em>ETag</em> for a given resource version. If the resource at a given URL changes, a new Etag value must be generated, so a client knows that as long as the ETag remains the same, the content has not changed.</p>
<p>Using ETags, curl can check for remote updates without having to rely on times or file dates. It also then makes the check able to detect sub-second changes, which the timestamp based checks cannot.</p>
<p>Using curl you can download a remote file and save its ETag (if it provides any) in a separate cache by using the <code>--etag-save</code> command line option. Like this:</p>
<pre><code>curl --etag-save etags.txt https://example.com/file -o output</code></pre>
<p>A subsequent command line can then use that previously saved etag and make sure to only download the file again if it has changed, like this:</p>
<pre><code>curl --etag-compare etag.txt https://example.com/file -o output</code></pre>
<p>The two etag options can also be combined in the same command line, so that if the file actually was updated, curl would save the update ETag again in the file:</p>
<pre><code>curl --etag-compare etag.txt --etag-save etag.txt \
  https://example.com/file -o output</code></pre>
<p><span id="http__https__md"></span></p>
</section>
</section>
</body>
</html>
